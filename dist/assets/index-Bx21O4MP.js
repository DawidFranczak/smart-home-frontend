var Em=n=>{throw TypeError(n)};var Xc=(n,e,t)=>e.has(n)||Em("Cannot "+t);var b=(n,e,t)=>(Xc(n,e,"read from private field"),t?t.call(n):e.get(n)),ue=(n,e,t)=>e.has(n)?Em("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),J=(n,e,t,r)=>(Xc(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),ve=(n,e,t)=>(Xc(n,e,"access private method"),t);var ml=(n,e,t,r)=>({set _(i){J(n,e,i,t)},get _(){return b(n,e,r)}});function zy(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function Wy(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var qy={exports:{}},Ec={},Yy={exports:{}},xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wo=Symbol.for("react.element"),jT=Symbol.for("react.portal"),GT=Symbol.for("react.fragment"),VT=Symbol.for("react.strict_mode"),HT=Symbol.for("react.profiler"),KT=Symbol.for("react.provider"),zT=Symbol.for("react.context"),WT=Symbol.for("react.forward_ref"),qT=Symbol.for("react.suspense"),YT=Symbol.for("react.memo"),QT=Symbol.for("react.lazy"),Sm=Symbol.iterator;function XT(n){return n===null||typeof n!="object"?null:(n=Sm&&n[Sm]||n["@@iterator"],typeof n=="function"?n:null)}var Qy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Xy=Object.assign,Zy={};function _a(n,e,t){this.props=n,this.context=e,this.refs=Zy,this.updater=t||Qy}_a.prototype.isReactComponent={};_a.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};_a.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Jy(){}Jy.prototype=_a.prototype;function Mf(n,e,t){this.props=n,this.context=e,this.refs=Zy,this.updater=t||Qy}var Nf=Mf.prototype=new Jy;Nf.constructor=Mf;Xy(Nf,_a.prototype);Nf.isPureReactComponent=!0;var xm=Array.isArray,ev=Object.prototype.hasOwnProperty,Uf={current:null},tv={key:!0,ref:!0,__self:!0,__source:!0};function nv(n,e,t){var r,i={},s=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)ev.call(e,r)&&!tv.hasOwnProperty(r)&&(i[r]=e[r]);var o=arguments.length-2;if(o===1)i.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];i.children=l}if(n&&n.defaultProps)for(r in o=n.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return{$$typeof:Wo,type:n,key:s,ref:a,props:i,_owner:Uf.current}}function ZT(n,e){return{$$typeof:Wo,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function $f(n){return typeof n=="object"&&n!==null&&n.$$typeof===Wo}function JT(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Tm=/\/+/g;function Zc(n,e){return typeof n=="object"&&n!==null&&n.key!=null?JT(""+n.key):e.toString(36)}function lu(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case Wo:case jT:a=!0}}if(a)return a=n,i=i(a),n=r===""?"."+Zc(a,0):r,xm(i)?(t="",n!=null&&(t=n.replace(Tm,"$&/")+"/"),lu(i,e,t,"",function(u){return u})):i!=null&&($f(i)&&(i=ZT(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(Tm,"$&/")+"/")+n)),e.push(i)),1;if(a=0,r=r===""?".":r+":",xm(n))for(var o=0;o<n.length;o++){s=n[o];var l=r+Zc(s,o);a+=lu(s,e,t,l,i)}else if(l=XT(n),typeof l=="function")for(n=l.call(n),o=0;!(s=n.next()).done;)s=s.value,l=r+Zc(s,o++),a+=lu(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function pl(n,e,t){if(n==null)return n;var r=[],i=0;return lu(n,r,"","",function(s){return e.call(t,s,i++)}),r}function e1(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Bt={current:null},uu={transition:null},t1={ReactCurrentDispatcher:Bt,ReactCurrentBatchConfig:uu,ReactCurrentOwner:Uf};function rv(){throw Error("act(...) is not supported in production builds of React.")}xe.Children={map:pl,forEach:function(n,e,t){pl(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return pl(n,function(){e++}),e},toArray:function(n){return pl(n,function(e){return e})||[]},only:function(n){if(!$f(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};xe.Component=_a;xe.Fragment=GT;xe.Profiler=HT;xe.PureComponent=Mf;xe.StrictMode=VT;xe.Suspense=qT;xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=t1;xe.act=rv;xe.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Xy({},n.props),i=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=Uf.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(l in e)ev.call(e,l)&&!tv.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:Wo,type:n.type,key:i,ref:s,props:r,_owner:a}};xe.createContext=function(n){return n={$$typeof:zT,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:KT,_context:n},n.Consumer=n};xe.createElement=nv;xe.createFactory=function(n){var e=nv.bind(null,n);return e.type=n,e};xe.createRef=function(){return{current:null}};xe.forwardRef=function(n){return{$$typeof:WT,render:n}};xe.isValidElement=$f;xe.lazy=function(n){return{$$typeof:QT,_payload:{_status:-1,_result:n},_init:e1}};xe.memo=function(n,e){return{$$typeof:YT,type:n,compare:e===void 0?null:e}};xe.startTransition=function(n){var e=uu.transition;uu.transition={};try{n()}finally{uu.transition=e}};xe.unstable_act=rv;xe.useCallback=function(n,e){return Bt.current.useCallback(n,e)};xe.useContext=function(n){return Bt.current.useContext(n)};xe.useDebugValue=function(){};xe.useDeferredValue=function(n){return Bt.current.useDeferredValue(n)};xe.useEffect=function(n,e){return Bt.current.useEffect(n,e)};xe.useId=function(){return Bt.current.useId()};xe.useImperativeHandle=function(n,e,t){return Bt.current.useImperativeHandle(n,e,t)};xe.useInsertionEffect=function(n,e){return Bt.current.useInsertionEffect(n,e)};xe.useLayoutEffect=function(n,e){return Bt.current.useLayoutEffect(n,e)};xe.useMemo=function(n,e){return Bt.current.useMemo(n,e)};xe.useReducer=function(n,e,t){return Bt.current.useReducer(n,e,t)};xe.useRef=function(n){return Bt.current.useRef(n)};xe.useState=function(n){return Bt.current.useState(n)};xe.useSyncExternalStore=function(n,e,t){return Bt.current.useSyncExternalStore(n,e,t)};xe.useTransition=function(){return Bt.current.useTransition()};xe.version="18.3.1";Yy.exports=xe;var C=Yy.exports;const Bf=Wy(C),n1=zy({__proto__:null,default:Bf},[C]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r1=C,i1=Symbol.for("react.element"),s1=Symbol.for("react.fragment"),a1=Object.prototype.hasOwnProperty,o1=r1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l1={key:!0,ref:!0,__self:!0,__source:!0};function iv(n,e,t){var r,i={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)a1.call(e,r)&&!l1.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:i1,type:n,key:s,ref:a,props:i,_owner:o1.current}}Ec.Fragment=s1;Ec.jsx=iv;Ec.jsxs=iv;qy.exports=Ec;var x=qy.exports,sv={exports:{}},gn={},av={exports:{}},ov={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e($,F){var U=$.length;$.push(F);e:for(;0<U;){var Q=U-1>>>1,Y=$[Q];if(0<i(Y,F))$[Q]=F,$[U]=Y,U=Q;else break e}}function t($){return $.length===0?null:$[0]}function r($){if($.length===0)return null;var F=$[0],U=$.pop();if(U!==F){$[0]=U;e:for(var Q=0,Y=$.length,oe=Y>>>1;Q<oe;){var de=2*(Q+1)-1,pe=$[de],he=de+1,Fe=$[he];if(0>i(pe,U))he<Y&&0>i(Fe,pe)?($[Q]=Fe,$[he]=U,Q=he):($[Q]=pe,$[de]=U,Q=de);else if(he<Y&&0>i(Fe,U))$[Q]=Fe,$[he]=U,Q=he;else break e}}return F}function i($,F){var U=$.sortIndex-F.sortIndex;return U!==0?U:$.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,f=!1,g=!1,m=!1,p=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E($){for(var F=t(u);F!==null;){if(F.callback===null)r(u);else if(F.startTime<=$)r(u),F.sortIndex=F.expirationTime,e(l,F);else break;F=t(u)}}function _($){if(m=!1,E($),!g)if(t(l)!==null)g=!0,H(L);else{var F=t(u);F!==null&&X(_,F.startTime-$)}}function L($,F){g=!1,m&&(m=!1,y(T),T=-1),f=!0;var U=h;try{for(E(F),d=t(l);d!==null&&(!(d.expirationTime>F)||$&&!M());){var Q=d.callback;if(typeof Q=="function"){d.callback=null,h=d.priorityLevel;var Y=Q(d.expirationTime<=F);F=n.unstable_now(),typeof Y=="function"?d.callback=Y:d===t(l)&&r(l),E(F)}else r(l);d=t(l)}if(d!==null)var oe=!0;else{var de=t(u);de!==null&&X(_,de.startTime-F),oe=!1}return oe}finally{d=null,h=U,f=!1}}var R=!1,A=null,T=-1,w=5,I=-1;function M(){return!(n.unstable_now()-I<w)}function j(){if(A!==null){var $=n.unstable_now();I=$;var F=!0;try{F=A(!0,$)}finally{F?z():(R=!1,A=null)}}else R=!1}var z;if(typeof v=="function")z=function(){v(j)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,W=K.port2;K.port1.onmessage=j,z=function(){W.postMessage(null)}}else z=function(){p(j,0)};function H($){A=$,R||(R=!0,z())}function X($,F){T=p(function(){$(n.unstable_now())},F)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function($){$.callback=null},n.unstable_continueExecution=function(){g||f||(g=!0,H(L))},n.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<$?Math.floor(1e3/$):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function($){switch(h){case 1:case 2:case 3:var F=3;break;default:F=h}var U=h;h=F;try{return $()}finally{h=U}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function($,F){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var U=h;h=$;try{return F()}finally{h=U}},n.unstable_scheduleCallback=function($,F,U){var Q=n.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?Q+U:Q):U=Q,$){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=U+Y,$={id:c++,callback:F,priorityLevel:$,startTime:U,expirationTime:Y,sortIndex:-1},U>Q?($.sortIndex=U,e(u,$),t(l)===null&&$===t(u)&&(m?(y(T),T=-1):m=!0,X(_,U-Q))):($.sortIndex=Y,e(l,$),g||f||(g=!0,H(L))),$},n.unstable_shouldYield=M,n.unstable_wrapCallback=function($){var F=h;return function(){var U=h;h=F;try{return $.apply(this,arguments)}finally{h=U}}}})(ov);av.exports=ov;var u1=av.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c1=C,fn=u1;function V(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lv=new Set,mo={};function fs(n,e){da(n,e),da(n+"Capture",e)}function da(n,e){for(mo[n]=e,n=0;n<e.length;n++)lv.add(e[n])}var Or=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lh=Object.prototype.hasOwnProperty,d1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,_m={},Lm={};function h1(n){return lh.call(Lm,n)?!0:lh.call(_m,n)?!1:d1.test(n)?Lm[n]=!0:(_m[n]=!0,!1)}function f1(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function g1(n,e,t,r){if(e===null||typeof e>"u"||f1(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function jt(n,e,t,r,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var Rt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Rt[n]=new jt(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Rt[e]=new jt(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Rt[n]=new jt(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Rt[n]=new jt(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Rt[n]=new jt(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Rt[n]=new jt(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Rt[n]=new jt(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Rt[n]=new jt(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Rt[n]=new jt(n,5,!1,n.toLowerCase(),null,!1,!1)});var jf=/[\-:]([a-z])/g;function Gf(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(jf,Gf);Rt[e]=new jt(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(jf,Gf);Rt[e]=new jt(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(jf,Gf);Rt[e]=new jt(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Rt[n]=new jt(n,1,!1,n.toLowerCase(),null,!1,!1)});Rt.xlinkHref=new jt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Rt[n]=new jt(n,1,!1,n.toLowerCase(),null,!0,!0)});function Vf(n,e,t,r){var i=Rt.hasOwnProperty(e)?Rt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(g1(e,t,i,r)&&(t=null),r||i===null?h1(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var $r=c1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,yl=Symbol.for("react.element"),Rs=Symbol.for("react.portal"),Is=Symbol.for("react.fragment"),Hf=Symbol.for("react.strict_mode"),uh=Symbol.for("react.profiler"),uv=Symbol.for("react.provider"),cv=Symbol.for("react.context"),Kf=Symbol.for("react.forward_ref"),ch=Symbol.for("react.suspense"),dh=Symbol.for("react.suspense_list"),zf=Symbol.for("react.memo"),Xr=Symbol.for("react.lazy"),dv=Symbol.for("react.offscreen"),Am=Symbol.iterator;function ba(n){return n===null||typeof n!="object"?null:(n=Am&&n[Am]||n["@@iterator"],typeof n=="function"?n:null)}var Qe=Object.assign,Jc;function Wa(n){if(Jc===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Jc=e&&e[1]||""}return`
`+Jc+n}var ed=!1;function td(n,e){if(!n||ed)return"";ed=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||i[a]!==s[o]){var l=`
`+i[a].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=a&&0<=o);break}}}finally{ed=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Wa(n):""}function m1(n){switch(n.tag){case 5:return Wa(n.type);case 16:return Wa("Lazy");case 13:return Wa("Suspense");case 19:return Wa("SuspenseList");case 0:case 2:case 15:return n=td(n.type,!1),n;case 11:return n=td(n.type.render,!1),n;case 1:return n=td(n.type,!0),n;default:return""}}function hh(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Is:return"Fragment";case Rs:return"Portal";case uh:return"Profiler";case Hf:return"StrictMode";case ch:return"Suspense";case dh:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case cv:return(n.displayName||"Context")+".Consumer";case uv:return(n._context.displayName||"Context")+".Provider";case Kf:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case zf:return e=n.displayName||null,e!==null?e:hh(n.type)||"Memo";case Xr:e=n._payload,n=n._init;try{return hh(n(e))}catch{}}return null}function p1(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hh(e);case 8:return e===Hf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Li(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function hv(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function y1(n){var e=hv(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function vl(n){n._valueTracker||(n._valueTracker=y1(n))}function fv(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=hv(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ku(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function fh(n,e){var t=e.checked;return Qe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Rm(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Li(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function gv(n,e){e=e.checked,e!=null&&Vf(n,"checked",e,!1)}function gh(n,e){gv(n,e);var t=Li(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?mh(n,e.type,t):e.hasOwnProperty("defaultValue")&&mh(n,e.type,Li(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Im(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function mh(n,e,t){(e!=="number"||ku(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var qa=Array.isArray;function Gs(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Li(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function ph(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(V(91));return Qe({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function wm(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(V(92));if(qa(t)){if(1<t.length)throw Error(V(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Li(t)}}function mv(n,e){var t=Li(e.value),r=Li(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function Cm(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function pv(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function yh(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?pv(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var El,yv=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(El=El||document.createElement("div"),El.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=El.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function po(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var to={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},v1=["Webkit","ms","Moz","O"];Object.keys(to).forEach(function(n){v1.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),to[e]=to[n]})});function vv(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||to.hasOwnProperty(n)&&to[n]?(""+e).trim():e+"px"}function Ev(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=vv(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var E1=Qe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vh(n,e){if(e){if(E1[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(V(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(V(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(V(61))}if(e.style!=null&&typeof e.style!="object")throw Error(V(62))}}function Eh(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sh=null;function Wf(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var xh=null,Vs=null,Hs=null;function Dm(n){if(n=Qo(n)){if(typeof xh!="function")throw Error(V(280));var e=n.stateNode;e&&(e=Lc(e),xh(n.stateNode,n.type,e))}}function Sv(n){Vs?Hs?Hs.push(n):Hs=[n]:Vs=n}function xv(){if(Vs){var n=Vs,e=Hs;if(Hs=Vs=null,Dm(n),e)for(n=0;n<e.length;n++)Dm(e[n])}}function Tv(n,e){return n(e)}function _v(){}var nd=!1;function Lv(n,e,t){if(nd)return n(e,t);nd=!0;try{return Tv(n,e,t)}finally{nd=!1,(Vs!==null||Hs!==null)&&(_v(),xv())}}function yo(n,e){var t=n.stateNode;if(t===null)return null;var r=Lc(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(V(231,e,typeof t));return t}var Th=!1;if(Or)try{var ka={};Object.defineProperty(ka,"passive",{get:function(){Th=!0}}),window.addEventListener("test",ka,ka),window.removeEventListener("test",ka,ka)}catch{Th=!1}function S1(n,e,t,r,i,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var no=!1,Pu=null,Ou=!1,_h=null,x1={onError:function(n){no=!0,Pu=n}};function T1(n,e,t,r,i,s,a,o,l){no=!1,Pu=null,S1.apply(x1,arguments)}function _1(n,e,t,r,i,s,a,o,l){if(T1.apply(this,arguments),no){if(no){var u=Pu;no=!1,Pu=null}else throw Error(V(198));Ou||(Ou=!0,_h=u)}}function gs(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Av(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function bm(n){if(gs(n)!==n)throw Error(V(188))}function L1(n){var e=n.alternate;if(!e){if(e=gs(n),e===null)throw Error(V(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return bm(i),n;if(s===r)return bm(i),e;s=s.sibling}throw Error(V(188))}if(t.return!==r.return)t=i,r=s;else{for(var a=!1,o=i.child;o;){if(o===t){a=!0,t=i,r=s;break}if(o===r){a=!0,r=i,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,r=i;break}if(o===r){a=!0,r=s,t=i;break}o=o.sibling}if(!a)throw Error(V(189))}}if(t.alternate!==r)throw Error(V(190))}if(t.tag!==3)throw Error(V(188));return t.stateNode.current===t?n:e}function Rv(n){return n=L1(n),n!==null?Iv(n):null}function Iv(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Iv(n);if(e!==null)return e;n=n.sibling}return null}var wv=fn.unstable_scheduleCallback,km=fn.unstable_cancelCallback,A1=fn.unstable_shouldYield,R1=fn.unstable_requestPaint,at=fn.unstable_now,I1=fn.unstable_getCurrentPriorityLevel,qf=fn.unstable_ImmediatePriority,Cv=fn.unstable_UserBlockingPriority,Fu=fn.unstable_NormalPriority,w1=fn.unstable_LowPriority,Dv=fn.unstable_IdlePriority,Sc=null,ur=null;function C1(n){if(ur&&typeof ur.onCommitFiberRoot=="function")try{ur.onCommitFiberRoot(Sc,n,void 0,(n.current.flags&128)===128)}catch{}}var jn=Math.clz32?Math.clz32:k1,D1=Math.log,b1=Math.LN2;function k1(n){return n>>>=0,n===0?32:31-(D1(n)/b1|0)|0}var Sl=64,xl=4194304;function Ya(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Mu(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~i;o!==0?r=Ya(o):(s&=a,s!==0&&(r=Ya(s)))}else a=t&~i,a!==0?r=Ya(a):s!==0&&(r=Ya(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-jn(e),i=1<<t,r|=n[t],e&=~i;return r}function P1(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function O1(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var a=31-jn(s),o=1<<a,l=i[a];l===-1?(!(o&t)||o&r)&&(i[a]=P1(o,e)):l<=e&&(n.expiredLanes|=o),s&=~o}}function Lh(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function bv(){var n=Sl;return Sl<<=1,!(Sl&4194240)&&(Sl=64),n}function rd(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function qo(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-jn(e),n[e]=t}function F1(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-jn(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function Yf(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-jn(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var Pe=0;function kv(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Pv,Qf,Ov,Fv,Mv,Ah=!1,Tl=[],pi=null,yi=null,vi=null,vo=new Map,Eo=new Map,ti=[],M1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pm(n,e){switch(n){case"focusin":case"focusout":pi=null;break;case"dragenter":case"dragleave":yi=null;break;case"mouseover":case"mouseout":vi=null;break;case"pointerover":case"pointerout":vo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Eo.delete(e.pointerId)}}function Pa(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Qo(e),e!==null&&Qf(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function N1(n,e,t,r,i){switch(e){case"focusin":return pi=Pa(pi,n,e,t,r,i),!0;case"dragenter":return yi=Pa(yi,n,e,t,r,i),!0;case"mouseover":return vi=Pa(vi,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return vo.set(s,Pa(vo.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Eo.set(s,Pa(Eo.get(s)||null,n,e,t,r,i)),!0}return!1}function Nv(n){var e=Vi(n.target);if(e!==null){var t=gs(e);if(t!==null){if(e=t.tag,e===13){if(e=Av(t),e!==null){n.blockedOn=e,Mv(n.priority,function(){Ov(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function cu(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Rh(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Sh=r,t.target.dispatchEvent(r),Sh=null}else return e=Qo(t),e!==null&&Qf(e),n.blockedOn=t,!1;e.shift()}return!0}function Om(n,e,t){cu(n)&&t.delete(e)}function U1(){Ah=!1,pi!==null&&cu(pi)&&(pi=null),yi!==null&&cu(yi)&&(yi=null),vi!==null&&cu(vi)&&(vi=null),vo.forEach(Om),Eo.forEach(Om)}function Oa(n,e){n.blockedOn===e&&(n.blockedOn=null,Ah||(Ah=!0,fn.unstable_scheduleCallback(fn.unstable_NormalPriority,U1)))}function So(n){function e(i){return Oa(i,n)}if(0<Tl.length){Oa(Tl[0],n);for(var t=1;t<Tl.length;t++){var r=Tl[t];r.blockedOn===n&&(r.blockedOn=null)}}for(pi!==null&&Oa(pi,n),yi!==null&&Oa(yi,n),vi!==null&&Oa(vi,n),vo.forEach(e),Eo.forEach(e),t=0;t<ti.length;t++)r=ti[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<ti.length&&(t=ti[0],t.blockedOn===null);)Nv(t),t.blockedOn===null&&ti.shift()}var Ks=$r.ReactCurrentBatchConfig,Nu=!0;function $1(n,e,t,r){var i=Pe,s=Ks.transition;Ks.transition=null;try{Pe=1,Xf(n,e,t,r)}finally{Pe=i,Ks.transition=s}}function B1(n,e,t,r){var i=Pe,s=Ks.transition;Ks.transition=null;try{Pe=4,Xf(n,e,t,r)}finally{Pe=i,Ks.transition=s}}function Xf(n,e,t,r){if(Nu){var i=Rh(n,e,t,r);if(i===null)fd(n,e,r,Uu,t),Pm(n,r);else if(N1(i,n,e,t,r))r.stopPropagation();else if(Pm(n,r),e&4&&-1<M1.indexOf(n)){for(;i!==null;){var s=Qo(i);if(s!==null&&Pv(s),s=Rh(n,e,t,r),s===null&&fd(n,e,r,Uu,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else fd(n,e,r,null,t)}}var Uu=null;function Rh(n,e,t,r){if(Uu=null,n=Wf(r),n=Vi(n),n!==null)if(e=gs(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Av(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Uu=n,null}function Uv(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(I1()){case qf:return 1;case Cv:return 4;case Fu:case w1:return 16;case Dv:return 536870912;default:return 16}default:return 16}}var hi=null,Zf=null,du=null;function $v(){if(du)return du;var n,e=Zf,t=e.length,r,i="value"in hi?hi.value:hi.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var a=t-n;for(r=1;r<=a&&e[t-r]===i[s-r];r++);return du=i.slice(n,1<r?1-r:void 0)}function hu(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function _l(){return!0}function Fm(){return!1}function mn(n){function e(t,r,i,s,a){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?_l:Fm,this.isPropagationStopped=Fm,this}return Qe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=_l)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=_l)},persist:function(){},isPersistent:_l}),e}var La={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jf=mn(La),Yo=Qe({},La,{view:0,detail:0}),j1=mn(Yo),id,sd,Fa,xc=Qe({},Yo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eg,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Fa&&(Fa&&n.type==="mousemove"?(id=n.screenX-Fa.screenX,sd=n.screenY-Fa.screenY):sd=id=0,Fa=n),id)},movementY:function(n){return"movementY"in n?n.movementY:sd}}),Mm=mn(xc),G1=Qe({},xc,{dataTransfer:0}),V1=mn(G1),H1=Qe({},Yo,{relatedTarget:0}),ad=mn(H1),K1=Qe({},La,{animationName:0,elapsedTime:0,pseudoElement:0}),z1=mn(K1),W1=Qe({},La,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),q1=mn(W1),Y1=Qe({},La,{data:0}),Nm=mn(Y1),Q1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},X1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Z1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function J1(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Z1[n])?!!e[n]:!1}function eg(){return J1}var e_=Qe({},Yo,{key:function(n){if(n.key){var e=Q1[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=hu(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?X1[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eg,charCode:function(n){return n.type==="keypress"?hu(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?hu(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),t_=mn(e_),n_=Qe({},xc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Um=mn(n_),r_=Qe({},Yo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eg}),i_=mn(r_),s_=Qe({},La,{propertyName:0,elapsedTime:0,pseudoElement:0}),a_=mn(s_),o_=Qe({},xc,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),l_=mn(o_),u_=[9,13,27,32],tg=Or&&"CompositionEvent"in window,ro=null;Or&&"documentMode"in document&&(ro=document.documentMode);var c_=Or&&"TextEvent"in window&&!ro,Bv=Or&&(!tg||ro&&8<ro&&11>=ro),$m=" ",Bm=!1;function jv(n,e){switch(n){case"keyup":return u_.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gv(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ws=!1;function d_(n,e){switch(n){case"compositionend":return Gv(e);case"keypress":return e.which!==32?null:(Bm=!0,$m);case"textInput":return n=e.data,n===$m&&Bm?null:n;default:return null}}function h_(n,e){if(ws)return n==="compositionend"||!tg&&jv(n,e)?(n=$v(),du=Zf=hi=null,ws=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Bv&&e.locale!=="ko"?null:e.data;default:return null}}var f_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jm(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!f_[n.type]:e==="textarea"}function Vv(n,e,t,r){Sv(r),e=$u(e,"onChange"),0<e.length&&(t=new Jf("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var io=null,xo=null;function g_(n){eE(n,0)}function Tc(n){var e=bs(n);if(fv(e))return n}function m_(n,e){if(n==="change")return e}var Hv=!1;if(Or){var od;if(Or){var ld="oninput"in document;if(!ld){var Gm=document.createElement("div");Gm.setAttribute("oninput","return;"),ld=typeof Gm.oninput=="function"}od=ld}else od=!1;Hv=od&&(!document.documentMode||9<document.documentMode)}function Vm(){io&&(io.detachEvent("onpropertychange",Kv),xo=io=null)}function Kv(n){if(n.propertyName==="value"&&Tc(xo)){var e=[];Vv(e,xo,n,Wf(n)),Lv(g_,e)}}function p_(n,e,t){n==="focusin"?(Vm(),io=e,xo=t,io.attachEvent("onpropertychange",Kv)):n==="focusout"&&Vm()}function y_(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Tc(xo)}function v_(n,e){if(n==="click")return Tc(e)}function E_(n,e){if(n==="input"||n==="change")return Tc(e)}function S_(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Vn=typeof Object.is=="function"?Object.is:S_;function To(n,e){if(Vn(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!lh.call(e,i)||!Vn(n[i],e[i]))return!1}return!0}function Hm(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Km(n,e){var t=Hm(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Hm(t)}}function zv(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?zv(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function Wv(){for(var n=window,e=ku();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ku(n.document)}return e}function ng(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function x_(n){var e=Wv(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&zv(t.ownerDocument.documentElement,t)){if(r!==null&&ng(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=Km(t,s);var a=Km(t,r);i&&a&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var T_=Or&&"documentMode"in document&&11>=document.documentMode,Cs=null,Ih=null,so=null,wh=!1;function zm(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;wh||Cs==null||Cs!==ku(r)||(r=Cs,"selectionStart"in r&&ng(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),so&&To(so,r)||(so=r,r=$u(Ih,"onSelect"),0<r.length&&(e=new Jf("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Cs)))}function Ll(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Ds={animationend:Ll("Animation","AnimationEnd"),animationiteration:Ll("Animation","AnimationIteration"),animationstart:Ll("Animation","AnimationStart"),transitionend:Ll("Transition","TransitionEnd")},ud={},qv={};Or&&(qv=document.createElement("div").style,"AnimationEvent"in window||(delete Ds.animationend.animation,delete Ds.animationiteration.animation,delete Ds.animationstart.animation),"TransitionEvent"in window||delete Ds.transitionend.transition);function _c(n){if(ud[n])return ud[n];if(!Ds[n])return n;var e=Ds[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in qv)return ud[n]=e[t];return n}var Yv=_c("animationend"),Qv=_c("animationiteration"),Xv=_c("animationstart"),Zv=_c("transitionend"),Jv=new Map,Wm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Di(n,e){Jv.set(n,e),fs(e,[n])}for(var cd=0;cd<Wm.length;cd++){var dd=Wm[cd],__=dd.toLowerCase(),L_=dd[0].toUpperCase()+dd.slice(1);Di(__,"on"+L_)}Di(Yv,"onAnimationEnd");Di(Qv,"onAnimationIteration");Di(Xv,"onAnimationStart");Di("dblclick","onDoubleClick");Di("focusin","onFocus");Di("focusout","onBlur");Di(Zv,"onTransitionEnd");da("onMouseEnter",["mouseout","mouseover"]);da("onMouseLeave",["mouseout","mouseover"]);da("onPointerEnter",["pointerout","pointerover"]);da("onPointerLeave",["pointerout","pointerover"]);fs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fs("onBeforeInput",["compositionend","keypress","textInput","paste"]);fs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),A_=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qa));function qm(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,_1(r,e,void 0,n),n.currentTarget=null}function eE(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==s&&i.isPropagationStopped())break e;qm(i,o,u),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==s&&i.isPropagationStopped())break e;qm(i,o,u),s=l}}}if(Ou)throw n=_h,Ou=!1,_h=null,n}function Ge(n,e){var t=e[Ph];t===void 0&&(t=e[Ph]=new Set);var r=n+"__bubble";t.has(r)||(tE(e,n,2,!1),t.add(r))}function hd(n,e,t){var r=0;e&&(r|=4),tE(t,n,r,e)}var Al="_reactListening"+Math.random().toString(36).slice(2);function _o(n){if(!n[Al]){n[Al]=!0,lv.forEach(function(t){t!=="selectionchange"&&(A_.has(t)||hd(t,!1,n),hd(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Al]||(e[Al]=!0,hd("selectionchange",!1,e))}}function tE(n,e,t,r){switch(Uv(e)){case 1:var i=$1;break;case 4:i=B1;break;default:i=Xf}t=i.bind(null,e,t,n),i=void 0,!Th||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function fd(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===i||o.nodeType===8&&o.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;a=a.return}for(;o!==null;){if(a=Vi(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}Lv(function(){var u=s,c=Wf(t),d=[];e:{var h=Jv.get(n);if(h!==void 0){var f=Jf,g=n;switch(n){case"keypress":if(hu(t)===0)break e;case"keydown":case"keyup":f=t_;break;case"focusin":g="focus",f=ad;break;case"focusout":g="blur",f=ad;break;case"beforeblur":case"afterblur":f=ad;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=V1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=i_;break;case Yv:case Qv:case Xv:f=z1;break;case Zv:f=a_;break;case"scroll":f=j1;break;case"wheel":f=l_;break;case"copy":case"cut":case"paste":f=q1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Um}var m=(e&4)!==0,p=!m&&n==="scroll",y=m?h!==null?h+"Capture":null:h;m=[];for(var v=u,E;v!==null;){E=v;var _=E.stateNode;if(E.tag===5&&_!==null&&(E=_,y!==null&&(_=yo(v,y),_!=null&&m.push(Lo(v,_,E)))),p)break;v=v.return}0<m.length&&(h=new f(h,g,null,t,c),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",h&&t!==Sh&&(g=t.relatedTarget||t.fromElement)&&(Vi(g)||g[Fr]))break e;if((f||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,f?(g=t.relatedTarget||t.toElement,f=u,g=g?Vi(g):null,g!==null&&(p=gs(g),g!==p||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=u),f!==g)){if(m=Mm,_="onMouseLeave",y="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(m=Um,_="onPointerLeave",y="onPointerEnter",v="pointer"),p=f==null?h:bs(f),E=g==null?h:bs(g),h=new m(_,v+"leave",f,t,c),h.target=p,h.relatedTarget=E,_=null,Vi(c)===u&&(m=new m(y,v+"enter",g,t,c),m.target=E,m.relatedTarget=p,_=m),p=_,f&&g)t:{for(m=f,y=g,v=0,E=m;E;E=vs(E))v++;for(E=0,_=y;_;_=vs(_))E++;for(;0<v-E;)m=vs(m),v--;for(;0<E-v;)y=vs(y),E--;for(;v--;){if(m===y||y!==null&&m===y.alternate)break t;m=vs(m),y=vs(y)}m=null}else m=null;f!==null&&Ym(d,h,f,m,!1),g!==null&&p!==null&&Ym(d,p,g,m,!0)}}e:{if(h=u?bs(u):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var L=m_;else if(jm(h))if(Hv)L=E_;else{L=y_;var R=p_}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(L=v_);if(L&&(L=L(n,u))){Vv(d,L,t,c);break e}R&&R(n,h,u),n==="focusout"&&(R=h._wrapperState)&&R.controlled&&h.type==="number"&&mh(h,"number",h.value)}switch(R=u?bs(u):window,n){case"focusin":(jm(R)||R.contentEditable==="true")&&(Cs=R,Ih=u,so=null);break;case"focusout":so=Ih=Cs=null;break;case"mousedown":wh=!0;break;case"contextmenu":case"mouseup":case"dragend":wh=!1,zm(d,t,c);break;case"selectionchange":if(T_)break;case"keydown":case"keyup":zm(d,t,c)}var A;if(tg)e:{switch(n){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else ws?jv(n,t)&&(T="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(T="onCompositionStart");T&&(Bv&&t.locale!=="ko"&&(ws||T!=="onCompositionStart"?T==="onCompositionEnd"&&ws&&(A=$v()):(hi=c,Zf="value"in hi?hi.value:hi.textContent,ws=!0)),R=$u(u,T),0<R.length&&(T=new Nm(T,n,null,t,c),d.push({event:T,listeners:R}),A?T.data=A:(A=Gv(t),A!==null&&(T.data=A)))),(A=c_?d_(n,t):h_(n,t))&&(u=$u(u,"onBeforeInput"),0<u.length&&(c=new Nm("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=A))}eE(d,e)})}function Lo(n,e,t){return{instance:n,listener:e,currentTarget:t}}function $u(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=yo(n,t),s!=null&&r.unshift(Lo(n,s,i)),s=yo(n,e),s!=null&&r.push(Lo(n,s,i))),n=n.return}return r}function vs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ym(n,e,t,r,i){for(var s=e._reactName,a=[];t!==null&&t!==r;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,i?(l=yo(t,s),l!=null&&a.unshift(Lo(t,l,o))):i||(l=yo(t,s),l!=null&&a.push(Lo(t,l,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var R_=/\r\n?/g,I_=/\u0000|\uFFFD/g;function Qm(n){return(typeof n=="string"?n:""+n).replace(R_,`
`).replace(I_,"")}function Rl(n,e,t){if(e=Qm(e),Qm(n)!==e&&t)throw Error(V(425))}function Bu(){}var Ch=null,Dh=null;function bh(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var kh=typeof setTimeout=="function"?setTimeout:void 0,w_=typeof clearTimeout=="function"?clearTimeout:void 0,Xm=typeof Promise=="function"?Promise:void 0,C_=typeof queueMicrotask=="function"?queueMicrotask:typeof Xm<"u"?function(n){return Xm.resolve(null).then(n).catch(D_)}:kh;function D_(n){setTimeout(function(){throw n})}function gd(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),So(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);So(e)}function Ei(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function Zm(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Aa=Math.random().toString(36).slice(2),ir="__reactFiber$"+Aa,Ao="__reactProps$"+Aa,Fr="__reactContainer$"+Aa,Ph="__reactEvents$"+Aa,b_="__reactListeners$"+Aa,k_="__reactHandles$"+Aa;function Vi(n){var e=n[ir];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Fr]||t[ir]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=Zm(n);n!==null;){if(t=n[ir])return t;n=Zm(n)}return e}n=t,t=n.parentNode}return null}function Qo(n){return n=n[ir]||n[Fr],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function bs(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(V(33))}function Lc(n){return n[Ao]||null}var Oh=[],ks=-1;function bi(n){return{current:n}}function Ve(n){0>ks||(n.current=Oh[ks],Oh[ks]=null,ks--)}function Be(n,e){ks++,Oh[ks]=n.current,n.current=e}var Ai={},kt=bi(Ai),qt=bi(!1),rs=Ai;function ha(n,e){var t=n.type.contextTypes;if(!t)return Ai;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Yt(n){return n=n.childContextTypes,n!=null}function ju(){Ve(qt),Ve(kt)}function Jm(n,e,t){if(kt.current!==Ai)throw Error(V(168));Be(kt,e),Be(qt,t)}function nE(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(V(108,p1(n)||"Unknown",i));return Qe({},t,r)}function Gu(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ai,rs=kt.current,Be(kt,n),Be(qt,qt.current),!0}function ep(n,e,t){var r=n.stateNode;if(!r)throw Error(V(169));t?(n=nE(n,e,rs),r.__reactInternalMemoizedMergedChildContext=n,Ve(qt),Ve(kt),Be(kt,n)):Ve(qt),Be(qt,t)}var wr=null,Ac=!1,md=!1;function rE(n){wr===null?wr=[n]:wr.push(n)}function P_(n){Ac=!0,rE(n)}function ki(){if(!md&&wr!==null){md=!0;var n=0,e=Pe;try{var t=wr;for(Pe=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}wr=null,Ac=!1}catch(i){throw wr!==null&&(wr=wr.slice(n+1)),wv(qf,ki),i}finally{Pe=e,md=!1}}return null}var Ps=[],Os=0,Vu=null,Hu=0,xn=[],Tn=0,is=null,Dr=1,br="";function $i(n,e){Ps[Os++]=Hu,Ps[Os++]=Vu,Vu=n,Hu=e}function iE(n,e,t){xn[Tn++]=Dr,xn[Tn++]=br,xn[Tn++]=is,is=n;var r=Dr;n=br;var i=32-jn(r)-1;r&=~(1<<i),t+=1;var s=32-jn(e)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Dr=1<<32-jn(e)+i|t<<i|r,br=s+n}else Dr=1<<s|t<<i|r,br=n}function rg(n){n.return!==null&&($i(n,1),iE(n,1,0))}function ig(n){for(;n===Vu;)Vu=Ps[--Os],Ps[Os]=null,Hu=Ps[--Os],Ps[Os]=null;for(;n===is;)is=xn[--Tn],xn[Tn]=null,br=xn[--Tn],xn[Tn]=null,Dr=xn[--Tn],xn[Tn]=null}var cn=null,ln=null,He=!1,Un=null;function sE(n,e){var t=_n(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function tp(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,cn=n,ln=Ei(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,cn=n,ln=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=is!==null?{id:Dr,overflow:br}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=_n(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,cn=n,ln=null,!0):!1;default:return!1}}function Fh(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Mh(n){if(He){var e=ln;if(e){var t=e;if(!tp(n,e)){if(Fh(n))throw Error(V(418));e=Ei(t.nextSibling);var r=cn;e&&tp(n,e)?sE(r,t):(n.flags=n.flags&-4097|2,He=!1,cn=n)}}else{if(Fh(n))throw Error(V(418));n.flags=n.flags&-4097|2,He=!1,cn=n}}}function np(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;cn=n}function Il(n){if(n!==cn)return!1;if(!He)return np(n),He=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!bh(n.type,n.memoizedProps)),e&&(e=ln)){if(Fh(n))throw aE(),Error(V(418));for(;e;)sE(n,e),e=Ei(e.nextSibling)}if(np(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(V(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ln=Ei(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ln=null}}else ln=cn?Ei(n.stateNode.nextSibling):null;return!0}function aE(){for(var n=ln;n;)n=Ei(n.nextSibling)}function fa(){ln=cn=null,He=!1}function sg(n){Un===null?Un=[n]:Un.push(n)}var O_=$r.ReactCurrentBatchConfig;function Ma(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(V(309));var r=t.stateNode}if(!r)throw Error(V(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=i.refs;a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof n!="string")throw Error(V(284));if(!t._owner)throw Error(V(290,n))}return n}function wl(n,e){throw n=Object.prototype.toString.call(e),Error(V(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function rp(n){var e=n._init;return e(n._payload)}function oE(n){function e(y,v){if(n){var E=y.deletions;E===null?(y.deletions=[v],y.flags|=16):E.push(v)}}function t(y,v){if(!n)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function r(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function i(y,v){return y=_i(y,v),y.index=0,y.sibling=null,y}function s(y,v,E){return y.index=E,n?(E=y.alternate,E!==null?(E=E.index,E<v?(y.flags|=2,v):E):(y.flags|=2,v)):(y.flags|=1048576,v)}function a(y){return n&&y.alternate===null&&(y.flags|=2),y}function o(y,v,E,_){return v===null||v.tag!==6?(v=Td(E,y.mode,_),v.return=y,v):(v=i(v,E),v.return=y,v)}function l(y,v,E,_){var L=E.type;return L===Is?c(y,v,E.props.children,_,E.key):v!==null&&(v.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===Xr&&rp(L)===v.type)?(_=i(v,E.props),_.ref=Ma(y,v,E),_.return=y,_):(_=Eu(E.type,E.key,E.props,null,y.mode,_),_.ref=Ma(y,v,E),_.return=y,_)}function u(y,v,E,_){return v===null||v.tag!==4||v.stateNode.containerInfo!==E.containerInfo||v.stateNode.implementation!==E.implementation?(v=_d(E,y.mode,_),v.return=y,v):(v=i(v,E.children||[]),v.return=y,v)}function c(y,v,E,_,L){return v===null||v.tag!==7?(v=ts(E,y.mode,_,L),v.return=y,v):(v=i(v,E),v.return=y,v)}function d(y,v,E){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Td(""+v,y.mode,E),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case yl:return E=Eu(v.type,v.key,v.props,null,y.mode,E),E.ref=Ma(y,null,v),E.return=y,E;case Rs:return v=_d(v,y.mode,E),v.return=y,v;case Xr:var _=v._init;return d(y,_(v._payload),E)}if(qa(v)||ba(v))return v=ts(v,y.mode,E,null),v.return=y,v;wl(y,v)}return null}function h(y,v,E,_){var L=v!==null?v.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return L!==null?null:o(y,v,""+E,_);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case yl:return E.key===L?l(y,v,E,_):null;case Rs:return E.key===L?u(y,v,E,_):null;case Xr:return L=E._init,h(y,v,L(E._payload),_)}if(qa(E)||ba(E))return L!==null?null:c(y,v,E,_,null);wl(y,E)}return null}function f(y,v,E,_,L){if(typeof _=="string"&&_!==""||typeof _=="number")return y=y.get(E)||null,o(v,y,""+_,L);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case yl:return y=y.get(_.key===null?E:_.key)||null,l(v,y,_,L);case Rs:return y=y.get(_.key===null?E:_.key)||null,u(v,y,_,L);case Xr:var R=_._init;return f(y,v,E,R(_._payload),L)}if(qa(_)||ba(_))return y=y.get(E)||null,c(v,y,_,L,null);wl(v,_)}return null}function g(y,v,E,_){for(var L=null,R=null,A=v,T=v=0,w=null;A!==null&&T<E.length;T++){A.index>T?(w=A,A=null):w=A.sibling;var I=h(y,A,E[T],_);if(I===null){A===null&&(A=w);break}n&&A&&I.alternate===null&&e(y,A),v=s(I,v,T),R===null?L=I:R.sibling=I,R=I,A=w}if(T===E.length)return t(y,A),He&&$i(y,T),L;if(A===null){for(;T<E.length;T++)A=d(y,E[T],_),A!==null&&(v=s(A,v,T),R===null?L=A:R.sibling=A,R=A);return He&&$i(y,T),L}for(A=r(y,A);T<E.length;T++)w=f(A,y,T,E[T],_),w!==null&&(n&&w.alternate!==null&&A.delete(w.key===null?T:w.key),v=s(w,v,T),R===null?L=w:R.sibling=w,R=w);return n&&A.forEach(function(M){return e(y,M)}),He&&$i(y,T),L}function m(y,v,E,_){var L=ba(E);if(typeof L!="function")throw Error(V(150));if(E=L.call(E),E==null)throw Error(V(151));for(var R=L=null,A=v,T=v=0,w=null,I=E.next();A!==null&&!I.done;T++,I=E.next()){A.index>T?(w=A,A=null):w=A.sibling;var M=h(y,A,I.value,_);if(M===null){A===null&&(A=w);break}n&&A&&M.alternate===null&&e(y,A),v=s(M,v,T),R===null?L=M:R.sibling=M,R=M,A=w}if(I.done)return t(y,A),He&&$i(y,T),L;if(A===null){for(;!I.done;T++,I=E.next())I=d(y,I.value,_),I!==null&&(v=s(I,v,T),R===null?L=I:R.sibling=I,R=I);return He&&$i(y,T),L}for(A=r(y,A);!I.done;T++,I=E.next())I=f(A,y,T,I.value,_),I!==null&&(n&&I.alternate!==null&&A.delete(I.key===null?T:I.key),v=s(I,v,T),R===null?L=I:R.sibling=I,R=I);return n&&A.forEach(function(j){return e(y,j)}),He&&$i(y,T),L}function p(y,v,E,_){if(typeof E=="object"&&E!==null&&E.type===Is&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case yl:e:{for(var L=E.key,R=v;R!==null;){if(R.key===L){if(L=E.type,L===Is){if(R.tag===7){t(y,R.sibling),v=i(R,E.props.children),v.return=y,y=v;break e}}else if(R.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===Xr&&rp(L)===R.type){t(y,R.sibling),v=i(R,E.props),v.ref=Ma(y,R,E),v.return=y,y=v;break e}t(y,R);break}else e(y,R);R=R.sibling}E.type===Is?(v=ts(E.props.children,y.mode,_,E.key),v.return=y,y=v):(_=Eu(E.type,E.key,E.props,null,y.mode,_),_.ref=Ma(y,v,E),_.return=y,y=_)}return a(y);case Rs:e:{for(R=E.key;v!==null;){if(v.key===R)if(v.tag===4&&v.stateNode.containerInfo===E.containerInfo&&v.stateNode.implementation===E.implementation){t(y,v.sibling),v=i(v,E.children||[]),v.return=y,y=v;break e}else{t(y,v);break}else e(y,v);v=v.sibling}v=_d(E,y.mode,_),v.return=y,y=v}return a(y);case Xr:return R=E._init,p(y,v,R(E._payload),_)}if(qa(E))return g(y,v,E,_);if(ba(E))return m(y,v,E,_);wl(y,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,v!==null&&v.tag===6?(t(y,v.sibling),v=i(v,E),v.return=y,y=v):(t(y,v),v=Td(E,y.mode,_),v.return=y,y=v),a(y)):t(y,v)}return p}var ga=oE(!0),lE=oE(!1),Ku=bi(null),zu=null,Fs=null,ag=null;function og(){ag=Fs=zu=null}function lg(n){var e=Ku.current;Ve(Ku),n._currentValue=e}function Nh(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function zs(n,e){zu=n,ag=Fs=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Wt=!0),n.firstContext=null)}function Rn(n){var e=n._currentValue;if(ag!==n)if(n={context:n,memoizedValue:e,next:null},Fs===null){if(zu===null)throw Error(V(308));Fs=n,zu.dependencies={lanes:0,firstContext:n}}else Fs=Fs.next=n;return e}var Hi=null;function ug(n){Hi===null?Hi=[n]:Hi.push(n)}function uE(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,ug(e)):(t.next=i.next,i.next=t),e.interleaved=t,Mr(n,r)}function Mr(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Zr=!1;function cg(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cE(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function kr(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Si(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Ae&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Mr(n,t)}return i=r.interleaved,i===null?(e.next=e,ug(r)):(e.next=i.next,i.next=e),r.interleaved=e,Mr(n,t)}function fu(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Yf(n,t)}}function ip(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Wu(n,e,t,r){var i=n.updateQueue;Zr=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(o!==null){i.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?s=u:a.next=u,a=l;var c=n.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;a=0,c=u=l=null,o=s;do{var h=o.lane,f=o.eventTime;if((r&h)===h){c!==null&&(c=c.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=n,m=o;switch(h=e,f=t,m.tag){case 1:if(g=m.payload,typeof g=="function"){d=g.call(f,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=m.payload,h=typeof g=="function"?g.call(f,d,h):g,h==null)break e;d=Qe({},d,h);break e;case 2:Zr=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,a|=h;if(o=o.next,o===null){if(o=i.shared.pending,o===null)break;h=o,o=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(c===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);as|=a,n.lanes=a,n.memoizedState=d}}function sp(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(V(191,i));i.call(r)}}}var Xo={},cr=bi(Xo),Ro=bi(Xo),Io=bi(Xo);function Ki(n){if(n===Xo)throw Error(V(174));return n}function dg(n,e){switch(Be(Io,e),Be(Ro,n),Be(cr,Xo),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:yh(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=yh(e,n)}Ve(cr),Be(cr,e)}function ma(){Ve(cr),Ve(Ro),Ve(Io)}function dE(n){Ki(Io.current);var e=Ki(cr.current),t=yh(e,n.type);e!==t&&(Be(Ro,n),Be(cr,t))}function hg(n){Ro.current===n&&(Ve(cr),Ve(Ro))}var qe=bi(0);function qu(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var pd=[];function fg(){for(var n=0;n<pd.length;n++)pd[n]._workInProgressVersionPrimary=null;pd.length=0}var gu=$r.ReactCurrentDispatcher,yd=$r.ReactCurrentBatchConfig,ss=0,Ye=null,ft=null,St=null,Yu=!1,ao=!1,wo=0,F_=0;function It(){throw Error(V(321))}function gg(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Vn(n[t],e[t]))return!1;return!0}function mg(n,e,t,r,i,s){if(ss=s,Ye=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,gu.current=n===null||n.memoizedState===null?$_:B_,n=t(r,i),ao){s=0;do{if(ao=!1,wo=0,25<=s)throw Error(V(301));s+=1,St=ft=null,e.updateQueue=null,gu.current=j_,n=t(r,i)}while(ao)}if(gu.current=Qu,e=ft!==null&&ft.next!==null,ss=0,St=ft=Ye=null,Yu=!1,e)throw Error(V(300));return n}function pg(){var n=wo!==0;return wo=0,n}function Qn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return St===null?Ye.memoizedState=St=n:St=St.next=n,St}function In(){if(ft===null){var n=Ye.alternate;n=n!==null?n.memoizedState:null}else n=ft.next;var e=St===null?Ye.memoizedState:St.next;if(e!==null)St=e,ft=n;else{if(n===null)throw Error(V(310));ft=n,n={memoizedState:ft.memoizedState,baseState:ft.baseState,baseQueue:ft.baseQueue,queue:ft.queue,next:null},St===null?Ye.memoizedState=St=n:St=St.next=n}return St}function Co(n,e){return typeof e=="function"?e(n):e}function vd(n){var e=In(),t=e.queue;if(t===null)throw Error(V(311));t.lastRenderedReducer=n;var r=ft,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var o=a=null,l=null,u=s;do{var c=u.lane;if((ss&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,a=r):l=l.next=d,Ye.lanes|=c,as|=c}u=u.next}while(u!==null&&u!==s);l===null?a=r:l.next=o,Vn(r,e.memoizedState)||(Wt=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,Ye.lanes|=s,as|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Ed(n){var e=In(),t=e.queue;if(t===null)throw Error(V(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do s=n(s,a.action),a=a.next;while(a!==i);Vn(s,e.memoizedState)||(Wt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function hE(){}function fE(n,e){var t=Ye,r=In(),i=e(),s=!Vn(r.memoizedState,i);if(s&&(r.memoizedState=i,Wt=!0),r=r.queue,yg(pE.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||St!==null&&St.memoizedState.tag&1){if(t.flags|=2048,Do(9,mE.bind(null,t,r,i,e),void 0,null),Tt===null)throw Error(V(349));ss&30||gE(t,e,i)}return i}function gE(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Ye.updateQueue,e===null?(e={lastEffect:null,stores:null},Ye.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function mE(n,e,t,r){e.value=t,e.getSnapshot=r,yE(e)&&vE(n)}function pE(n,e,t){return t(function(){yE(e)&&vE(n)})}function yE(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Vn(n,t)}catch{return!0}}function vE(n){var e=Mr(n,1);e!==null&&Gn(e,n,1,-1)}function ap(n){var e=Qn();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Co,lastRenderedState:n},e.queue=n,n=n.dispatch=U_.bind(null,Ye,n),[e.memoizedState,n]}function Do(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Ye.updateQueue,e===null?(e={lastEffect:null,stores:null},Ye.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function EE(){return In().memoizedState}function mu(n,e,t,r){var i=Qn();Ye.flags|=n,i.memoizedState=Do(1|e,t,void 0,r===void 0?null:r)}function Rc(n,e,t,r){var i=In();r=r===void 0?null:r;var s=void 0;if(ft!==null){var a=ft.memoizedState;if(s=a.destroy,r!==null&&gg(r,a.deps)){i.memoizedState=Do(e,t,s,r);return}}Ye.flags|=n,i.memoizedState=Do(1|e,t,s,r)}function op(n,e){return mu(8390656,8,n,e)}function yg(n,e){return Rc(2048,8,n,e)}function SE(n,e){return Rc(4,2,n,e)}function xE(n,e){return Rc(4,4,n,e)}function TE(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function _E(n,e,t){return t=t!=null?t.concat([n]):null,Rc(4,4,TE.bind(null,e,n),t)}function vg(){}function LE(n,e){var t=In();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&gg(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function AE(n,e){var t=In();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&gg(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function RE(n,e,t){return ss&21?(Vn(t,e)||(t=bv(),Ye.lanes|=t,as|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Wt=!0),n.memoizedState=t)}function M_(n,e){var t=Pe;Pe=t!==0&&4>t?t:4,n(!0);var r=yd.transition;yd.transition={};try{n(!1),e()}finally{Pe=t,yd.transition=r}}function IE(){return In().memoizedState}function N_(n,e,t){var r=Ti(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},wE(n))CE(e,t);else if(t=uE(n,e,t,r),t!==null){var i=$t();Gn(t,n,r,i),DE(t,e,r)}}function U_(n,e,t){var r=Ti(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(wE(n))CE(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(i.hasEagerState=!0,i.eagerState=o,Vn(o,a)){var l=e.interleaved;l===null?(i.next=i,ug(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=uE(n,e,i,r),t!==null&&(i=$t(),Gn(t,n,r,i),DE(t,e,r))}}function wE(n){var e=n.alternate;return n===Ye||e!==null&&e===Ye}function CE(n,e){ao=Yu=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function DE(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Yf(n,t)}}var Qu={readContext:Rn,useCallback:It,useContext:It,useEffect:It,useImperativeHandle:It,useInsertionEffect:It,useLayoutEffect:It,useMemo:It,useReducer:It,useRef:It,useState:It,useDebugValue:It,useDeferredValue:It,useTransition:It,useMutableSource:It,useSyncExternalStore:It,useId:It,unstable_isNewReconciler:!1},$_={readContext:Rn,useCallback:function(n,e){return Qn().memoizedState=[n,e===void 0?null:e],n},useContext:Rn,useEffect:op,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,mu(4194308,4,TE.bind(null,e,n),t)},useLayoutEffect:function(n,e){return mu(4194308,4,n,e)},useInsertionEffect:function(n,e){return mu(4,2,n,e)},useMemo:function(n,e){var t=Qn();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Qn();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=N_.bind(null,Ye,n),[r.memoizedState,n]},useRef:function(n){var e=Qn();return n={current:n},e.memoizedState=n},useState:ap,useDebugValue:vg,useDeferredValue:function(n){return Qn().memoizedState=n},useTransition:function(){var n=ap(!1),e=n[0];return n=M_.bind(null,n[1]),Qn().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Ye,i=Qn();if(He){if(t===void 0)throw Error(V(407));t=t()}else{if(t=e(),Tt===null)throw Error(V(349));ss&30||gE(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,op(pE.bind(null,r,s,n),[n]),r.flags|=2048,Do(9,mE.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=Qn(),e=Tt.identifierPrefix;if(He){var t=br,r=Dr;t=(r&~(1<<32-jn(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=wo++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=F_++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},B_={readContext:Rn,useCallback:LE,useContext:Rn,useEffect:yg,useImperativeHandle:_E,useInsertionEffect:SE,useLayoutEffect:xE,useMemo:AE,useReducer:vd,useRef:EE,useState:function(){return vd(Co)},useDebugValue:vg,useDeferredValue:function(n){var e=In();return RE(e,ft.memoizedState,n)},useTransition:function(){var n=vd(Co)[0],e=In().memoizedState;return[n,e]},useMutableSource:hE,useSyncExternalStore:fE,useId:IE,unstable_isNewReconciler:!1},j_={readContext:Rn,useCallback:LE,useContext:Rn,useEffect:yg,useImperativeHandle:_E,useInsertionEffect:SE,useLayoutEffect:xE,useMemo:AE,useReducer:Ed,useRef:EE,useState:function(){return Ed(Co)},useDebugValue:vg,useDeferredValue:function(n){var e=In();return ft===null?e.memoizedState=n:RE(e,ft.memoizedState,n)},useTransition:function(){var n=Ed(Co)[0],e=In().memoizedState;return[n,e]},useMutableSource:hE,useSyncExternalStore:fE,useId:IE,unstable_isNewReconciler:!1};function Pn(n,e){if(n&&n.defaultProps){e=Qe({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Uh(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Qe({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ic={isMounted:function(n){return(n=n._reactInternals)?gs(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=$t(),i=Ti(n),s=kr(r,i);s.payload=e,t!=null&&(s.callback=t),e=Si(n,s,i),e!==null&&(Gn(e,n,i,r),fu(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=$t(),i=Ti(n),s=kr(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Si(n,s,i),e!==null&&(Gn(e,n,i,r),fu(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=$t(),r=Ti(n),i=kr(t,r);i.tag=2,e!=null&&(i.callback=e),e=Si(n,i,r),e!==null&&(Gn(e,n,r,t),fu(e,n,r))}};function lp(n,e,t,r,i,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!To(t,r)||!To(i,s):!0}function bE(n,e,t){var r=!1,i=Ai,s=e.contextType;return typeof s=="object"&&s!==null?s=Rn(s):(i=Yt(e)?rs:kt.current,r=e.contextTypes,s=(r=r!=null)?ha(n,i):Ai),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ic,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function up(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Ic.enqueueReplaceState(e,e.state,null)}function $h(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},cg(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Rn(s):(s=Yt(e)?rs:kt.current,i.context=ha(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Uh(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Ic.enqueueReplaceState(i,i.state,null),Wu(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function pa(n,e){try{var t="",r=e;do t+=m1(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function Sd(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Bh(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var G_=typeof WeakMap=="function"?WeakMap:Map;function kE(n,e,t){t=kr(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Zu||(Zu=!0,Qh=r),Bh(n,e)},t}function PE(n,e,t){t=kr(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){Bh(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){Bh(n,e),typeof r!="function"&&(xi===null?xi=new Set([this]):xi.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function cp(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new G_;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=nL.bind(null,n,e,t),e.then(n,n))}function dp(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function hp(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=kr(-1,1),e.tag=2,Si(t,e,1))),t.lanes|=1),n)}var V_=$r.ReactCurrentOwner,Wt=!1;function Ut(n,e,t,r){e.child=n===null?lE(e,null,t,r):ga(e,n.child,t,r)}function fp(n,e,t,r,i){t=t.render;var s=e.ref;return zs(e,i),r=mg(n,e,t,r,s,i),t=pg(),n!==null&&!Wt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Nr(n,e,i)):(He&&t&&rg(e),e.flags|=1,Ut(n,e,r,i),e.child)}function gp(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!Rg(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,OE(n,e,s,r,i)):(n=Eu(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:To,t(a,r)&&n.ref===e.ref)return Nr(n,e,i)}return e.flags|=1,n=_i(s,r),n.ref=e.ref,n.return=e,e.child=n}function OE(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(To(s,r)&&n.ref===e.ref)if(Wt=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(Wt=!0);else return e.lanes=n.lanes,Nr(n,e,i)}return jh(n,e,t,r,i)}function FE(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Be(Ns,sn),sn|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Be(Ns,sn),sn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,Be(Ns,sn),sn|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,Be(Ns,sn),sn|=r;return Ut(n,e,i,t),e.child}function ME(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function jh(n,e,t,r,i){var s=Yt(t)?rs:kt.current;return s=ha(e,s),zs(e,i),t=mg(n,e,t,r,s,i),r=pg(),n!==null&&!Wt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Nr(n,e,i)):(He&&r&&rg(e),e.flags|=1,Ut(n,e,t,i),e.child)}function mp(n,e,t,r,i){if(Yt(t)){var s=!0;Gu(e)}else s=!1;if(zs(e,i),e.stateNode===null)pu(n,e),bE(e,t,r),$h(e,t,r,i),r=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=Rn(u):(u=Yt(t)?rs:kt.current,u=ha(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==u)&&up(e,a,r,u),Zr=!1;var h=e.memoizedState;a.state=h,Wu(e,r,a,i),l=e.memoizedState,o!==r||h!==l||qt.current||Zr?(typeof c=="function"&&(Uh(e,t,c,r),l=e.memoizedState),(o=Zr||lp(e,t,o,r,h,l,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=u,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,cE(n,e),o=e.memoizedProps,u=e.type===e.elementType?o:Pn(e.type,o),a.props=u,d=e.pendingProps,h=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Rn(l):(l=Yt(t)?rs:kt.current,l=ha(e,l));var f=t.getDerivedStateFromProps;(c=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||h!==l)&&up(e,a,r,l),Zr=!1,h=e.memoizedState,a.state=h,Wu(e,r,a,i);var g=e.memoizedState;o!==d||h!==g||qt.current||Zr?(typeof f=="function"&&(Uh(e,t,f,r),g=e.memoizedState),(u=Zr||lp(e,t,u,r,h,g,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),a.props=r,a.state=g,a.context=l,r=u):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return Gh(n,e,t,r,s,i)}function Gh(n,e,t,r,i,s){ME(n,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&ep(e,t,!1),Nr(n,e,s);r=e.stateNode,V_.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&a?(e.child=ga(e,n.child,null,s),e.child=ga(e,null,o,s)):Ut(n,e,o,s),e.memoizedState=r.state,i&&ep(e,t,!0),e.child}function NE(n){var e=n.stateNode;e.pendingContext?Jm(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Jm(n,e.context,!1),dg(n,e.containerInfo)}function pp(n,e,t,r,i){return fa(),sg(i),e.flags|=256,Ut(n,e,t,r),e.child}var Vh={dehydrated:null,treeContext:null,retryLane:0};function Hh(n){return{baseLanes:n,cachePool:null,transitions:null}}function UE(n,e,t){var r=e.pendingProps,i=qe.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(i&2)!==0),o?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Be(qe,i&1),n===null)return Mh(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,n=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=Dc(a,r,0,null),n=ts(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=Hh(t),e.memoizedState=Vh,n):Eg(e,a));if(i=n.memoizedState,i!==null&&(o=i.dehydrated,o!==null))return H_(n,e,a,r,o,i,t);if(s){s=r.fallback,a=e.mode,i=n.child,o=i.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=_i(i,l),r.subtreeFlags=i.subtreeFlags&14680064),o!==null?s=_i(o,s):(s=ts(s,a,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,a=n.child.memoizedState,a=a===null?Hh(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=n.childLanes&~t,e.memoizedState=Vh,r}return s=n.child,n=s.sibling,r=_i(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Eg(n,e){return e=Dc({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Cl(n,e,t,r){return r!==null&&sg(r),ga(e,n.child,null,t),n=Eg(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function H_(n,e,t,r,i,s,a){if(t)return e.flags&256?(e.flags&=-257,r=Sd(Error(V(422))),Cl(n,e,a,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Dc({mode:"visible",children:r.children},i,0,null),s=ts(s,i,a,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&ga(e,n.child,null,a),e.child.memoizedState=Hh(a),e.memoizedState=Vh,s);if(!(e.mode&1))return Cl(n,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(V(419)),r=Sd(s,r,void 0),Cl(n,e,a,r)}if(o=(a&n.childLanes)!==0,Wt||o){if(r=Tt,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Mr(n,i),Gn(r,n,i,-1))}return Ag(),r=Sd(Error(V(421))),Cl(n,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=rL.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,ln=Ei(i.nextSibling),cn=e,He=!0,Un=null,n!==null&&(xn[Tn++]=Dr,xn[Tn++]=br,xn[Tn++]=is,Dr=n.id,br=n.overflow,is=e),e=Eg(e,r.children),e.flags|=4096,e)}function yp(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Nh(n.return,e,t)}function xd(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function $E(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ut(n,e,r.children,t),r=qe.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&yp(n,t,e);else if(n.tag===19)yp(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Be(qe,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&qu(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),xd(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&qu(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}xd(e,!0,t,null,s);break;case"together":xd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function pu(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Nr(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),as|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(V(153));if(e.child!==null){for(n=e.child,t=_i(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=_i(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function K_(n,e,t){switch(e.tag){case 3:NE(e),fa();break;case 5:dE(e);break;case 1:Yt(e.type)&&Gu(e);break;case 4:dg(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Be(Ku,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Be(qe,qe.current&1),e.flags|=128,null):t&e.child.childLanes?UE(n,e,t):(Be(qe,qe.current&1),n=Nr(n,e,t),n!==null?n.sibling:null);Be(qe,qe.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return $E(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Be(qe,qe.current),r)break;return null;case 22:case 23:return e.lanes=0,FE(n,e,t)}return Nr(n,e,t)}var BE,Kh,jE,GE;BE=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Kh=function(){};jE=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Ki(cr.current);var s=null;switch(t){case"input":i=fh(n,i),r=fh(n,r),s=[];break;case"select":i=Qe({},i,{value:void 0}),r=Qe({},r,{value:void 0}),s=[];break;case"textarea":i=ph(n,i),r=ph(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Bu)}vh(t,r);var a;t=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var o=i[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(mo.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(o=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(s||(s=[]),s.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(mo.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ge("scroll",n),s||o===l||(s=[])):(s=s||[]).push(u,l))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};GE=function(n,e,t,r){t!==r&&(e.flags|=4)};function Na(n,e){if(!He)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function wt(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function z_(n,e,t){var r=e.pendingProps;switch(ig(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wt(e),null;case 1:return Yt(e.type)&&ju(),wt(e),null;case 3:return r=e.stateNode,ma(),Ve(qt),Ve(kt),fg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Il(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Un!==null&&(Jh(Un),Un=null))),Kh(n,e),wt(e),null;case 5:hg(e);var i=Ki(Io.current);if(t=e.type,n!==null&&e.stateNode!=null)jE(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(V(166));return wt(e),null}if(n=Ki(cr.current),Il(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[ir]=e,r[Ao]=s,n=(e.mode&1)!==0,t){case"dialog":Ge("cancel",r),Ge("close",r);break;case"iframe":case"object":case"embed":Ge("load",r);break;case"video":case"audio":for(i=0;i<Qa.length;i++)Ge(Qa[i],r);break;case"source":Ge("error",r);break;case"img":case"image":case"link":Ge("error",r),Ge("load",r);break;case"details":Ge("toggle",r);break;case"input":Rm(r,s),Ge("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Ge("invalid",r);break;case"textarea":wm(r,s),Ge("invalid",r)}vh(t,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&Rl(r.textContent,o,n),i=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&Rl(r.textContent,o,n),i=["children",""+o]):mo.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Ge("scroll",r)}switch(t){case"input":vl(r),Im(r,s,!0);break;case"textarea":vl(r),Cm(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Bu)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=pv(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=a.createElement(t,{is:r.is}):(n=a.createElement(t),t==="select"&&(a=n,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):n=a.createElementNS(n,t),n[ir]=e,n[Ao]=r,BE(n,e,!1,!1),e.stateNode=n;e:{switch(a=Eh(t,r),t){case"dialog":Ge("cancel",n),Ge("close",n),i=r;break;case"iframe":case"object":case"embed":Ge("load",n),i=r;break;case"video":case"audio":for(i=0;i<Qa.length;i++)Ge(Qa[i],n);i=r;break;case"source":Ge("error",n),i=r;break;case"img":case"image":case"link":Ge("error",n),Ge("load",n),i=r;break;case"details":Ge("toggle",n),i=r;break;case"input":Rm(n,r),i=fh(n,r),Ge("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Qe({},r,{value:void 0}),Ge("invalid",n);break;case"textarea":wm(n,r),i=ph(n,r),Ge("invalid",n);break;default:i=r}vh(t,i),o=i;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?Ev(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&yv(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&po(n,l):typeof l=="number"&&po(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(mo.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Ge("scroll",n):l!=null&&Vf(n,s,l,a))}switch(t){case"input":vl(n),Im(n,r,!1);break;case"textarea":vl(n),Cm(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Li(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?Gs(n,!!r.multiple,s,!1):r.defaultValue!=null&&Gs(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Bu)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return wt(e),null;case 6:if(n&&e.stateNode!=null)GE(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(V(166));if(t=Ki(Io.current),Ki(cr.current),Il(e)){if(r=e.stateNode,t=e.memoizedProps,r[ir]=e,(s=r.nodeValue!==t)&&(n=cn,n!==null))switch(n.tag){case 3:Rl(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Rl(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[ir]=e,e.stateNode=r}return wt(e),null;case 13:if(Ve(qe),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(He&&ln!==null&&e.mode&1&&!(e.flags&128))aE(),fa(),e.flags|=98560,s=!1;else if(s=Il(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(V(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(V(317));s[ir]=e}else fa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;wt(e),s=!1}else Un!==null&&(Jh(Un),Un=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||qe.current&1?pt===0&&(pt=3):Ag())),e.updateQueue!==null&&(e.flags|=4),wt(e),null);case 4:return ma(),Kh(n,e),n===null&&_o(e.stateNode.containerInfo),wt(e),null;case 10:return lg(e.type._context),wt(e),null;case 17:return Yt(e.type)&&ju(),wt(e),null;case 19:if(Ve(qe),s=e.memoizedState,s===null)return wt(e),null;if(r=(e.flags&128)!==0,a=s.rendering,a===null)if(r)Na(s,!1);else{if(pt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=qu(n),a!==null){for(e.flags|=128,Na(s,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Be(qe,qe.current&1|2),e.child}n=n.sibling}s.tail!==null&&at()>ya&&(e.flags|=128,r=!0,Na(s,!1),e.lanes=4194304)}else{if(!r)if(n=qu(a),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Na(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!He)return wt(e),null}else 2*at()-s.renderingStartTime>ya&&t!==1073741824&&(e.flags|=128,r=!0,Na(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=at(),e.sibling=null,t=qe.current,Be(qe,r?t&1|2:t&1),e):(wt(e),null);case 22:case 23:return Lg(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?sn&1073741824&&(wt(e),e.subtreeFlags&6&&(e.flags|=8192)):wt(e),null;case 24:return null;case 25:return null}throw Error(V(156,e.tag))}function W_(n,e){switch(ig(e),e.tag){case 1:return Yt(e.type)&&ju(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return ma(),Ve(qt),Ve(kt),fg(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return hg(e),null;case 13:if(Ve(qe),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(V(340));fa()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Ve(qe),null;case 4:return ma(),null;case 10:return lg(e.type._context),null;case 22:case 23:return Lg(),null;case 24:return null;default:return null}}var Dl=!1,bt=!1,q_=typeof WeakSet=="function"?WeakSet:Set,te=null;function Ms(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){nt(n,e,r)}else t.current=null}function zh(n,e,t){try{t()}catch(r){nt(n,e,r)}}var vp=!1;function Y_(n,e){if(Ch=Nu,n=Wv(),ng(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,c=0,d=n,h=null;t:for(;;){for(var f;d!==t||i!==0&&d.nodeType!==3||(o=a+i),d!==s||r!==0&&d.nodeType!==3||(l=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===n)break t;if(h===t&&++u===i&&(o=a),h===s&&++c===r&&(l=a),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Dh={focusedElem:n,selectionRange:t},Nu=!1,te=e;te!==null;)if(e=te,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,te=n;else for(;te!==null;){e=te;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var m=g.memoizedProps,p=g.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:Pn(e.type,m),p);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(V(163))}}catch(_){nt(e,e.return,_)}if(n=e.sibling,n!==null){n.return=e.return,te=n;break}te=e.return}return g=vp,vp=!1,g}function oo(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&zh(e,t,s)}i=i.next}while(i!==r)}}function wc(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Wh(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function VE(n){var e=n.alternate;e!==null&&(n.alternate=null,VE(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[ir],delete e[Ao],delete e[Ph],delete e[b_],delete e[k_])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function HE(n){return n.tag===5||n.tag===3||n.tag===4}function Ep(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||HE(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function qh(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Bu));else if(r!==4&&(n=n.child,n!==null))for(qh(n,e,t),n=n.sibling;n!==null;)qh(n,e,t),n=n.sibling}function Yh(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Yh(n,e,t),n=n.sibling;n!==null;)Yh(n,e,t),n=n.sibling}var Lt=null,Mn=!1;function Kr(n,e,t){for(t=t.child;t!==null;)KE(n,e,t),t=t.sibling}function KE(n,e,t){if(ur&&typeof ur.onCommitFiberUnmount=="function")try{ur.onCommitFiberUnmount(Sc,t)}catch{}switch(t.tag){case 5:bt||Ms(t,e);case 6:var r=Lt,i=Mn;Lt=null,Kr(n,e,t),Lt=r,Mn=i,Lt!==null&&(Mn?(n=Lt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Lt.removeChild(t.stateNode));break;case 18:Lt!==null&&(Mn?(n=Lt,t=t.stateNode,n.nodeType===8?gd(n.parentNode,t):n.nodeType===1&&gd(n,t),So(n)):gd(Lt,t.stateNode));break;case 4:r=Lt,i=Mn,Lt=t.stateNode.containerInfo,Mn=!0,Kr(n,e,t),Lt=r,Mn=i;break;case 0:case 11:case 14:case 15:if(!bt&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&zh(t,e,a),i=i.next}while(i!==r)}Kr(n,e,t);break;case 1:if(!bt&&(Ms(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(o){nt(t,e,o)}Kr(n,e,t);break;case 21:Kr(n,e,t);break;case 22:t.mode&1?(bt=(r=bt)||t.memoizedState!==null,Kr(n,e,t),bt=r):Kr(n,e,t);break;default:Kr(n,e,t)}}function Sp(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new q_),e.forEach(function(r){var i=iL.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function bn(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Lt=o.stateNode,Mn=!1;break e;case 3:Lt=o.stateNode.containerInfo,Mn=!0;break e;case 4:Lt=o.stateNode.containerInfo,Mn=!0;break e}o=o.return}if(Lt===null)throw Error(V(160));KE(s,a,i),Lt=null,Mn=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){nt(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)zE(e,n),e=e.sibling}function zE(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(bn(e,n),qn(n),r&4){try{oo(3,n,n.return),wc(3,n)}catch(m){nt(n,n.return,m)}try{oo(5,n,n.return)}catch(m){nt(n,n.return,m)}}break;case 1:bn(e,n),qn(n),r&512&&t!==null&&Ms(t,t.return);break;case 5:if(bn(e,n),qn(n),r&512&&t!==null&&Ms(t,t.return),n.flags&32){var i=n.stateNode;try{po(i,"")}catch(m){nt(n,n.return,m)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,a=t!==null?t.memoizedProps:s,o=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&gv(i,s),Eh(o,a);var u=Eh(o,s);for(a=0;a<l.length;a+=2){var c=l[a],d=l[a+1];c==="style"?Ev(i,d):c==="dangerouslySetInnerHTML"?yv(i,d):c==="children"?po(i,d):Vf(i,c,d,u)}switch(o){case"input":gh(i,s);break;case"textarea":mv(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?Gs(i,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?Gs(i,!!s.multiple,s.defaultValue,!0):Gs(i,!!s.multiple,s.multiple?[]:"",!1))}i[Ao]=s}catch(m){nt(n,n.return,m)}}break;case 6:if(bn(e,n),qn(n),r&4){if(n.stateNode===null)throw Error(V(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(m){nt(n,n.return,m)}}break;case 3:if(bn(e,n),qn(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{So(e.containerInfo)}catch(m){nt(n,n.return,m)}break;case 4:bn(e,n),qn(n);break;case 13:bn(e,n),qn(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Tg=at())),r&4&&Sp(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(bt=(u=bt)||c,bn(e,n),bt=u):bn(e,n),qn(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(te=n,c=n.child;c!==null;){for(d=te=c;te!==null;){switch(h=te,f=h.child,h.tag){case 0:case 11:case 14:case 15:oo(4,h,h.return);break;case 1:Ms(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(m){nt(r,t,m)}}break;case 5:Ms(h,h.return);break;case 22:if(h.memoizedState!==null){Tp(d);continue}}f!==null?(f.return=h,te=f):Tp(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=vv("display",a))}catch(m){nt(n,n.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){nt(n,n.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:bn(e,n),qn(n),r&4&&Sp(n);break;case 21:break;default:bn(e,n),qn(n)}}function qn(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(HE(t)){var r=t;break e}t=t.return}throw Error(V(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(po(i,""),r.flags&=-33);var s=Ep(n);Yh(n,s,i);break;case 3:case 4:var a=r.stateNode.containerInfo,o=Ep(n);qh(n,o,a);break;default:throw Error(V(161))}}catch(l){nt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Q_(n,e,t){te=n,WE(n)}function WE(n,e,t){for(var r=(n.mode&1)!==0;te!==null;){var i=te,s=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||Dl;if(!a){var o=i.alternate,l=o!==null&&o.memoizedState!==null||bt;o=Dl;var u=bt;if(Dl=a,(bt=l)&&!u)for(te=i;te!==null;)a=te,l=a.child,a.tag===22&&a.memoizedState!==null?_p(i):l!==null?(l.return=a,te=l):_p(i);for(;s!==null;)te=s,WE(s),s=s.sibling;te=i,Dl=o,bt=u}xp(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,te=s):xp(n)}}function xp(n){for(;te!==null;){var e=te;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bt||wc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bt)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Pn(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&sp(e,s,r);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}sp(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&So(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(V(163))}bt||e.flags&512&&Wh(e)}catch(h){nt(e,e.return,h)}}if(e===n){te=null;break}if(t=e.sibling,t!==null){t.return=e.return,te=t;break}te=e.return}}function Tp(n){for(;te!==null;){var e=te;if(e===n){te=null;break}var t=e.sibling;if(t!==null){t.return=e.return,te=t;break}te=e.return}}function _p(n){for(;te!==null;){var e=te;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{wc(4,e)}catch(l){nt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){nt(e,i,l)}}var s=e.return;try{Wh(e)}catch(l){nt(e,s,l)}break;case 5:var a=e.return;try{Wh(e)}catch(l){nt(e,a,l)}}}catch(l){nt(e,e.return,l)}if(e===n){te=null;break}var o=e.sibling;if(o!==null){o.return=e.return,te=o;break}te=e.return}}var X_=Math.ceil,Xu=$r.ReactCurrentDispatcher,Sg=$r.ReactCurrentOwner,An=$r.ReactCurrentBatchConfig,Ae=0,Tt=null,ct=null,At=0,sn=0,Ns=bi(0),pt=0,bo=null,as=0,Cc=0,xg=0,lo=null,Kt=null,Tg=0,ya=1/0,Ar=null,Zu=!1,Qh=null,xi=null,bl=!1,fi=null,Ju=0,uo=0,Xh=null,yu=-1,vu=0;function $t(){return Ae&6?at():yu!==-1?yu:yu=at()}function Ti(n){return n.mode&1?Ae&2&&At!==0?At&-At:O_.transition!==null?(vu===0&&(vu=bv()),vu):(n=Pe,n!==0||(n=window.event,n=n===void 0?16:Uv(n.type)),n):1}function Gn(n,e,t,r){if(50<uo)throw uo=0,Xh=null,Error(V(185));qo(n,t,r),(!(Ae&2)||n!==Tt)&&(n===Tt&&(!(Ae&2)&&(Cc|=t),pt===4&&ni(n,At)),Qt(n,r),t===1&&Ae===0&&!(e.mode&1)&&(ya=at()+500,Ac&&ki()))}function Qt(n,e){var t=n.callbackNode;O1(n,e);var r=Mu(n,n===Tt?At:0);if(r===0)t!==null&&km(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&km(t),e===1)n.tag===0?P_(Lp.bind(null,n)):rE(Lp.bind(null,n)),C_(function(){!(Ae&6)&&ki()}),t=null;else{switch(kv(r)){case 1:t=qf;break;case 4:t=Cv;break;case 16:t=Fu;break;case 536870912:t=Dv;break;default:t=Fu}t=tS(t,qE.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function qE(n,e){if(yu=-1,vu=0,Ae&6)throw Error(V(327));var t=n.callbackNode;if(Ws()&&n.callbackNode!==t)return null;var r=Mu(n,n===Tt?At:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=ec(n,r);else{e=r;var i=Ae;Ae|=2;var s=QE();(Tt!==n||At!==e)&&(Ar=null,ya=at()+500,es(n,e));do try{eL();break}catch(o){YE(n,o)}while(!0);og(),Xu.current=s,Ae=i,ct!==null?e=0:(Tt=null,At=0,e=pt)}if(e!==0){if(e===2&&(i=Lh(n),i!==0&&(r=i,e=Zh(n,i))),e===1)throw t=bo,es(n,0),ni(n,r),Qt(n,at()),t;if(e===6)ni(n,r);else{if(i=n.current.alternate,!(r&30)&&!Z_(i)&&(e=ec(n,r),e===2&&(s=Lh(n),s!==0&&(r=s,e=Zh(n,s))),e===1))throw t=bo,es(n,0),ni(n,r),Qt(n,at()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(V(345));case 2:Bi(n,Kt,Ar);break;case 3:if(ni(n,r),(r&130023424)===r&&(e=Tg+500-at(),10<e)){if(Mu(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){$t(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=kh(Bi.bind(null,n,Kt,Ar),e);break}Bi(n,Kt,Ar);break;case 4:if(ni(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var a=31-jn(r);s=1<<a,a=e[a],a>i&&(i=a),r&=~s}if(r=i,r=at()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*X_(r/1960))-r,10<r){n.timeoutHandle=kh(Bi.bind(null,n,Kt,Ar),r);break}Bi(n,Kt,Ar);break;case 5:Bi(n,Kt,Ar);break;default:throw Error(V(329))}}}return Qt(n,at()),n.callbackNode===t?qE.bind(null,n):null}function Zh(n,e){var t=lo;return n.current.memoizedState.isDehydrated&&(es(n,e).flags|=256),n=ec(n,e),n!==2&&(e=Kt,Kt=t,e!==null&&Jh(e)),n}function Jh(n){Kt===null?Kt=n:Kt.push.apply(Kt,n)}function Z_(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!Vn(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ni(n,e){for(e&=~xg,e&=~Cc,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-jn(e),r=1<<t;n[t]=-1,e&=~r}}function Lp(n){if(Ae&6)throw Error(V(327));Ws();var e=Mu(n,0);if(!(e&1))return Qt(n,at()),null;var t=ec(n,e);if(n.tag!==0&&t===2){var r=Lh(n);r!==0&&(e=r,t=Zh(n,r))}if(t===1)throw t=bo,es(n,0),ni(n,e),Qt(n,at()),t;if(t===6)throw Error(V(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Bi(n,Kt,Ar),Qt(n,at()),null}function _g(n,e){var t=Ae;Ae|=1;try{return n(e)}finally{Ae=t,Ae===0&&(ya=at()+500,Ac&&ki())}}function os(n){fi!==null&&fi.tag===0&&!(Ae&6)&&Ws();var e=Ae;Ae|=1;var t=An.transition,r=Pe;try{if(An.transition=null,Pe=1,n)return n()}finally{Pe=r,An.transition=t,Ae=e,!(Ae&6)&&ki()}}function Lg(){sn=Ns.current,Ve(Ns)}function es(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,w_(t)),ct!==null)for(t=ct.return;t!==null;){var r=t;switch(ig(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ju();break;case 3:ma(),Ve(qt),Ve(kt),fg();break;case 5:hg(r);break;case 4:ma();break;case 13:Ve(qe);break;case 19:Ve(qe);break;case 10:lg(r.type._context);break;case 22:case 23:Lg()}t=t.return}if(Tt=n,ct=n=_i(n.current,null),At=sn=e,pt=0,bo=null,xg=Cc=as=0,Kt=lo=null,Hi!==null){for(e=0;e<Hi.length;e++)if(t=Hi[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var a=s.next;s.next=i,r.next=a}t.pending=r}Hi=null}return n}function YE(n,e){do{var t=ct;try{if(og(),gu.current=Qu,Yu){for(var r=Ye.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Yu=!1}if(ss=0,St=ft=Ye=null,ao=!1,wo=0,Sg.current=null,t===null||t.return===null){pt=1,bo=e,ct=null;break}e:{var s=n,a=t.return,o=t,l=e;if(e=At,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=dp(a);if(f!==null){f.flags&=-257,hp(f,a,o,s,e),f.mode&1&&cp(s,u,e),e=f,l=u;var g=e.updateQueue;if(g===null){var m=new Set;m.add(l),e.updateQueue=m}else g.add(l);break e}else{if(!(e&1)){cp(s,u,e),Ag();break e}l=Error(V(426))}}else if(He&&o.mode&1){var p=dp(a);if(p!==null){!(p.flags&65536)&&(p.flags|=256),hp(p,a,o,s,e),sg(pa(l,o));break e}}s=l=pa(l,o),pt!==4&&(pt=2),lo===null?lo=[s]:lo.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=kE(s,l,e);ip(s,y);break e;case 1:o=l;var v=s.type,E=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(xi===null||!xi.has(E)))){s.flags|=65536,e&=-e,s.lanes|=e;var _=PE(s,o,e);ip(s,_);break e}}s=s.return}while(s!==null)}ZE(t)}catch(L){e=L,ct===t&&t!==null&&(ct=t=t.return);continue}break}while(!0)}function QE(){var n=Xu.current;return Xu.current=Qu,n===null?Qu:n}function Ag(){(pt===0||pt===3||pt===2)&&(pt=4),Tt===null||!(as&268435455)&&!(Cc&268435455)||ni(Tt,At)}function ec(n,e){var t=Ae;Ae|=2;var r=QE();(Tt!==n||At!==e)&&(Ar=null,es(n,e));do try{J_();break}catch(i){YE(n,i)}while(!0);if(og(),Ae=t,Xu.current=r,ct!==null)throw Error(V(261));return Tt=null,At=0,pt}function J_(){for(;ct!==null;)XE(ct)}function eL(){for(;ct!==null&&!A1();)XE(ct)}function XE(n){var e=eS(n.alternate,n,sn);n.memoizedProps=n.pendingProps,e===null?ZE(n):ct=e,Sg.current=null}function ZE(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=W_(t,e),t!==null){t.flags&=32767,ct=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{pt=6,ct=null;return}}else if(t=z_(t,e,sn),t!==null){ct=t;return}if(e=e.sibling,e!==null){ct=e;return}ct=e=n}while(e!==null);pt===0&&(pt=5)}function Bi(n,e,t){var r=Pe,i=An.transition;try{An.transition=null,Pe=1,tL(n,e,t,r)}finally{An.transition=i,Pe=r}return null}function tL(n,e,t,r){do Ws();while(fi!==null);if(Ae&6)throw Error(V(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(V(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(F1(n,s),n===Tt&&(ct=Tt=null,At=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||bl||(bl=!0,tS(Fu,function(){return Ws(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=An.transition,An.transition=null;var a=Pe;Pe=1;var o=Ae;Ae|=4,Sg.current=null,Y_(n,t),zE(t,n),x_(Dh),Nu=!!Ch,Dh=Ch=null,n.current=t,Q_(t),R1(),Ae=o,Pe=a,An.transition=s}else n.current=t;if(bl&&(bl=!1,fi=n,Ju=i),s=n.pendingLanes,s===0&&(xi=null),C1(t.stateNode),Qt(n,at()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Zu)throw Zu=!1,n=Qh,Qh=null,n;return Ju&1&&n.tag!==0&&Ws(),s=n.pendingLanes,s&1?n===Xh?uo++:(uo=0,Xh=n):uo=0,ki(),null}function Ws(){if(fi!==null){var n=kv(Ju),e=An.transition,t=Pe;try{if(An.transition=null,Pe=16>n?16:n,fi===null)var r=!1;else{if(n=fi,fi=null,Ju=0,Ae&6)throw Error(V(331));var i=Ae;for(Ae|=4,te=n.current;te!==null;){var s=te,a=s.child;if(te.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(te=u;te!==null;){var c=te;switch(c.tag){case 0:case 11:case 15:oo(8,c,s)}var d=c.child;if(d!==null)d.return=c,te=d;else for(;te!==null;){c=te;var h=c.sibling,f=c.return;if(VE(c),c===u){te=null;break}if(h!==null){h.return=f,te=h;break}te=f}}}var g=s.alternate;if(g!==null){var m=g.child;if(m!==null){g.child=null;do{var p=m.sibling;m.sibling=null,m=p}while(m!==null)}}te=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,te=a;else e:for(;te!==null;){if(s=te,s.flags&2048)switch(s.tag){case 0:case 11:case 15:oo(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,te=y;break e}te=s.return}}var v=n.current;for(te=v;te!==null;){a=te;var E=a.child;if(a.subtreeFlags&2064&&E!==null)E.return=a,te=E;else e:for(a=v;te!==null;){if(o=te,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:wc(9,o)}}catch(L){nt(o,o.return,L)}if(o===a){te=null;break e}var _=o.sibling;if(_!==null){_.return=o.return,te=_;break e}te=o.return}}if(Ae=i,ki(),ur&&typeof ur.onPostCommitFiberRoot=="function")try{ur.onPostCommitFiberRoot(Sc,n)}catch{}r=!0}return r}finally{Pe=t,An.transition=e}}return!1}function Ap(n,e,t){e=pa(t,e),e=kE(n,e,1),n=Si(n,e,1),e=$t(),n!==null&&(qo(n,1,e),Qt(n,e))}function nt(n,e,t){if(n.tag===3)Ap(n,n,t);else for(;e!==null;){if(e.tag===3){Ap(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xi===null||!xi.has(r))){n=pa(t,n),n=PE(e,n,1),e=Si(e,n,1),n=$t(),e!==null&&(qo(e,1,n),Qt(e,n));break}}e=e.return}}function nL(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=$t(),n.pingedLanes|=n.suspendedLanes&t,Tt===n&&(At&t)===t&&(pt===4||pt===3&&(At&130023424)===At&&500>at()-Tg?es(n,0):xg|=t),Qt(n,e)}function JE(n,e){e===0&&(n.mode&1?(e=xl,xl<<=1,!(xl&130023424)&&(xl=4194304)):e=1);var t=$t();n=Mr(n,e),n!==null&&(qo(n,e,t),Qt(n,t))}function rL(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),JE(n,t)}function iL(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(V(314))}r!==null&&r.delete(e),JE(n,t)}var eS;eS=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||qt.current)Wt=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Wt=!1,K_(n,e,t);Wt=!!(n.flags&131072)}else Wt=!1,He&&e.flags&1048576&&iE(e,Hu,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;pu(n,e),n=e.pendingProps;var i=ha(e,kt.current);zs(e,t),i=mg(null,e,r,n,i,t);var s=pg();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Yt(r)?(s=!0,Gu(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,cg(e),i.updater=Ic,e.stateNode=i,i._reactInternals=e,$h(e,r,n,t),e=Gh(null,e,r,!0,s,t)):(e.tag=0,He&&s&&rg(e),Ut(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(pu(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=aL(r),n=Pn(r,n),i){case 0:e=jh(null,e,r,n,t);break e;case 1:e=mp(null,e,r,n,t);break e;case 11:e=fp(null,e,r,n,t);break e;case 14:e=gp(null,e,r,Pn(r.type,n),t);break e}throw Error(V(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pn(r,i),jh(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pn(r,i),mp(n,e,r,i,t);case 3:e:{if(NE(e),n===null)throw Error(V(387));r=e.pendingProps,s=e.memoizedState,i=s.element,cE(n,e),Wu(e,r,null,t);var a=e.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=pa(Error(V(423)),e),e=pp(n,e,r,t,i);break e}else if(r!==i){i=pa(Error(V(424)),e),e=pp(n,e,r,t,i);break e}else for(ln=Ei(e.stateNode.containerInfo.firstChild),cn=e,He=!0,Un=null,t=lE(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(fa(),r===i){e=Nr(n,e,t);break e}Ut(n,e,r,t)}e=e.child}return e;case 5:return dE(e),n===null&&Mh(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,a=i.children,bh(r,i)?a=null:s!==null&&bh(r,s)&&(e.flags|=32),ME(n,e),Ut(n,e,a,t),e.child;case 6:return n===null&&Mh(e),null;case 13:return UE(n,e,t);case 4:return dg(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=ga(e,null,r,t):Ut(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pn(r,i),fp(n,e,r,i,t);case 7:return Ut(n,e,e.pendingProps,t),e.child;case 8:return Ut(n,e,e.pendingProps.children,t),e.child;case 12:return Ut(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,Be(Ku,r._currentValue),r._currentValue=a,s!==null)if(Vn(s.value,a)){if(s.children===i.children&&!qt.current){e=Nr(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=kr(-1,t&-t),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),Nh(s.return,t,e),o.lanes|=t;break}l=l.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(V(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),Nh(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Ut(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,zs(e,t),i=Rn(i),r=r(i),e.flags|=1,Ut(n,e,r,t),e.child;case 14:return r=e.type,i=Pn(r,e.pendingProps),i=Pn(r.type,i),gp(n,e,r,i,t);case 15:return OE(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pn(r,i),pu(n,e),e.tag=1,Yt(r)?(n=!0,Gu(e)):n=!1,zs(e,t),bE(e,r,i),$h(e,r,i,t),Gh(null,e,r,!0,n,t);case 19:return $E(n,e,t);case 22:return FE(n,e,t)}throw Error(V(156,e.tag))};function tS(n,e){return wv(n,e)}function sL(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _n(n,e,t,r){return new sL(n,e,t,r)}function Rg(n){return n=n.prototype,!(!n||!n.isReactComponent)}function aL(n){if(typeof n=="function")return Rg(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Kf)return 11;if(n===zf)return 14}return 2}function _i(n,e){var t=n.alternate;return t===null?(t=_n(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Eu(n,e,t,r,i,s){var a=2;if(r=n,typeof n=="function")Rg(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Is:return ts(t.children,i,s,e);case Hf:a=8,i|=8;break;case uh:return n=_n(12,t,e,i|2),n.elementType=uh,n.lanes=s,n;case ch:return n=_n(13,t,e,i),n.elementType=ch,n.lanes=s,n;case dh:return n=_n(19,t,e,i),n.elementType=dh,n.lanes=s,n;case dv:return Dc(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case uv:a=10;break e;case cv:a=9;break e;case Kf:a=11;break e;case zf:a=14;break e;case Xr:a=16,r=null;break e}throw Error(V(130,n==null?n:typeof n,""))}return e=_n(a,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function ts(n,e,t,r){return n=_n(7,n,r,e),n.lanes=t,n}function Dc(n,e,t,r){return n=_n(22,n,r,e),n.elementType=dv,n.lanes=t,n.stateNode={isHidden:!1},n}function Td(n,e,t){return n=_n(6,n,null,e),n.lanes=t,n}function _d(n,e,t){return e=_n(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function oL(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rd(0),this.expirationTimes=rd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rd(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Ig(n,e,t,r,i,s,a,o,l){return n=new oL(n,e,t,o,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=_n(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},cg(s),n}function lL(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rs,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function nS(n){if(!n)return Ai;n=n._reactInternals;e:{if(gs(n)!==n||n.tag!==1)throw Error(V(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Yt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(V(171))}if(n.tag===1){var t=n.type;if(Yt(t))return nE(n,t,e)}return e}function rS(n,e,t,r,i,s,a,o,l){return n=Ig(t,r,!0,n,i,s,a,o,l),n.context=nS(null),t=n.current,r=$t(),i=Ti(t),s=kr(r,i),s.callback=e??null,Si(t,s,i),n.current.lanes=i,qo(n,i,r),Qt(n,r),n}function bc(n,e,t,r){var i=e.current,s=$t(),a=Ti(i);return t=nS(t),e.context===null?e.context=t:e.pendingContext=t,e=kr(s,a),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Si(i,e,a),n!==null&&(Gn(n,i,a,s),fu(n,i,a)),a}function tc(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Rp(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function wg(n,e){Rp(n,e),(n=n.alternate)&&Rp(n,e)}function uL(){return null}var iS=typeof reportError=="function"?reportError:function(n){console.error(n)};function Cg(n){this._internalRoot=n}kc.prototype.render=Cg.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(V(409));bc(n,e,null,null)};kc.prototype.unmount=Cg.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;os(function(){bc(null,n,null,null)}),e[Fr]=null}};function kc(n){this._internalRoot=n}kc.prototype.unstable_scheduleHydration=function(n){if(n){var e=Fv();n={blockedOn:null,target:n,priority:e};for(var t=0;t<ti.length&&e!==0&&e<ti[t].priority;t++);ti.splice(t,0,n),t===0&&Nv(n)}};function Dg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Pc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Ip(){}function cL(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=tc(a);s.call(u)}}var a=rS(e,r,n,0,null,!1,!1,"",Ip);return n._reactRootContainer=a,n[Fr]=a.current,_o(n.nodeType===8?n.parentNode:n),os(),a}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var o=r;r=function(){var u=tc(l);o.call(u)}}var l=Ig(n,0,!1,null,null,!1,!1,"",Ip);return n._reactRootContainer=l,n[Fr]=l.current,_o(n.nodeType===8?n.parentNode:n),os(function(){bc(e,l,t,r)}),l}function Oc(n,e,t,r,i){var s=t._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var o=i;i=function(){var l=tc(a);o.call(l)}}bc(e,a,n,i)}else a=cL(t,e,n,i,r);return tc(a)}Pv=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Ya(e.pendingLanes);t!==0&&(Yf(e,t|1),Qt(e,at()),!(Ae&6)&&(ya=at()+500,ki()))}break;case 13:os(function(){var r=Mr(n,1);if(r!==null){var i=$t();Gn(r,n,1,i)}}),wg(n,1)}};Qf=function(n){if(n.tag===13){var e=Mr(n,134217728);if(e!==null){var t=$t();Gn(e,n,134217728,t)}wg(n,134217728)}};Ov=function(n){if(n.tag===13){var e=Ti(n),t=Mr(n,e);if(t!==null){var r=$t();Gn(t,n,e,r)}wg(n,e)}};Fv=function(){return Pe};Mv=function(n,e){var t=Pe;try{return Pe=n,e()}finally{Pe=t}};xh=function(n,e,t){switch(e){case"input":if(gh(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=Lc(r);if(!i)throw Error(V(90));fv(r),gh(r,i)}}}break;case"textarea":mv(n,t);break;case"select":e=t.value,e!=null&&Gs(n,!!t.multiple,e,!1)}};Tv=_g;_v=os;var dL={usingClientEntryPoint:!1,Events:[Qo,bs,Lc,Sv,xv,_g]},Ua={findFiberByHostInstance:Vi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hL={bundleType:Ua.bundleType,version:Ua.version,rendererPackageName:Ua.rendererPackageName,rendererConfig:Ua.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$r.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Rv(n),n===null?null:n.stateNode},findFiberByHostInstance:Ua.findFiberByHostInstance||uL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kl.isDisabled&&kl.supportsFiber)try{Sc=kl.inject(hL),ur=kl}catch{}}gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dL;gn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Dg(e))throw Error(V(200));return lL(n,e,null,t)};gn.createRoot=function(n,e){if(!Dg(n))throw Error(V(299));var t=!1,r="",i=iS;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Ig(n,1,!1,null,null,t,!1,r,i),n[Fr]=e.current,_o(n.nodeType===8?n.parentNode:n),new Cg(e)};gn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(V(188)):(n=Object.keys(n).join(","),Error(V(268,n)));return n=Rv(e),n=n===null?null:n.stateNode,n};gn.flushSync=function(n){return os(n)};gn.hydrate=function(n,e,t){if(!Pc(e))throw Error(V(200));return Oc(null,n,e,!0,t)};gn.hydrateRoot=function(n,e,t){if(!Dg(n))throw Error(V(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",a=iS;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=rS(e,null,n,1,t??null,i,!1,s,a),n[Fr]=e.current,_o(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new kc(e)};gn.render=function(n,e,t){if(!Pc(e))throw Error(V(200));return Oc(null,n,e,!1,t)};gn.unmountComponentAtNode=function(n){if(!Pc(n))throw Error(V(40));return n._reactRootContainer?(os(function(){Oc(null,null,n,!1,function(){n._reactRootContainer=null,n[Fr]=null})}),!0):!1};gn.unstable_batchedUpdates=_g;gn.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Pc(t))throw Error(V(200));if(n==null||n._reactInternals===void 0)throw Error(V(38));return Oc(n,e,t,!1,r)};gn.version="18.3.1-next-f1338f8080-20240426";function sS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(sS)}catch(n){console.error(n)}}sS(),sv.exports=gn;var bg=sv.exports;const fL=Wy(bg),gL=zy({__proto__:null,default:fL},[bg]);var aS,wp=bg;aS=wp.createRoot,wp.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function We(){return We=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},We.apply(this,arguments)}var ut;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(ut||(ut={}));const Cp="popstate";function mL(n){n===void 0&&(n={});function e(r,i){let{pathname:s,search:a,hash:o}=r.location;return ko("",{pathname:s,search:a,hash:o},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:Ri(i)}return yL(e,t,null,n)}function Ee(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function va(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function pL(){return Math.random().toString(36).substr(2,8)}function Dp(n,e){return{usr:n.state,key:n.key,idx:e}}function ko(n,e,t,r){return t===void 0&&(t=null),We({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Pi(e):e,{state:t,key:e&&e.key||r||pL()})}function Ri(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Pi(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function yL(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,a=i.history,o=ut.Pop,l=null,u=c();u==null&&(u=0,a.replaceState(We({},a.state,{idx:u}),""));function c(){return(a.state||{idx:null}).idx}function d(){o=ut.Pop;let p=c(),y=p==null?null:p-u;u=p,l&&l({action:o,location:m.location,delta:y})}function h(p,y){o=ut.Push;let v=ko(m.location,p,y);u=c()+1;let E=Dp(v,u),_=m.createHref(v);try{a.pushState(E,"",_)}catch(L){if(L instanceof DOMException&&L.name==="DataCloneError")throw L;i.location.assign(_)}s&&l&&l({action:o,location:m.location,delta:1})}function f(p,y){o=ut.Replace;let v=ko(m.location,p,y);u=c();let E=Dp(v,u),_=m.createHref(v);a.replaceState(E,"",_),s&&l&&l({action:o,location:m.location,delta:0})}function g(p){let y=i.location.origin!=="null"?i.location.origin:i.location.href,v=typeof p=="string"?p:Ri(p);return v=v.replace(/ $/,"%20"),Ee(y,"No window.location.(origin|href) available to create URL for href: "+v),new URL(v,y)}let m={get action(){return o},get location(){return n(i,a)},listen(p){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(Cp,d),l=p,()=>{i.removeEventListener(Cp,d),l=null}},createHref(p){return e(i,p)},createURL:g,encodeLocation(p){let y=g(p);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:h,replace:f,go(p){return a.go(p)}};return m}var Me;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Me||(Me={}));const vL=new Set(["lazy","caseSensitive","path","id","index","children"]);function EL(n){return n.index===!0}function Po(n,e,t,r){return t===void 0&&(t=[]),r===void 0&&(r={}),n.map((i,s)=>{let a=[...t,String(s)],o=typeof i.id=="string"?i.id:a.join("-");if(Ee(i.index!==!0||!i.children,"Cannot specify children on an index route"),Ee(!r[o],'Found a route id collision on id "'+o+`".  Route id's must be globally unique within Data Router usages`),EL(i)){let l=We({},i,e(i),{id:o});return r[o]=l,l}else{let l=We({},i,e(i),{id:o,children:void 0});return r[o]=l,i.children&&(l.children=Po(i.children,e,a,r)),l}})}function Gi(n,e,t){return t===void 0&&(t="/"),Su(n,e,t,!1)}function Su(n,e,t,r){let i=typeof e=="string"?Pi(e):e,s=Ii(i.pathname||"/",t);if(s==null)return null;let a=oS(n);xL(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=kL(s);o=DL(a[l],u,r)}return o}function SL(n,e){let{route:t,pathname:r,params:i}=n;return{id:t.id,pathname:r,params:i,data:e[t.id],handle:t.handle}}function oS(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(Ee(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let u=dr([r,l.relativePath]),c=t.concat(l);s.children&&s.children.length>0&&(Ee(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),oS(s.children,e,c,u)),!(s.path==null&&!s.index)&&e.push({path:u,score:wL(u,s.index),routesMeta:c})};return n.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))i(s,a);else for(let l of lS(s.path))i(s,a,l)}),e}function lS(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let a=lS(r.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),i&&o.push(...a),o.map(l=>n.startsWith("/")&&l===""?"/":l)}function xL(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:CL(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const TL=/^:[\w-]+$/,_L=3,LL=2,AL=1,RL=10,IL=-2,bp=n=>n==="*";function wL(n,e){let t=n.split("/"),r=t.length;return t.some(bp)&&(r+=IL),e&&(r+=LL),t.filter(i=>!bp(i)).reduce((i,s)=>i+(TL.test(s)?_L:s===""?AL:RL),r)}function CL(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function DL(n,e,t){t===void 0&&(t=!1);let{routesMeta:r}=n,i={},s="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],u=o===r.length-1,c=s==="/"?e:e.slice(s.length)||"/",d=kp({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),h=l.route;if(!d&&u&&t&&!r[r.length-1].route.index&&(d=kp({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!d)return null;Object.assign(i,d.params),a.push({params:i,pathname:dr([s,d.pathname]),pathnameBase:FL(dr([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=dr([s,d.pathnameBase]))}return a}function kp(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=bL(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:r.reduce((u,c,d)=>{let{paramName:h,isOptional:f}=c;if(h==="*"){let m=o[d]||"";a=s.slice(0,s.length-m.length).replace(/(.)\/+$/,"$1")}const g=o[d];return f&&!g?u[h]=void 0:u[h]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:a,pattern:n}}function bL(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),va(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function kL(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return va(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function Ii(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function PL(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?Pi(n):n;return{pathname:t?t.startsWith("/")?t:OL(t,e):e,search:ML(r),hash:NL(i)}}function OL(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function Ld(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function uS(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Fc(n,e){let t=uS(n);return e?t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function Mc(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=Pi(n):(i=We({},n),Ee(!i.pathname||!i.pathname.includes("?"),Ld("?","pathname","search",i)),Ee(!i.pathname||!i.pathname.includes("#"),Ld("#","pathname","hash",i)),Ee(!i.search||!i.search.includes("#"),Ld("#","search","hash",i)));let s=n===""||i.pathname==="",a=s?"/":i.pathname,o;if(a==null)o=t;else{let d=e.length-1;if(!r&&a.startsWith("..")){let h=a.split("/");for(;h[0]==="..";)h.shift(),d-=1;i.pathname=h.join("/")}o=d>=0?e[d]:"/"}let l=PL(i,o),u=a&&a!=="/"&&a.endsWith("/"),c=(s||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const dr=n=>n.join("/").replace(/\/\/+/g,"/"),FL=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),ML=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,NL=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;class nc{constructor(e,t,r,i){i===void 0&&(i=!1),this.status=e,this.statusText=t||"",this.internal=i,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}}function Nc(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const cS=["post","put","patch","delete"],UL=new Set(cS),$L=["get",...cS],BL=new Set($L),jL=new Set([301,302,303,307,308]),GL=new Set([307,308]),Ad={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},VL={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},$a={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},kg=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,HL=n=>({hasErrorBoundary:!!n.hasErrorBoundary}),dS="remix-router-transitions";function KL(n){const e=n.window?n.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",r=!t;Ee(n.routes.length>0,"You must provide a non-empty routes array to createRouter");let i;if(n.mapRouteProperties)i=n.mapRouteProperties;else if(n.detectErrorBoundary){let D=n.detectErrorBoundary;i=k=>({hasErrorBoundary:D(k)})}else i=HL;let s={},a=Po(n.routes,i,void 0,s),o,l=n.basename||"/",u=n.unstable_dataStrategy||XL,c=n.unstable_patchRoutesOnNavigation,d=We({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},n.future),h=null,f=new Set,g=1e3,m=new Set,p=null,y=null,v=null,E=n.hydrationData!=null,_=Gi(a,n.history.location,l),L=null;if(_==null&&!c){let D=Nt(404,{pathname:n.history.location.pathname}),{matches:k,route:N}=jp(a);_=k,L={[N.id]:D}}_&&!n.hydrationData&&ul(_,a,n.history.location.pathname).active&&(_=null);let R;if(_)if(_.some(D=>D.route.lazy))R=!1;else if(!_.some(D=>D.route.loader))R=!0;else if(d.v7_partialHydration){let D=n.hydrationData?n.hydrationData.loaderData:null,k=n.hydrationData?n.hydrationData.errors:null,N=G=>G.route.loader?typeof G.route.loader=="function"&&G.route.loader.hydrate===!0?!1:D&&D[G.route.id]!==void 0||k&&k[G.route.id]!==void 0:!0;if(k){let G=_.findIndex(ee=>k[ee.route.id]!==void 0);R=_.slice(0,G+1).every(N)}else R=_.every(N)}else R=n.hydrationData!=null;else if(R=!1,_=[],d.v7_partialHydration){let D=ul(null,a,n.history.location.pathname);D.active&&D.matches&&(_=D.matches)}let A,T={historyAction:n.history.action,location:n.history.location,matches:_,initialized:R,navigation:Ad,restoreScrollPosition:n.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:n.hydrationData&&n.hydrationData.loaderData||{},actionData:n.hydrationData&&n.hydrationData.actionData||null,errors:n.hydrationData&&n.hydrationData.errors||L,fetchers:new Map,blockers:new Map},w=ut.Pop,I=!1,M,j=!1,z=new Map,K=null,W=!1,H=!1,X=[],$=new Set,F=new Map,U=0,Q=-1,Y=new Map,oe=new Set,de=new Map,pe=new Map,he=new Set,Fe=new Map,Ze=new Map,Wn=new Map,Mi;function Wc(){if(h=n.history.listen(D=>{let{action:k,location:N,delta:G}=D;if(Mi){Mi(),Mi=void 0;return}va(Ze.size===0||G!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let ee=gm({currentLocation:T.location,nextLocation:N,historyAction:k});if(ee&&G!=null){let ae=new Promise(fe=>{Mi=fe});n.history.go(G*-1),ol(ee,{state:"blocked",location:N,proceed(){ol(ee,{state:"proceeding",proceed:void 0,reset:void 0,location:N}),ae.then(()=>n.history.go(G))},reset(){let fe=new Map(T.blockers);fe.set(ee,$a),dt({blockers:fe})}});return}return ot(k,N)}),t){hA(e,z);let D=()=>fA(e,z);e.addEventListener("pagehide",D),K=()=>e.removeEventListener("pagehide",D)}return T.initialized||ot(ut.Pop,T.location,{initialHydration:!0}),A}function qc(){h&&h(),K&&K(),f.clear(),M&&M.abort(),T.fetchers.forEach((D,k)=>al(k)),T.blockers.forEach((D,k)=>fm(k))}function Ca(D){return f.add(D),()=>f.delete(D)}function dt(D,k){k===void 0&&(k={}),T=We({},T,D);let N=[],G=[];d.v7_fetcherPersist&&T.fetchers.forEach((ee,ae)=>{ee.state==="idle"&&(he.has(ae)?G.push(ae):N.push(ae))}),[...f].forEach(ee=>ee(T,{deletedFetchers:G,unstable_viewTransitionOpts:k.viewTransitionOpts,unstable_flushSync:k.flushSync===!0})),d.v7_fetcherPersist&&(N.forEach(ee=>T.fetchers.delete(ee)),G.forEach(ee=>al(ee)))}function Ni(D,k,N){var G,ee;let{flushSync:ae}=N===void 0?{}:N,fe=T.actionData!=null&&T.navigation.formMethod!=null&&Nn(T.navigation.formMethod)&&T.navigation.state==="loading"&&((G=D.state)==null?void 0:G._isRedirect)!==!0,q;k.actionData?Object.keys(k.actionData).length>0?q=k.actionData:q=null:fe?q=T.actionData:q=null;let le=k.loaderData?$p(T.loaderData,k.loaderData,k.matches||[],k.errors):T.loaderData,ie=T.blockers;ie.size>0&&(ie=new Map(ie),ie.forEach((ke,je)=>ie.set(je,$a)));let se=I===!0||T.navigation.formMethod!=null&&Nn(T.navigation.formMethod)&&((ee=D.state)==null?void 0:ee._isRedirect)!==!0;o&&(a=o,o=void 0),W||w===ut.Pop||(w===ut.Push?n.history.push(D,D.state):w===ut.Replace&&n.history.replace(D,D.state));let Ie;if(w===ut.Pop){let ke=z.get(T.location.pathname);ke&&ke.has(D.pathname)?Ie={currentLocation:T.location,nextLocation:D}:z.has(D.pathname)&&(Ie={currentLocation:D,nextLocation:T.location})}else if(j){let ke=z.get(T.location.pathname);ke?ke.add(D.pathname):(ke=new Set([D.pathname]),z.set(T.location.pathname,ke)),Ie={currentLocation:T.location,nextLocation:D}}dt(We({},k,{actionData:q,loaderData:le,historyAction:w,location:D,initialized:!0,navigation:Ad,revalidation:"idle",restoreScrollPosition:pm(D,k.matches||T.matches),preventScrollReset:se,blockers:ie}),{viewTransitionOpts:Ie,flushSync:ae===!0}),w=ut.Pop,I=!1,j=!1,W=!1,H=!1,X=[]}async function Te(D,k){if(typeof D=="number"){n.history.go(D);return}let N=ef(T.location,T.matches,l,d.v7_prependBasename,D,d.v7_relativeSplatPath,k==null?void 0:k.fromRouteId,k==null?void 0:k.relative),{path:G,submission:ee,error:ae}=Pp(d.v7_normalizeFormMethod,!1,N,k),fe=T.location,q=ko(T.location,G,k&&k.state);q=We({},q,n.history.encodeLocation(q));let le=k&&k.replace!=null?k.replace:void 0,ie=ut.Push;le===!0?ie=ut.Replace:le===!1||ee!=null&&Nn(ee.formMethod)&&ee.formAction===T.location.pathname+T.location.search&&(ie=ut.Replace);let se=k&&"preventScrollReset"in k?k.preventScrollReset===!0:void 0,Ie=(k&&k.unstable_flushSync)===!0,ke=gm({currentLocation:fe,nextLocation:q,historyAction:ie});if(ke){ol(ke,{state:"blocked",location:q,proceed(){ol(ke,{state:"proceeding",proceed:void 0,reset:void 0,location:q}),Te(D,k)},reset(){let je=new Map(T.blockers);je.set(ke,$a),dt({blockers:je})}});return}return await ot(ie,q,{submission:ee,pendingError:ae,preventScrollReset:se,replace:k&&k.replace,enableViewTransition:k&&k.unstable_viewTransition,flushSync:Ie})}function yt(){if(ps(),dt({revalidation:"loading"}),T.navigation.state!=="submitting"){if(T.navigation.state==="idle"){ot(T.historyAction,T.location,{startUninterruptedRevalidation:!0});return}ot(w||T.historyAction,T.navigation.location,{overrideNavigation:T.navigation,enableViewTransition:j===!0})}}async function ot(D,k,N){M&&M.abort(),M=null,w=D,W=(N&&N.startUninterruptedRevalidation)===!0,NT(T.location,T.matches),I=(N&&N.preventScrollReset)===!0,j=(N&&N.enableViewTransition)===!0;let G=o||a,ee=N&&N.overrideNavigation,ae=Gi(G,k,l),fe=(N&&N.flushSync)===!0,q=ul(ae,G,k.pathname);if(q.active&&q.matches&&(ae=q.matches),!ae){let{error:Le,notFoundMatches:vt,route:lt}=Yc(k.pathname);Ni(k,{matches:vt,loaderData:{},errors:{[lt.id]:Le}},{flushSync:fe});return}if(T.initialized&&!H&&rA(T.location,k)&&!(N&&N.submission&&Nn(N.submission.formMethod))){Ni(k,{matches:ae},{flushSync:fe});return}M=new AbortController;let le=Es(n.history,k,M.signal,N&&N.submission),ie;if(N&&N.pendingError)ie=[Us(ae).route.id,{type:Me.error,error:N.pendingError}];else if(N&&N.submission&&Nn(N.submission.formMethod)){let Le=await pr(le,k,N.submission,ae,q.active,{replace:N.replace,flushSync:fe});if(Le.shortCircuited)return;if(Le.pendingActionResult){let[vt,lt]=Le.pendingActionResult;if(an(lt)&&Nc(lt.error)&&lt.error.status===404){M=null,Ni(k,{matches:Le.matches,loaderData:{},errors:{[vt]:lt.error}});return}}ae=Le.matches||ae,ie=Le.pendingActionResult,ee=Rd(k,N.submission),fe=!1,q.active=!1,le=Es(n.history,le.url,le.signal)}let{shortCircuited:se,matches:Ie,loaderData:ke,errors:je}=await Jt(le,k,ae,q.active,ee,N&&N.submission,N&&N.fetcherSubmission,N&&N.replace,N&&N.initialHydration===!0,fe,ie);se||(M=null,Ni(k,We({matches:Ie||ae},Bp(ie),{loaderData:ke,errors:je})))}async function pr(D,k,N,G,ee,ae){ae===void 0&&(ae={}),ps();let fe=cA(k,N);if(dt({navigation:fe},{flushSync:ae.flushSync===!0}),ee){let ie=await cl(G,k.pathname,D.signal);if(ie.type==="aborted")return{shortCircuited:!0};if(ie.type==="error"){let{boundaryId:se,error:Ie}=ll(k.pathname,ie);return{matches:ie.partialMatches,pendingActionResult:[se,{type:Me.error,error:Ie}]}}else if(ie.matches)G=ie.matches;else{let{notFoundMatches:se,error:Ie,route:ke}=Yc(k.pathname);return{matches:se,pendingActionResult:[ke.id,{type:Me.error,error:Ie}]}}}let q,le=Xa(G,k);if(!le.route.action&&!le.route.lazy)q={type:Me.error,error:Nt(405,{method:D.method,pathname:k.pathname,routeId:le.route.id})};else if(q=(await Gr("action",T,D,[le],G,null))[le.route.id],D.signal.aborted)return{shortCircuited:!0};if(zi(q)){let ie;return ae&&ae.replace!=null?ie=ae.replace:ie=Mp(q.response.headers.get("Location"),new URL(D.url),l)===T.location.pathname+T.location.search,await en(D,q,!0,{submission:N,replace:ie}),{shortCircuited:!0}}if(gi(q))throw Nt(400,{type:"defer-action"});if(an(q)){let ie=Us(G,le.route.id);return(ae&&ae.replace)!==!0&&(w=ut.Push),{matches:G,pendingActionResult:[ie.route.id,q]}}return{matches:G,pendingActionResult:[le.route.id,q]}}async function Jt(D,k,N,G,ee,ae,fe,q,le,ie,se){let Ie=ee||Rd(k,ae),ke=ae||fe||Vp(Ie),je=!W&&(!d.v7_partialHydration||!le);if(G){if(je){let Je=yr(se);dt(We({navigation:Ie},Je!==void 0?{actionData:Je}:{}),{flushSync:ie})}let ye=await cl(N,k.pathname,D.signal);if(ye.type==="aborted")return{shortCircuited:!0};if(ye.type==="error"){let{boundaryId:Je,error:tn}=ll(k.pathname,ye);return{matches:ye.partialMatches,loaderData:{},errors:{[Je]:tn}}}else if(ye.matches)N=ye.matches;else{let{error:Je,notFoundMatches:tn,route:et}=Yc(k.pathname);return{matches:tn,loaderData:{},errors:{[et.id]:Je}}}}let Le=o||a,[vt,lt]=Op(n.history,T,N,ke,k,d.v7_partialHydration&&le===!0,d.v7_skipActionErrorRevalidation,H,X,$,he,de,oe,Le,l,se);if(Qc(ye=>!(N&&N.some(Je=>Je.route.id===ye))||vt&&vt.some(Je=>Je.route.id===ye)),Q=++U,vt.length===0&&lt.length===0){let ye=dm();return Ni(k,We({matches:N,loaderData:{},errors:se&&an(se[1])?{[se[0]]:se[1].error}:null},Bp(se),ye?{fetchers:new Map(T.fetchers)}:{}),{flushSync:ie}),{shortCircuited:!0}}if(je){let ye={};if(!G){ye.navigation=Ie;let Je=yr(se);Je!==void 0&&(ye.actionData=Je)}lt.length>0&&(ye.fetchers=vr(lt)),dt(ye,{flushSync:ie})}lt.forEach(ye=>{F.has(ye.key)&&Vr(ye.key),ye.controller&&F.set(ye.key,ye.controller)});let Da=()=>lt.forEach(ye=>Vr(ye.key));M&&M.signal.addEventListener("abort",Da);let{loaderResults:Er,fetcherResults:ys}=await sl(T,N,vt,lt,D);if(D.signal.aborted)return{shortCircuited:!0};M&&M.signal.removeEventListener("abort",Da),lt.forEach(ye=>F.delete(ye.key));let Hr=Pl(Er);if(Hr)return await en(D,Hr.result,!0,{replace:q}),{shortCircuited:!0};if(Hr=Pl(ys),Hr)return oe.add(Hr.key),await en(D,Hr.result,!0,{replace:q}),{shortCircuited:!0};let{loaderData:dl,errors:Sr}=Up(T,N,vt,Er,se,lt,ys,Fe);Fe.forEach((ye,Je)=>{ye.subscribe(tn=>{(tn||ye.done)&&Fe.delete(Je)})}),d.v7_partialHydration&&le&&T.errors&&Object.entries(T.errors).filter(ye=>{let[Je]=ye;return!vt.some(tn=>tn.route.id===Je)}).forEach(ye=>{let[Je,tn]=ye;Sr=Object.assign(Sr||{},{[Je]:tn})});let hl=dm(),fl=hm(Q),gl=hl||fl||lt.length>0;return We({matches:N,loaderData:dl,errors:Sr},gl?{fetchers:new Map(T.fetchers)}:{})}function yr(D){if(D&&!an(D[1]))return{[D[0]]:D[1].data};if(T.actionData)return Object.keys(T.actionData).length===0?null:T.actionData}function vr(D){return D.forEach(k=>{let N=T.fetchers.get(k.key),G=Ba(void 0,N?N.data:void 0);T.fetchers.set(k.key,G)}),new Map(T.fetchers)}function rl(D,k,N,G){if(r)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");F.has(D)&&Vr(D);let ee=(G&&G.unstable_flushSync)===!0,ae=o||a,fe=ef(T.location,T.matches,l,d.v7_prependBasename,N,d.v7_relativeSplatPath,k,G==null?void 0:G.relative),q=Gi(ae,fe,l),le=ul(q,ae,fe);if(le.active&&le.matches&&(q=le.matches),!q){Ot(D,k,Nt(404,{pathname:fe}),{flushSync:ee});return}let{path:ie,submission:se,error:Ie}=Pp(d.v7_normalizeFormMethod,!0,fe,G);if(Ie){Ot(D,k,Ie,{flushSync:ee});return}let ke=Xa(q,ie);if(I=(G&&G.preventScrollReset)===!0,se&&Nn(se.formMethod)){ms(D,k,ie,ke,q,le.active,ee,se);return}de.set(D,{routeId:k,path:ie}),il(D,k,ie,ke,q,le.active,ee,se)}async function ms(D,k,N,G,ee,ae,fe,q){ps(),de.delete(D);function le(et){if(!et.route.action&&!et.route.lazy){let xr=Nt(405,{method:q.formMethod,pathname:N,routeId:k});return Ot(D,k,xr,{flushSync:fe}),!0}return!1}if(!ae&&le(G))return;let ie=T.fetchers.get(D);Dn(D,dA(q,ie),{flushSync:fe});let se=new AbortController,Ie=Es(n.history,N,se.signal,q);if(ae){let et=await cl(ee,N,Ie.signal);if(et.type==="aborted")return;if(et.type==="error"){let{error:xr}=ll(N,et);Ot(D,k,xr,{flushSync:fe});return}else if(et.matches){if(ee=et.matches,G=Xa(ee,N),le(G))return}else{Ot(D,k,Nt(404,{pathname:N}),{flushSync:fe});return}}F.set(D,se);let ke=U,Le=(await Gr("action",T,Ie,[G],ee,D))[G.route.id];if(Ie.signal.aborted){F.get(D)===se&&F.delete(D);return}if(d.v7_fetcherPersist&&he.has(D)){if(zi(Le)||an(Le)){Dn(D,Yr(void 0));return}}else{if(zi(Le))if(F.delete(D),Q>ke){Dn(D,Yr(void 0));return}else return oe.add(D),Dn(D,Ba(q)),en(Ie,Le,!1,{fetcherSubmission:q});if(an(Le)){Ot(D,k,Le.error);return}}if(gi(Le))throw Nt(400,{type:"defer-action"});let vt=T.navigation.location||T.location,lt=Es(n.history,vt,se.signal),Da=o||a,Er=T.navigation.state!=="idle"?Gi(Da,T.navigation.location,l):T.matches;Ee(Er,"Didn't find any matches after fetcher action");let ys=++U;Y.set(D,ys);let Hr=Ba(q,Le.data);T.fetchers.set(D,Hr);let[dl,Sr]=Op(n.history,T,Er,q,vt,!1,d.v7_skipActionErrorRevalidation,H,X,$,he,de,oe,Da,l,[G.route.id,Le]);Sr.filter(et=>et.key!==D).forEach(et=>{let xr=et.key,vm=T.fetchers.get(xr),BT=Ba(void 0,vm?vm.data:void 0);T.fetchers.set(xr,BT),F.has(xr)&&Vr(xr),et.controller&&F.set(xr,et.controller)}),dt({fetchers:new Map(T.fetchers)});let hl=()=>Sr.forEach(et=>Vr(et.key));se.signal.addEventListener("abort",hl);let{loaderResults:fl,fetcherResults:gl}=await sl(T,Er,dl,Sr,lt);if(se.signal.aborted)return;se.signal.removeEventListener("abort",hl),Y.delete(D),F.delete(D),Sr.forEach(et=>F.delete(et.key));let ye=Pl(fl);if(ye)return en(lt,ye.result,!1);if(ye=Pl(gl),ye)return oe.add(ye.key),en(lt,ye.result,!1);let{loaderData:Je,errors:tn}=Up(T,Er,dl,fl,void 0,Sr,gl,Fe);if(T.fetchers.has(D)){let et=Yr(Le.data);T.fetchers.set(D,et)}hm(ys),T.navigation.state==="loading"&&ys>Q?(Ee(w,"Expected pending action"),M&&M.abort(),Ni(T.navigation.location,{matches:Er,loaderData:Je,errors:tn,fetchers:new Map(T.fetchers)})):(dt({errors:tn,loaderData:$p(T.loaderData,Je,Er,tn),fetchers:new Map(T.fetchers)}),H=!1)}async function il(D,k,N,G,ee,ae,fe,q){let le=T.fetchers.get(D);Dn(D,Ba(q,le?le.data:void 0),{flushSync:fe});let ie=new AbortController,se=Es(n.history,N,ie.signal);if(ae){let Le=await cl(ee,N,se.signal);if(Le.type==="aborted")return;if(Le.type==="error"){let{error:vt}=ll(N,Le);Ot(D,k,vt,{flushSync:fe});return}else if(Le.matches)ee=Le.matches,G=Xa(ee,N);else{Ot(D,k,Nt(404,{pathname:N}),{flushSync:fe});return}}F.set(D,ie);let Ie=U,je=(await Gr("loader",T,se,[G],ee,D))[G.route.id];if(gi(je)&&(je=await Pg(je,se.signal,!0)||je),F.get(D)===ie&&F.delete(D),!se.signal.aborted){if(he.has(D)){Dn(D,Yr(void 0));return}if(zi(je))if(Q>Ie){Dn(D,Yr(void 0));return}else{oe.add(D),await en(se,je,!1);return}if(an(je)){Ot(D,k,je.error);return}Ee(!gi(je),"Unhandled fetcher deferred data"),Dn(D,Yr(je.data))}}async function en(D,k,N,G){let{submission:ee,fetcherSubmission:ae,replace:fe}=G===void 0?{}:G;k.response.headers.has("X-Remix-Revalidate")&&(H=!0);let q=k.response.headers.get("Location");Ee(q,"Expected a Location header on the redirect Response"),q=Mp(q,new URL(D.url),l);let le=ko(T.location,q,{_isRedirect:!0});if(t){let Le=!1;if(k.response.headers.has("X-Remix-Reload-Document"))Le=!0;else if(kg.test(q)){const vt=n.history.createURL(q);Le=vt.origin!==e.location.origin||Ii(vt.pathname,l)==null}if(Le){fe?e.location.replace(q):e.location.assign(q);return}}M=null;let ie=fe===!0||k.response.headers.has("X-Remix-Replace")?ut.Replace:ut.Push,{formMethod:se,formAction:Ie,formEncType:ke}=T.navigation;!ee&&!ae&&se&&Ie&&ke&&(ee=Vp(T.navigation));let je=ee||ae;if(GL.has(k.response.status)&&je&&Nn(je.formMethod))await ot(ie,le,{submission:We({},je,{formAction:q}),preventScrollReset:I,enableViewTransition:N?j:void 0});else{let Le=Rd(le,ee);await ot(ie,le,{overrideNavigation:Le,fetcherSubmission:ae,preventScrollReset:I,enableViewTransition:N?j:void 0})}}async function Gr(D,k,N,G,ee,ae){let fe,q={};try{fe=await ZL(u,D,k,N,G,ee,ae,s,i)}catch(le){return G.forEach(ie=>{q[ie.route.id]={type:Me.error,error:le}}),q}for(let[le,ie]of Object.entries(fe))if(sA(ie)){let se=ie.result;q[le]={type:Me.redirect,response:tA(se,N,le,ee,l,d.v7_relativeSplatPath)}}else q[le]=await eA(ie);return q}async function sl(D,k,N,G,ee){let ae=D.matches,fe=Gr("loader",D,ee,N,k,null),q=Promise.all(G.map(async se=>{if(se.matches&&se.match&&se.controller){let ke=(await Gr("loader",D,Es(n.history,se.path,se.controller.signal),[se.match],se.matches,se.key))[se.match.route.id];return{[se.key]:ke}}else return Promise.resolve({[se.key]:{type:Me.error,error:Nt(404,{pathname:se.path})}})})),le=await fe,ie=(await q).reduce((se,Ie)=>Object.assign(se,Ie),{});return await Promise.all([lA(k,le,ee.signal,ae,D.loaderData),uA(k,ie,G)]),{loaderResults:le,fetcherResults:ie}}function ps(){H=!0,X.push(...Qc()),de.forEach((D,k)=>{F.has(k)&&($.add(k),Vr(k))})}function Dn(D,k,N){N===void 0&&(N={}),T.fetchers.set(D,k),dt({fetchers:new Map(T.fetchers)},{flushSync:(N&&N.flushSync)===!0})}function Ot(D,k,N,G){G===void 0&&(G={});let ee=Us(T.matches,k);al(D),dt({errors:{[ee.route.id]:N},fetchers:new Map(T.fetchers)},{flushSync:(G&&G.flushSync)===!0})}function um(D){return d.v7_fetcherPersist&&(pe.set(D,(pe.get(D)||0)+1),he.has(D)&&he.delete(D)),T.fetchers.get(D)||VL}function al(D){let k=T.fetchers.get(D);F.has(D)&&!(k&&k.state==="loading"&&Y.has(D))&&Vr(D),de.delete(D),Y.delete(D),oe.delete(D),he.delete(D),$.delete(D),T.fetchers.delete(D)}function OT(D){if(d.v7_fetcherPersist){let k=(pe.get(D)||0)-1;k<=0?(pe.delete(D),he.add(D)):pe.set(D,k)}else al(D);dt({fetchers:new Map(T.fetchers)})}function Vr(D){let k=F.get(D);Ee(k,"Expected fetch controller: "+D),k.abort(),F.delete(D)}function cm(D){for(let k of D){let N=um(k),G=Yr(N.data);T.fetchers.set(k,G)}}function dm(){let D=[],k=!1;for(let N of oe){let G=T.fetchers.get(N);Ee(G,"Expected fetcher: "+N),G.state==="loading"&&(oe.delete(N),D.push(N),k=!0)}return cm(D),k}function hm(D){let k=[];for(let[N,G]of Y)if(G<D){let ee=T.fetchers.get(N);Ee(ee,"Expected fetcher: "+N),ee.state==="loading"&&(Vr(N),Y.delete(N),k.push(N))}return cm(k),k.length>0}function FT(D,k){let N=T.blockers.get(D)||$a;return Ze.get(D)!==k&&Ze.set(D,k),N}function fm(D){T.blockers.delete(D),Ze.delete(D)}function ol(D,k){let N=T.blockers.get(D)||$a;Ee(N.state==="unblocked"&&k.state==="blocked"||N.state==="blocked"&&k.state==="blocked"||N.state==="blocked"&&k.state==="proceeding"||N.state==="blocked"&&k.state==="unblocked"||N.state==="proceeding"&&k.state==="unblocked","Invalid blocker state transition: "+N.state+" -> "+k.state);let G=new Map(T.blockers);G.set(D,k),dt({blockers:G})}function gm(D){let{currentLocation:k,nextLocation:N,historyAction:G}=D;if(Ze.size===0)return;Ze.size>1&&va(!1,"A router only supports one blocker at a time");let ee=Array.from(Ze.entries()),[ae,fe]=ee[ee.length-1],q=T.blockers.get(ae);if(!(q&&q.state==="proceeding")&&fe({currentLocation:k,nextLocation:N,historyAction:G}))return ae}function Yc(D){let k=Nt(404,{pathname:D}),N=o||a,{matches:G,route:ee}=jp(N);return Qc(),{notFoundMatches:G,route:ee,error:k}}function ll(D,k){return{boundaryId:Us(k.partialMatches).route.id,error:Nt(400,{type:"route-discovery",pathname:D,message:k.error!=null&&"message"in k.error?k.error:String(k.error)})}}function Qc(D){let k=[];return Fe.forEach((N,G)=>{(!D||D(G))&&(N.cancel(),k.push(G),Fe.delete(G))}),k}function MT(D,k,N){if(p=D,v=k,y=N||null,!E&&T.navigation===Ad){E=!0;let G=pm(T.location,T.matches);G!=null&&dt({restoreScrollPosition:G})}return()=>{p=null,v=null,y=null}}function mm(D,k){return y&&y(D,k.map(G=>SL(G,T.loaderData)))||D.key}function NT(D,k){if(p&&v){let N=mm(D,k);p[N]=v()}}function pm(D,k){if(p){let N=mm(D,k),G=p[N];if(typeof G=="number")return G}return null}function ul(D,k,N){if(c){if(m.has(N))return{active:!1,matches:D};if(D){if(Object.keys(D[0].params).length>0)return{active:!0,matches:Su(k,N,l,!0)}}else return{active:!0,matches:Su(k,N,l,!0)||[]}}return{active:!1,matches:null}}async function cl(D,k,N){let G=D;for(;;){let ee=o==null,ae=o||a;try{await YL(c,k,G,ae,s,i,Wn,N)}catch(le){return{type:"error",error:le,partialMatches:G}}finally{ee&&(a=[...a])}if(N.aborted)return{type:"aborted"};let fe=Gi(ae,k,l);if(fe)return ym(k,m),{type:"success",matches:fe};let q=Su(ae,k,l,!0);if(!q||G.length===q.length&&G.every((le,ie)=>le.route.id===q[ie].route.id))return ym(k,m),{type:"success",matches:null};G=q}}function ym(D,k){if(k.size>=g){let N=k.values().next().value;k.delete(N)}k.add(D)}function UT(D){s={},o=Po(D,i,void 0,s)}function $T(D,k){let N=o==null;fS(D,k,o||a,s,i),N&&(a=[...a],dt({}))}return A={get basename(){return l},get future(){return d},get state(){return T},get routes(){return a},get window(){return e},initialize:Wc,subscribe:Ca,enableScrollRestoration:MT,navigate:Te,fetch:rl,revalidate:yt,createHref:D=>n.history.createHref(D),encodeLocation:D=>n.history.encodeLocation(D),getFetcher:um,deleteFetcher:OT,dispose:qc,getBlocker:FT,deleteBlocker:fm,patchRoutes:$T,_internalFetchControllers:F,_internalActiveDeferreds:Fe,_internalSetRoutes:UT},A}function zL(n){return n!=null&&("formData"in n&&n.formData!=null||"body"in n&&n.body!==void 0)}function ef(n,e,t,r,i,s,a,o){let l,u;if(a){l=[];for(let d of e)if(l.push(d),d.route.id===a){u=d;break}}else l=e,u=e[e.length-1];let c=Mc(i||".",Fc(l,s),Ii(n.pathname,t)||n.pathname,o==="path");return i==null&&(c.search=n.search,c.hash=n.hash),(i==null||i===""||i===".")&&u&&u.route.index&&!Og(c.search)&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),r&&t!=="/"&&(c.pathname=c.pathname==="/"?t:dr([t,c.pathname])),Ri(c)}function Pp(n,e,t,r){if(!r||!zL(r))return{path:t};if(r.formMethod&&!oA(r.formMethod))return{path:t,error:Nt(405,{method:r.formMethod})};let i=()=>({path:t,error:Nt(400,{type:"invalid-body"})}),s=r.formMethod||"get",a=n?s.toUpperCase():s.toLowerCase(),o=gS(t);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Nn(a))return i();let h=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((f,g)=>{let[m,p]=g;return""+f+m+"="+p+`
`},""):String(r.body);return{path:t,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:void 0,text:h}}}else if(r.formEncType==="application/json"){if(!Nn(a))return i();try{let h=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:t,submission:{formMethod:a,formAction:o,formEncType:r.formEncType,formData:void 0,json:h,text:void 0}}}catch{return i()}}}Ee(typeof FormData=="function","FormData is not available in this environment");let l,u;if(r.formData)l=tf(r.formData),u=r.formData;else if(r.body instanceof FormData)l=tf(r.body),u=r.body;else if(r.body instanceof URLSearchParams)l=r.body,u=Np(l);else if(r.body==null)l=new URLSearchParams,u=new FormData;else try{l=new URLSearchParams(r.body),u=Np(l)}catch{return i()}let c={formMethod:a,formAction:o,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:u,json:void 0,text:void 0};if(Nn(c.formMethod))return{path:t,submission:c};let d=Pi(t);return e&&d.search&&Og(d.search)&&l.append("index",""),d.search="?"+l,{path:Ri(d),submission:c}}function WL(n,e){let t=n;if(e){let r=n.findIndex(i=>i.route.id===e);r>=0&&(t=n.slice(0,r))}return t}function Op(n,e,t,r,i,s,a,o,l,u,c,d,h,f,g,m){let p=m?an(m[1])?m[1].error:m[1].data:void 0,y=n.createURL(e.location),v=n.createURL(i),E=m&&an(m[1])?m[0]:void 0,_=E?WL(t,E):t,L=m?m[1].statusCode:void 0,R=a&&L&&L>=400,A=_.filter((w,I)=>{let{route:M}=w;if(M.lazy)return!0;if(M.loader==null)return!1;if(s)return typeof M.loader!="function"||M.loader.hydrate?!0:e.loaderData[M.id]===void 0&&(!e.errors||e.errors[M.id]===void 0);if(qL(e.loaderData,e.matches[I],w)||l.some(K=>K===w.route.id))return!0;let j=e.matches[I],z=w;return Fp(w,We({currentUrl:y,currentParams:j.params,nextUrl:v,nextParams:z.params},r,{actionResult:p,actionStatus:L,defaultShouldRevalidate:R?!1:o||y.pathname+y.search===v.pathname+v.search||y.search!==v.search||hS(j,z)}))}),T=[];return d.forEach((w,I)=>{if(s||!t.some(W=>W.route.id===w.routeId)||c.has(I))return;let M=Gi(f,w.path,g);if(!M){T.push({key:I,routeId:w.routeId,path:w.path,matches:null,match:null,controller:null});return}let j=e.fetchers.get(I),z=Xa(M,w.path),K=!1;h.has(I)?K=!1:u.has(I)?(u.delete(I),K=!0):j&&j.state!=="idle"&&j.data===void 0?K=o:K=Fp(z,We({currentUrl:y,currentParams:e.matches[e.matches.length-1].params,nextUrl:v,nextParams:t[t.length-1].params},r,{actionResult:p,actionStatus:L,defaultShouldRevalidate:R?!1:o})),K&&T.push({key:I,routeId:w.routeId,path:w.path,matches:M,match:z,controller:new AbortController})}),[A,T]}function qL(n,e,t){let r=!e||t.route.id!==e.route.id,i=n[t.route.id]===void 0;return r||i}function hS(n,e){let t=n.route.path;return n.pathname!==e.pathname||t!=null&&t.endsWith("*")&&n.params["*"]!==e.params["*"]}function Fp(n,e){if(n.route.shouldRevalidate){let t=n.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}async function YL(n,e,t,r,i,s,a,o){let l=[e,...t.map(u=>u.route.id)].join("-");try{let u=a.get(l);u||(u=n({path:e,matches:t,patch:(c,d)=>{o.aborted||fS(c,d,r,i,s)}}),a.set(l,u)),u&&iA(u)&&await u}finally{a.delete(l)}}function fS(n,e,t,r,i){if(n){var s;let a=r[n];Ee(a,"No route found to patch children into: routeId = "+n);let o=Po(e,i,[n,"patch",String(((s=a.children)==null?void 0:s.length)||"0")],r);a.children?a.children.push(...o):a.children=o}else{let a=Po(e,i,["patch",String(t.length||"0")],r);t.push(...a)}}async function QL(n,e,t){if(!n.lazy)return;let r=await n.lazy();if(!n.lazy)return;let i=t[n.id];Ee(i,"No route found in manifest");let s={};for(let a in r){let l=i[a]!==void 0&&a!=="hasErrorBoundary";va(!l,'Route "'+i.id+'" has a static property "'+a+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+a+'" will be ignored.')),!l&&!vL.has(a)&&(s[a]=r[a])}Object.assign(i,s),Object.assign(i,We({},e(i),{lazy:void 0}))}async function XL(n){let{matches:e}=n,t=e.filter(i=>i.shouldLoad);return(await Promise.all(t.map(i=>i.resolve()))).reduce((i,s,a)=>Object.assign(i,{[t[a].route.id]:s}),{})}async function ZL(n,e,t,r,i,s,a,o,l,u){let c=s.map(f=>f.route.lazy?QL(f.route,l,o):void 0),d=s.map((f,g)=>{let m=c[g],p=i.some(v=>v.route.id===f.route.id);return We({},f,{shouldLoad:p,resolve:async v=>(v&&r.method==="GET"&&(f.route.lazy||f.route.loader)&&(p=!0),p?JL(e,r,f,m,v,u):Promise.resolve({type:Me.data,result:void 0}))})}),h=await n({matches:d,request:r,params:s[0].params,fetcherKey:a,context:u});try{await Promise.all(c)}catch{}return h}async function JL(n,e,t,r,i,s){let a,o,l=u=>{let c,d=new Promise((g,m)=>c=m);o=()=>c(),e.signal.addEventListener("abort",o);let h=g=>typeof u!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+n+'" [routeId: '+t.route.id+"]"))):u({request:e,params:t.params,context:s},...g!==void 0?[g]:[]),f=(async()=>{try{return{type:"data",result:await(i?i(m=>h(m)):h())}}catch(g){return{type:"error",result:g}}})();return Promise.race([f,d])};try{let u=t.route[n];if(r)if(u){let c,[d]=await Promise.all([l(u).catch(h=>{c=h}),r]);if(c!==void 0)throw c;a=d}else if(await r,u=t.route[n],u)a=await l(u);else if(n==="action"){let c=new URL(e.url),d=c.pathname+c.search;throw Nt(405,{method:e.method,pathname:d,routeId:t.route.id})}else return{type:Me.data,result:void 0};else if(u)a=await l(u);else{let c=new URL(e.url),d=c.pathname+c.search;throw Nt(404,{pathname:d})}Ee(a.result!==void 0,"You defined "+(n==="action"?"an action":"a loader")+" for route "+('"'+t.route.id+"\" but didn't return anything from your `"+n+"` ")+"function. Please return a value or `null`.")}catch(u){return{type:Me.error,result:u}}finally{o&&e.signal.removeEventListener("abort",o)}return a}async function eA(n){let{result:e,type:t}=n;if(mS(e)){let u;try{let c=e.headers.get("Content-Type");c&&/\bapplication\/json\b/.test(c)?e.body==null?u=null:u=await e.json():u=await e.text()}catch(c){return{type:Me.error,error:c}}return t===Me.error?{type:Me.error,error:new nc(e.status,e.statusText,u),statusCode:e.status,headers:e.headers}:{type:Me.data,data:u,statusCode:e.status,headers:e.headers}}if(t===Me.error){if(Gp(e)){var r;if(e.data instanceof Error){var i;return{type:Me.error,error:e.data,statusCode:(i=e.init)==null?void 0:i.status}}e=new nc(((r=e.init)==null?void 0:r.status)||500,void 0,e.data)}return{type:Me.error,error:e,statusCode:Nc(e)?e.status:void 0}}if(aA(e)){var s,a;return{type:Me.deferred,deferredData:e,statusCode:(s=e.init)==null?void 0:s.status,headers:((a=e.init)==null?void 0:a.headers)&&new Headers(e.init.headers)}}if(Gp(e)){var o,l;return{type:Me.data,data:e.data,statusCode:(o=e.init)==null?void 0:o.status,headers:(l=e.init)!=null&&l.headers?new Headers(e.init.headers):void 0}}return{type:Me.data,data:e}}function tA(n,e,t,r,i,s){let a=n.headers.get("Location");if(Ee(a,"Redirects returned/thrown from loaders/actions must have a Location header"),!kg.test(a)){let o=r.slice(0,r.findIndex(l=>l.route.id===t)+1);a=ef(new URL(e.url),o,i,!0,a,s),n.headers.set("Location",a)}return n}function Mp(n,e,t){if(kg.test(n)){let r=n,i=r.startsWith("//")?new URL(e.protocol+r):new URL(r),s=Ii(i.pathname,t)!=null;if(i.origin===e.origin&&s)return i.pathname+i.search+i.hash}return n}function Es(n,e,t,r){let i=n.createURL(gS(e)).toString(),s={signal:t};if(r&&Nn(r.formMethod)){let{formMethod:a,formEncType:o}=r;s.method=a.toUpperCase(),o==="application/json"?(s.headers=new Headers({"Content-Type":o}),s.body=JSON.stringify(r.json)):o==="text/plain"?s.body=r.text:o==="application/x-www-form-urlencoded"&&r.formData?s.body=tf(r.formData):s.body=r.formData}return new Request(i,s)}function tf(n){let e=new URLSearchParams;for(let[t,r]of n.entries())e.append(t,typeof r=="string"?r:r.name);return e}function Np(n){let e=new FormData;for(let[t,r]of n.entries())e.append(t,r);return e}function nA(n,e,t,r,i){let s={},a=null,o,l=!1,u={},c=t&&an(t[1])?t[1].error:void 0;return n.forEach(d=>{if(!(d.route.id in e))return;let h=d.route.id,f=e[h];if(Ee(!zi(f),"Cannot handle redirect results in processLoaderData"),an(f)){let g=f.error;c!==void 0&&(g=c,c=void 0),a=a||{};{let m=Us(n,h);a[m.route.id]==null&&(a[m.route.id]=g)}s[h]=void 0,l||(l=!0,o=Nc(f.error)?f.error.status:500),f.headers&&(u[h]=f.headers)}else gi(f)?(r.set(h,f.deferredData),s[h]=f.deferredData.data,f.statusCode!=null&&f.statusCode!==200&&!l&&(o=f.statusCode),f.headers&&(u[h]=f.headers)):(s[h]=f.data,f.statusCode&&f.statusCode!==200&&!l&&(o=f.statusCode),f.headers&&(u[h]=f.headers))}),c!==void 0&&t&&(a={[t[0]]:c},s[t[0]]=void 0),{loaderData:s,errors:a,statusCode:o||200,loaderHeaders:u}}function Up(n,e,t,r,i,s,a,o){let{loaderData:l,errors:u}=nA(e,r,i,o);return s.forEach(c=>{let{key:d,match:h,controller:f}=c,g=a[d];if(Ee(g,"Did not find corresponding fetcher result"),!(f&&f.signal.aborted))if(an(g)){let m=Us(n.matches,h==null?void 0:h.route.id);u&&u[m.route.id]||(u=We({},u,{[m.route.id]:g.error})),n.fetchers.delete(d)}else if(zi(g))Ee(!1,"Unhandled fetcher revalidation redirect");else if(gi(g))Ee(!1,"Unhandled fetcher deferred data");else{let m=Yr(g.data);n.fetchers.set(d,m)}}),{loaderData:l,errors:u}}function $p(n,e,t,r){let i=We({},e);for(let s of t){let a=s.route.id;if(e.hasOwnProperty(a)?e[a]!==void 0&&(i[a]=e[a]):n[a]!==void 0&&s.route.loader&&(i[a]=n[a]),r&&r.hasOwnProperty(a))break}return i}function Bp(n){return n?an(n[1])?{actionData:{}}:{actionData:{[n[0]]:n[1].data}}:{}}function Us(n,e){return(e?n.slice(0,n.findIndex(r=>r.route.id===e)+1):[...n]).reverse().find(r=>r.route.hasErrorBoundary===!0)||n[0]}function jp(n){let e=n.length===1?n[0]:n.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Nt(n,e){let{pathname:t,routeId:r,method:i,type:s,message:a}=e===void 0?{}:e,o="Unknown Server Error",l="Unknown @remix-run/router error";return n===400?(o="Bad Request",s==="route-discovery"?l='Unable to match URL "'+t+'" - the `unstable_patchRoutesOnNavigation()` '+(`function threw the following error:
`+a):i&&t&&r?l="You made a "+i+' request to "'+t+'" but '+('did not provide a `loader` for route "'+r+'", ')+"so there is no way to handle the request.":s==="defer-action"?l="defer() is not supported in actions":s==="invalid-body"&&(l="Unable to encode submission body")):n===403?(o="Forbidden",l='Route "'+r+'" does not match URL "'+t+'"'):n===404?(o="Not Found",l='No route matches URL "'+t+'"'):n===405&&(o="Method Not Allowed",i&&t&&r?l="You made a "+i.toUpperCase()+' request to "'+t+'" but '+('did not provide an `action` for route "'+r+'", ')+"so there is no way to handle the request.":i&&(l='Invalid request method "'+i.toUpperCase()+'"')),new nc(n||500,o,new Error(l),!0)}function Pl(n){let e=Object.entries(n);for(let t=e.length-1;t>=0;t--){let[r,i]=e[t];if(zi(i))return{key:r,result:i}}}function gS(n){let e=typeof n=="string"?Pi(n):n;return Ri(We({},e,{hash:""}))}function rA(n,e){return n.pathname!==e.pathname||n.search!==e.search?!1:n.hash===""?e.hash!=="":n.hash===e.hash?!0:e.hash!==""}function iA(n){return typeof n=="object"&&n!=null&&"then"in n}function sA(n){return mS(n.result)&&jL.has(n.result.status)}function gi(n){return n.type===Me.deferred}function an(n){return n.type===Me.error}function zi(n){return(n&&n.type)===Me.redirect}function Gp(n){return typeof n=="object"&&n!=null&&"type"in n&&"data"in n&&"init"in n&&n.type==="DataWithResponseInit"}function aA(n){let e=n;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function mS(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.headers=="object"&&typeof n.body<"u"}function oA(n){return BL.has(n.toLowerCase())}function Nn(n){return UL.has(n.toLowerCase())}async function lA(n,e,t,r,i){let s=Object.entries(e);for(let a=0;a<s.length;a++){let[o,l]=s[a],u=n.find(h=>(h==null?void 0:h.route.id)===o);if(!u)continue;let c=r.find(h=>h.route.id===u.route.id),d=c!=null&&!hS(c,u)&&(i&&i[u.route.id])!==void 0;gi(l)&&d&&await Pg(l,t,!1).then(h=>{h&&(e[o]=h)})}}async function uA(n,e,t){for(let r=0;r<t.length;r++){let{key:i,routeId:s,controller:a}=t[r],o=e[i];n.find(u=>(u==null?void 0:u.route.id)===s)&&gi(o)&&(Ee(a,"Expected an AbortController for revalidating fetcher deferred result"),await Pg(o,a.signal,!0).then(u=>{u&&(e[i]=u)}))}}async function Pg(n,e,t){if(t===void 0&&(t=!1),!await n.deferredData.resolveData(e)){if(t)try{return{type:Me.data,data:n.deferredData.unwrappedData}}catch(i){return{type:Me.error,error:i}}return{type:Me.data,data:n.deferredData.data}}}function Og(n){return new URLSearchParams(n).getAll("index").some(e=>e==="")}function Xa(n,e){let t=typeof e=="string"?Pi(e).search:e.search;if(n[n.length-1].route.index&&Og(t||""))return n[n.length-1];let r=uS(n);return r[r.length-1]}function Vp(n){let{formMethod:e,formAction:t,formEncType:r,text:i,formData:s,json:a}=n;if(!(!e||!t||!r)){if(i!=null)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:void 0,text:i};if(s!=null)return{formMethod:e,formAction:t,formEncType:r,formData:s,json:void 0,text:void 0};if(a!==void 0)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:a,text:void 0}}}function Rd(n,e){return e?{state:"loading",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function cA(n,e){return{state:"submitting",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function Ba(n,e){return n?{state:"loading",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function dA(n,e){return{state:"submitting",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e?e.data:void 0}}function Yr(n){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function hA(n,e){try{let t=n.sessionStorage.getItem(dS);if(t){let r=JSON.parse(t);for(let[i,s]of Object.entries(r||{}))s&&Array.isArray(s)&&e.set(i,new Set(s||[]))}}catch{}}function fA(n,e){if(e.size>0){let t={};for(let[r,i]of e)t[r]=[...i];try{n.sessionStorage.setItem(dS,JSON.stringify(t))}catch(r){va(!1,"Failed to save applied view transitions in sessionStorage ("+r+").")}}}/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rc(){return rc=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},rc.apply(this,arguments)}const Zo=C.createContext(null),pS=C.createContext(null),fr=C.createContext(null),Fg=C.createContext(null),Hn=C.createContext({outlet:null,matches:[],isDataRoute:!1}),yS=C.createContext(null);function gA(n,e){let{relative:t}=e===void 0?{}:e;Ra()||Ee(!1);let{basename:r,navigator:i}=C.useContext(fr),{hash:s,pathname:a,search:o}=Mg(n,{relative:t}),l=a;return r!=="/"&&(l=a==="/"?r:dr([r,a])),i.createHref({pathname:l,search:o,hash:s})}function Ra(){return C.useContext(Fg)!=null}function Oi(){return Ra()||Ee(!1),C.useContext(Fg).location}function vS(n){C.useContext(fr).static||C.useLayoutEffect(n)}function Kn(){let{isDataRoute:n}=C.useContext(Hn);return n?wA():mA()}function mA(){Ra()||Ee(!1);let n=C.useContext(Zo),{basename:e,future:t,navigator:r}=C.useContext(fr),{matches:i}=C.useContext(Hn),{pathname:s}=Oi(),a=JSON.stringify(Fc(i,t.v7_relativeSplatPath)),o=C.useRef(!1);return vS(()=>{o.current=!0}),C.useCallback(function(u,c){if(c===void 0&&(c={}),!o.current)return;if(typeof u=="number"){r.go(u);return}let d=Mc(u,JSON.parse(a),s,c.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:dr([e,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[e,r,a,s,n])}const pA=C.createContext(null);function yA(n){let e=C.useContext(Hn).outlet;return e&&C.createElement(pA.Provider,{value:n},e)}function Br(){let{matches:n}=C.useContext(Hn),e=n[n.length-1];return e?e.params:{}}function Mg(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=C.useContext(fr),{matches:i}=C.useContext(Hn),{pathname:s}=Oi(),a=JSON.stringify(Fc(i,r.v7_relativeSplatPath));return C.useMemo(()=>Mc(n,JSON.parse(a),s,t==="path"),[n,a,s,t])}function vA(n,e,t,r){Ra()||Ee(!1);let{navigator:i}=C.useContext(fr),{matches:s}=C.useContext(Hn),a=s[s.length-1],o=a?a.params:{};a&&a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let u=Oi(),c;c=u;let d=c.pathname||"/",h=d;if(l!=="/"){let m=l.replace(/^\//,"").split("/");h="/"+d.replace(/^\//,"").split("/").slice(m.length).join("/")}let f=Gi(n,{pathname:h});return _A(f&&f.map(m=>Object.assign({},m,{params:Object.assign({},o,m.params),pathname:dr([l,i.encodeLocation?i.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?l:dr([l,i.encodeLocation?i.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),s,t,r)}function EA(){let n=IA(),e=Nc(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},e),t?C.createElement("pre",{style:i},t):null,null)}const SA=C.createElement(EA,null);class xA extends C.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?C.createElement(Hn.Provider,{value:this.props.routeContext},C.createElement(yS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function TA(n){let{routeContext:e,match:t,children:r}=n,i=C.useContext(Zo);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),C.createElement(Hn.Provider,{value:e},r)}function _A(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var s;if(!t)return null;if(t.errors)n=t.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let a=n,o=(i=t)==null?void 0:i.errors;if(o!=null){let c=a.findIndex(d=>d.route.id&&(o==null?void 0:o[d.route.id])!==void 0);c>=0||Ee(!1),a=a.slice(0,Math.min(a.length,c+1))}let l=!1,u=-1;if(t&&r&&r.v7_partialHydration)for(let c=0;c<a.length;c++){let d=a[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:h,errors:f}=t,g=d.route.loader&&h[d.route.id]===void 0&&(!f||f[d.route.id]===void 0);if(d.route.lazy||g){l=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((c,d,h)=>{let f,g=!1,m=null,p=null;t&&(f=o&&d.route.id?o[d.route.id]:void 0,m=d.route.errorElement||SA,l&&(u<0&&h===0?(CA("route-fallback"),g=!0,p=null):u===h&&(g=!0,p=d.route.hydrateFallbackElement||null)));let y=e.concat(a.slice(0,h+1)),v=()=>{let E;return f?E=m:g?E=p:d.route.Component?E=C.createElement(d.route.Component,null):d.route.element?E=d.route.element:E=c,C.createElement(TA,{match:d,routeContext:{outlet:c,matches:y,isDataRoute:t!=null},children:E})};return t&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?C.createElement(xA,{location:t.location,revalidation:t.revalidation,component:m,error:f,children:v(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):v()},null)}var ES=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(ES||{}),ls=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(ls||{});function LA(n){let e=C.useContext(Zo);return e||Ee(!1),e}function SS(n){let e=C.useContext(pS);return e||Ee(!1),e}function AA(n){let e=C.useContext(Hn);return e||Ee(!1),e}function Uc(n){let e=AA(),t=e.matches[e.matches.length-1];return t.route.id||Ee(!1),t.route.id}function RA(){return Uc(ls.UseRouteId)}function xS(){let n=SS(ls.UseActionData),e=Uc(ls.UseLoaderData);return n.actionData?n.actionData[e]:void 0}function IA(){var n;let e=C.useContext(yS),t=SS(ls.UseRouteError),r=Uc(ls.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function wA(){let{router:n}=LA(ES.UseNavigateStable),e=Uc(ls.UseNavigateStable),t=C.useRef(!1);return vS(()=>{t.current=!0}),C.useCallback(function(i,s){s===void 0&&(s={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,rc({fromRouteId:e},s)))},[n,e])}const Hp={};function CA(n,e,t){Hp[n]||(Hp[n]=!0)}function DA(n){let{to:e,replace:t,state:r,relative:i}=n;Ra()||Ee(!1);let{future:s,static:a}=C.useContext(fr),{matches:o}=C.useContext(Hn),{pathname:l}=Oi(),u=Kn(),c=Mc(e,Fc(o,s.v7_relativeSplatPath),l,i==="path"),d=JSON.stringify(c);return C.useEffect(()=>u(JSON.parse(d),{replace:t,state:r,relative:i}),[u,d,i,t,r]),null}function bA(n){return yA(n.context)}function kA(n){let{basename:e="/",children:t=null,location:r,navigationType:i=ut.Pop,navigator:s,static:a=!1,future:o}=n;Ra()&&Ee(!1);let l=e.replace(/^\/*/,"/"),u=C.useMemo(()=>({basename:l,navigator:s,static:a,future:rc({v7_relativeSplatPath:!1},o)}),[l,o,s,a]);typeof r=="string"&&(r=Pi(r));let{pathname:c="/",search:d="",hash:h="",state:f=null,key:g="default"}=r,m=C.useMemo(()=>{let p=Ii(c,l);return p==null?null:{location:{pathname:p,search:d,hash:h,state:f,key:g},navigationType:i}},[l,c,d,h,f,g,i]);return m==null?null:C.createElement(fr.Provider,{value:u},C.createElement(Fg.Provider,{children:t,value:m}))}new Promise(()=>{});function PA(n){let e={hasErrorBoundary:n.ErrorBoundary!=null||n.errorElement!=null};return n.Component&&Object.assign(e,{element:C.createElement(n.Component),Component:void 0}),n.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:C.createElement(n.HydrateFallback),HydrateFallback:void 0}),n.ErrorBoundary&&Object.assign(e,{errorElement:C.createElement(n.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function us(){return us=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},us.apply(this,arguments)}function TS(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}const xu="get",Id="application/x-www-form-urlencoded";function $c(n){return n!=null&&typeof n.tagName=="string"}function OA(n){return $c(n)&&n.tagName.toLowerCase()==="button"}function FA(n){return $c(n)&&n.tagName.toLowerCase()==="form"}function MA(n){return $c(n)&&n.tagName.toLowerCase()==="input"}function NA(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function UA(n,e){return n.button===0&&(!e||e==="_self")&&!NA(n)}let Ol=null;function $A(){if(Ol===null)try{new FormData(document.createElement("form"),0),Ol=!1}catch{Ol=!0}return Ol}const BA=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function wd(n){return n!=null&&!BA.has(n)?null:n}function jA(n,e){let t,r,i,s,a;if(FA(n)){let o=n.getAttribute("action");r=o?Ii(o,e):null,t=n.getAttribute("method")||xu,i=wd(n.getAttribute("enctype"))||Id,s=new FormData(n)}else if(OA(n)||MA(n)&&(n.type==="submit"||n.type==="image")){let o=n.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||o.getAttribute("action");if(r=l?Ii(l,e):null,t=n.getAttribute("formmethod")||o.getAttribute("method")||xu,i=wd(n.getAttribute("formenctype"))||wd(o.getAttribute("enctype"))||Id,s=new FormData(o,n),!$A()){let{name:u,type:c,value:d}=n;if(c==="image"){let h=u?u+".":"";s.append(h+"x","0"),s.append(h+"y","0")}else u&&s.append(u,d)}}else{if($c(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=xu,r=null,i=Id,a=n}return s&&i==="text/plain"&&(a=s,s=void 0),{action:r,method:t.toLowerCase(),encType:i,formData:s,body:a}}const GA=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],VA=["fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","unstable_viewTransition"],HA="6";try{window.__reactRouterVersion=HA}catch{}function KA(n,e){return KL({basename:void 0,future:us({},void 0,{v7_prependBasename:!0}),history:mL({window:void 0}),hydrationData:zA(),routes:n,mapRouteProperties:PA,unstable_dataStrategy:void 0,unstable_patchRoutesOnNavigation:void 0,window:void 0}).initialize()}function zA(){var n;let e=(n=window)==null?void 0:n.__staticRouterHydrationData;return e&&e.errors&&(e=us({},e,{errors:WA(e.errors)})),e}function WA(n){if(!n)return null;let e=Object.entries(n),t={};for(let[r,i]of e)if(i&&i.__type==="RouteErrorResponse")t[r]=new nc(i.status,i.statusText,i.data,i.internal===!0);else if(i&&i.__type==="Error"){if(i.__subType){let s=window[i.__subType];if(typeof s=="function")try{let a=new s(i.message);a.stack="",t[r]=a}catch{}}if(t[r]==null){let s=new Error(i.message);s.stack="",t[r]=s}}else t[r]=i;return t}const qA=C.createContext({isTransitioning:!1}),YA=C.createContext(new Map),QA="startTransition",Kp=n1[QA],XA="flushSync",zp=gL[XA];function ZA(n){Kp?Kp(n):n()}function ja(n){zp?zp(n):n()}class JA{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",t(r))}})}}function eR(n){let{fallbackElement:e,router:t,future:r}=n,[i,s]=C.useState(t.state),[a,o]=C.useState(),[l,u]=C.useState({isTransitioning:!1}),[c,d]=C.useState(),[h,f]=C.useState(),[g,m]=C.useState(),p=C.useRef(new Map),{v7_startTransition:y}=r||{},v=C.useCallback(T=>{y?ZA(T):T()},[y]),E=C.useCallback((T,w)=>{let{deletedFetchers:I,unstable_flushSync:M,unstable_viewTransitionOpts:j}=w;I.forEach(K=>p.current.delete(K)),T.fetchers.forEach((K,W)=>{K.data!==void 0&&p.current.set(W,K.data)});let z=t.window==null||t.window.document==null||typeof t.window.document.startViewTransition!="function";if(!j||z){M?ja(()=>s(T)):v(()=>s(T));return}if(M){ja(()=>{h&&(c&&c.resolve(),h.skipTransition()),u({isTransitioning:!0,flushSync:!0,currentLocation:j.currentLocation,nextLocation:j.nextLocation})});let K=t.window.document.startViewTransition(()=>{ja(()=>s(T))});K.finished.finally(()=>{ja(()=>{d(void 0),f(void 0),o(void 0),u({isTransitioning:!1})})}),ja(()=>f(K));return}h?(c&&c.resolve(),h.skipTransition(),m({state:T,currentLocation:j.currentLocation,nextLocation:j.nextLocation})):(o(T),u({isTransitioning:!0,flushSync:!1,currentLocation:j.currentLocation,nextLocation:j.nextLocation}))},[t.window,h,c,p,v]);C.useLayoutEffect(()=>t.subscribe(E),[t,E]),C.useEffect(()=>{l.isTransitioning&&!l.flushSync&&d(new JA)},[l]),C.useEffect(()=>{if(c&&a&&t.window){let T=a,w=c.promise,I=t.window.document.startViewTransition(async()=>{v(()=>s(T)),await w});I.finished.finally(()=>{d(void 0),f(void 0),o(void 0),u({isTransitioning:!1})}),f(I)}},[v,a,c,t.window]),C.useEffect(()=>{c&&a&&i.location.key===a.location.key&&c.resolve()},[c,h,i.location,a]),C.useEffect(()=>{!l.isTransitioning&&g&&(o(g.state),u({isTransitioning:!0,flushSync:!1,currentLocation:g.currentLocation,nextLocation:g.nextLocation}),m(void 0))},[l.isTransitioning,g]),C.useEffect(()=>{},[]);let _=C.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:T=>t.navigate(T),push:(T,w,I)=>t.navigate(T,{state:w,preventScrollReset:I==null?void 0:I.preventScrollReset}),replace:(T,w,I)=>t.navigate(T,{replace:!0,state:w,preventScrollReset:I==null?void 0:I.preventScrollReset})}),[t]),L=t.basename||"/",R=C.useMemo(()=>({router:t,navigator:_,static:!1,basename:L}),[t,_,L]),A=C.useMemo(()=>({v7_relativeSplatPath:t.future.v7_relativeSplatPath}),[t.future.v7_relativeSplatPath]);return C.createElement(C.Fragment,null,C.createElement(Zo.Provider,{value:R},C.createElement(pS.Provider,{value:i},C.createElement(YA.Provider,{value:p.current},C.createElement(qA.Provider,{value:l},C.createElement(kA,{basename:L,location:i.location,navigationType:i.historyAction,navigator:_,future:A},i.initialized||t.future.v7_partialHydration?C.createElement(tR,{routes:t.routes,future:t.future,state:i}):e))))),null)}const tR=C.memo(nR);function nR(n){let{routes:e,future:t,state:r}=n;return vA(e,void 0,r,t)}const rR=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",iR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_S=C.forwardRef(function(e,t){let{onClick:r,relative:i,reloadDocument:s,replace:a,state:o,target:l,to:u,preventScrollReset:c,unstable_viewTransition:d}=e,h=TS(e,GA),{basename:f}=C.useContext(fr),g,m=!1;if(typeof u=="string"&&iR.test(u)&&(g=u,rR))try{let E=new URL(window.location.href),_=u.startsWith("//")?new URL(E.protocol+u):new URL(u),L=Ii(_.pathname,f);_.origin===E.origin&&L!=null?u=L+_.search+_.hash:m=!0}catch{}let p=gA(u,{relative:i}),y=aR(u,{replace:a,state:o,target:l,preventScrollReset:c,relative:i,unstable_viewTransition:d});function v(E){r&&r(E),E.defaultPrevented||y(E)}return C.createElement("a",us({},h,{href:g||p,onClick:m||s?r:v,ref:t,target:l}))}),LS=C.forwardRef((n,e)=>{let{fetcherKey:t,navigate:r,reloadDocument:i,replace:s,state:a,method:o=xu,action:l,onSubmit:u,relative:c,preventScrollReset:d,unstable_viewTransition:h}=n,f=TS(n,VA),g=cR(),m=dR(l,{relative:c}),p=o.toLowerCase()==="get"?"get":"post",y=v=>{if(u&&u(v),v.defaultPrevented)return;v.preventDefault();let E=v.nativeEvent.submitter,_=(E==null?void 0:E.getAttribute("formmethod"))||o;g(E||v.currentTarget,{fetcherKey:t,method:_,navigate:r,replace:s,state:a,relative:c,preventScrollReset:d,unstable_viewTransition:h})};return C.createElement("form",us({ref:e,method:p,action:m,onSubmit:i?u:y},f))});var nf;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(nf||(nf={}));var Wp;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(Wp||(Wp={}));function sR(n){let e=C.useContext(Zo);return e||Ee(!1),e}function aR(n,e){let{target:t,replace:r,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:o}=e===void 0?{}:e,l=Kn(),u=Oi(),c=Mg(n,{relative:a});return C.useCallback(d=>{if(UA(d,t)){d.preventDefault();let h=r!==void 0?r:Ri(u)===Ri(c);l(n,{replace:h,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:o})}},[u,l,c,r,i,t,n,s,a,o])}function oR(){if(typeof document>"u")throw new Error("You are calling submit during the server render. Try calling submit within a `useEffect` or callback instead.")}let lR=0,uR=()=>"__"+String(++lR)+"__";function cR(){let{router:n}=sR(nf.UseSubmit),{basename:e}=C.useContext(fr),t=RA();return C.useCallback(function(r,i){i===void 0&&(i={}),oR();let{action:s,method:a,encType:o,formData:l,body:u}=jA(r,e);if(i.navigate===!1){let c=i.fetcherKey||uR();n.fetch(c,t,i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||a,formEncType:i.encType||o,unstable_flushSync:i.unstable_flushSync})}else n.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||a,formEncType:i.encType||o,replace:i.replace,state:i.state,fromRouteId:t,unstable_flushSync:i.unstable_flushSync,unstable_viewTransition:i.unstable_viewTransition})},[n,e,t])}function dR(n,e){let{relative:t}=e===void 0?{}:e,{basename:r}=C.useContext(fr),i=C.useContext(Hn);i||Ee(!1);let[s]=i.matches.slice(-1),a=us({},Mg(n||".",{relative:t})),o=Oi();if(n==null){a.search=o.search;let l=new URLSearchParams(a.search);l.has("index")&&l.get("index")===""&&(l.delete("index"),a.search=l.toString()?"?"+l.toString():"")}return(!n||n===".")&&s.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(a.pathname=a.pathname==="/"?r:dr([r,a.pathname])),Ri(a)}var Ia=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},cs=typeof window>"u"||"Deno"in globalThis;function En(){}function hR(n,e){return typeof n=="function"?n(e):n}function rf(n){return typeof n=="number"&&n>=0&&n!==1/0}function AS(n,e){return Math.max(n+(e||0)-Date.now(),0)}function qs(n,e){return typeof n=="function"?n(e):n}function $n(n,e){return typeof n=="function"?n(e):n}function qp(n,e){const{type:t="all",exact:r,fetchStatus:i,predicate:s,queryKey:a,stale:o}=n;if(a){if(r){if(e.queryHash!==Ng(a,e.options))return!1}else if(!Oo(e.queryKey,a))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof o=="boolean"&&e.isStale()!==o||i&&i!==e.state.fetchStatus||s&&!s(e))}function Yp(n,e){const{exact:t,status:r,predicate:i,mutationKey:s}=n;if(s){if(!e.options.mutationKey)return!1;if(t){if(ds(e.options.mutationKey)!==ds(s))return!1}else if(!Oo(e.options.mutationKey,s))return!1}return!(r&&e.state.status!==r||i&&!i(e))}function Ng(n,e){return((e==null?void 0:e.queryKeyHashFn)||ds)(n)}function ds(n){return JSON.stringify(n,(e,t)=>sf(t)?Object.keys(t).sort().reduce((r,i)=>(r[i]=t[i],r),{}):t)}function Oo(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?!Object.keys(e).some(t=>!Oo(n[t],e[t])):!1}function RS(n,e){if(n===e)return n;const t=Qp(n)&&Qp(e);if(t||sf(n)&&sf(e)){const r=t?n:Object.keys(n),i=r.length,s=t?e:Object.keys(e),a=s.length,o=t?[]:{};let l=0;for(let u=0;u<a;u++){const c=t?u:s[u];(!t&&r.includes(c)||t)&&n[c]===void 0&&e[c]===void 0?(o[c]=void 0,l++):(o[c]=RS(n[c],e[c]),o[c]===n[c]&&n[c]!==void 0&&l++)}return i===a&&l===i?n:o}return e}function ic(n,e){if(!e||Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(n[t]!==e[t])return!1;return!0}function Qp(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function sf(n){if(!Xp(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!Xp(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function Xp(n){return Object.prototype.toString.call(n)==="[object Object]"}function fR(n){return new Promise(e=>{setTimeout(e,n)})}function af(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?RS(n,e):e}function gR(n,e,t=0){const r=[...n,e];return t&&r.length>t?r.slice(1):r}function mR(n,e,t=0){const r=[e,...n];return t&&r.length>t?r.slice(0,-1):r}var Ug=Symbol();function IS(n,e){return!n.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!n.queryFn||n.queryFn===Ug?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var Wi,ri,Zs,My,pR=(My=class extends Ia{constructor(){super();ue(this,Wi);ue(this,ri);ue(this,Zs);J(this,Zs,e=>{if(!cs&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){b(this,ri)||this.setEventListener(b(this,Zs))}onUnsubscribe(){var e;this.hasListeners()||((e=b(this,ri))==null||e.call(this),J(this,ri,void 0))}setEventListener(e){var t;J(this,Zs,e),(t=b(this,ri))==null||t.call(this),J(this,ri,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){b(this,Wi)!==e&&(J(this,Wi,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof b(this,Wi)=="boolean"?b(this,Wi):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Wi=new WeakMap,ri=new WeakMap,Zs=new WeakMap,My),$g=new pR,Js,ii,ea,Ny,yR=(Ny=class extends Ia{constructor(){super();ue(this,Js,!0);ue(this,ii);ue(this,ea);J(this,ea,e=>{if(!cs&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){b(this,ii)||this.setEventListener(b(this,ea))}onUnsubscribe(){var e;this.hasListeners()||((e=b(this,ii))==null||e.call(this),J(this,ii,void 0))}setEventListener(e){var t;J(this,ea,e),(t=b(this,ii))==null||t.call(this),J(this,ii,e(this.setOnline.bind(this)))}setOnline(e){b(this,Js)!==e&&(J(this,Js,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return b(this,Js)}},Js=new WeakMap,ii=new WeakMap,ea=new WeakMap,Ny),sc=new yR;function of(){let n,e;const t=new Promise((i,s)=>{n=i,e=s});t.status="pending",t.catch(()=>{});function r(i){Object.assign(t,i),delete t.resolve,delete t.reject}return t.resolve=i=>{r({status:"fulfilled",value:i}),n(i)},t.reject=i=>{r({status:"rejected",reason:i}),e(i)},t}function vR(n){return Math.min(1e3*2**n,3e4)}function wS(n){return(n??"online")==="online"?sc.isOnline():!0}var CS=class extends Error{constructor(n){super("CancelledError"),this.revert=n==null?void 0:n.revert,this.silent=n==null?void 0:n.silent}};function Cd(n){return n instanceof CS}function DS(n){let e=!1,t=0,r=!1,i;const s=of(),a=m=>{var p;r||(h(new CS(m)),(p=n.abort)==null||p.call(n))},o=()=>{e=!0},l=()=>{e=!1},u=()=>$g.isFocused()&&(n.networkMode==="always"||sc.isOnline())&&n.canRun(),c=()=>wS(n.networkMode)&&n.canRun(),d=m=>{var p;r||(r=!0,(p=n.onSuccess)==null||p.call(n,m),i==null||i(),s.resolve(m))},h=m=>{var p;r||(r=!0,(p=n.onError)==null||p.call(n,m),i==null||i(),s.reject(m))},f=()=>new Promise(m=>{var p;i=y=>{(r||u())&&m(y)},(p=n.onPause)==null||p.call(n)}).then(()=>{var m;i=void 0,r||(m=n.onContinue)==null||m.call(n)}),g=()=>{if(r)return;let m;const p=t===0?n.initialPromise:void 0;try{m=p??n.fn()}catch(y){m=Promise.reject(y)}Promise.resolve(m).then(d).catch(y=>{var R;if(r)return;const v=n.retry??(cs?0:3),E=n.retryDelay??vR,_=typeof E=="function"?E(t,y):E,L=v===!0||typeof v=="number"&&t<v||typeof v=="function"&&v(t,y);if(e||!L){h(y);return}t++,(R=n.onFail)==null||R.call(n,t,y),fR(_).then(()=>u()?void 0:f()).then(()=>{e?h(y):g()})})};return{promise:s,cancel:a,continue:()=>(i==null||i(),s),cancelRetry:o,continueRetry:l,canStart:c,start:()=>(c()?g():f().then(g),s)}}function ER(){let n=[],e=0,t=o=>{o()},r=o=>{o()},i=o=>setTimeout(o,0);const s=o=>{e?n.push(o):i(()=>{t(o)})},a=()=>{const o=n;n=[],o.length&&i(()=>{r(()=>{o.forEach(l=>{t(l)})})})};return{batch:o=>{let l;e++;try{l=o()}finally{e--,e||a()}return l},batchCalls:o=>(...l)=>{s(()=>{o(...l)})},schedule:s,setNotifyFunction:o=>{t=o},setBatchNotifyFunction:o=>{r=o},setScheduler:o=>{i=o}}}var mt=ER(),qi,Uy,bS=(Uy=class{constructor(){ue(this,qi)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),rf(this.gcTime)&&J(this,qi,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(cs?1/0:5*60*1e3))}clearGcTimeout(){b(this,qi)&&(clearTimeout(b(this,qi)),J(this,qi,void 0))}},qi=new WeakMap,Uy),ta,na,vn,Ct,Vo,Yi,Fn,Lr,$y,SR=($y=class extends bS{constructor(e){super();ue(this,Fn);ue(this,ta);ue(this,na);ue(this,vn);ue(this,Ct);ue(this,Vo);ue(this,Yi);J(this,Yi,!1),J(this,Vo,e.defaultOptions),this.setOptions(e.options),this.observers=[],J(this,vn,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,J(this,ta,xR(this.options)),this.state=e.state??b(this,ta),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=b(this,Ct))==null?void 0:e.promise}setOptions(e){this.options={...b(this,Vo),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&b(this,vn).remove(this)}setData(e,t){const r=af(this.state.data,e,this.options);return ve(this,Fn,Lr).call(this,{data:r,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),r}setState(e,t){ve(this,Fn,Lr).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var r,i;const t=(r=b(this,Ct))==null?void 0:r.promise;return(i=b(this,Ct))==null||i.cancel(e),t?t.then(En).catch(En):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(b(this,ta))}isActive(){return this.observers.some(e=>$n(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Ug||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!AS(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=b(this,Ct))==null||t.continue()}onOnline(){var t;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=b(this,Ct))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),b(this,vn).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(b(this,Ct)&&(b(this,Yi)?b(this,Ct).cancel({revert:!0}):b(this,Ct).cancelRetry()),this.scheduleGc()),b(this,vn).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ve(this,Fn,Lr).call(this,{type:"invalidate"})}fetch(e,t){var l,u,c;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(b(this,Ct))return b(this,Ct).continueRetry(),b(this,Ct).promise}if(e&&this.setOptions(e),!this.options.queryFn){const d=this.observers.find(h=>h.options.queryFn);d&&this.setOptions(d.options)}const r=new AbortController,i=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(J(this,Yi,!0),r.signal)})},s=()=>{const d=IS(this.options,t),h={queryKey:this.queryKey,meta:this.meta};return i(h),J(this,Yi,!1),this.options.persister?this.options.persister(d,h,this):d(h)},a={fetchOptions:t,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:s};i(a),(l=this.options.behavior)==null||l.onFetch(a,this),J(this,na,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=a.fetchOptions)==null?void 0:u.meta))&&ve(this,Fn,Lr).call(this,{type:"fetch",meta:(c=a.fetchOptions)==null?void 0:c.meta});const o=d=>{var h,f,g,m;Cd(d)&&d.silent||ve(this,Fn,Lr).call(this,{type:"error",error:d}),Cd(d)||((f=(h=b(this,vn).config).onError)==null||f.call(h,d,this),(m=(g=b(this,vn).config).onSettled)==null||m.call(g,this.state.data,d,this)),this.scheduleGc()};return J(this,Ct,DS({initialPromise:t==null?void 0:t.initialPromise,fn:a.fetchFn,abort:r.abort.bind(r),onSuccess:d=>{var h,f,g,m;if(d===void 0){o(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(p){o(p);return}(f=(h=b(this,vn).config).onSuccess)==null||f.call(h,d,this),(m=(g=b(this,vn).config).onSettled)==null||m.call(g,d,this.state.error,this),this.scheduleGc()},onError:o,onFail:(d,h)=>{ve(this,Fn,Lr).call(this,{type:"failed",failureCount:d,error:h})},onPause:()=>{ve(this,Fn,Lr).call(this,{type:"pause"})},onContinue:()=>{ve(this,Fn,Lr).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),b(this,Ct).start()}},ta=new WeakMap,na=new WeakMap,vn=new WeakMap,Ct=new WeakMap,Vo=new WeakMap,Yi=new WeakMap,Fn=new WeakSet,Lr=function(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...kS(r.data,this.options),fetchMeta:e.meta??null};case"success":return{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const i=e.error;return Cd(i)&&i.revert&&b(this,na)?{...b(this,na),fetchStatus:"idle"}:{...r,error:i,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),mt.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),b(this,vn).notify({query:this,type:"updated",action:e})})},$y);function kS(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:wS(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function xR(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,r=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var Jn,By,TR=(By=class extends Ia{constructor(e={}){super();ue(this,Jn);this.config=e,J(this,Jn,new Map)}build(e,t,r){const i=t.queryKey,s=t.queryHash??Ng(i,t);let a=this.get(s);return a||(a=new SR({cache:this,queryKey:i,queryHash:s,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(i)}),this.add(a)),a}add(e){b(this,Jn).has(e.queryHash)||(b(this,Jn).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=b(this,Jn).get(e.queryHash);t&&(e.destroy(),t===e&&b(this,Jn).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){mt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return b(this,Jn).get(e)}getAll(){return[...b(this,Jn).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(r=>qp(t,r))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(r=>qp(e,r)):t}notify(e){mt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){mt.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){mt.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Jn=new WeakMap,By),er,Ft,Qi,tr,Qr,jy,_R=(jy=class extends bS{constructor(e){super();ue(this,tr);ue(this,er);ue(this,Ft);ue(this,Qi);this.mutationId=e.mutationId,J(this,Ft,e.mutationCache),J(this,er,[]),this.state=e.state||PS(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){b(this,er).includes(e)||(b(this,er).push(e),this.clearGcTimeout(),b(this,Ft).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){J(this,er,b(this,er).filter(t=>t!==e)),this.scheduleGc(),b(this,Ft).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){b(this,er).length||(this.state.status==="pending"?this.scheduleGc():b(this,Ft).remove(this))}continue(){var e;return((e=b(this,Qi))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var i,s,a,o,l,u,c,d,h,f,g,m,p,y,v,E,_,L,R,A;J(this,Qi,DS({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(T,w)=>{ve(this,tr,Qr).call(this,{type:"failed",failureCount:T,error:w})},onPause:()=>{ve(this,tr,Qr).call(this,{type:"pause"})},onContinue:()=>{ve(this,tr,Qr).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>b(this,Ft).canRun(this)}));const t=this.state.status==="pending",r=!b(this,Qi).canStart();try{if(!t){ve(this,tr,Qr).call(this,{type:"pending",variables:e,isPaused:r}),await((s=(i=b(this,Ft).config).onMutate)==null?void 0:s.call(i,e,this));const w=await((o=(a=this.options).onMutate)==null?void 0:o.call(a,e));w!==this.state.context&&ve(this,tr,Qr).call(this,{type:"pending",context:w,variables:e,isPaused:r})}const T=await b(this,Qi).start();return await((u=(l=b(this,Ft).config).onSuccess)==null?void 0:u.call(l,T,e,this.state.context,this)),await((d=(c=this.options).onSuccess)==null?void 0:d.call(c,T,e,this.state.context)),await((f=(h=b(this,Ft).config).onSettled)==null?void 0:f.call(h,T,null,this.state.variables,this.state.context,this)),await((m=(g=this.options).onSettled)==null?void 0:m.call(g,T,null,e,this.state.context)),ve(this,tr,Qr).call(this,{type:"success",data:T}),T}catch(T){try{throw await((y=(p=b(this,Ft).config).onError)==null?void 0:y.call(p,T,e,this.state.context,this)),await((E=(v=this.options).onError)==null?void 0:E.call(v,T,e,this.state.context)),await((L=(_=b(this,Ft).config).onSettled)==null?void 0:L.call(_,void 0,T,this.state.variables,this.state.context,this)),await((A=(R=this.options).onSettled)==null?void 0:A.call(R,void 0,T,e,this.state.context)),T}finally{ve(this,tr,Qr).call(this,{type:"error",error:T})}}finally{b(this,Ft).runNext(this)}}},er=new WeakMap,Ft=new WeakMap,Qi=new WeakMap,tr=new WeakSet,Qr=function(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),mt.batch(()=>{b(this,er).forEach(r=>{r.onMutationUpdate(e)}),b(this,Ft).notify({mutation:this,type:"updated",action:e})})},jy);function PS(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var rn,Ho,Gy,LR=(Gy=class extends Ia{constructor(e={}){super();ue(this,rn);ue(this,Ho);this.config=e,J(this,rn,new Map),J(this,Ho,Date.now())}build(e,t,r){const i=new _R({mutationCache:this,mutationId:++ml(this,Ho)._,options:e.defaultMutationOptions(t),state:r});return this.add(i),i}add(e){const t=Fl(e),r=b(this,rn).get(t)??[];r.push(e),b(this,rn).set(t,r),this.notify({type:"added",mutation:e})}remove(e){var r;const t=Fl(e);if(b(this,rn).has(t)){const i=(r=b(this,rn).get(t))==null?void 0:r.filter(s=>s!==e);i&&(i.length===0?b(this,rn).delete(t):b(this,rn).set(t,i))}this.notify({type:"removed",mutation:e})}canRun(e){var r;const t=(r=b(this,rn).get(Fl(e)))==null?void 0:r.find(i=>i.state.status==="pending");return!t||t===e}runNext(e){var r;const t=(r=b(this,rn).get(Fl(e)))==null?void 0:r.find(i=>i!==e&&i.state.isPaused);return(t==null?void 0:t.continue())??Promise.resolve()}clear(){mt.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...b(this,rn).values()].flat()}find(e){const t={exact:!0,...e};return this.getAll().find(r=>Yp(t,r))}findAll(e={}){return this.getAll().filter(t=>Yp(e,t))}notify(e){mt.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return mt.batch(()=>Promise.all(e.map(t=>t.continue().catch(En))))}},rn=new WeakMap,Ho=new WeakMap,Gy);function Fl(n){var e;return((e=n.options.scope)==null?void 0:e.id)??String(n.mutationId)}function Zp(n){return{onFetch:(e,t)=>{var c,d,h,f,g;const r=e.options,i=(h=(d=(c=e.fetchOptions)==null?void 0:c.meta)==null?void 0:d.fetchMore)==null?void 0:h.direction,s=((f=e.state.data)==null?void 0:f.pages)||[],a=((g=e.state.data)==null?void 0:g.pageParams)||[];let o={pages:[],pageParams:[]},l=0;const u=async()=>{let m=!1;const p=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(e.signal.aborted?m=!0:e.signal.addEventListener("abort",()=>{m=!0}),e.signal)})},y=IS(e.options,e.fetchOptions),v=async(E,_,L)=>{if(m)return Promise.reject();if(_==null&&E.pages.length)return Promise.resolve(E);const R={queryKey:e.queryKey,pageParam:_,direction:L?"backward":"forward",meta:e.options.meta};p(R);const A=await y(R),{maxPages:T}=e.options,w=L?mR:gR;return{pages:w(E.pages,A,T),pageParams:w(E.pageParams,_,T)}};if(i&&s.length){const E=i==="backward",_=E?AR:Jp,L={pages:s,pageParams:a},R=_(r,L);o=await v(L,R,E)}else{const E=n??s.length;do{const _=l===0?a[0]??r.initialPageParam:Jp(r,o);if(l>0&&_==null)break;o=await v(o,_),l++}while(l<E)}return o};e.options.persister?e.fetchFn=()=>{var m,p;return(p=(m=e.options).persister)==null?void 0:p.call(m,u,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=u}}}function Jp(n,{pages:e,pageParams:t}){const r=e.length-1;return e.length>0?n.getNextPageParam(e[r],e,t[r],t):void 0}function AR(n,{pages:e,pageParams:t}){var r;return e.length>0?(r=n.getPreviousPageParam)==null?void 0:r.call(n,e[0],e,t[0],t):void 0}var tt,si,ai,ra,ia,oi,sa,aa,Vy,RR=(Vy=class{constructor(n={}){ue(this,tt);ue(this,si);ue(this,ai);ue(this,ra);ue(this,ia);ue(this,oi);ue(this,sa);ue(this,aa);J(this,tt,n.queryCache||new TR),J(this,si,n.mutationCache||new LR),J(this,ai,n.defaultOptions||{}),J(this,ra,new Map),J(this,ia,new Map),J(this,oi,0)}mount(){ml(this,oi)._++,b(this,oi)===1&&(J(this,sa,$g.subscribe(async n=>{n&&(await this.resumePausedMutations(),b(this,tt).onFocus())})),J(this,aa,sc.subscribe(async n=>{n&&(await this.resumePausedMutations(),b(this,tt).onOnline())})))}unmount(){var n,e;ml(this,oi)._--,b(this,oi)===0&&((n=b(this,sa))==null||n.call(this),J(this,sa,void 0),(e=b(this,aa))==null||e.call(this),J(this,aa,void 0))}isFetching(n){return b(this,tt).findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return b(this,si).findAll({...n,status:"pending"}).length}getQueryData(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=b(this,tt).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(n){const e=this.defaultQueryOptions(n),t=b(this,tt).build(this,e),r=t.state.data;return r===void 0?this.fetchQuery(n):(n.revalidateIfStale&&t.isStaleByTime(qs(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(n){return b(this,tt).findAll(n).map(({queryKey:e,state:t})=>{const r=t.data;return[e,r]})}setQueryData(n,e,t){const r=this.defaultQueryOptions({queryKey:n}),i=b(this,tt).get(r.queryHash),s=i==null?void 0:i.state.data,a=hR(e,s);if(a!==void 0)return b(this,tt).build(this,r).setData(a,{...t,manual:!0})}setQueriesData(n,e,t){return mt.batch(()=>b(this,tt).findAll(n).map(({queryKey:r})=>[r,this.setQueryData(r,e,t)]))}getQueryState(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=b(this,tt).get(e.queryHash))==null?void 0:t.state}removeQueries(n){const e=b(this,tt);mt.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=b(this,tt),r={type:"active",...n};return mt.batch(()=>(t.findAll(n).forEach(i=>{i.reset()}),this.refetchQueries(r,e)))}cancelQueries(n,e={}){const t={revert:!0,...e},r=mt.batch(()=>b(this,tt).findAll(n).map(i=>i.cancel(t)));return Promise.all(r).then(En).catch(En)}invalidateQueries(n,e={}){return mt.batch(()=>{if(b(this,tt).findAll(n).forEach(r=>{r.invalidate()}),(n==null?void 0:n.refetchType)==="none")return Promise.resolve();const t={...n,type:(n==null?void 0:n.refetchType)??(n==null?void 0:n.type)??"active"};return this.refetchQueries(t,e)})}refetchQueries(n,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},r=mt.batch(()=>b(this,tt).findAll(n).filter(i=>!i.isDisabled()).map(i=>{let s=i.fetch(void 0,t);return t.throwOnError||(s=s.catch(En)),i.state.fetchStatus==="paused"?Promise.resolve():s}));return Promise.all(r).then(En)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=b(this,tt).build(this,e);return t.isStaleByTime(qs(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(En).catch(En)}fetchInfiniteQuery(n){return n.behavior=Zp(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(En).catch(En)}ensureInfiniteQueryData(n){return n.behavior=Zp(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return sc.isOnline()?b(this,si).resumePausedMutations():Promise.resolve()}getQueryCache(){return b(this,tt)}getMutationCache(){return b(this,si)}getDefaultOptions(){return b(this,ai)}setDefaultOptions(n){J(this,ai,n)}setQueryDefaults(n,e){b(this,ra).set(ds(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...b(this,ra).values()],t={};return e.forEach(r=>{Oo(n,r.queryKey)&&Object.assign(t,r.defaultOptions)}),t}setMutationDefaults(n,e){b(this,ia).set(ds(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...b(this,ia).values()];let t={};return e.forEach(r=>{Oo(n,r.mutationKey)&&(t={...t,...r.defaultOptions})}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...b(this,ai).queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=Ng(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Ug&&(e.enabled=!1),e}defaultMutationOptions(n){return n!=null&&n._defaulted?n:{...b(this,ai).mutations,...(n==null?void 0:n.mutationKey)&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){b(this,tt).clear(),b(this,si).clear()}},tt=new WeakMap,si=new WeakMap,ai=new WeakMap,ra=new WeakMap,ia=new WeakMap,oi=new WeakMap,sa=new WeakMap,aa=new WeakMap,Vy),Vt,_e,Ko,Mt,Xi,oa,li,nr,zo,la,ua,Zi,Ji,ui,ca,De,Za,lf,uf,cf,df,hf,ff,gf,OS,Hy,IR=(Hy=class extends Ia{constructor(e,t){super();ue(this,De);ue(this,Vt);ue(this,_e);ue(this,Ko);ue(this,Mt);ue(this,Xi);ue(this,oa);ue(this,li);ue(this,nr);ue(this,zo);ue(this,la);ue(this,ua);ue(this,Zi);ue(this,Ji);ue(this,ui);ue(this,ca,new Set);this.options=t,J(this,Vt,e),J(this,nr,null),J(this,li,of()),this.options.experimental_prefetchInRender||b(this,li).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(b(this,_e).addObserver(this),e0(b(this,_e),this.options)?ve(this,De,Za).call(this):this.updateResult(),ve(this,De,df).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return mf(b(this,_e),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return mf(b(this,_e),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,ve(this,De,hf).call(this),ve(this,De,ff).call(this),b(this,_e).removeObserver(this)}setOptions(e,t){const r=this.options,i=b(this,_e);if(this.options=b(this,Vt).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof $n(this.options.enabled,b(this,_e))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");ve(this,De,gf).call(this),b(this,_e).setOptions(this.options),r._defaulted&&!ic(this.options,r)&&b(this,Vt).getQueryCache().notify({type:"observerOptionsUpdated",query:b(this,_e),observer:this});const s=this.hasListeners();s&&t0(b(this,_e),i,this.options,r)&&ve(this,De,Za).call(this),this.updateResult(t),s&&(b(this,_e)!==i||$n(this.options.enabled,b(this,_e))!==$n(r.enabled,b(this,_e))||qs(this.options.staleTime,b(this,_e))!==qs(r.staleTime,b(this,_e)))&&ve(this,De,lf).call(this);const a=ve(this,De,uf).call(this);s&&(b(this,_e)!==i||$n(this.options.enabled,b(this,_e))!==$n(r.enabled,b(this,_e))||a!==b(this,ui))&&ve(this,De,cf).call(this,a)}getOptimisticResult(e){const t=b(this,Vt).getQueryCache().build(b(this,Vt),e),r=this.createResult(t,e);return CR(this,r)&&(J(this,Mt,r),J(this,oa,this.options),J(this,Xi,b(this,_e).state)),r}getCurrentResult(){return b(this,Mt)}trackResult(e,t){const r={};return Object.keys(e).forEach(i=>{Object.defineProperty(r,i,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(i),t==null||t(i),e[i])})}),r}trackProp(e){b(this,ca).add(e)}getCurrentQuery(){return b(this,_e)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=b(this,Vt).defaultQueryOptions(e),r=b(this,Vt).getQueryCache().build(b(this,Vt),t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return ve(this,De,Za).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),b(this,Mt)))}createResult(e,t){var T;const r=b(this,_e),i=this.options,s=b(this,Mt),a=b(this,Xi),o=b(this,oa),u=e!==r?e.state:b(this,Ko),{state:c}=e;let d={...c},h=!1,f;if(t._optimisticResults){const w=this.hasListeners(),I=!w&&e0(e,t),M=w&&t0(e,r,t,i);(I||M)&&(d={...d,...kS(c.data,e.options)}),t._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:g,errorUpdatedAt:m,status:p}=d;if(t.select&&d.data!==void 0)if(s&&d.data===(a==null?void 0:a.data)&&t.select===b(this,zo))f=b(this,la);else try{J(this,zo,t.select),f=t.select(d.data),f=af(s==null?void 0:s.data,f,t),J(this,la,f),J(this,nr,null)}catch(w){J(this,nr,w)}else f=d.data;if(t.placeholderData!==void 0&&f===void 0&&p==="pending"){let w;if(s!=null&&s.isPlaceholderData&&t.placeholderData===(o==null?void 0:o.placeholderData))w=s.data;else if(w=typeof t.placeholderData=="function"?t.placeholderData((T=b(this,ua))==null?void 0:T.state.data,b(this,ua)):t.placeholderData,t.select&&w!==void 0)try{w=t.select(w),J(this,nr,null)}catch(I){J(this,nr,I)}w!==void 0&&(p="success",f=af(s==null?void 0:s.data,w,t),h=!0)}b(this,nr)&&(g=b(this,nr),f=b(this,la),m=Date.now(),p="error");const y=d.fetchStatus==="fetching",v=p==="pending",E=p==="error",_=v&&y,L=f!==void 0,A={status:p,fetchStatus:d.fetchStatus,isPending:v,isSuccess:p==="success",isError:E,isInitialLoading:_,isLoading:_,data:f,dataUpdatedAt:d.dataUpdatedAt,error:g,errorUpdatedAt:m,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>u.dataUpdateCount||d.errorUpdateCount>u.errorUpdateCount,isFetching:y,isRefetching:y&&!v,isLoadingError:E&&!L,isPaused:d.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:E&&L,isStale:Bg(e,t),refetch:this.refetch,promise:b(this,li)};if(this.options.experimental_prefetchInRender){const w=j=>{A.status==="error"?j.reject(A.error):A.data!==void 0&&j.resolve(A.data)},I=()=>{const j=J(this,li,A.promise=of());w(j)},M=b(this,li);switch(M.status){case"pending":e.queryHash===r.queryHash&&w(M);break;case"fulfilled":(A.status==="error"||A.data!==M.value)&&I();break;case"rejected":(A.status!=="error"||A.error!==M.reason)&&I();break}}return A}updateResult(e){const t=b(this,Mt),r=this.createResult(b(this,_e),this.options);if(J(this,Xi,b(this,_e).state),J(this,oa,this.options),b(this,Xi).data!==void 0&&J(this,ua,b(this,_e)),ic(r,t))return;J(this,Mt,r);const i={},s=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,o=typeof a=="function"?a():a;if(o==="all"||!o&&!b(this,ca).size)return!0;const l=new Set(o??b(this,ca));return this.options.throwOnError&&l.add("error"),Object.keys(b(this,Mt)).some(u=>{const c=u;return b(this,Mt)[c]!==t[c]&&l.has(c)})};(e==null?void 0:e.listeners)!==!1&&s()&&(i.listeners=!0),ve(this,De,OS).call(this,{...i,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&ve(this,De,df).call(this)}},Vt=new WeakMap,_e=new WeakMap,Ko=new WeakMap,Mt=new WeakMap,Xi=new WeakMap,oa=new WeakMap,li=new WeakMap,nr=new WeakMap,zo=new WeakMap,la=new WeakMap,ua=new WeakMap,Zi=new WeakMap,Ji=new WeakMap,ui=new WeakMap,ca=new WeakMap,De=new WeakSet,Za=function(e){ve(this,De,gf).call(this);let t=b(this,_e).fetch(this.options,e);return e!=null&&e.throwOnError||(t=t.catch(En)),t},lf=function(){ve(this,De,hf).call(this);const e=qs(this.options.staleTime,b(this,_e));if(cs||b(this,Mt).isStale||!rf(e))return;const r=AS(b(this,Mt).dataUpdatedAt,e)+1;J(this,Zi,setTimeout(()=>{b(this,Mt).isStale||this.updateResult()},r))},uf=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(b(this,_e)):this.options.refetchInterval)??!1},cf=function(e){ve(this,De,ff).call(this),J(this,ui,e),!(cs||$n(this.options.enabled,b(this,_e))===!1||!rf(b(this,ui))||b(this,ui)===0)&&J(this,Ji,setInterval(()=>{(this.options.refetchIntervalInBackground||$g.isFocused())&&ve(this,De,Za).call(this)},b(this,ui)))},df=function(){ve(this,De,lf).call(this),ve(this,De,cf).call(this,ve(this,De,uf).call(this))},hf=function(){b(this,Zi)&&(clearTimeout(b(this,Zi)),J(this,Zi,void 0))},ff=function(){b(this,Ji)&&(clearInterval(b(this,Ji)),J(this,Ji,void 0))},gf=function(){const e=b(this,Vt).getQueryCache().build(b(this,Vt),this.options);if(e===b(this,_e))return;const t=b(this,_e);J(this,_e,e),J(this,Ko,e.state),this.hasListeners()&&(t==null||t.removeObserver(this),e.addObserver(this))},OS=function(e){mt.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(b(this,Mt))}),b(this,Vt).getQueryCache().notify({query:b(this,_e),type:"observerResultsUpdated"})})},Hy);function wR(n,e){return $n(e.enabled,n)!==!1&&n.state.data===void 0&&!(n.state.status==="error"&&e.retryOnMount===!1)}function e0(n,e){return wR(n,e)||n.state.data!==void 0&&mf(n,e,e.refetchOnMount)}function mf(n,e,t){if($n(e.enabled,n)!==!1){const r=typeof t=="function"?t(n):t;return r==="always"||r!==!1&&Bg(n,e)}return!1}function t0(n,e,t,r){return(n!==e||$n(r.enabled,n)===!1)&&(!t.suspense||n.state.status!=="error")&&Bg(n,t)}function Bg(n,e){return $n(e.enabled,n)!==!1&&n.isStaleByTime(qs(e.staleTime,n))}function CR(n,e){return!ic(n.getCurrentResult(),e)}var ci,di,Ht,Cr,Pr,Tu,pf,Ky,DR=(Ky=class extends Ia{constructor(t,r){super();ue(this,Pr);ue(this,ci);ue(this,di);ue(this,Ht);ue(this,Cr);J(this,ci,t),this.setOptions(r),this.bindMethods(),ve(this,Pr,Tu).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var i;const r=this.options;this.options=b(this,ci).defaultMutationOptions(t),ic(this.options,r)||b(this,ci).getMutationCache().notify({type:"observerOptionsUpdated",mutation:b(this,Ht),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&ds(r.mutationKey)!==ds(this.options.mutationKey)?this.reset():((i=b(this,Ht))==null?void 0:i.state.status)==="pending"&&b(this,Ht).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=b(this,Ht))==null||t.removeObserver(this)}onMutationUpdate(t){ve(this,Pr,Tu).call(this),ve(this,Pr,pf).call(this,t)}getCurrentResult(){return b(this,di)}reset(){var t;(t=b(this,Ht))==null||t.removeObserver(this),J(this,Ht,void 0),ve(this,Pr,Tu).call(this),ve(this,Pr,pf).call(this)}mutate(t,r){var i;return J(this,Cr,r),(i=b(this,Ht))==null||i.removeObserver(this),J(this,Ht,b(this,ci).getMutationCache().build(b(this,ci),this.options)),b(this,Ht).addObserver(this),b(this,Ht).execute(t)}},ci=new WeakMap,di=new WeakMap,Ht=new WeakMap,Cr=new WeakMap,Pr=new WeakSet,Tu=function(){var r;const t=((r=b(this,Ht))==null?void 0:r.state)??PS();J(this,di,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},pf=function(t){mt.batch(()=>{var r,i,s,a,o,l,u,c;if(b(this,Cr)&&this.hasListeners()){const d=b(this,di).variables,h=b(this,di).context;(t==null?void 0:t.type)==="success"?((i=(r=b(this,Cr)).onSuccess)==null||i.call(r,t.data,d,h),(a=(s=b(this,Cr)).onSettled)==null||a.call(s,t.data,null,d,h)):(t==null?void 0:t.type)==="error"&&((l=(o=b(this,Cr)).onError)==null||l.call(o,t.error,d,h),(c=(u=b(this,Cr)).onSettled)==null||c.call(u,void 0,t.error,d,h))}this.listeners.forEach(d=>{d(b(this,di))})})},Ky),FS=C.createContext(void 0),Zt=n=>{const e=C.useContext(FS);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},bR=({client:n,children:e})=>(C.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),x.jsx(FS.Provider,{value:n,children:e})),MS=C.createContext(!1),kR=()=>C.useContext(MS);MS.Provider;function PR(){let n=!1;return{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n}}var OR=C.createContext(PR()),FR=()=>C.useContext(OR);function NS(n,e){return typeof n=="function"?n(...e):!!n}function yf(){}var MR=(n,e)=>{(n.suspense||n.throwOnError||n.experimental_prefetchInRender)&&(e.isReset()||(n.retryOnMount=!1))},NR=n=>{C.useEffect(()=>{n.clearReset()},[n])},UR=({result:n,errorResetBoundary:e,throwOnError:t,query:r})=>n.isError&&!e.isReset()&&!n.isFetching&&r&&NS(t,[n.error,r]),$R=n=>{n.suspense&&(n.staleTime===void 0&&(n.staleTime=1e3),typeof n.gcTime=="number"&&(n.gcTime=Math.max(n.gcTime,1e3)))},BR=(n,e)=>n.isLoading&&n.isFetching&&!e,jR=(n,e)=>(n==null?void 0:n.suspense)&&e.isPending,n0=(n,e,t)=>e.fetchOptimistic(n).catch(()=>{t.clearReset()});function GR(n,e,t){var c,d,h,f,g;const r=Zt(),i=kR(),s=FR(),a=r.defaultQueryOptions(n);(d=(c=r.getDefaultOptions().queries)==null?void 0:c._experimental_beforeQuery)==null||d.call(c,a),a._optimisticResults=i?"isRestoring":"optimistic",$R(a),MR(a,s),NR(s);const o=!r.getQueryCache().get(a.queryHash),[l]=C.useState(()=>new e(r,a)),u=l.getOptimisticResult(a);if(C.useSyncExternalStore(C.useCallback(m=>{const p=i?yf:l.subscribe(mt.batchCalls(m));return l.updateResult(),p},[l,i]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),C.useEffect(()=>{l.setOptions(a,{listeners:!1})},[a,l]),jR(a,u))throw n0(a,l,s);if(UR({result:u,errorResetBoundary:s,throwOnError:a.throwOnError,query:r.getQueryCache().get(a.queryHash)}))throw u.error;if((f=(h=r.getDefaultOptions().queries)==null?void 0:h._experimental_afterQuery)==null||f.call(h,a,u),a.experimental_prefetchInRender&&!cs&&BR(u,i)){const m=o?n0(a,l,s):(g=r.getQueryCache().get(a.queryHash))==null?void 0:g.promise;m==null||m.catch(yf).finally(()=>{l.updateResult()})}return a.notifyOnChangeProps?u:l.trackResult(u)}function gr(n,e){return GR(n,IR)}function _t(n,e){const t=Zt(),[r]=C.useState(()=>new DR(t,n));C.useEffect(()=>{r.setOptions(n)},[r,n]);const i=C.useSyncExternalStore(C.useCallback(a=>r.subscribe(mt.batchCalls(a)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),s=C.useCallback((a,o)=>{r.mutate(a,o).catch(yf)},[r]);if(i.error&&NS(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:s,mutateAsync:i.mutate}}const VR="wss://dashing-cod-pretty.ngrok-free.app",st="https://dashing-cod-pretty.ngrok-free.app",be={refreshToken:st+"/api/token/refresh/",login:st+"/api/login/",logout:st+"/api/logout/",registration:st+"/api/registration/",changePassword:st+"/api/change-password/",home:st+"/api/home/",room:st+"/api/room/",favourite:st+"/api/favourite/",aquarium:st+"/api/aquarium/",rfid:st+"/api/rfid/",card:st+"/api/rfid/card/",lamp:st+"/api/lamp/",button:st+"/api/button/",device:st+"/api/device/",unassignedDevice:st+"/api/device/?unassigned=true",router:st+"/api/device/router/",event:st+"/api/event/",action:st+"/api/event/action/",getUpdateLamp:st+"/api/lamp/",getAllEvents:st+"/api/device/get/event/"},US=C.createContext(void 0),Jo=()=>{const n=C.useContext(US);if(n===void 0)throw Error("Auth context is undefined");return n},HR=({children:n})=>{const[e,t]=C.useState(null),[r,i]=C.useState(!0),[s,a]=C.useState(!1),{data:o,isSuccess:l,isError:u,isPending:c}=gr({queryKey:["token"],queryFn:KR,staleTime:5*60*1e3,refetchInterval:60*60*1e3,enabled:!s,refetchIntervalInBackground:!0});C.useEffect(()=>{c||((o==null?void 0:o.status)===200&&l?d(o.token):h(),i(!1))},[o,c,l,u]);const d=f=>{t(f),a(!1)},h=()=>{t(null),a(!0)};return c||r?null:x.jsx(US.Provider,{value:{login:d,logout:h,invalidToken:s,access:e},children:n})};async function KR(){const n=await fetch(be.refreshToken,{credentials:"include"});return{token:(await n.json()).access,status:n.status}}const zR="_button_ui35u_1",WR="_primary_ui35u_25",qR="_danger_ui35u_37",YR="_success_ui35u_49",QR="_fancy_ui35u_69",r0={button:zR,primary:WR,danger:qR,success:YR,fancy:QR,"form-primary":"_form-primary_ui35u_105","form-secondary":"_form-secondary_ui35u_125"};function Xe({onClick:n,children:e,className:t,type:r="primary"}){return x.jsx("button",{className:`${r0.button} ${r0[r]} ${t}`,onClick:n,children:e})}const XR="_container_nusmj_1",ZR="_field_nusmj_11",JR="_label_nusmj_45",eI="_labelFloating_nusmj_71",tI="_error_nusmj_127",Ga={container:XR,field:ZR,label:JR,labelFloating:eI,error:tI};function dn({onChange:n,error:e,type:t,name:r,placeholder:i,pattern:s,inputMode:a}){const[o,l]=C.useState(!1),[u,c]=C.useState(!1),d=new RegExp(s||".*"),h=m=>{const p=m.target.value;if(c(p.length>0),d.test(p)){n&&n(m);return}m.target.value=p.slice(0,-1)},f=()=>{l(!0)},g=m=>{l(!1),c(m.target.value.length>0)};return x.jsxs("div",{className:Ga.container,children:[x.jsx("label",{className:`${Ga.label} ${o||u?Ga.labelFloating:""}`,htmlFor:r,children:i}),x.jsx("input",{id:r,onChange:n?m=>h(m):()=>{},onFocus:f,onBlur:g,className:`${Ga.field} ${e?Ga.error:""}`,type:t,name:r,inputMode:a})]})}const nI="_container_11q4e_1",rI="_form_11q4e_11",iI="_formContent_11q4e_29",sI="_title_11q4e_41",aI="_subtitle_11q4e_59",oI="_submitButton_11q4e_75",lI="_loginLink_11q4e_141",uI="_errorMessage_11q4e_171",cI="_backArrow_11q4e_211",Ml={container:nI,form:rI,formContent:iI,title:sI,subtitle:aI,submitButton:oI,loginLink:lI,errorMessage:uI,backArrow:cI},dI="_basic_x45va_1",hI="_header_x45va_45",fI="_title_x45va_63",gI={basic:dI,header:hI,title:fI};function mr({children:n}){return x.jsx("h1",{className:`${gI.basic}`,children:n})}const mI="_message_1qw8b_1",pI="_hidden_1qw8b_25",yI="_visible_1qw8b_35",vI="_success_1qw8b_45",EI="_error_1qw8b_57",SI="_info_1qw8b_69",xI="_warning_1qw8b_105",i0={message:mI,hidden:pI,visible:yI,success:vI,error:EI,info:SI,warning:xI};function Ne({children:n,show:e,timeout:t=0,onTimeout:r,type:i="info"}){const[s,a]=C.useState(e);return C.useEffect(()=>{if(e){if(a(!0),t===0){a(!0);return}const o=setTimeout(()=>{a(!1),r&&r()},t);return()=>{clearTimeout(o)}}else a(!1)},[e]),s?x.jsx("div",{className:`${i0.message} ${i0[i]}`,children:n}):null}const TI="_container_18kqk_3",_I="_topAccent_18kqk_63",LI="_onTop_18kqk_87",Dd={container:TI,topAccent:_I,onTop:LI};function Fi({children:n,className:e,onTop:t=!1}){return x.jsxs("div",{className:`${Dd.container} ${t&&Dd.onTop} ${e}`,children:[x.jsx("div",{className:Dd.topAccent}),n]})}const AI="_button_18aqk_1",RI="_fancy_18aqk_33",II="_primary_18aqk_69",wI="_danger_18aqk_85",CI="_success_18aqk_101",s0={button:AI,fancy:RI,primary:II,danger:wI,success:CI};function Xt({children:n,to:e,type:t="primary"}){return x.jsx(_S,{to:e,className:`${s0.button} ${s0[t]}`,children:n})}const DI="_container_htovd_1",bI={container:DI};function Pt({children:n,className:e}){return x.jsx("div",{className:`${bI.container} ${e}`,children:n})}const kI=()=>{const n=xS(),e=Kn(),{access:t}=Jo();return C.useEffect(()=>{t&&e("/")},[t]),n&&n.status===201&&setTimeout(()=>{e("/")},2e3),x.jsx(Pt,{className:Ml.container,children:x.jsxs(Fi,{children:[x.jsx(mr,{children:"Smart Home"}),x.jsx("p",{className:Ml.subtitle,children:"Utwórz nowe konto"}),x.jsx(LS,{method:"POST",className:Ml.form,children:x.jsxs("div",{className:Ml.formContent,children:[x.jsx(dn,{type:"text",name:"username",placeholder:"Login"}),x.jsx(Ne,{type:"error",show:(n==null?void 0:n.status)===400&&(n==null?void 0:n.body.username),children:n==null?void 0:n.body.username}),x.jsx(dn,{type:"password",name:"password",placeholder:"Hasło"}),x.jsxs(Ne,{type:"error",show:(n==null?void 0:n.status)===400&&(n==null?void 0:n.body.password),children:[n==null?void 0:n.body.password," "]}),x.jsx(dn,{type:"password",name:"password2",placeholder:"Powtórz hasło"}),x.jsxs(Ne,{type:"error",show:(n==null?void 0:n.status)===400&&(n==null?void 0:n.body.password2),children:[n==null?void 0:n.body.password2," "]}),x.jsx(Xe,{children:"Rejestracja"}),x.jsx(Xt,{to:"/login",children:"Wróć"}),x.jsxs(Ne,{type:"error",show:(n==null?void 0:n.status)===400&&(n==null?void 0:n.body.empty),children:[n==null?void 0:n.body.empty," "]})]})}),x.jsx(Ne,{type:"success",show:(n==null?void 0:n.status)===201,children:'"Rejestracja przebiegła pomyślnie. Za chwilę zostaniesz przekierowany na stronę"'})]})})},PI=async({request:n})=>{const e=await n.formData(),t=Object.fromEntries(e),r={username:t.username,password:t.password,password2:t.password2},i=await fetch(be.registration,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"1234"},body:JSON.stringify(r)}),s=await i.json();return{status:i.status,body:s}},OI="_container_806qd_1",FI="_formContent_806qd_13",MI="_form_806qd_13",NI="_subtitle_806qd_49",UI="_footerText_806qd_67",Nl={container:OI,formContent:FI,form:MI,subtitle:NI,footerText:UI};function $I(){const n=xS(),{login:e,access:t}=Jo(),r=Kn(),i=Zt();return C.useEffect(()=>{n!=null&&n.body.access?(e(n.body.access),r("/")):i.clear()},[n,e]),C.useEffect(()=>{t?r("/"):i.clear()},[]),x.jsx(Pt,{className:Nl.container,children:x.jsx(Fi,{children:x.jsx(LS,{method:"POST",className:Nl.form,children:x.jsxs("div",{className:Nl.formContent,children:[x.jsx(mr,{children:"Smart Home"}),x.jsx("p",{className:Nl.subtitle,children:"Zaloguj się do swojego konta"}),x.jsx(dn,{type:"text",name:"username",placeholder:"Nazwa użytkownika"}),x.jsx(dn,{type:"password",name:"password",placeholder:"Hasło"}),x.jsx(Ne,{type:"error",show:(n==null?void 0:n.status)===400,children:n==null?void 0:n.body.message}),x.jsx(Xe,{children:"Zaloguj się"}),x.jsx(Xt,{to:"/registration",children:"Utwórz nowe konto"})]})})})})}const BI=async({request:n})=>{const e=await n.formData(),t=Object.fromEntries(e),r={username:t.username,password:t.password},i=await fetch(be.login,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"1234"},body:JSON.stringify(r)}),s=await i.json();return{status:i.status,body:s}},rt={DEVICES:"devices",ROOMS:"rooms",FAVOURITES:"favourites",UNASSIGNED_DEVICE:"unassignedDevice"};function el(n,e){const t=n.getQueryData([rt.DEVICES]);if(!t)return;const r=t.data.map(i=>(i.id===e.data.id&&(i=e.data),i));n.setQueryData([rt.DEVICES],{status:e.status,data:r})}function jI(n,e){const t=n.getQueryData(["unassignedDevice"]),r=Array.isArray(t.data)?[...t.data,e.data]:[e.data],i={status:e.status,data:r};n.setQueryData(["unassignedDevice"],i)}var _u=(n=>(n.UPDATE_ROUTER="update_router",n.UPDATE_DEVICE="update_device",n.NEW_DEVICE_CONNECTED="new_device_connected",n))(_u||{});function GI(n,e){const t={status:e.status,data:[e.data]};n.setQueryData(["router"],t)}function VI(){const[n,e]=C.useState(),t=Zt();return C.useEffect(()=>{const r=t.getQueryData(["token"]);if(!r)return;const i=new WebSocket(`${VR}/ws/user/${r.token}/`);return i.onopen=s=>{console.log(s)},i.onmessage=s=>{const a=JSON.parse(s.data);switch(a.action){case _u.UPDATE_ROUTER:GI(t,a.data);break;case _u.UPDATE_DEVICE:el(t,a.data);break;case _u.NEW_DEVICE_CONNECTED:jI(t,a.data)}},i.onerror=()=>{},i.onclose=()=>{},e(i),()=>i.close()},[]),null}function HI(){var n=null;if(document.cookie&&document.cookie!=="")for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var r=e[t].trim();if(r.substring(0,10)==="csrftoken="){n=decodeURIComponent(r.substring(10));break}}return n}class a0 extends Error{constructor(e,t){super(e),this.details=t}}function it(){const{access:n}=Jo(),e={credentials:"include",headers:{"Content-Type":"application/json","ngrok-skip-browser-warning":"1234",Authorization:`Bearer ${n}`,"X-CSRFToken":HI()||""}};async function t(a,o=null){const l=await fetch(a,{method:"POST",...e,body:o?JSON.stringify(o):null}),u=await l.json();if(!l.ok)throw new a0("Błąd podczas wysyłania danych",u);return{status:l.status,data:u}}async function r(a){const o=await fetch(a,{method:"GET",...e}),l=await o.json();return{status:o.status,data:l}}async function i(a,o=null){const l=await fetch(a,{method:"PUT",...e,body:o?JSON.stringify(o):null}),u=await l.json();if(!l.ok)throw new a0("Błąd podczas wysyłania danych",{...u,status:l.status});return{status:l.status,data:u}}async function s(a){return{status:(await fetch(a,{method:"DELETE",...e})).status}}return{createData:t,readData:r,updateData:i,deleteData:s}}const KI="_sidebar_1y5jd_1",zI="_header_1y5jd_27",WI="_title_1y5jd_41",qI="_version_1y5jd_57",YI="_navigation_1y5jd_75",QI="_navItem_1y5jd_89",XI="_active_1y5jd_157",ZI="_icon_1y5jd_179",JI="_label_1y5jd_193",ew="_footer_1y5jd_203",tw="_logoutButton_1y5jd_215",nn={sidebar:KI,header:zI,title:WI,version:qI,navigation:YI,navItem:QI,active:XI,icon:ZI,label:JI,footer:ew,logoutButton:tw},nw="/static/svg/dashboard.svg",rw="/static/svg/room.svg",iw="/static/svg/device.svg",sw="/static/svg/router.svg",aw="/static/svg/settings.svg",ow="/static/svg/camera.svg",lw="/static/svg/logout.svg",uw=[{icon:nw,label:"Dashboard",path:"/"},{icon:rw,label:"Pokoje",path:"/room"},{icon:iw,label:"Urządzenia",path:"/device"},{icon:sw,label:"Router",path:"/router"},{icon:ow,label:"Kamery",path:"/camera"},{icon:aw,label:"Ustawienia",path:"/settings"}];function cw(){const n=Oi(),{deleteData:e}=it(),{logout:t}=Jo(),r=_t({mutationFn:()=>e(be.logout),onSuccess:()=>t()}),i=()=>{r.mutate()};return x.jsxs("aside",{className:nn.sidebar,children:[x.jsxs("div",{className:nn.header,children:[x.jsx("h2",{className:nn.title,children:"Smart Home"}),x.jsx("div",{className:nn.version,children:"v2.0"})]}),x.jsx("nav",{className:nn.navigation,children:uw.map(s=>x.jsxs(_S,{to:s.path,className:`${nn.navItem} ${n.pathname===s.path?nn.active:""}`,children:[x.jsx("img",{src:s.icon,alt:s.label,className:nn.icon}),x.jsx("span",{className:nn.label,children:s.label})]},s.path))}),x.jsx("div",{className:nn.footer,children:x.jsxs("button",{onClick:i,className:nn.logoutButton,children:[x.jsx("img",{src:lw,alt:"Wyloguj",className:nn.icon}),x.jsx("span",{className:nn.label,children:"Wyloguj"})]})})]})}const dw="_container_14ocf_1",hw="_content_14ocf_13",o0={container:dw,content:hw};function Bc(){const{readData:n}=it(),{data:e,isLoading:t,isError:r}=gr({queryKey:[rt.DEVICES],queryFn:()=>n(be.device),staleTime:10*60*1e3});return{status:e==null?void 0:e.status,deviceData:e==null?void 0:e.data,isLoading:t,isError:r}}function jc(){const{readData:n}=it(),{data:e,isLoading:t,isError:r}=gr({queryKey:[rt.ROOMS],queryFn:()=>n(be.room),staleTime:10*60*1e3});return{status:e==null?void 0:e.status,roomData:e==null?void 0:e.data,isLoading:t,isError:r}}function fw(){return Bc(),jc(),null}function gw(){return x.jsxs("div",{className:o0.container,children:[x.jsx(VI,{}),x.jsx(fw,{}),x.jsx(cw,{}),x.jsx("main",{className:o0.content,children:x.jsx(bA,{})})]})}function mw(){const{invalidToken:n}=Jo(),e=Oi();return n?x.jsx(DA,{to:"/login",state:{from:e},replace:!0}):x.jsx(gw,{})}const pw="_card_110q8_1",yw="_star_110q8_51",vw="_lock_110q8_75",Ew="_devicesInfo_110q8_137",Va={card:pw,star:yw,lock:vw,devicesInfo:Ew},Sw="/static/svg/favourite_select.svg",xw="/static/svg/favourite_not_select.svg";function $S(n,e,t){const r=n.getQueryData([rt.FAVOURITES]);if(!r)return;let i=r.data.devices,s=r.data.rooms;e.type==="device"?e.is_favourite?i=i.filter(o=>o!==e.id):i.push(e.id):e.type==="room"&&(e.is_favourite?s=s.filter(o=>o!==e.id):s.push(e.id));const a={status:t,data:{rooms:s,devices:i}};n.setQueryData([rt.FAVOURITES],a)}function BS(n,e){console.log(e);const t=n.getQueryData([rt.ROOMS]);if(!t)return;const r=t.data.map(i=>(i.id===e.data.id&&(i=e.data),i));n.setQueryData([rt.ROOMS],{status:e.status,data:r})}function Tw(n){const e=Zt(),{updateData:t}=it();return _t({mutationFn:r=>t(be.favourite,r),onSuccess:(r,i)=>{$S(e,i,r.status),i.type==="room"?BS(e,r):i.type==="device"&&el(e,r),n&&n(!i.is_favourite)}})}function jS({isFavourite:n,onClick:e,className:t,id:r,type:i}){const s=Tw(e),a=()=>{s.mutate({id:r,is_favourite:n,type:i})};return x.jsx(x.Fragment,{children:x.jsx("img",{src:n?Sw:xw,alt:"Star",width:"24",height:"24",onClick:a,className:t})})}const _w="/static/svg/lock_unlocked.svg",Lw="/static/svg/lock_locked.svg";function Aw({visibility:n,className:e}){return x.jsx("img",{src:n==="public"?_w:Lw,alt:"Lock",width:"24",height:"24",className:e})}const Rw="_container_1ukyk_1",Iw={container:Rw};function tl({children:n}){return x.jsx("div",{className:Iw.container,children:n})}const ww="_statMini_1ouzn_1",Cw="_icon_1ouzn_37",Dw="_value_1ouzn_47",bd={statMini:ww,icon:Cw,value:Dw};function Bn({icon:n,children:e,className:t}){return x.jsxs("div",{className:`${bd.statMini} ${t}`,children:[x.jsx("span",{className:bd.icon,children:n}),x.jsx("span",{className:bd.value,children:e})]})}function GS({room:n}){const[e,t]=C.useState(n.is_favourite),r=Kn(),i=()=>{r(`/room/${n.id}/`)},s=()=>t(!e);return x.jsxs("div",{className:Va.card,children:[x.jsx(jS,{className:Va.star,isFavourite:e,onClick:s,id:n.id,type:"room"}),x.jsx(Aw,{visibility:n.visibility,className:Va.lock}),x.jsx(mr,{children:n.name}),x.jsxs(tl,{children:[x.jsx(Bn,{className:Va.devicesInfo,children:x.jsxs("p",{children:["Aktywne : ",n.active_device_count]})}),x.jsx(Bn,{className:Va.devicesInfo,children:x.jsxs("p",{children:["Wszystkie : ",n.device_count]})})]}),x.jsx(Xe,{type:"fancy",onClick:i,children:"Wybierz"})]})}const bw="_dot_18v8x_1",kw="_small_18v8x_9",Pw="_medium_18v8x_17",Ow="_large_18v8x_25",Fw="_xlarge_18v8x_33",l0={dot:bw,small:kw,medium:Pw,large:Ow,xlarge:Fw};function Mw({color:n,size:e="medium"}){return x.jsx("div",{className:`${l0.dot} ${l0[e]}`,style:{backgroundColor:n}})}const Nw="_card_jvul6_1",Uw="_active_jvul6_51",$w="_inactive_jvul6_61",Bw="_disabled_jvul6_71",jw="_star_jvul6_93",Gw="_wifi_jvul6_119",Vw="_pulse_jvul6_1",kd={card:Nw,active:Uw,inactive:$w,disabled:Bw,star:jw,wifi:Gw,pulse:Vw},Hw="_icon_12aio_1",Kw="_small_12aio_13",zw="_medium_12aio_23",Ww="_large_12aio_33",qw="_weak_12aio_51",Yw="_pulse_12aio_1",Qw="_offline_12aio_77",ac={icon:Hw,small:Kw,medium:zw,large:Ww,weak:qw,pulse:Yw,offline:Qw},Xw="/static/svg/wifi_perfect.svg",Zw="/static/svg/wifi_medium.svg",Jw="/static/svg/wifi_low.svg",eC="/static/svg/wifi_no.svg",tC=n=>n<=-80?eC:n<=-60?Jw:n<=-50?Zw:Xw,nC=n=>n<=-80?ac.offline:n<=-60?ac.weak:"";function wa({strength:n,size:e="medium",className:t}){const r=tC(n),i=nC(n);return x.jsx("img",{src:r,alt:"Wifi",className:`${ac.icon} ${ac[e]} ${i} ${t||""}`})}function Gc({isFavourite:n,name:e,wifiStrength:t,isOnline:r,id:i,children:s}){const[a,o]=C.useState(n);return x.jsxs("div",{className:kd.card,children:[x.jsx(mr,{children:e}),x.jsx(jS,{isFavourite:a,onClick:()=>o(l=>!l),className:kd.star,id:i,type:"device"}),x.jsx(wa,{strength:r?t:-100,className:kd.wifi}),s]})}const rC="_times_1fnon_1",iC="_time_1fnon_1",sC="_arrow_1fnon_39",Ul={times:rC,time:iC,arrow:sC},u0=n=>n.length>5?n.slice(0,5):n;function vf({start:n,end:e}){return x.jsxs("div",{className:Ul.times,children:[x.jsx("span",{className:Ul.time,children:u0(n)}),x.jsx("span",{className:Ul.arrow,children:"→"}),x.jsx("span",{className:Ul.time,children:u0(e)})]})}function aC(n){return x.jsxs(Gc,{isFavourite:n.is_favourite,isOnline:n.is_online,wifiStrength:n.wifi_strength,name:n.name,id:n.id,children:[n.mode||x.jsxs(tl,{children:[x.jsx(Bn,{icon:"💡",children:n.led_mode?"ON":"OFF"}),x.jsx(Bn,{icon:"🔆",children:n.fluo_mode?"ON":"OFF"}),x.jsx(Bn,{icon:"🎨",children:x.jsx(Mw,{color:`rgb(${n.color_r},${n.color_g},${n.color_b})`})}),x.jsx(Bn,{icon:"⚙️",children:n.mode?"Automat":"Manual"})]}),n.mode&&x.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginTop:"8px"},children:[x.jsx(Bn,{icon:"💡",children:x.jsx(vf,{start:n.led_start,end:n.led_stop})}),x.jsx(Bn,{icon:"🔆",children:x.jsx(vf,{start:n.fluo_start,end:n.fluo_stop})})]}),x.jsx(Xt,{type:"fancy",to:`/aquarium/${n.id}/`,children:"Szczegóły"})]})}const oC="_hold_1679d_1",lC="_click_1679d_43",uC="_pressed_1679d_151",cC={hold:oC,click:lC,pressed:uC};function oc({onClick:n,className:e,type:t,children:r}){return x.jsx("button",{className:`${cC[t]} ${e}`,onClick:n,children:r})}function dC(n){function e(){console.log("hold")}function t(){console.log("click")}return x.jsxs(Gc,{isFavourite:n.is_favourite,name:n.name,wifiStrength:n.wifi_strength,isOnline:n.is_online,id:n.id,children:[x.jsxs(tl,{children:[x.jsx(oc,{onClick:e,type:"hold",children:"HOLD"}),x.jsx(oc,{onClick:t,type:"click",children:"CLICK"})]}),x.jsx(Xt,{type:"fancy",to:`/button/${n.id}/`,children:"Wybierz"})]})}const hC="_scheduleCard_1r1d8_1",fC="_lampInfo_1r1d8_11",gC="_statsLine_1r1d8_21",mC="_time_1r1d8_29",pC="_arrow_1r1d8_39",yC="_times_1r1d8_69",vC="_statMini_1r1d8_99",EC="_schedule_1r1d8_1",SC={scheduleCard:hC,lampInfo:fC,statsLine:gC,time:mC,arrow:pC,times:yC,statMini:vC,schedule:EC};function xC(n){return x.jsxs(Gc,{isFavourite:n.is_favourite,name:n.name,wifiStrength:n.brightness,isOnline:n.is_online,id:n.id,children:[x.jsxs(tl,{children:[x.jsxs(Bn,{icon:"💡",children:[n.brightness,"%"]}),x.jsxs(Bn,{icon:"⏱️",children:[n.lighting_time," s"]}),x.jsx(Bn,{icon:"📅",className:SC.scheduleCard,children:x.jsx(vf,{start:n.light_start,end:n.light_stop})})]}),x.jsx(Xt,{type:"fancy",to:`/lamp/${n.id}/`,children:"Szczegóły"})]})}function TC(n){function e(){console.log("hold")}function t(){console.log("click")}return x.jsxs(Gc,{isFavourite:n.is_favourite,name:n.name,wifiStrength:n.wifi_strength,isOnline:n.is_online,id:n.id,children:[x.jsxs(tl,{children:[x.jsx(oc,{onClick:e,type:"hold",children:"HOLD"}),x.jsx(oc,{onClick:t,type:"click",children:"CLICK"})]}),x.jsx(Xt,{type:"fancy",to:`/rfid/${n.id}`,children:"Wybierz"})]})}function jg(n){switch(n.fun){case"lamp":return C.createElement(xC,{...n,key:n.id});case"rfid":return C.createElement(TC,{...n,key:n.id});case"button":return C.createElement(dC,{...n,key:n.id});case"aquarium":return C.createElement(aC,{...n,key:n.id})}}function _C(){const{readData:n}=it(),{data:e,isLoading:t}=gr({queryFn:()=>n(be.favourite),queryKey:[rt.FAVOURITES],staleTime:10*60*1e3});return{status:e==null?void 0:e.status,favouriteData:e==null?void 0:e.data,isLoading:t}}const LC="_container_y2ttj_1",AC="_expanded_y2ttj_95",RC="_shimmer_y2ttj_1",IC="_input_y2ttj_153",wC="_searchIcon_y2ttj_225",CC="_active_y2ttj_289",DC="_pulse_y2ttj_1",bC="_typing_y2ttj_321",kC="_searchButton_y2ttj_481",PC="_searchResults_y2ttj_531",OC="_visible_y2ttj_569",Ha={container:LC,expanded:AC,shimmer:RC,input:IC,searchIcon:wC,active:CC,pulse:DC,typing:bC,searchButton:kC,searchResults:PC,visible:OC},FC="/static/svg/search.svg";function nl({onChange:n,className:e}){const[t,r]=C.useState(!1),i=C.useRef(null);function s(){i.current&&i.current.focus(),r(a=>!a)}return x.jsxs("div",{className:`${Ha.container} ${t&&Ha.expanded}`,children:[x.jsx("img",{src:FC,className:Ha.searchIcon,onClick:s}),x.jsx("input",{ref:i,type:"text",onChange:a=>n(a.target.value),className:`${Ha.input} ${t&&Ha.expanded} ${e}`})]})}const MC="_cardContainer_ju8f0_1",NC="_fadeInUp_ju8f0_1",UC="_header_ju8f0_103",$C={cardContainer:MC,fadeInUp:NC,header:UC};function Vc({children:n}){return x.jsx("div",{className:$C.cardContainer,children:n})}const BC="_pageHeader_1ui1w_1",jC="_title_1ui1w_37",GC="_subtitle_1ui1w_59",Pd={pageHeader:BC,title:jC,subtitle:GC};function pn({children:n,className:e,title:t,subtitle:r}){return x.jsxs("div",{className:`${Pd.pageHeader} ${e}`,children:[x.jsxs("div",{children:[t&&x.jsx("h1",{className:Pd.title,children:t}),r&&x.jsx("p",{className:Pd.subtitle,children:r})]}),n]})}function VS(n){const{deviceData:e,status:t,isLoading:r,isError:i}=Bc();return e?{devices:e.filter(s=>n.includes(s.id)),isLoading:r,isError:i,status:t}:{devices:[],status:t,isLoading:r,isError:i}}function VC(n){const{roomData:e,isLoading:t,isError:r}=jc();return e?{rooms:e.filter(i=>n.includes(i.id)),isLoading:t,isError:r}:{rooms:[],isLoading:t,isError:r}}function HC(){const{favouriteData:n}=_C(),{devices:e}=VS((n==null?void 0:n.devices)||[]),{rooms:t}=VC((n==null?void 0:n.rooms)||[]),[r,i]=C.useState([]),[s,a]=C.useState([]),o=C.useMemo(()=>e,[JSON.stringify(e)]),l=C.useMemo(()=>t,[JSON.stringify(t)]);C.useEffect(()=>{e&&a(e),t&&i(t)},[o,l]);function u(c){const d=c.toLowerCase();i(n.rooms.filter(h=>h.name.toLowerCase().includes(d))),a(n.devices.filter(h=>h.name.toLowerCase().includes(d)))}return!s||!r?null:x.jsxs(Pt,{children:[x.jsx(pn,{title:"Dashboard",subtitle:"Witaj z powrotem w Smart Home",children:x.jsx(nl,{onChange:u})}),x.jsxs(Vc,{children:[r.map(c=>x.jsx(GS,{room:c},c.id)),s.map(c=>jg(c))]})]})}function KC(){const{readData:n}=it(),{data:e}=gr({queryKey:["router"],queryFn:()=>n(be.router),staleTime:10*60*1e3});return{status:e==null?void 0:e.status,routerData:e==null?void 0:e.data}}const zC="_container_65rya_1",WC={container:zC};function qC(){const{createData:n}=it(),e=Zt();function t(){return _t({mutationFn:r=>n(be.router,{mac:r}),onSuccess:()=>{e.invalidateQueries({queryKey:["router"]})}})}return{createRouter:t}}function YC(){const[n,e]=C.useState(""),{createRouter:t}=qC(),r=t();function i(){r.mutate(n)}const s=r.error;return x.jsx(Pt,{className:WC.container,children:x.jsxs(Fi,{children:[x.jsx(mr,{children:"Dodaj nowy router"}),x.jsx(dn,{name:"router",type:"text",placeholder:"Podaj adres mac",onChange:a=>e(a.target.value)}),x.jsx(Ne,{type:"error",show:!!(s!=null&&s.details),children:s==null?void 0:s.details[Object.keys(s==null?void 0:s.details)[0]]}),x.jsx(Xe,{type:"fancy",onClick:i,children:"Dodaj"})]})})}const QC="_tilesContainer_11tjx_1",XC={tilesContainer:QC};function Ur({children:n}){return x.jsx("div",{className:XC.tilesContainer,children:n})}const ZC="_tile_xfysy_1",JC="_blue_xfysy_87",eD="_danger_xfysy_97",c0={tile:ZC,blue:JC,danger:eD};function Ue({children:n,type:e="blue",className:t}){return x.jsx("div",{className:`${c0.tile} ${c0[e]} ${t}`,children:n})}const tD="_container_469dx_1",nD="_small_469dx_19",rD="_medium_469dx_29",iD="_large_469dx_39",sD="_xlarge_469dx_49",aD="_spinner_469dx_59",oD="_spin_469dx_59",lD="_pulse_469dx_1",uD="_dots_469dx_149",cD="_rotate_469dx_1",dD="_orbit_469dx_1",hD="_rings_469dx_217",fD="_glow_469dx_461",$l={container:tD,small:nD,medium:rD,large:iD,xlarge:sD,spinner:aD,spin:oD,pulse:lD,dots:uD,rotate:cD,orbit:dD,rings:hD,"pulse-ring":"_pulse-ring_469dx_1",glow:fD};function Cn({size:n="medium",type:e="spinner",glow:t=!1,className:r=""}){const i=`
    ${$l[n]} 
    ${$l[e]} 
    ${t?$l.glow:""} 
    ${r}
  `.trim();return x.jsx("div",{className:$l.container,children:x.jsx("div",{className:i})})}const gD="_data_czau7_1",Bl={data:gD};function mD(){const{routerData:n,status:e}=KC();if(!n)return x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0});const t=n[0];return e===404?x.jsx(YC,{}):x.jsxs(Pt,{children:[x.jsx(pn,{title:"Router",children:x.jsx(wa,{strength:t.is_online?0:-100,size:"large"})}),x.jsxs(Ur,{children:[x.jsx(Ue,{children:x.jsxs("div",{className:Bl.data,children:[x.jsx("p",{children:"IP:"})," ",t.ip]})}),x.jsx(Ue,{children:x.jsxs("div",{className:Bl.data,children:[x.jsx("p",{children:"Mac:"})," ",t.mac]})}),x.jsx(Ue,{children:x.jsxs("div",{className:Bl.data,children:[x.jsx("p",{children:"Przypisane urządzenia:"})," ",t.connected_devices]})}),x.jsx(Ue,{children:x.jsxs("div",{className:Bl.data,children:[x.jsx("p",{children:"Urządzenia aktywne:"})," ",t.online_device]})})]})]})}const pD="_container_1dbhk_1",yD="_fadeIn_1dbhk_1",vD={container:pD,fadeIn:yD},ED="_container_1lcut_3",SD="_input_1lcut_53",xD="_radioGroup_1lcut_421",TD="_error_1lcut_453",_D="_disabled_1lcut_501",jl={container:ED,input:SD,"pulse-glow":"_pulse-glow_1lcut_1","dot-appear":"_dot-appear_1lcut_1",radioGroup:xD,error:TD,disabled:_D};function d0({name:n,onSelect:e,value:t,checked:r=!1,disabled:i=!1,error:s=!1,className:a="",groupName:o="select"}){const l=`
    ${jl.container} 
    ${i?jl.disabled:""} 
    ${s?jl.error:""} 
    ${a}
  `.trim();return x.jsxs("div",{className:l,children:[x.jsx("input",{id:`${o}-${t}`,type:"radio",name:o,value:t,className:jl.input,onChange:e,defaultChecked:r,disabled:i,"aria-describedby":s?`${o}-error`:void 0}),x.jsx("label",{htmlFor:`${o}-${t}`,children:n})]})}const LD="_buttonContainer_opy2u_1",AD={buttonContainer:LD};function zn({children:n}){return x.jsx("div",{className:AD.buttonContainer,children:n})}function RD({onClose:n}){var c,d,h,f,g,m;const e=Zt(),[t,r]=C.useState({name:"",visibility:"public"}),{createData:i}=it(),s=_t({mutationFn:p=>i(be.room,p),onSuccess:()=>{e.invalidateQueries({queryKey:["rooms"]}),n()}});function a(p){r({...t,visibility:p.target.value})}function o(p){r({...t,name:p.target.value})}const l=p=>{p.preventDefault(),s.mutate(t)},u=s.error;return x.jsx("section",{className:vD.container,children:x.jsxs(Fi,{children:[x.jsx(mr,{children:"Dodaj nowy pokój"}),x.jsx(dn,{name:"nazwa",type:"text",placeholder:"Nazwa",onChange:o}),x.jsx(Ne,{type:"error",show:!!((c=u==null?void 0:u.details)!=null&&c.name&&u.details.name.length>0),children:(h=(d=u==null?void 0:u.details)==null?void 0:d.name)==null?void 0:h[0]}),x.jsx(d0,{name:"Ogólny",value:"public",onSelect:a,checked:!0}),x.jsx(d0,{name:"Prywatny",value:"private",onSelect:a}),x.jsx(Ne,{type:"error",show:!!((f=u==null?void 0:u.details)!=null&&f.visibility&&u.details.visibility.length>0),children:(m=(g=u==null?void 0:u.details)==null?void 0:g.visibility)==null?void 0:m[0]}),x.jsxs(zn,{children:[x.jsx(Xe,{type:"fancy",onClick:l,children:"Dodaj"}),x.jsx(Xe,{type:"fancy",onClick:n,children:"Zamknij"})]})]})})}function ID(){const[n,e]=C.useState([]),[t,r]=C.useState(!1),{roomData:i}=jc();C.useEffect(()=>{i&&e(i)},[i]);function s(a){const o=a.toLowerCase();e(i.filter(l=>l.name.toLowerCase().includes(o)))}return i?x.jsxs(Pt,{children:[x.jsx(pn,{title:"Pokoje",children:x.jsxs(zn,{children:[x.jsx(nl,{onChange:s}),x.jsx(Xe,{type:"fancy",onClick:()=>r(!0),children:"Dodaj"})]})}),t&&x.jsx(RD,{onClose:()=>r(!1)}),x.jsx(Vc,{children:n.map(a=>x.jsx(GS,{room:a},a.id))})]}):x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0})}const wD="_emptyState_i5p5j_3",CD={emptyState:wD};function HS(n){const{roomData:e,isLoading:t,isError:r}=jc();return e?{room:e.filter(i=>n===i.id)[0],isLoading:t,isError:r}:{room:null,isLoading:t,isError:r}}function DD(){const n=Br(),{room:e}=HS(n.id?parseInt(n.id):0),t=C.useMemo(()=>(e==null?void 0:e.device)||[],[e==null?void 0:e.device]),{devices:r}=VS(t),[i,s]=C.useState([]),a=C.useMemo(()=>r,[JSON.stringify(r)]);C.useEffect(()=>{a&&s(a)},[a]);function o(l){if(!r)return;const u=l.toLowerCase(),c=r.filter(d=>d.name.toLowerCase().includes(u));s(c)}return e?x.jsxs(Pt,{children:[x.jsx(pn,{title:e.name,children:x.jsxs(zn,{children:[x.jsx(nl,{onChange:o}),x.jsx(Xt,{type:"fancy",to:`/room/${n.id}/settings`,children:"Edytuj"}),x.jsx(Xt,{type:"fancy",to:`/room/${n.id}/add`,children:"Dodaj urządzenie"})]})}),(i==null?void 0:i.length)===0?x.jsx("div",{className:CD.emptyState,children:x.jsx("p",{children:"Nie znaleziono urządzeń"})}):x.jsx(Vc,{children:i==null?void 0:i.map(l=>jg(l))})]}):x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0})}function bD(){const{readData:n}=it(),{data:e}=gr({queryFn:()=>n(be.unassignedDevice),queryKey:["unassignedDevice"],staleTime:10*60*1e3});return{status:e==null?void 0:e.status,unassignedDeviceData:e==null?void 0:e.data}}function kD(n,e){const t=n.getQueryData([rt.ROOMS]);if(!t||!t.data.filter(s=>s.id===e.room_id)[0])return;const i=t.data.map(s=>(s.id===e.room_id&&s.device.push(e.device_id),s));n.setQueryData([rt.ROOMS],{status:t.status,data:i})}function PD(n,e){const t=n.getQueryData([rt.UNASSIGNED_DEVICE]),r=t.status,s=t.data.filter(a=>a.id!==e);n.setQueryData([rt.UNASSIGNED_DEVICE],{status:r,data:s})}function OD(){const{createData:n}=it(),e=Zt();function t(){return _t({mutationFn:r=>n(`${be.device}`,{device_id:r.deviceId,room_id:r.roomId}),onSuccess:async r=>{PD(e,r.data.device_id),await Promise.all([e.invalidateQueries({queryKey:[rt.ROOMS]}),e.invalidateQueries({queryKey:[rt.DEVICES]})]),kD(e,r.data)}})}return{selectDevice:t}}const FD="_row_13akr_3",MD="_pulse_13akr_1",ND="_noDevices_13akr_189",UD="_fadeIn_13akr_1",$D="_shimmer_13akr_1",BD="_withIcon_13akr_347",jD="_info_13akr_381",h0={row:FD,pulse:MD,noDevices:ND,fadeIn:UD,shimmer:$D,withIcon:BD,info:jD};function GD(){const n=Br(),e=parseInt(n.id?n.id:"0"),{status:t,unassignedDeviceData:r}=bD(),{selectDevice:i}=OD(),s=i();function a(o){s.mutate({deviceId:o,roomId:e})}return r?x.jsxs(Pt,{children:[x.jsx(pn,{title:"Przypisz urządzenie"}),(t===404||r.length===0)&&x.jsx("p",{className:h0.noDevices,children:"Brak nowo dodanych urządzeń"}),t===200&&x.jsx(Ur,{children:r.map(o=>x.jsx(Ue,{children:x.jsxs("div",{className:h0.row,children:[x.jsx("p",{children:o.name}),x.jsx("p",{children:o.fun}),x.jsx("p",{children:o.last_seen.split("T")[1].slice(0,5)}),x.jsx(Xe,{onClick:()=>a(o.id),children:"Przypisz"})]},o.id)},o.id))})]}):x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0})}const VD="_container_lymwv_1",HD="_link_lymwv_18",KD="_sh02_lymwv_1",zD={container:VD,link:HD,sh02:KD},WD=()=>(Kn(),C.useEffect(()=>{(async()=>{})()},[]),x.jsx("div",{className:zD.container}));function ar(){return ar=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ar.apply(null,arguments)}function KS(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.includes(r))continue;t[r]=n[r]}return t}var $s=255,mi=100,zS=n=>{var{r:e,g:t,b:r,a:i}=n,s=Math.max(e,t,r),a=s-Math.min(e,t,r),o=a?s===e?(t-r)/a:s===t?2+(r-e)/a:4+(e-t)/a:0;return{h:60*(o<0?o+6:o),s:s?a/s*mi:0,v:s/$s*mi,a:i}},qD=n=>{var{h:e,s:t,v:r,a:i}=n,s=(200-t)*r/mi;return{h:e,s:s>0&&s<200?t*r/mi/(s<=mi?s:200-s)*mi:0,l:s/2,a:i}},WS=n=>{var{r:e,g:t,b:r}=n,i=e<<16|t<<8|r;return"#"+(s=>new Array(7-s.length).join("0")+s)(i.toString(16))},YD=n=>{var{r:e,g:t,b:r,a:i}=n,s=typeof i=="number"&&(i*255|256).toString(16).slice(1);return""+WS({r:e,g:t,b:r,a:i})+(s||"")},qS=n=>zS(QD(n)),QD=n=>{var e=n.replace("#","");/^#?/.test(n)&&e.length===3&&(n="#"+e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2));var t=new RegExp("[A-Za-z0-9]{2}","g"),[r,i,s=0,a]=n.match(t).map(o=>parseInt(o,16));return{r,g:i,b:s,a:(a??255)/$s}},YS=n=>{var{h:e,s:t,v:r,a:i}=n,s=e/60,a=t/mi,o=r/mi,l=Math.floor(s)%6,u=s-Math.floor(s),c=$s*o*(1-a),d=$s*o*(1-a*u),h=$s*o*(1-a*(1-u));o*=$s;var f={};switch(l){case 0:f.r=o,f.g=h,f.b=c;break;case 1:f.r=d,f.g=o,f.b=c;break;case 2:f.r=c,f.g=o,f.b=h;break;case 3:f.r=c,f.g=d,f.b=o;break;case 4:f.r=h,f.g=c,f.b=o;break;case 5:f.r=o,f.g=c,f.b=d;break}return f.r=Math.round(f.r),f.g=Math.round(f.g),f.b=Math.round(f.b),ar({},f,{a:i})},XD=n=>{var{r:e,g:t,b:r}=n;return{r:e,g:t,b:r}},ZD=n=>{var{h:e,s:t,l:r}=n;return{h:e,s:t,l:r}},QS=n=>WS(YS(n)),JD=n=>{var{h:e,s:t,v:r}=n;return{h:e,s:t,v:r}},eb=n=>{var{r:e,g:t,b:r}=n,i=function(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)},s=i(e/255),a=i(t/255),o=i(r/255),l={};return l.x=s*.4124+a*.3576+o*.1805,l.y=s*.2126+a*.7152+o*.0722,l.bri=s*.0193+a*.1192+o*.9505,l},tb=n=>{var e,t,r,i,s,a,o,l,u;return typeof n=="string"&&XS(n)?(a=qS(n),l=n):typeof n!="string"&&(a=n),a&&(r=JD(a),s=qD(a),i=YS(a),u=YD(i),l=QS(a),t=ZD(s),e=XD(i),o=eb(e)),{rgb:e,hsl:t,hsv:r,rgba:i,hsla:s,hsva:a,hex:l,hexa:u,xy:o}},XS=n=>/^#?([A-Fa-f0-9]{3,4}){1,2}$/.test(n);function f0(n){var e=C.useRef(n);return C.useEffect(()=>{e.current=n}),C.useCallback((t,r)=>e.current&&e.current(t,r),[])}var co=n=>"touches"in n,g0=n=>{!co(n)&&n.preventDefault&&n.preventDefault()},m0=function(e,t,r){return t===void 0&&(t=0),r===void 0&&(r=1),e>r?r:e<t?t:e},p0=(n,e)=>{var t=n.getBoundingClientRect(),r=co(e)?e.touches[0]:e;return{left:m0((r.pageX-(t.left+window.pageXOffset))/t.width),top:m0((r.pageY-(t.top+window.pageYOffset))/t.height),width:t.width,height:t.height,x:r.pageX-(t.left+window.pageXOffset),y:r.pageY-(t.top+window.pageYOffset)}},nb=["prefixCls","className","onMove","onDown"],ZS=Bf.forwardRef((n,e)=>{var{prefixCls:t="w-color-interactive",className:r,onMove:i,onDown:s}=n,a=KS(n,nb),o=C.useRef(null),l=C.useRef(!1),[u,c]=C.useState(!1),d=f0(i),h=f0(s),f=v=>l.current&&!co(v)?!1:(l.current=co(v),!0),g=C.useCallback(v=>{g0(v);var E=co(v)?v.touches.length>0:v.buttons>0;E&&o.current?d&&d(p0(o.current,v),v):c(!1)},[d]),m=C.useCallback(()=>c(!1),[]),p=C.useCallback(v=>{var E=v?window.addEventListener:window.removeEventListener;E(l.current?"touchmove":"mousemove",g),E(l.current?"touchend":"mouseup",m)},[]);C.useEffect(()=>(p(u),()=>{u&&p(!1)}),[u,p]);var y=C.useCallback(v=>{g0(v.nativeEvent),f(v.nativeEvent)&&(h&&h(p0(o.current,v.nativeEvent),v.nativeEvent),c(!0))},[h]);return x.jsx("div",ar({},a,{className:[t,r||""].filter(Boolean).join(" "),style:ar({},a.style,{touchAction:"none"}),ref:o,tabIndex:0,onMouseDown:y,onTouchStart:y}))});ZS.displayName="Interactive";var rb="rgb(255 255 255) 0px 0px 0px 1.5px, rgb(0 0 0 / 30%) 0px 0px 1px 1px inset, rgb(0 0 0 / 40%) 0px 0px 1px 2px",ib=n=>{var{className:e,color:t,left:r,top:i,style:s,prefixCls:a}=n,o=ar({},s,{position:"absolute",top:i,left:r}),l=a+"-pointer "+(e||"");return x.jsx("div",{className:l,style:o,children:x.jsx("div",{className:a+"-fill",style:{width:10,height:10,transform:"translate(-5px, -5px)",boxShadow:rb,borderRadius:"50%",backgroundColor:"#fff"},children:x.jsx("div",{style:{inset:0,borderRadius:"50%",position:"absolute",backgroundColor:t}})})})},JS=Math.PI*2,sb=(n,e)=>(n%e+e)%e,ab=(n,e)=>Math.sqrt(n*n+e*e);function ex(n){var{width:e=0}=n,t=e/2;return{width:e,radius:t,cx:t,cy:t}}function ob(n,e){var{cx:t,cy:r}=ex(n),i=tx(n),s=(180+nx(n,e.h,!0))*(JS/360),a=e.s/100*i,o=n.direction==="clockwise"?-1:1;return{x:t+a*Math.cos(s)*o,y:r+a*Math.sin(s)*o}}function tx(n){var{width:e=0}=n;return e/2}function nx(n,e,t){var r=n.angle||0,i=n.direction;return t&&i==="clockwise"?e=r+e:i==="clockwise"?e=360-r+e:t&&i==="anticlockwise"?e=r+180-e:i==="anticlockwise"&&(e=r-e),sb(e,360)}function lb(n,e,t){var{cx:r,cy:i}=ex(n),s=tx(n);e=r-e,t=i-t;var a=nx(n,Math.atan2(-t,-e)*(360/JS)),o=Math.min(ab(e,t),s);return{h:Math.round(a),s:Math.round(100/s*o)}}var ub=["prefixCls","radius","pointer","className","style","width","height","oval","direction","angle","color","onChange"],cb="conic-gradient(red, yellow, lime, aqua, blue, magenta, red)",db="conic-gradient(red, magenta, blue, aqua, lime, yellow, red)",rx=Bf.forwardRef((n,e)=>{var{prefixCls:t="w-color-wheel",radius:r=0,pointer:i,className:s,style:a,width:o=200,height:l=200,oval:u,direction:c="anticlockwise",angle:d=180,color:h,onChange:f}=n,g=KS(n,ub),m=typeof h=="string"&&XS(h)?qS(h):h||{},p=h?QS(m):"",y=ob({width:o},m),v={top:"0",left:"0",color:p},E=(R,A)=>{var T=lb({width:o},o-R.x,l-R.y),w={h:T.h,s:T.s,v:m.v,a:m.a};f&&f(tb(w))},_={zIndex:1,transform:"translate("+y.x+"px, "+y.y+"px) "+(u==="x"||u==="X"?"scaleY(2)":u==="y"||u==="Y"?"scaleX(2)":"")},L=i&&typeof i=="function"?i(ar({prefixCls:t,style:_},v)):x.jsx(ib,ar({prefixCls:t,style:_},v));return x.jsxs(ZS,ar({className:[t,s||""].filter(Boolean).join(" ")},g,{style:ar({position:"relative",width:o,transform:u==="x"||u==="X"?"scaleY(0.5)":u==="y"||u==="Y"?"scaleX(0.5)":"",height:l},a),ref:e,onMove:E,onDown:E,children:[L,x.jsx("div",{style:{position:"absolute",borderRadius:"50%",background:c==="anticlockwise"?cb:db,transform:"rotateZ("+(d+90)+"deg)",inset:0}}),x.jsx("div",{style:{position:"absolute",borderRadius:"50%",background:"radial-gradient(circle closest-side, #fff, transparent)",inset:0}}),x.jsx("div",{style:{backgroundColor:"#000",borderRadius:"50%",position:"absolute",inset:0,opacity:typeof m.v=="number"?1-m.v/100:0}})]}))});rx.displayName="Wheel";const hb="_messageContainer_eihp9_1",fb="_container_eihp9_17",gb="_button_eihp9_23",Od={messageContainer:hb,container:fb,button:gb};function mb(n){const{updateData:e}=it(),t=Zt();return _t({mutationFn:r=>e(`${be.aquarium}${n}/`,r),onSuccess:r=>{el(t,r)}})}const pb="_container_zhy7u_1",yb="_label_zhy7u_19",vb="_input_zhy7u_41",Eb="_glow_zhy7u_1",Sb="_error_zhy7u_269",Fd={container:pb,label:yb,input:vb,glow:Eb,error:Sb},Bs=({initialTime:n,onChange:e,label:t,disabled:r=!1})=>{const[i,s]=C.useState(n),a=C.useRef(null);C.useEffect(()=>{e(i)},[i]);const o=u=>{s(u.target.value.slice(0,5))},l=()=>{a.current&&a.current.showPicker()};return x.jsxs("div",{className:Fd.container,onClick:l,children:[x.jsx("label",{className:Fd.label,children:t}),x.jsx("input",{ref:a,className:Fd.input,type:"time",step:"60",onChange:o,value:i.slice(0,5),disabled:r})]})},xb="_container_ocf0j_1",Tb="_label_ocf0j_15",_b="_toggleButton_ocf0j_37",Lb="_disabled_ocf0j_63",Ab="_slider_ocf0j_81",Rb="_text_ocf0j_105",Ib="_on_ocf0j_117",wb="_off_ocf0j_145",zr={container:xb,label:Tb,toggleButton:_b,disabled:Lb,slider:Ab,text:Rb,on:Ib,off:wb};function Md({label:n,initialValue:e=!1,onChange:t,onLabel:r="Włącz",offLabel:i="Wyłącz",disabled:s=!1}){const[a,o]=C.useState(e);C.useEffect(()=>{o(e)},[e]);const l=()=>{if(s)return;const u=!a;o(u),t(u)};return x.jsxs("div",{className:zr.container,children:[x.jsx("label",{className:zr.label,children:n}),x.jsx("button",{className:`${zr.toggleButton} ${a?zr.on:zr.off} ${s?zr.disabled:""}`,onClick:l,disabled:s,type:"button",children:x.jsx("div",{className:zr.slider,children:x.jsx("span",{className:zr.text,children:a?r:i})})})]})}function Hc(n){const{deviceData:e,isLoading:t,isError:r,status:i}=Bc();return e?{device:e.filter(s=>n===s.id)[0],isLoading:t,isError:r,status:i}:{device:null,isLoading:t,isError:r}}const Cb={aquariumData:{},hsva:{h:0,s:0,v:100,a:1}};function Db(n,e){switch(e.type){case"set/init_value":return{...n,...e.payload};case"set/color":return{...n,aquariumData:{...n.aquariumData,color_r:e.payload.rgb.r,color_g:e.payload.rgb.g,color_b:e.payload.rgb.b},hsva:e.payload.hsva};case"set/ledStart":return{...n,aquariumData:{...n.aquariumData,led_start:e.payload}};case"set/ledStop":return{...n,aquariumData:{...n.aquariumData,led_stop:e.payload}};case"set/fluoStart":return{...n,aquariumData:{...n.aquariumData,fluo_start:e.payload}};case"set/fluoStop":return{...n,aquariumData:{...n.aquariumData,fluo_stop:e.payload}};default:return n}}function bb(){var u;const n=Br(),e=n.id?parseInt(n.id):0,{device:t,isLoading:r}=Hc(e),i=mb(e),[s,a]=C.useReducer(Db,Cb),o=t;C.useEffect(()=>{!r&&o&&a({type:"set/init_value",payload:{aquariumData:o,hsva:zS({r:o.color_r,g:o.color_g,b:o.color_b,a:1})}})},[r,o]);const l=c=>{if(c){i.mutate({...s.aquariumData,[c]:!s.aquariumData[c]});return}i.mutate(s.aquariumData)};return Object.keys(s.aquariumData).length===0?x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0}):x.jsxs(Pt,{className:Od.container,children:[x.jsx(pn,{title:s.aquariumData.name,children:x.jsxs(zn,{children:[x.jsx(Xt,{type:"fancy",to:`/aquarium/${o.id}/settings/`,children:"Ustawienia urządzenia"}),x.jsx(wa,{size:"large",strength:s.aquariumData.is_online?s.aquariumData.wifi_strength:-100})]})}),x.jsxs(Ur,{children:[x.jsx(Ue,{children:x.jsx(rx,{color:s.hsva,onChange:c=>{a({type:"set/color",payload:{hsva:c.hsva,rgb:c.rgb}})}})}),x.jsx(Ue,{children:x.jsx(Bs,{label:"Czas ledów - rozpoczęcie",initialTime:s.aquariumData.led_start,onChange:c=>a({type:"set/ledStart",payload:c}),disabled:!s.aquariumData.mode})}),x.jsx(Ue,{children:x.jsx(Bs,{label:"Czas ledów - zakończenie",initialTime:s.aquariumData.led_stop,onChange:c=>a({type:"set/ledStop",payload:c}),disabled:!s.aquariumData.mode})}),x.jsx(Ue,{children:x.jsx(Bs,{label:"Czas świetlówki - rozpoczęcie",initialTime:s.aquariumData.fluo_start,onChange:c=>a({type:"set/fluoStart",payload:c}),disabled:!s.aquariumData.mode})}),x.jsx(Ue,{children:x.jsx(Bs,{label:"Czas świetlówki - zakończenie",initialTime:s.aquariumData.fluo_stop,onChange:c=>a({type:"set/fluoStop",payload:c}),disabled:!s.aquariumData.mode})}),x.jsx(Ue,{children:x.jsx(Md,{label:"Świetlówka",initialValue:s.aquariumData.fluo_mode,onChange:c=>l("fluo_mode"),onLabel:"Włączona",offLabel:"Wyłączona",disabled:s.aquariumData.mode})}),x.jsx(Ue,{children:x.jsx(Md,{label:"Ledy",initialValue:s.aquariumData.led_mode,onChange:c=>l("led_mode"),onLabel:"Włączona",offLabel:"Wyłączona",disabled:s.aquariumData.mode})}),x.jsx(Ue,{children:x.jsx(Md,{label:"Tryb",initialValue:s.aquariumData.mode,onChange:c=>l("mode"),onLabel:"Automatyczny",offLabel:"Ręczny"})})]}),x.jsx(Xe,{className:Od.button,type:"fancy",onClick:()=>l(void 0),children:"Zapisz"}),x.jsxs("div",{className:Od.messageContainer,children:[x.jsx(Ne,{show:!!i.error,type:"error",children:" Błąd w komunikacji z akwarium. "}),x.jsx(Ne,{show:!!((u=i==null?void 0:i.data)!=null&&u.status),type:"success",children:" Zapisano dane "})]})]})}const kb="_card_71tom_1",Pb="_lastUsed_71tom_13",Ob="_headerName_71tom_47",Fb="_header_71tom_47",Gl={card:kb,lastUsed:Pb,delete:"_delete_71tom_27",headerName:Ob,header:Fb},ix="/static/svg/delete.svg";function Mb(n){const e=new Date(n),t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${s}:${a} ${i}.${r}.${t} `}const Nb="_container_ndgmq_1",Ub="_text_ndgmq_59",y0={container:Nb,text:Ub};function Ea({name:n,onConfirm:e,onCancel:t,className:r,show:i=!0}){return i?x.jsxs("div",{className:`${y0.container} ${r}`,children:[x.jsxs("p",{className:y0.text,children:["Czy na pewno chcesz usunąć ",x.jsx("b",{children:n}),"?"]}),x.jsxs(zn,{children:[x.jsx(Xe,{type:"danger",onClick:e,children:"Tak"}),x.jsx(Xe,{onClick:t,children:"Nie"})]})]}):null}function sx(){const n=Zt(),{deleteData:e,createData:t}=it();function r(s){return _t({mutationFn:()=>e(`${be.card}${s}/`)})}function i(s){return _t({mutationFn:a=>t(`${be.card}`,{name:a,rfid:s}),onSuccess:a=>{el(n,a)}})}return{mutationDelete:r,mutationCreate:i}}function $b({card:n}){const[e,t]=C.useState(!1),{mutationDelete:r}=sx(),i=r(n.id),s=()=>{i.mutate()};return x.jsxs("div",{className:Gl.card,children:[x.jsxs("div",{className:Gl.header,children:[x.jsx(mr,{children:n.name}),x.jsx("img",{src:ix,alt:"delete icon",width:24,height:24,className:Gl.delete,onClick:()=>t(!0)})]}),x.jsxs("div",{className:Gl.lastUsed,children:["Ostatnie użycie:",x.jsx("p",{children:Mb(n.last_used)})]}),e&&x.jsx(Ea,{onConfirm:s,onCancel:()=>t(!1)})]})}const Bb="_container_u0hfq_1",jb="_deleteIcon_u0hfq_19",v0={container:Bb,deleteIcon:jb};function ax(){const{createData:n,deleteData:e}=it(),t=Zt();function r(s){return _t({mutationFn:a=>n(`${be.event}${s}/`,a),onSuccess:a=>{const o=t.getQueryData(["availableAction",s]);if(o){const l={...o,data:{...o.data,active_events:[...o.data.active_events,a.data]}};t.setQueryData(["availableAction",s],l)}}})}function i(s,a){return _t({mutationFn:()=>e(`${be.event}${a}/`),onSuccess:()=>{const o=t.getQueryData(["availableAction",s]);if(o){const l={...o,data:{...o.data,active_events:o.data.active_events.filter(u=>u.id!==a)}};t.setQueryData(["availableAction",s],l)}}})}return{createEvent:r,deleteEvent:i}}function ox({event:n}){const[e,t]=C.useState(!1),{deleteEvent:r}=ax(),i=r(1,n.id);return x.jsxs("div",{className:v0.container,children:[x.jsxs("span",{children:[n.event,"-",n.action,"-",n.device]}),x.jsx("img",{src:ix,alt:"Delete",width:"24",height:"24",className:v0.deleteIcon,onClick:()=>{t(!0)}},`${n.id} img`),e&&x.jsx(Ea,{onCancel:()=>t(!1),onConfirm:()=>{i.mutate(),t(!1)},name:"akcje"})]})}const Gb="_form_qk7al_1",Vb="_pendingMessage_qk7al_13",Hb="_pulse_qk7al_1",Kb="_pendingAnimation_qk7al_35",zb="_buttonGroup_qk7al_47",Wb="_instructionText_qk7al_61",qb="_fadeInOverlay_qk7al_1",Nd={form:Gb,pendingMessage:Vb,pulse:Hb,pendingAnimation:Kb,buttonGroup:zb,instructionText:Wb,fadeInOverlay:qb},Yb="_container_w5cxh_1",Qb={container:Yb};function Xb({children:n}){return x.jsx("div",{className:Qb.container,children:n})}function Zb({rfidID:n,handleAddFunction:e,show:t,pending:r,status:i}){var h,f,g;const[s,a]=C.useState(""),{mutationCreate:o}=sx(),l=o(n);function u(){l.mutate(s)}function c(){l.reset(),e()}const d=l.error;return t?x.jsx(Xb,{children:x.jsxs(Fi,{children:[x.jsx(mr,{children:"Dodaj kartę"}),r&&x.jsxs(x.Fragment,{children:[x.jsx("div",{className:Nd.pendingAnimation,children:x.jsx(Cn,{size:"small",type:"spinner",glow:!0})}),x.jsx("div",{className:Nd.pendingMessage,children:"Zbliż kartę do czytnika..."})]}),x.jsx("div",{className:Nd.instructionText,children:"Wprowadź nazwę karty i zbliż ją do czytnika RFID"}),x.jsx(dn,{error:!!d,name:"card",type:"text",placeholder:"Nazwa karty",onChange:m=>a(m.target.value)}),x.jsx(Ne,{show:!!((h=d==null?void 0:d.details)!=null&&h.non_field_errors),type:"error",children:(f=d==null?void 0:d.details)==null?void 0:f.non_field_errors}),x.jsx(Ne,{show:!!((g=d==null?void 0:d.details)!=null&&g.name),type:"error",children:"To pole jest wymagane"}),x.jsx(Ne,{show:i===400,type:"error",children:"Nie udało się dodać karty, spróbuj ponownie."}),x.jsx(Ne,{show:i===409,type:"error",children:"Ta karta jest już zapisana"}),x.jsxs(zn,{children:[x.jsx(Xe,{type:"form-secondary",onClick:c,children:"Anuluj"}),x.jsx(Xe,{type:"form-primary",onClick:u,children:"Dodaj kartę"})]})]})}):null}function Jb(){var c;const[n,e]=C.useState([]),[t,r]=C.useState(!1),i=Br(),s=i.id?parseInt(i.id):0,{device:a,status:o}=Hc(s),l=a;if(C.useEffect(()=>{l&&e(l.cards),o===201&&r(!1)},[l,o]),!l)return x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0});function u(d){const h=d.toLowerCase(),f=l.cards.filter(g=>g.name.toLowerCase().includes(h));e(f)}return x.jsxs(Pt,{children:[x.jsx(pn,{title:l.name,children:x.jsxs(zn,{children:[x.jsx(nl,{onChange:u}),x.jsx(Xt,{type:"fancy",to:`/rfid/${l.id}/event/wizard/`,children:"Dodaj zadarzenie"}),x.jsx(Xe,{type:"fancy",onClick:()=>{r(!0)},children:"Dodaj karte"}),x.jsx(Xt,{type:"fancy",to:`/rfid/${l.id}/settings/`,children:"Ustawienia urządzenia"}),x.jsx(wa,{strength:l.is_online?l.wifi_strength:-100,size:"large"})]})}),x.jsx(Zb,{show:t,pending:l.pending.includes("add_tag"),rfidID:l.id,handleAddFunction:()=>r(!1),status:o}),x.jsx(Ur,{children:(c=l.events)==null?void 0:c.map(d=>x.jsx(Ue,{children:x.jsx(ox,{event:d},`event-${d.id}`)},d.id))}),x.jsx("hr",{}),x.jsx(Ur,{children:n==null?void 0:n.map(d=>x.jsx(Ue,{children:x.jsx($b,{card:d},d.id)},d.id))})]})}const ek="_container_zrhuq_1",tk="_link_zrhuq_35",nk="_sh02_zrhuq_1",rk={container:ek,link:tk,sh02:nk},ik={email:"M13.106 7.222c0-2.967-2.249-5.032-5.482-5.032-3.35 0-5.646 2.318-5.646 5.702 0 3.493 2.235 5.708 5.762 5.708.862 0 1.689-.123 2.304-.335v-.862c-.43.199-1.354.328-2.29.328-2.926 0-4.813-1.88-4.813-4.798 0-2.844 1.921-4.881 4.594-4.881 2.735 0 4.608 1.688 4.608 4.156 0 1.682-.554 2.769-1.416 2.769-.492 0-.772-.28-.772-.76V5.206H8.923v.834h-.11c-.266-.595-.881-.964-1.6-.964-1.4 0-2.378 1.162-2.378 2.823 0 1.737.957 2.906 2.379 2.906.8 0 1.415-.39 1.709-1.087h.11c.081.67.703 1.148 1.503 1.148 1.572 0 2.57-1.415 2.57-3.643zm-7.177.704c0-1.197.54-1.907 1.456-1.907.93 0 1.524.738 1.524 1.907S8.308 9.84 7.371 9.84c-.895 0-1.442-.725-1.442-1.914z",password:"M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z",user:"M15.992 2c3.396 0 6.998 2.86 6.998 4.995v4.997c0 1.924-0.8 5.604-2.945 7.293-0.547 0.43-0.831 1.115-0.749 1.807 0.082 0.692 0.518 1.291 1.151 1.582l8.703 4.127c0.068 0.031 0.834 0.16 0.834 1.23l0.001 1.952-27.984 0.002v-2.029c0-0.795 0.596-1.045 0.835-1.154l8.782-4.145c0.63-0.289 1.065-0.885 1.149-1.573s-0.193-1.37-0.733-1.803c-2.078-1.668-3.046-5.335-3.046-7.287v-4.997c0.001-2.089 3.638-4.995 7.004-4.995zM15.992-0c-4.416 0-9.004 3.686-9.004 6.996v4.997c0 2.184 0.997 6.601 3.793 8.847l-8.783 4.145s-1.998 0.89-1.998 1.999v3.001c0 1.105 0.895 1.999 1.998 1.999h27.986c1.105 0 1.999-0.895 1.999-1.999v-3.001c0-1.175-1.999-1.999-1.999-1.999l-8.703-4.127c2.77-2.18 3.708-6.464 3.708-8.865v-4.997c0-3.31-4.582-6.995-8.998-6.995v0z",backArrow:"M14.389 7.956v4.374l1.056 0.010c7.335 0.071 11.466 3.333 12.543 9.944-4.029-4.661-8.675-4.663-12.532-4.664h-1.067v4.337l-9.884-7.001 9.884-7zM15.456 5.893l-12.795 9.063 12.795 9.063v-5.332c5.121 0.002 9.869 0.26 13.884 7.42 0-4.547-0.751-14.706-13.884-14.833v-5.381z",settings:"M10.65 3L9.93163 3.53449L9.32754 5.54812L7.47651 4.55141L6.5906 4.68143L4.68141 6.59062L4.55139 7.47652L5.5481 9.32755L3.53449 9.93163L3 10.65V13.35L3.53449 14.0684L5.54811 14.6725L4.55142 16.5235L4.68144 17.4094L6.59063 19.3186L7.47653 19.4486L9.32754 18.4519L9.93163 20.4655L10.65 21H13.35L14.0684 20.4655L14.6725 18.4519L16.5235 19.4486L17.4094 19.3185L19.3186 17.4094L19.4486 16.5235L18.4519 14.6724L20.4655 14.0684L21 13.35V10.65L20.4655 9.93163L18.4519 9.32754L19.4486 7.47654L19.3186 6.59063L17.4094 4.68144L16.5235 4.55142L14.6725 5.54812L14.0684 3.53449L13.35 3H10.65ZM10.4692 6.96284L11.208 4.5H12.792L13.5308 6.96284L13.8753 7.0946C13.9654 7.12908 14.0543 7.16597 14.142 7.2052L14.4789 7.35598L16.7433 6.13668L17.8633 7.25671L16.644 9.52111L16.7948 9.85803C16.834 9.9457 16.8709 10.0346 16.9054 10.1247L17.0372 10.4692L19.5 11.208V12.792L17.0372 13.5308L16.9054 13.8753C16.8709 13.9654 16.834 14.0543 16.7948 14.1419L16.644 14.4789L17.8633 16.7433L16.7433 17.8633L14.4789 16.644L14.142 16.7948C14.0543 16.834 13.9654 16.8709 13.8753 16.9054L13.5308 17.0372L12.792 19.5H11.208L10.4692 17.0372L10.1247 16.9054C10.0346 16.8709 9.94569 16.834 9.85803 16.7948L9.52111 16.644L7.25671 17.8633L6.13668 16.7433L7.35597 14.4789L7.2052 14.142C7.16597 14.0543 7.12908 13.9654 7.0946 13.8753L6.96284 13.5308L4.5 12.792L4.5 11.208L6.96284 10.4692L7.0946 10.1247C7.12907 10.0346 7.16596 9.94571 7.20519 9.85805L7.35596 9.52113L6.13666 7.2567L7.25668 6.13667L9.5211 7.35598L9.85803 7.2052C9.9457 7.16597 10.0346 7.12908 10.1247 7.0946L10.4692 6.96284ZM14.25 12C14.25 13.2426 13.2426 14.25 12 14.25C10.7574 14.25 9.75 13.2426 9.75 12C9.75 10.7574 10.7574 9.75 12 9.75C13.2426 9.75 14.25 10.7574 14.25 12ZM15.75 12C15.75 14.0711 14.0711 15.75 12 15.75C9.92893 15.75 8.25 14.0711 8.25 12C8.25 9.92893 9.92893 8.25 12 8.25C14.0711 8.25 15.75 9.92893 15.75 12Z",plus:"M12 3a1 1 0 0 0-1 1v7H4a1 1 0 1 0 0 2h7v7a1 1 0 1 0 2 0v-7h7a1 1 0 1 0 0-2h-7V4a1 1 0 0 0-1-1z"},sk="_iconBack_16kp3_1",ak={iconBack:sk},ok=({className:n})=>{const e=Kn();return x.jsx("button",{className:`${ak.iconBack} ${n}`,onClick:()=>{e(-1)},children:x.jsx("svg",{viewBox:"0 0 30 30",children:x.jsx("path",{d:ik.backArrow,fill:"#FFFFFF"})})})},lk=()=>x.jsx("div",{className:rk.container,children:x.jsx(ok,{})}),uk="_messageContainer_16545_1",ck="_container_16545_17",dk="_button_16545_25",Ud={messageContainer:uk,container:ck,button:dk},hk="_container_1eetx_1",fk="_label_1eetx_19",gk="_input_1eetx_41",mk="_glow_1eetx_1",pk="_error_1eetx_351",Vl={container:hk,label:fk,input:gk,glow:mk,error:pk};function yk({value:n,onChange:e,name:t,placeholder:r,min:i,max:s,step:a=1,disabled:o=!1,error:l=!1}){return x.jsxs("div",{className:Vl.container,children:[x.jsx("label",{className:Vl.label,children:t}),x.jsx("input",{className:`${Vl.input} ${l?Vl.error:""}`,type:"number",min:i,max:s,step:a,placeholder:r,disabled:o,onChange:u=>e?e(parseInt(u.target.value)||0):()=>{},value:n||""})]})}const vk="_container_1nsf3_1",Ek="_label_1nsf3_17",Sk="_name_1nsf3_37",xk="_range_1nsf3_61",Tk="_glow_1nsf3_1",_k="_error_1nsf3_511",Hl={container:vk,label:Ek,name:Sk,range:xk,glow:Tk,error:_k};function E0({onChange:n,min:e,max:t,value:r,className:i,name:s,step:a="1",disabled:o=!1,error:l=!1,showValue:u=!1}){return x.jsxs("div",{className:Hl.container,children:[s&&x.jsxs("span",{className:Hl.label,children:[s,u&&r!==void 0&&` ${r}${t==="100"?"%":""}`]}),x.jsx("input",{className:`${Hl.range} ${i||""} ${l?Hl.error:""}`,type:"range",onChange:c=>n&&n(parseInt(c.target.value)),value:r||0,min:e,max:t,step:a,disabled:o})]})}function Lk(){const{updateData:n}=it(),e=Zt();function t(r){return _t({mutationFn:i=>n(`${be.lamp}${r}/`,i),onSuccess:i=>{el(e,i)}})}return{updateLamp:t}}function Ak(n,e){switch(e.type){case"INIT_DATA":return{...n,...e.payload};case"set/light_start":return{...n,light_start:e.payload};case"set/light_stop":return{...n,light_stop:e.payload};case"set/brightness":return{...n,brightness:e.payload};case"set/lighting_time":return{...n,lighting_time:e.payload};case"set/step":return{...n,step:e.payload};default:return n}}function Rk(){const n=Br(),[e,t]=C.useReducer(Ak,null),r=parseInt(n.id?n.id:"0"),{device:i}=Hc(r),{updateLamp:s}=Lk(),a=s(r),o=i;C.useEffect(()=>{o&&t({type:"INIT_DATA",payload:o})},[o]);function l(){a.mutate(e)}return e?x.jsxs(Pt,{className:Ud.container,children:[x.jsx(pn,{title:e.name,children:x.jsxs(zn,{children:[x.jsx(Xt,{type:"fancy",to:`/lamp/${e.id}/settings/`,children:"Ustawienia urządzenia"}),x.jsx(wa,{size:"large",strength:e.is_online?e.wifi_strength:-100})]})}),x.jsxs(Ur,{children:[x.jsx(Ue,{children:x.jsx(Bs,{label:"Godzina rozpoczęcia",initialTime:e.light_start,onChange:u=>t({type:"set/light_start",payload:u})})}),x.jsx(Ue,{children:x.jsx(Bs,{label:"Godzina zakonczenia",initialTime:e.light_stop,onChange:u=>t({type:"set/light_stop",payload:u})})}),x.jsx(Ue,{children:x.jsx(yk,{name:"Czas świecenia [s]",value:e.lighting_time,onChange:u=>t({type:"set/lighting_time",payload:u})})}),x.jsx(Ue,{children:x.jsx(E0,{name:`Jasność ${e.brightness} %`,value:e.brightness,onChange:u=>t({type:"set/brightness",payload:u}),min:"0",max:"100"})}),x.jsx(Ue,{children:x.jsx(E0,{name:`Szybkość ${e.step} %`,value:e.step,onChange:u=>t({type:"set/step",payload:u}),min:"0",max:"100"})})]}),x.jsx(Xe,{className:Ud.button,type:"fancy",onClick:l,children:"Zapisz"}),x.jsxs("div",{className:Ud.messageContainer,children:[x.jsx(Ne,{type:"success",show:a.isSuccess,children:"Zapisano dane"}),x.jsx(Ne,{type:"error",show:a.isError,children:"Wystąpił bład podczas zapisu"})]})]}):x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0})}function Ik(){var i;const n=Br(),e=parseInt(n.id?n.id:"0"),{device:t}=Hc(e),r=t;return r?x.jsxs(Pt,{children:[x.jsx(pn,{title:r.name,children:x.jsxs(zn,{children:[x.jsx(Xt,{type:"fancy",to:`/button/${r.id}/event/wizard/`,children:"Ustawienia zdarzeń"}),x.jsx(Xt,{type:"fancy",to:`/button/${r.id}/settings/`,children:"Ustawienia urządzenia"}),x.jsx(wa,{strength:r.is_online?r.wifi_strength:-100,size:"large"})]})}),x.jsx(Ur,{children:(i=r.events)==null?void 0:i.map(s=>x.jsx(Ue,{children:x.jsx(ox,{event:s},s.id)},s.id))})]}):x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0})}function wk(){const{deviceData:n}=Bc(),[e,t]=C.useState([]);C.useEffect(()=>{n&&t(n)},[n]);const r=i=>{const s=i.toLowerCase(),a=n.filter(o=>o.name.toLowerCase().includes(s));t(a)};return e?x.jsxs(Pt,{children:[x.jsx(pn,{title:"Urządzenia",children:x.jsx(nl,{onChange:r})}),x.jsx(Vc,{children:e.map(i=>jg(i))})]}):x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0})}function Ck(n,e){const{readData:t}=it(),{data:r}=gr({queryKey:["availableAction",n],queryFn:()=>t(`${be.event}?id=${n}&fun=${e}`),staleTime:10*60*1e3});return{status:r==null?void 0:r.status,availableAction:r==null?void 0:r.data}}const Dk="_select_dochq_1",bk={select:Dk};function Kl({onChange:n,iterable:e,name:t}){const r=e&&e.length>0?e:[];return x.jsxs("select",{className:bk.select,onChange:n,children:[x.jsx("option",{children:t}),r.map(i=>x.jsx("option",{id:`${i[1]}`,children:i[0]},i[1]))]})}function kk(n){const{readData:e}=it(),{data:t}=gr({queryKey:["deviceByFunction",n],queryFn:()=>e(`${be.device}?function=${n}`),staleTime:10*60*1e3,enabled:n!==""});return{status:t==null?void 0:t.status,deviceByFunction:t==null?void 0:t.data}}function Pk(n){const{readData:e}=it(),{data:t}=gr({queryKey:["actionByFunction",n],queryFn:()=>e(`${be.action}?function=${n}`),staleTime:10*60*1e3,enabled:n!==""});return{status:t==null?void 0:t.status,actionByFunction:t==null?void 0:t.data}}function Ok(){var _,L;const n=Br(),e=parseInt(n.id?n.id:"0"),t=Kn(),[r,i]=C.useState(""),[s,a]=C.useState(0),[o,l]=C.useState(""),[u,c]=C.useState(""),[d,h]=C.useState(!1),{deviceByFunction:f}=kk(o),{actionByFunction:g}=Pk(o),{availableAction:m}=Ck(e,n.deviceFun?n.deviceFun:"");console.log(m);const{createEvent:p}=ax(),y=p(e);C.useEffect(()=>{y.isSuccess&&v()},[y.isSuccess]);function v(){t(-1)}function E(){if(!r||!o||!s||!u){h(!0);return}const R={target_device:s,action:u,device:e,event:r,extra_settings:{}};y.mutate(R)}return m?x.jsxs(Pt,{children:[x.jsx(pn,{title:"Dodawanie akcji"}),x.jsxs(Fi,{children:[x.jsx(Kl,{name:"Wybierz event",iterable:(_=m.available_events)==null?void 0:_.map((R,A)=>[R,A]),onChange:R=>i(R.target.value)}),x.jsx(Kl,{name:"Wybierz typ",iterable:(L=m.models)==null?void 0:L.map((R,A)=>[R,A]),onChange:R=>l(R.target.value)}),x.jsx(Kl,{name:"Wybierz urządzenie",iterable:f==null?void 0:f.map(R=>[R.name,R.id]),onChange:R=>a(parseInt(R.target.selectedOptions[0].id))}),x.jsx(Kl,{name:"Wybierz akcje",iterable:g==null?void 0:g.map((R,A)=>[R,A]),onChange:R=>c(R.target.value)}),x.jsx(Ne,{show:d,type:"error",children:"Wypełnij wszystkie pola"}),x.jsxs(zn,{children:[x.jsx(Xe,{type:"fancy",onClick:v,children:"Wróć"}),x.jsx(Xe,{type:"fancy",onClick:E,children:"Dodaj"})]})]})]}):x.jsx(Cn,{size:"xlarge",type:"spinner",glow:!0})}const Fk="_container_14mo9_1",Mk={container:Fk},Z=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},Nk=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=Uk},Uk=Number.MAX_SAFE_INTEGER||9007199254740991;let re=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),O=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n}({}),S=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n}({});var Se={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ne={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Ss{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class $k{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ss(e),this.fast_=new Ss(t),this.defaultTTFB_=i,this.ttfb_=new Ss(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new Ss(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Ss(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Ss(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,i=e/1e3,s=r/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Bk(n,e,t){return(e=Gk(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Oe(){return Oe=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Oe.apply(null,arguments)}function S0(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function we(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?S0(Object(t),!0).forEach(function(r){Bk(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):S0(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function jk(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Gk(n){var e=jk(n,"string");return typeof e=="symbol"?e:e+""}class jr{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=Jr,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const Jr=function(){},Vk={trace:Jr,debug:Jr,log:Jr,warn:Jr,info:Jr,error:Jr};function Ef(){return Oe({},Vk)}function Hk(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):Jr}function x0(n,e,t){return e[n]?e[n].bind(e):Hk(n,t)}const Sf=Ef();function Kk(n,e,t){const r=Ef();if(typeof console=="object"&&n===!0||typeof n=="object"){const i=["debug","log","info","warn","error"];i.forEach(s=>{r[s]=x0(s,n,t)});try{r.log(`Debug logs enabled for "${e}" in hls.js version 1.6.5`)}catch{return Ef()}i.forEach(s=>{Sf[s]=x0(s,n)})}else Oe(Sf,r);return r}const Re=Sf;function wi(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function zk(n){return typeof self<"u"&&n===self.ManagedMediaSource}function lx(n,e){const t=Object.keys(n),r=Object.keys(e),i=t.length,s=r.length;return!i||!s||i===s&&!t.some(a=>r.indexOf(a)===-1)}function hn(n,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=n.length;let r,i,s,a="",o=0;for(;o<t;){if(r=n[o++],r===0&&e)return a;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(r);break;case 12:case 13:i=n[o++],a+=String.fromCharCode((r&31)<<6|i&63);break;case 14:i=n[o++],s=n[o++],a+=String.fromCharCode((r&15)<<12|(i&63)<<6|(s&63)<<0);break}}return a}const Zn={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}};function Wk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $d={exports:{}},T0;function qk(){return T0||(T0=1,function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var h=o.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return c.alwaysNormalize?(h.path=o.normalizePath(h.path),o.buildURLFromParts(h)):u;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var g=i.exec(f.path);f.netLoc=g[1],f.path=g[2]}f.netLoc&&!f.path&&(f.path="/");var m={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(m.netLoc=f.netLoc,h.path[0]!=="/"))if(!h.path)m.path=f.path,h.params||(m.params=f.params,h.query||(m.query=f.query));else{var p=f.path,y=p.substring(0,p.lastIndexOf("/")+1)+h.path;m.path=o.normalizePath(y)}return m.path===null&&(m.path=c.alwaysNormalize?o.normalizePath(h.path):h.path),o.buildURLFromParts(m)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=o})()}($d)),$d.exports}var Gg=qk();class Vg{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var $e={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class ux{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,Qk(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let i;r.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[$e.AUDIO]:null,[$e.VIDEO]:null,[$e.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Vg),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Gg.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[$e.AUDIO]=null,e[$e.VIDEO]=null,e[$e.AUDIOVIDEO]=null}}function xt(n){return n.sn!=="initSegment"}class Bd extends ux{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(Z(e)&&Z(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Z(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Z(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return xt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,i,s,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:s,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,i),l.endDTS=Math.max(l.endDTS,s)}}class Yk extends ux{constructor(e,t,r,i,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function cx(n,e){const t=Object.getPrototypeOf(n);if(t){const r=Object.getOwnPropertyDescriptor(t,e);return r||cx(t,e)}}function Qk(n,e){const t=cx(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const lc=Math.pow(2,32)-1,Xk=[].push,dx={video:1,audio:2,id3:3,text:4};function ht(n){return String.fromCharCode.apply(null,n)}function hx(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function ce(n,e){const t=fx(n,e);return t<0?4294967296+t:t}function _0(n,e){let t=ce(n,e);return t*=Math.pow(2,32),t+=ce(n,e+4),t}function fx(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function jd(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=t&255}function Zk(n){const e=n.byteLength;for(let t=0;t<e;){const r=ce(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function me(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let i=0;i<r;){const s=ce(n,i),a=ht(n.subarray(i+4,i+8)),o=s>1?i+s:r;if(a===e[0])if(e.length===1)t.push(n.subarray(i+8,o));else{const l=me(n.subarray(i+8,o),e.slice(1));l.length&&Xk.apply(t,l)}i=o}return t}function Jk(n){const e=[],t=n[0];let r=8;const i=ce(n,r);r+=4;let s=0,a=0;t===0?(s=ce(n,r),a=ce(n,r+4),r+=8):(s=_0(n,r),a=_0(n,r+8),r+=16),r+=2;let o=n.length+a;const l=hx(n,r);r+=2;for(let u=0;u<l;u++){let c=r;const d=ce(n,c);c+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return Re.warn("SIDX has hierarchical references (not supported)"),null;const g=ce(n,c);c+=4,e.push({referenceSize:h,subsegmentDuration:g,info:{duration:g/i,start:o,end:o+h-1}}),o+=h,c+=4,r=c}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:l,references:e}}function gx(n){const e=[],t=me(n,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],a=me(s,["tkhd"])[0];if(a){let o=a[0];const l=ce(a,o===0?12:20),u=me(s,["mdia","mdhd"])[0];if(u){o=u[0];const c=ce(u,o===0?12:20),d=me(s,["mdia","hdlr"])[0];if(d){const h=ht(d.subarray(8,12)),f={soun:$e.AUDIO,vide:$e.VIDEO}[h],g=me(s,["mdia","minf","stbl","stsd"])[0],m=eP(g);f?(e[l]={timescale:c,type:f,stsd:m},e[f]=we({timescale:c,id:l},m)):e[l]={timescale:c,type:h,stsd:m}}}}}return me(n,["moov","mvex","trex"]).forEach(i=>{const s=ce(i,4),a=e[s];a&&(a.default={duration:ce(i,12),flags:ce(i,20)})}),e}function eP(n){const e=n.subarray(8),t=e.subarray(86),r=ht(e.subarray(4,8));let i=r,s;const a=r==="enca"||r==="encv";if(a){const u=me(e,[r])[0].subarray(r==="enca"?28:78);me(u,["sinf"]).forEach(d=>{const h=me(d,["schm"])[0];if(h){const f=ht(h.subarray(4,8));if(f==="cbcs"||f==="cenc"){const g=me(d,["frma"])[0];g&&(i=ht(g))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const l=me(t,["avcC"])[0];l&&l.length>3&&(i+="."+Wl(l[1])+Wl(l[2])+Wl(l[3]),s=zl(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=me(e,[r])[0],u=me(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=Gd(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=Gd(u,c);const h=u[c++];if(h===64)i+="."+Wl(h);else break;if(c+=12,u[c++]!==5)break;c=Gd(u,c);const f=u[c++];let g=(f&248)>>3;g===31&&(g+=1+((f&7)<<3)+((u[c]&224)>>5)),i+="."+g}break}case"hvc1":case"hev1":{const l=me(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,h=ce(l,2),f=(u&32)>>5?"H":"L",g=l[12],m=l.subarray(6,12);i+="."+c+d,i+="."+tP(h).toString(16).toUpperCase(),i+="."+f+g;let p="";for(let y=m.length;y--;){const v=m[y];(v||p)&&(p="."+v.toString(16).toUpperCase()+p)}i+=p}s=zl(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=zl(i,t)||i;break}case"vp09":{const l=me(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;i+="."+Xn(u)+"."+Xn(c)+"."+Xn(d)}break}case"av01":{const l=me(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,f=(l[2]&32)>>5,g=u===2&&h?f?12:10:h?10:8,m=(l[2]&16)>>4,p=(l[2]&8)>>3,y=(l[2]&4)>>2,v=l[2]&3;i+="."+u+"."+Xn(c)+d+"."+Xn(g)+"."+m+"."+p+y+v+"."+Xn(1)+"."+Xn(1)+"."+Xn(1)+"."+0,s=zl("dav1",t)}break}}return{codec:i,encrypted:a,supplemental:s}}function zl(n,e){const t=me(e,["dvvC"]),r=t.length?t[0]:me(e,["dvcC"])[0];if(r){const i=r[2]>>1&127,s=r[2]<<5&32|r[3]>>3&31;return n+"."+Xn(i)+"."+Xn(s)}}function tP(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function Gd(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Wl(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Xn(n){return(n<10?"0":"")+n}function nP(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&me(n,["moov","trak"]).forEach(i=>{const a=me(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=me(a,["enca"]);const l=o.length>0;l||(o=me(a,["encv"])),o.forEach(u=>{const c=l?u.subarray(28):u.subarray(78);me(c,["sinf"]).forEach(h=>{const f=mx(h);if(f){const g=f.subarray(8,24);g.some(m=>m!==0)||(Re.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Zn.hexDump(g)} -> ${Zn.hexDump(t)}`),f.set(t,8))}})})}),n}function mx(n){const e=me(n,["schm"])[0];if(e){const t=ht(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return me(n,["schi","tenc"])[0]}return null}function rP(n,e,t){const r={},i=me(n,["moof","traf"]);for(let s=0;s<i.length;s++){const a=i[s],o=me(a,["tfhd"])[0],l=ce(o,4),u=e[l];if(!u)continue;const c=r[l]||(r[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type}),d=me(a,["tfdt"])[0];if(d){const E=d[0];let _=ce(d,4);E===1&&(_===lc?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(_*=lc+1,_+=ce(d,8))),Z(_)&&(!Z(c.start)||_<c.start)&&(c.start=_)}const h=u.default,f=ce(o,0)|(h==null?void 0:h.flags);let g=(h==null?void 0:h.duration)||0;f&8&&(f&2?g=ce(o,12):g=ce(o,8));const m=me(a,["trun"]);let p=c.start||0,y=0,v=g;for(let E=0;E<m.length;E++){const _=m[E],L=ce(_,4),R=c.sampleCount;c.sampleCount+=L;const A=_[3]&1,T=_[3]&4,w=_[2]&1,I=_[2]&2,M=_[2]&4,j=_[2]&8;let z=8,K=L;for(A&&(z+=4),T&&L&&(!(_[z+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=R),z+=4,w?(v=ce(_,z),z+=4):v=g,I&&(z+=4),j&&(z+=4),p+=v,y+=v,K--);K--;)w?(v=ce(_,z),z+=4):v=g,I&&(z+=4),M&&(_[z+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(K+1),c.keyFrameStart=p),z+=4),j&&(z+=4),p+=v,y+=v;!y&&g&&(y+=g*L)}c.duration+=y}if(!Object.keys(r).some(s=>r[s].duration)){let s=1/0,a=0;const o=me(n,["sidx"]);for(let l=0;l<o.length;l++){const u=Jk(o[l]);if(u!=null&&u.references){s=Math.min(s,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,h)=>d+h.info.duration||0,0);a=Math.max(a,c+u.earliestPresentationTime/u.timescale)}}a&&Z(a)&&Object.keys(r).forEach(l=>{r[l].duration||(r[l].duration=a*r[l].timescale-r[l].start)})}return r}function iP(n,e,t){me(e,["moof","traf"]).forEach(r=>{me(r,["tfhd"]).forEach(i=>{const s=ce(i,4),a=n[s];if(!a)return;const o=a.timescale||9e4;me(r,["tfdt"]).forEach(l=>{const u=l[0],c=t*o;if(c){let d=ce(l,4);if(u===0)d-=c,d=Math.max(d,0),jd(l,4,d);else{d*=Math.pow(2,32),d+=ce(l,8),d-=c,d=Math.max(d,0);const h=Math.floor(d/(lc+1)),f=Math.floor(d%(lc+1));jd(l,4,h),jd(l,8,f)}}})})})}function sP(n){const e={valid:null,remainder:null},t=me(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=n.slice(0,r.byteOffset-8),e.remainder=n.slice(r.byteOffset-8),e}function wn(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function L0(n,e){const t=[],r=e.samples,i=e.timescale,s=e.id;let a=!1;return me(r,["moof"]).map(l=>{const u=l.byteOffset-8;me(l,["traf"]).map(d=>{const h=me(d,["tfdt"]).map(f=>{const g=f[0];let m=ce(f,4);return g===1&&(m*=Math.pow(2,32),m+=ce(f,8)),m/i})[0];return h!==void 0&&(n=h),me(d,["tfhd"]).map(f=>{const g=ce(f,4),m=ce(f,0)&16777215,p=(m&1)!==0,y=(m&2)!==0,v=(m&8)!==0;let E=0;const _=(m&16)!==0;let L=0;const R=(m&32)!==0;let A=8;g===s&&(p&&(A+=8),y&&(A+=4),v&&(E=ce(f,A),A+=4),_&&(L=ce(f,A),A+=4),R&&(A+=4),e.type==="video"&&(a=Kc(e.codec)),me(d,["trun"]).map(T=>{const w=T[0],I=ce(T,0)&16777215,M=(I&1)!==0;let j=0;const z=(I&4)!==0,K=(I&256)!==0;let W=0;const H=(I&512)!==0;let X=0;const $=(I&1024)!==0,F=(I&2048)!==0;let U=0;const Q=ce(T,4);let Y=8;M&&(j=ce(T,Y),Y+=4),z&&(Y+=4);let oe=j+u;for(let de=0;de<Q;de++){if(K?(W=ce(T,Y),Y+=4):W=E,H?(X=ce(T,Y),Y+=4):X=L,$&&(Y+=4),F&&(w===0?U=ce(T,Y):U=fx(T,Y),Y+=4),e.type===$e.VIDEO){let pe=0;for(;pe<X;){const he=ce(r,oe);if(oe+=4,aP(a,r[oe])){const Fe=r.subarray(oe,oe+he);Hg(Fe,a?2:1,n+U/i,t)}oe+=he,pe+=he+4}}n+=W/i}}))})})}),t}function Kc(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function aP(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Hg(n,e,t,r){const i=px(n);let s=0;s+=e;let a=0,o=0,l=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;l=i[s++],a+=l}while(l===255);o=0;do{if(s>=i.length)break;l=i[s++],o+=l}while(l===255);const u=i.length-s;let c=s;if(o<u)s+=o;else if(o>u){Re.error(`Malformed SEI payload. ${o} is too small, only ${u} bytes left to parse.`);break}if(a===4){if(i[c++]===181){const h=hx(i,c);if(c+=2,h===49){const f=ce(i,c);if(c+=4,f===1195456820){const g=i[c++];if(g===3){const m=i[c++],p=31&m,y=64&m,v=y?2+p*3:0,E=new Uint8Array(v);if(y){E[0]=m;for(let _=1;_<v;_++)E[_]=i[c++]}r.push({type:g,payloadType:a,pts:t,bytes:E})}}}}}else if(a===5&&o>16){const d=[];for(let g=0;g<16;g++){const m=i[c++].toString(16);d.push(m.length==1?"0"+m:m),(g===3||g===5||g===7||g===9)&&d.push("-")}const h=o-16,f=new Uint8Array(h);for(let g=0;g<h;g++)f[g]=i[c++];r.push({payloadType:a,pts:t,uuid:d.join(""),userData:hn(f),userDataBytes:f})}}}function px(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const i=e-t.length,s=new Uint8Array(i);let a=0;for(r=0;r<i;a++,r++)a===t[0]&&(a++,t.shift()),s[r]=n[a];return s}function oP(n){const e=n[0];let t="",r="",i=0,s=0,a=0,o=0,l=0,u=0;if(e===0){for(;ht(n.subarray(u,u+1))!=="\0";)t+=ht(n.subarray(u,u+1)),u+=1;for(t+=ht(n.subarray(u,u+1)),u+=1;ht(n.subarray(u,u+1))!=="\0";)r+=ht(n.subarray(u,u+1)),u+=1;r+=ht(n.subarray(u,u+1)),u+=1,i=ce(n,12),s=ce(n,16),o=ce(n,20),l=ce(n,24),u=28}else if(e===1){u+=4,i=ce(n,u),u+=4;const d=ce(n,u);u+=4;const h=ce(n,u);for(u+=4,a=2**32*d+h,Nk(a)||(a=Number.MAX_SAFE_INTEGER,Re.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ce(n,u),u+=4,l=ce(n,u),u+=4;ht(n.subarray(u,u+1))!=="\0";)t+=ht(n.subarray(u,u+1)),u+=1;for(t+=ht(n.subarray(u,u+1)),u+=1;ht(n.subarray(u,u+1))!=="\0";)r+=ht(n.subarray(u,u+1)),u+=1;r+=ht(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:r,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:c}}function lP(n,...e){const t=e.length;let r=8,i=t;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(n,4),i=0,r=8;i<t;i++)s.set(e[i],r),r+=e[i].byteLength;return s}function uP(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,i;r=0,i=new Uint8Array;let s;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),lP([112,115,115,104],new Uint8Array([r,0,0,0]),n,s,i,a,t||new Uint8Array)}function cP(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const i=new DataView(n,r),s=dP(i);e.push(s),r+=s.size}}return e}function dP(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const a=n.buffer,o=Zn.hexDump(new Uint8Array(a,t+12,16)),l=n.getUint32(28);let u=null,c=null;if(s===0){if(e-32<l||l<22)return{offset:t,size:e};c=new Uint8Array(a,t+32,l)}else if(s===1){if(!l||r<t+32+l*16+16)return{offset:t,size:e};u=[];for(let d=0;d<l;d++)u.push(new Uint8Array(a,t+32+d*16,16))}return{version:s,systemId:o,kids:u,data:c,offset:t,size:e}}const yx=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Sa={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function vx(n,e){const t=Sa[e];return!!t&&!!t[n.slice(0,4)]}function xf(n,e,t=!0){return!n.split(",").some(r=>!Ex(r,e,t))}function Ex(n,e,t=!0){var r;const i=wi(t);return(r=i==null?void 0:i.isTypeSupported(Fo(n,e)))!=null?r:!1}function Fo(n,e){return`${e}/mp4;codecs=${n}`}function A0(n){if(n){const e=n.substring(0,4);return Sa.video[e]}return 2}function uc(n){const e=yx();return n.split(",").reduce((t,r)=>{const s=e&&Kc(r)?9:Sa.video[r];return s?(s*2+t)/(t?3:2):(Sa.audio[r]+t)/(t?2:1)},0)}const Vd={};function hP(n,e=!0){if(Vd[n])return Vd[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let i=0;i<t.length;i++){var r;if(Ex(t[i],"audio",e))return Vd[n]=t[i],t[i];if(t[i]==="mp3"&&(r=wi(e))!=null&&r.isTypeSupported("audio/mpeg"))return""}return n}const fP=/flac|opus|mp4a\.40\.34/i;function cc(n,e=!0){return n.replace(fP,t=>hP(t.toLowerCase(),e))}function gP(n,e){const t=[];if(n){const r=n.split(",");for(let i=0;i<r.length;i++)vx(r[i],"video")||t.push(r[i])}return e&&t.push(e),t.join(",")}function Lu(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let r=t.length;r--;)if(t[r].substring(0,4)===n.substring(0,4))return t[r]}return t[0]}}return e||n}function mP(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");r.length>2&&r[0]==="avc1"&&(e[t]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return e.join(",")}function pP(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let r=e.length;r>4&&r<10;r++)e[r]=t[r-4];return e.join(".")}return n}function R0(n){const e=wi(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Sx(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const xx={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Tx(n,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:n}}const I0={};function yP(n,e,t,r,i,s){const a=n.audioCodec?n.audioGroups:null,o=s==null?void 0:s.audioCodec,l=s==null?void 0:s.channels,u=l?parseInt(l):o?1/0:2;let c=null;if(a!=null&&a.length)try{a.length===1&&a[0]?c=e.groups[a[0]].channels:c=a.reduce((d,h)=>{if(h){const f=e.groups[h];if(!f)throw new Error(`Audio track group ${h} not found`);Object.keys(f.channels).forEach(g=>{d[g]=(d[g]||0)+f.channels[g]})}return d},{2:0})}catch{return!0}return n.videoCodec!==void 0&&(n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!c&&Z(u)&&Object.keys(c).some(d=>parseInt(d)>u)}function _x(n,e,t){const r=n.videoCodec,i=n.audioCodec;if(!r&&!i||!t)return Promise.resolve(xx);const s=[];if(r){const a={width:n.width,height:n.height,bitrate:Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)),framerate:n.frameRate||30},o=n.videoRange;o!=="SDR"&&(a.transferFunction=o.toLowerCase());const l=r.split(","),u=navigator.userAgent;if(l.some(c=>Kc(c))&&yx())return Promise.resolve(Tx(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${u})`),s));s.push.apply(s,l.map(c=>({type:"media-source",video:we(we({},a),{},{contentType:Fo(pP(c),"video")})})))}return i&&n.audioGroups&&n.audioGroups.forEach(a=>{var o;a&&((o=e.groups[a])==null||o.tracks.forEach(l=>{if(l.groupId===a){const u=l.channels||"",c=parseFloat(u);Z(c)&&c>2&&s.push.apply(s,i.split(",").map(d=>({type:"media-source",audio:{contentType:Fo(d,"audio"),channels:""+c}})))}}))}),Promise.all(s.map(a=>{const o=vP(a);return I0[o]||(I0[o]=t.decodingInfo(a))})).then(a=>({supported:!a.some(o=>!o.supported),configurations:s,decodingInfoResults:a})).catch(a=>({supported:!1,configurations:s,decodingInfoResults:[],error:a}))}function vP(n){const{audio:e,video:t}=n,r=t||e;if(r){const i=Sx(r.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${i}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${i}`}return""}const Tf=["NONE","TYPE-0","TYPE-1",null];function EP(n){return Tf.indexOf(n)>-1}const dc=["SDR","PQ","HLG"];function SP(n){return!!n&&dc.indexOf(n)>-1}var Au={No:"",Yes:"YES",v2:"v2"};function w0(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,i=r<e/2;return e&&i?t?Au.v2:Au.Yes:Au.No}class C0{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Mo{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(r=>!!r).map(r=>r.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return D0(this._audioGroups,e)}hasSubtitleGroup(e){return D0(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function D0(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function xP(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function TP(n,e){let t=!1,r=[];if(n&&(t=n!=="SDR",r=[n]),e){r=e.allowedVideoRanges||dc.slice(0);const i=r.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&xP(),t||(r=["SDR"])}return{preferHDR:t,allowedVideoRanges:r}}const _P=n=>{const e=new WeakSet;return(t,r)=>{if(n&&(r=n(t,r)),typeof r=="object"&&r!==null){if(e.has(r))return;e.add(r)}return r}},Ke=(n,e)=>JSON.stringify(n,_P(e));function LP(n,e,t,r,i){const s=Object.keys(n),a=r==null?void 0:r.channels,o=r==null?void 0:r.audioCodec,l=i==null?void 0:i.videoCodec,u=a&&parseInt(a)===2;let c=!1,d=!1,h=1/0,f=1/0,g=1/0,m=1/0,p=0,y=[];const{preferHDR:v,allowedVideoRanges:E}=TP(e,i);for(let T=s.length;T--;){const w=n[s[T]];c||(c=w.channels[2]>0),h=Math.min(h,w.minHeight),f=Math.min(f,w.minFramerate),g=Math.min(g,w.minBitrate),E.filter(M=>w.videoRanges[M]>0).length>0&&(d=!0)}h=Z(h)?h:0,f=Z(f)?f:0;const _=Math.max(1080,h),L=Math.max(30,f);g=Z(g)?g:t,t=Math.max(g,t),d||(e=void 0);const R=s.length>1;return{codecSet:s.reduce((T,w)=>{const I=n[w];if(w===T)return T;if(y=d?E.filter(M=>I.videoRanges[M]>0):[],R){if(I.minBitrate>t)return Yn(w,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),T;if(!I.hasDefaultAudio)return Yn(w,"no renditions with default or auto-select sound found"),T;if(o&&w.indexOf(o.substring(0,4))%5!==0)return Yn(w,`audio codec preference "${o}" not found`),T;if(a&&!u){if(!I.channels[a])return Yn(w,`no renditions with ${a} channel sound found (channels options: ${Object.keys(I.channels)})`),T}else if((!o||u)&&c&&I.channels[2]===0)return Yn(w,"no renditions with stereo sound found"),T;if(I.minHeight>_)return Yn(w,`min resolution of ${I.minHeight} > maximum of ${_}`),T;if(I.minFramerate>L)return Yn(w,`min framerate of ${I.minFramerate} > maximum of ${L}`),T;if(!y.some(M=>I.videoRanges[M]>0))return Yn(w,`no variants with VIDEO-RANGE of ${Ke(y)} found`),T;if(l&&w.indexOf(l.substring(0,4))%5!==0)return Yn(w,`video codec preference "${l}" not found`),T;if(I.maxScore<p)return Yn(w,`max score of ${I.maxScore} < selected max of ${p}`),T}return T&&(uc(w)>=uc(T)||I.fragmentError>n[T].fragmentError)?T:(m=I.minIndex,p=I.maxScore,w)},void 0),videoRanges:y,preferHDR:v,minFramerate:f,minBitrate:g,minIndex:m}}function Yn(n,e){Re.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function Lx(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const i=t.channels||"2";return r.channels[i]=(r.channels[i]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function AP(n,e,t,r){return n.slice(t,r+1).reduce((i,s,a)=>{if(!s.codecSet)return i;const o=s.audioGroups;let l=i[s.codecSet];l||(i[s.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,s.bitrate);const u=Math.min(s.height,s.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,s.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,s.score),l.fragmentError+=s.fragmentError,l.videoRanges[s.videoRange]=(l.videoRanges[s.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}),i},{})}function b0(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}=n;return{lang:e,assocLang:t,characteristics:r,channels:i,audioCodec:s}}function or(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const i=e[r];if(ns(n,i,t))return r}return-1}function ns(n,e,t){const{groupId:r,name:i,lang:s,assocLang:a,default:o}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(i===void 0||e.name===i)&&(s===void 0||RP(s,e.lang))&&(s===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||IP(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function RP(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function IP(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(i=>r.indexOf(i)===-1)}function ji(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function wP(n,e,t,r,i){const s=e[r],o=e.reduce((h,f,g)=>{const m=f.uri;return(h[m]||(h[m]=[])).push(g),h},{})[s.uri];o.length>1&&(r=Math.max.apply(Math,o));const l=s.videoRange,u=s.frameRate,c=s.codecSet.substring(0,4),d=k0(e,r,h=>{if(h.videoRange!==l||h.frameRate!==u||h.codecSet.substring(0,4)!==c)return!1;const f=h.audioGroups,g=t.filter(m=>!f||f.indexOf(m.groupId)!==-1);return or(n,g,i)>-1});return d>-1?d:k0(e,r,h=>{const f=h.audioGroups,g=t.filter(m=>!f||f.indexOf(m.groupId)!==-1);return or(n,g,i)>-1})}function k0(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}function hc(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class CP extends jr{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var r;const{fragCurrent:i,partCurrent:s,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!i||!l)return;const u=performance.now(),c=s?s.stats:i.stats,d=s?s.duration:i.duration,h=u-c.loading.start,f=a.minAutoLevel,g=i.level,m=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||g<=f){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const p=m>-1&&m!==g,y=!!t||p;if(!y&&(l.paused||!l.playbackRate||!l.readyState))return;const v=a.mainForwardBufferInfo;if(!y&&v===null)return;const E=this.bwEstimator.getEstimateTTFB(),_=Math.abs(l.playbackRate);if(h<=Math.max(E,1e3*(d/(_*2))))return;const L=v?v.len/_:0,R=c.loading.first?c.loading.first-c.loading.start:-1,A=c.loaded&&R>-1,T=this.getBwEstimate(),w=a.levels,I=w[g],M=Math.max(c.loaded,Math.round(d*(i.bitrate||I.averageBitrate)/8));let j=A?h-R:h;j<1&&A&&(j=Math.min(h,c.loaded*8/T));const z=A?c.loaded*1e3/j:0,K=E/1e3,W=z?(M-c.loaded)/z:M*8/T+K;if(W<=L)return;const H=z?z*8:T,X=((r=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:r.live)===!0,$=this.hls.config.abrBandWidthUpFactor;let F=Number.POSITIVE_INFINITY,U;for(U=g-1;U>f;U--){const de=w[U].maxBitrate,pe=!w[U].details||X;if(F=this.getTimeToLoadFrag(K,H,d*de,pe),F<Math.min(L,d+K))break}if(F>=W||F>d*10)return;A?this.bwEstimator.sample(h-Math.min(E,R),c.loaded):this.bwEstimator.sampleTTFB(h);const Q=w[U].maxBitrate;this.getBwEstimate()*$>Q&&this.resetEstimator(Q);const Y=this.findBestLevel(Q,f,U,0,L,1,1);Y>-1&&(U=Y),this.warn(`Fragment ${i.sn}${s?" part "+s.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${L.toFixed(3)} s
      Estimated load time for current fragment: ${W.toFixed(3)} s
      Estimated load time for down switch fragment: ${F.toFixed(3)} s
      TTFB estimate: ${R|0} ms
      Current BW estimate: ${Z(T)?T|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${U} @ ${Q|0} bps`),a.nextLoadLevel=a.nextAutoLevel=U,this.clearTimer();const oe=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===U&&U>0){const de=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${U>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${de.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,U>f){let pe=this.findBestLevel(this.hls.levels[f].bitrate,f,U,0,de,1,1);pe===-1&&(pe=f),this.hls.nextLoadLevel=this.hls.nextAutoLevel=pe,this.resetEstimator(this.hls.levels[pe].bitrate)}}};p||W>F*2?oe():this.timer=self.setInterval(oe,F*1e3),a.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:s,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new $k(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var i;this.fragCurrent=r,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case O.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:i,partCurrent:s}=this;if(r&&i&&r.sn===i.sn&&r.level===i.level){const a=performance.now(),o=s?s.stats:r.stats,l=a-o.loading.start,u=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,i){const s=e+r/t,a=i?e+this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const r=this.hls.config,{loading:i}=t.stats,s=i.end-i.first;Z(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===ne.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=r?r.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+i.loaded,l=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const s={stats:i,frag:t,part:r,id:t.type};this.onFragBuffered(S.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ne.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(r,t,e,0,i,1,1);if(s>-1)return s;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=r&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:i,config:s,minAutoLevel:a}=r,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(u){const p=this.findBestLevel(l,a,i,u,0,c,d);if(p>=0)return this.rebufferNotice=-1,p}let h=o?Math.min(o,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){const p=this.bitrateTestDelay;p&&(h=(o?Math.min(o,s.maxLoadingDelay):s.maxLoadingDelay)-p,this.info(`bitrate test took ${Math.round(1e3*p)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),c=d=1)}const f=this.findBestLevel(l,a,i,u,h,c,d);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const g=r.levels[a],m=r.loadLevelObj;return m&&(g==null?void 0:g.bitrate)<m.bitrate?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,i,s,a,o){var l;const u=i+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:f}=this,{levels:g,allAudioTracks:m,loadLevel:p,config:y}=this.hls;if(g.length===1)return 0;const v=g[d],E=!!((l=this.hls.latestLevelDetails)!=null&&l.live),_=p===-1||c===-1;let L,R="SDR",A=(v==null?void 0:v.frameRate)||0;const{audioPreference:T,videoPreference:w}=y,I=this.audioTracksByGroup||(this.audioTracksByGroup=Lx(m));let M=-1;if(_){if(this.firstSelection!==-1)return this.firstSelection;const H=this.codecTiers||(this.codecTiers=AP(g,I,t,r)),X=LP(H,R,e,T,w),{codecSet:$,videoRanges:F,minFramerate:U,minBitrate:Q,minIndex:Y,preferHDR:oe}=X;M=Y,L=$,R=oe?F[F.length-1]:F[0],A=U,e=Math.max(e,Q),this.log(`picked start tier ${Ke(X)}`)}else L=v==null?void 0:v.codecSet,R=v==null?void 0:v.videoRange;const j=f?f.duration:h?h.duration:0,z=this.bwEstimator.getEstimateTTFB()/1e3,K=[];for(let H=r;H>=t;H--){var W;const X=g[H],$=H>d;if(!X)continue;if(y.useMediaCapabilities&&!X.supportedResult&&!X.supportedPromise){const pe=navigator.mediaCapabilities;typeof(pe==null?void 0:pe.decodingInfo)=="function"&&(yP(X,I,R,A,e,T)||Kc(X.videoCodec))?(X.supportedPromise=_x(X,I,pe),X.supportedPromise.then(he=>{if(!this.hls)return;X.supportedResult=he;const Fe=this.hls.levels,Ze=Fe.indexOf(X);he.error?this.warn(`MediaCapabilities decodingInfo error: "${he.error}" for level ${Ze} ${Ke(he)}`):he.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ze} ${Ke(he)}`),Ze>-1&&Fe.length>1&&(this.log(`Removing unsupported level ${Ze}`),this.hls.removeLevel(Ze),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):X.supportedResult=xx}if((L&&X.codecSet!==L||R&&X.videoRange!==R||$&&A>X.frameRate||!$&&A>0&&A<X.frameRate||X.supportedResult&&!((W=X.supportedResult.decodingInfoResults)!=null&&W[0].smooth))&&(!_||H!==M)){K.push(H);continue}const F=X.details,U=(f?F==null?void 0:F.partTarget:F==null?void 0:F.averagetargetduration)||j;let Q;$?Q=o*e:Q=a*e;const Y=j&&i>=j*2&&s===0?X.averageBitrate:X.maxBitrate,oe=this.getTimeToLoadFrag(z,Q,Y*U,F===void 0);if(Q>=Y&&(H===c||X.loadError===0&&X.fragmentError===0)&&(oe<=z||!Z(oe)||E&&!this.bitrateTestDelay||oe<u)){const pe=this.forcedAutoLevel;return H!==p&&(pe===-1||pe!==p)&&(K.length&&this.trace(`Skipped level(s) ${K.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${g[K[0]].codecs}" ${g[K[0]].videoRange}; not compatible with "${L}" ${R}`),this.info(`switch candidate:${d}->${H} adjustedbw(${Math.round(Q)})-bitrate=${Math.round(Q-Y)} ttfb:${z.toFixed(1)} avgDuration:${U.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${oe.toFixed(1)} firstSelection:${_} codecSet:${X.codecSet} videoRange:${X.videoRange} hls.loadLevel:${p}`)),_&&(this.firstSelection=H),H}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}}const Ax={search:function(n,e){let t=0,r=n.length-1,i=null,s=null;for(;t<=r;){i=(t+r)/2|0,s=n[i];const a=e(s);if(a>0)t=i+1;else if(a<0)r=i-1;else return s}return null}};function DP(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!Z(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let s=0;s<n.length;++s){const a=n[s];if(kP(e,t,a))return a}return null}function hs(n,e,t=0,r=0,i=.005){let s=null;if(n){s=e[1+n.sn-e[0].sn]||null;const o=n.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),s&&n.level!==s.level&&s.end<=n.end&&(s=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&P0(t,r,s)===0||bP(s,n,Math.min(i,r))))return s;const a=Ax.search(e,P0.bind(null,t,r));return a&&(a!==n||!s)?a:s}function bP(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return n.start<=r}return!1}function P0(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function kP(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function Rx(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let r=n.fragments;const{fragmentHint:i}=n;i&&(r=r.concat(i));let s;return Ax.search(r,a=>a.cc<e?1:a.cc>e?-1:(s=a,a.end<=t?1:a.start>t?-1:0)),s||null}return null}function fc(n){switch(n.details){case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_TIMEOUT:case O.LEVEL_LOAD_TIMEOUT:case O.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function O0(n,e){const t=fc(e);return n.default[`${t?"timeout":"error"}Retry`]}function Kg(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function F0(n){return we(we({},n),{errorRetry:null,timeoutRetry:null})}function gc(n,e,t,r){if(!n)return!1;const i=r==null?void 0:r.code,s=e<n.maxNumRetry&&(PP(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,s):s}function PP(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}var Dt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},On={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class OP extends jr{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ne.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const i=this.hls,s=t.context;switch(t.details){case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case O.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction=No();return}case O.FRAG_GAP:case O.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Dt.SendAlternateToPenaltyBox;return}case O.LEVEL_EMPTY_ERROR:case O.LEVEL_PARSING_ERROR:{var a,o;const u=t.parent===ne.MAIN?t.level:i.loadLevel;t.details===O.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(o=a.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case O.LEVEL_LOAD_ERROR:case O.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.level));return;case O.AUDIO_TRACK_LOAD_ERROR:case O.AUDIO_TRACK_LOAD_TIMEOUT:case O.SUBTITLE_LOAD_ERROR:case O.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const u=i.loadLevelObj;if(u&&(s.type===Se.AUDIO_TRACK&&u.hasAudioGroup(s.groupId)||s.type===Se.SUBTITLE_TRACK&&u.hasSubtitleGroup(s.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=Dt.SendAlternateToPenaltyBox,t.errorAction.flags=On.MoveAllAlternatesMatchingHost;return}}return;case O.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const u=i.loadLevelObj,c=u==null?void 0:u.attrs["HDCP-LEVEL"];c?t.errorAction={action:Dt.SendAlternateToPenaltyBox,flags:On.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(t)}return;case O.BUFFER_ADD_CODEC_ERROR:case O.REMUX_ALLOC_ERROR:case O.BUFFER_APPEND_ERROR:if(!t.errorAction){var l;t.errorAction=this.getLevelSwitchAction(t,(l=t.level)!=null?l:i.loadLevel)}return;case O.INTERNAL_EXCEPTION:case O.BUFFER_APPENDING_ERROR:case O.BUFFER_FULL_ERROR:case O.LEVEL_SWITCH_ERROR:case O.BUFFER_STALLED_ERROR:case O.BUFFER_SEEK_OVER_HOLE:case O.BUFFER_NUDGE_ON_STALL:t.errorAction=No();return}t.type===re.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,i=O0(r.config.playlistLoadPolicy,e),s=this.playlistError++;if(gc(i,s,fc(e),e.response))return{action:Dt.RetryRequest,flags:On.None,retryConfig:i,retryCount:s};const o=this.getLevelSwitchAction(e,t);return i&&(o.retryConfig=i,o.retryCount=s),o}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,o=O0(e.details.startsWith("key")?a:s,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(i&&(e.details!==O.FRAG_GAP&&i.fragmentError++,gc(o,l,fc(e),e.response)))return{action:Dt.RetryRequest,flags:On.None,retryConfig:o,retryCount:l};const u=this.getLevelSwitchAction(e,r);return o&&(u.retryConfig=o,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const i=this.hls.levels[t];if(i){var s,a;const u=e.details;i.loadError++,u===O.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:d,loadLevel:h,minAutoLevel:f,maxAutoLevel:g}=r;!r.autoLevelEnabled&&!r.config.preserveManualLevelOnError&&(r.loadLevel=-1);const m=(s=e.frag)==null?void 0:s.type,y=(m===ne.AUDIO&&u===O.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===O.BUFFER_ADD_CODEC_ERROR||u===O.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:R})=>i.audioCodec!==R),E=e.sourceBufferName==="video"&&(u===O.BUFFER_ADD_CODEC_ERROR||u===O.BUFFER_APPEND_ERROR)&&d.some(({codecSet:R,audioCodec:A})=>i.codecSet!==R&&i.audioCodec===A),{type:_,groupId:L}=(a=e.context)!=null?a:{};for(let R=d.length;R--;){const A=(R+h)%d.length;if(A!==h&&A>=f&&A<=g&&d[A].loadError===0){var o,l;const T=d[A];if(u===O.FRAG_GAP&&m===ne.MAIN&&e.frag){const w=d[A].details;if(w){const I=hs(e.frag,w.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(_===Se.AUDIO_TRACK&&T.hasAudioGroup(L)||_===Se.SUBTITLE_TRACK&&T.hasSubtitleGroup(L))continue;if(m===ne.AUDIO&&(o=i.audioGroups)!=null&&o.some(w=>T.hasAudioGroup(w))||m===ne.SUBTITLE&&(l=i.subtitleGroups)!=null&&l.some(w=>T.hasSubtitleGroup(w))||y&&i.audioCodec===T.audioCodec||!y&&i.audioCodec!==T.audioCodec||E&&i.codecSet===T.codecSet)continue}c=A;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Dt.SendAlternateToPenaltyBox,flags:On.None,nextAutoLevel:c}}return{action:Dt.SendAlternateToPenaltyBox,flags:On.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Dt.DoNothing:break;case Dt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==O.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i,hdcpLevel:s,nextAutoLevel:a}=r;switch(i){case On.None:this.switchLevel(e,a);break;case On.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=Tf[Tf.indexOf(s)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,a)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===O.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const r=Sx(e.mimeType),i=this.hls.levels;for(let s=i.length;s--;)i[s][`${e.sourceBufferName}Codec`]===r&&this.hls.removeLevel(s)}}}function No(n){const e={action:Dt.DoNothing,flags:On.None};return n&&(e.resolved=!0),e}var gt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FP{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const s=r[i];if(!s)break;const a=s.end;if(s.start<=e&&a!==null&&e<=a)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:i}=this,s=Object.keys(i);for(let a=s.length;a--;){const o=i[s[a]];if((o==null?void 0:o.body.type)===t&&(!r||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,r,i,s){this.timeRanges&&(this.timeRanges[e]=t);const a=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||s)){l.body.type===r&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const r=e.frag,i=xs(r),s=this.fragments[i];if(!s||s.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(o=>{const l=r.elementaryStreams[o];if(!l)return;const u=t[o],c=a||l.partial===!0;s.range[o]=this.getBufferedTimes(r,e.part,c,u)}),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=r.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),ql(s)||this.removeParts(r.sn-1,r.type)):this.removeFragment(s.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=M0(r,i=>i.fragment.sn>=e))}fragBuffered(e,t){const r=xs(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){const s={time:[],partial:r},a=e.start,o=e.end,l=e.minEndPTS||o,u=e.maxStartPTS||a;for(let c=0;c<i.length;c++){const d=i.start(c)-this.bufferPadding,h=i.end(c)+this.bufferPadding;if(u>=d&&l<=h){s.time.push({startPTS:Math.max(a,i.start(c)),endPTS:Math.min(o,i.end(c))});break}else if(a<h&&o>d){const f=Math.max(a,i.start(c)),g=Math.min(o,i.end(c));g>f&&(s.partial=!0,s.time.push({startPTS:f,endPTS:g}))}else if(o<=d)break}return s}getPartialFragment(e){let t=null,r,i,s,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&ql(c)&&(i=c.body.start-o,s=c.body.end+o,e>=i&&e<=s&&(r=Math.min(e-i,s-e),a<=r&&(t=c.body,a=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ql(t))}getState(e){const t=xs(e),r=this.fragments[t];return r?r.buffered?ql(r)?gt.PARTIAL:gt.OK:gt.APPENDING:gt.NOT_LOADED}isTimeBuffered(e,t,r){let i,s;for(let a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,s=r.end(a)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const r=t.frag,i=t.part?null:t,s=xs(r);this.fragments[s]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:s,type:a}=t;if(r.sn==="initSegment")return;const o=r.type;if(i){let u=this.activePartLists[o];u||(this.activePartLists[o]=u=[]),u.push(i)}this.timeRanges=s;const l=s[a];this.detectEvictedFragments(a,l,o,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=xs(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let i=r.length;i--;){const s=t[r[i]];if((s==null?void 0:s.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==r||i&&!l.gap||l.start<t&&l.end>e&&(o.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=xs(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const i=e.sn;this.activePartLists[e.type]=M0(r,s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const r=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;r&&r.forEach(i=>i.clearElementaryStreamInfo())}}function ql(n){var e,t,r;return n.buffered&&(n.body.gap||((e=n.range.video)==null?void 0:e.partial)||((t=n.range.audio)==null?void 0:t.partial)||((r=n.range.audiovideo)==null?void 0:r.partial))}function xs(n){return`${n.type}_${n.level}_${n.sn}`}function M0(n,e){return n.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Ci={cbc:0,ctr:1};class MP{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case Ci.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ci.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function NP(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class UP{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(i*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],a=r[2],o=r[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],h=l[3],f=new Uint32Array(256);let g=0,m=0,p=0;for(p=0;p<256;p++)p<128?f[p]=p<<1:f[p]=p<<1^283;for(p=0;p<256;p++){let y=m^m<<1^m<<2^m<<3^m<<4;y=y>>>8^y&255^99,e[g]=y,t[y]=g;const v=f[g],E=f[v],_=f[E];let L=f[y]*257^y*16843008;i[g]=L<<24|L>>>8,s[g]=L<<16|L>>>16,a[g]=L<<8|L>>>24,o[g]=L,L=_*16843009^E*65537^v*257^g*16843008,u[y]=L<<24|L>>>8,c[y]=L<<16|L>>>16,d[y]=L<<8|L>>>24,h[y]=L,g?(g=v^f[f[f[_^v]]],m^=f[f[m]]):g=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let o,l;const u=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,h=this.rcon,f=this.invSubMix,g=f[0],m=f[1],p=f[2],y=f[3];let v,E;for(o=0;o<a;o++){if(o<s){v=u[o]=t[o];continue}E=v,o%s===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=h[o/s|0]<<24):s>6&&o%s===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),u[o]=v=(u[o-s]^E)>>>0}for(l=0;l<a;l++)o=a-l,l&3?E=u[o]:E=u[o-4],l<4||o<=4?c[l]=E:c[l]=g[d[E>>>24]]^m[d[E>>>16&255]]^p[d[E>>>8&255]]^y[d[E&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=this.uint8ArrayToUint32Array_(r);let f=h[0],g=h[1],m=h[2],p=h[3];const y=new Int32Array(e),v=new Int32Array(y.length);let E,_,L,R,A,T,w,I,M,j,z,K,W,H;const X=this.networkToHostOrderSwap;for(;t<y.length;){for(M=X(y[t]),j=X(y[t+1]),z=X(y[t+2]),K=X(y[t+3]),A=M^s[0],T=K^s[1],w=z^s[2],I=j^s[3],W=4,H=1;H<i;H++)E=l[A>>>24]^u[T>>16&255]^c[w>>8&255]^d[I&255]^s[W],_=l[T>>>24]^u[w>>16&255]^c[I>>8&255]^d[A&255]^s[W+1],L=l[w>>>24]^u[I>>16&255]^c[A>>8&255]^d[T&255]^s[W+2],R=l[I>>>24]^u[A>>16&255]^c[T>>8&255]^d[w&255]^s[W+3],A=E,T=_,w=L,I=R,W=W+4;E=a[A>>>24]<<24^a[T>>16&255]<<16^a[w>>8&255]<<8^a[I&255]^s[W],_=a[T>>>24]<<24^a[w>>16&255]<<16^a[I>>8&255]<<8^a[A&255]^s[W+1],L=a[w>>>24]<<24^a[I>>16&255]<<16^a[A>>8&255]<<8^a[T&255]^s[W+2],R=a[I>>>24]<<24^a[A>>16&255]<<16^a[T>>8&255]<<8^a[w&255]^s[W+3],v[t]=X(E^f),v[t+1]=X(R^g),v[t+2]=X(L^m),v[t+3]=X(_^p),f=M,g=j,m=z,p=K,t=t+4}return v.buffer}}class $P{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=BP(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function BP(n){switch(n){case Ci.cbc:return"AES-CBC";case Ci.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const jP=16;class zg{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?NP(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,i){return this.useSoftware?new Promise((s,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,r,i);const l=this.flush();l?s(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,i)}softwareDecrypt(e,t,r,i){const{currentIV:s,currentResult:a,remainderData:o}=this;if(i!==Ci.cbc||t.byteLength!==16)return Re.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=wn(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;s&&(r=s);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new UP),u.expandKey(t);const c=a;return this.currentResult=u.decrypt(l.buffer,0,r),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,r,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,i));this.key=t,this.fastAesKey=new $P(this.subtle,t,i)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new MP(this.subtle,new Uint8Array(r),i).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Re.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r,i)))}onWebCryptoError(e,t,r,i){const s=this.enableSoftwareAES;if(s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,i);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(s?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%jP;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Re.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const N0=Math.pow(2,17);class GP{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Rr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l($0(e));return}else e.gap=!1;const u=this.loader=s?new s(i):new a(i),c=U0(e);e.loader=u;const d=F0(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:N0};e.stats=u.stats;const f={onSuccess:(g,m,p,y)=>{this.resetLoader(e,u);let v=g.data;p.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),o({frag:e,part:null,payload:v,networkDetails:y})},onError:(g,m,p,y)=>{this.resetLoader(e,u),l(new Rr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:we({url:r,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:p,stats:y}))},onAbort:(g,m,p)=>{this.resetLoader(e,u),l(new Rr({type:re.NETWORK_ERROR,details:O.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:p,stats:g}))},onTimeout:(g,m,p)=>{this.resetLoader(e,u),l(new Rr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:p,stats:g}))}};t&&(f.onProgress=(g,m,p,y)=>t({frag:e,part:null,payload:p,networkDetails:y})),u.load(c,h,f)})}loadPart(e,t,r){this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l($0(e,t));return}const u=this.loader=s?new s(i):new a(i),c=U0(e,t);e.loader=u;const d=F0(i.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:N0};t.stats=u.stats,u.load(c,h,{onSuccess:(f,g,m,p)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:f.data,networkDetails:p};r(y),o(y)},onError:(f,g,m,p)=>{this.resetLoader(e,u),l(new Rr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:we({url:c.url,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:m,stats:p}))},onAbort:(f,g,m)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Rr({type:re.NETWORK_ERROR,details:O.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:m,stats:f}))},onTimeout:(f,g,m)=>{this.resetLoader(e,u),l(new Rr({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:m,stats:f}))}})})}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(r.loaded/s),l),d=(l-u)*Math.round(r.loaded/u);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const a=r.loading,o=i.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function U0(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Z(i)&&Z(s)){var a;let o=i,l=s;if(n.sn==="initSegment"&&VP((a=n.decryptdata)==null?void 0:a.method)){const u=s-i;u%16&&(l=s+(16-u%16)),i!==0&&(r.resetIV=!0,o=i-16)}r.rangeStart=o,r.rangeEnd=l}return r}function $0(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:re.MEDIA_ERROR,details:O.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Rr(r)}function VP(n){return n==="AES-128"||n==="AES-256"}class Rr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Ix extends jr{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Wg{constructor(e,t,r,i=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Yl(),this.buffering={audio:Yl(),video:Yl(),audiovideo:Yl()},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=s,this.partial=a}}function Yl(){return{start:0,executeStart:0,executeEnd:0,end:0}}const B0={length:0,start:()=>0,end:()=>0};class ge{static isBuffered(e,t){if(e){const r=ge.getBuffered(e);for(let i=r.length;i--;)if(t>=r.start(i)&&t<=r.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=ge.getBuffered(e);return ge.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const i=ge.bufferedRanges(e);if(i.length)return ge.bufferedInfo(i,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let i=-1,s=[];if(r)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(i=c);const d=s.length;if(d){const h=s[d-1].end;e[c].start-h<r?e[c].end>h&&(s[d-1].end=e[c].end):s.push(e[c])}else s.push(e[c])}else s=e;let a=0,o,l=t,u=t;for(let c=0;c<s.length;c++){const d=s[c].start,h=s[c].end;if(i===-1&&t>=d&&t<=h&&(i=c),t+r>=d&&t<h)l=d,u=h,a=u-t;else if(t+r<d){o=d;break}}return{len:a,start:l||0,end:u||0,nextStart:o,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||B0}catch(t){return Re.log("failed to get media.buffered",t),B0}}}const wx=/\{\$([a-zA-Z0-9-_]+)\}/g;function j0(n){return wx.test(n)}function _f(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(wx,r=>{const i=r.substring(2,r.length-1),s=t==null?void 0:t[i];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),r):s})}return e}function G0(n,e,t){let r=n.variableList;r||(n.variableList=r={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))s=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,s=e.VALUE;i in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):r[i]=s||""}function HP(n,e,t){const r=e.IMPORT;if(t&&r in t){let i=n.variableList;i||(n.variableList=i={}),i[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}const KP=/^(\d+)x(\d+)$/,V0=/(.+?)=(".*?"|.*?)(?:,|$)/g;class ze{constructor(e,t){typeof e=="string"&&(e=ze.parseAttrList(e,t)),Oe(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(i*2,i*2+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((i,s)=>(i[s.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=KP.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const i={},s='"';for(V0.lastIndex=0;(r=V0.exec(e))!==null;){const a=r[1].trim();let o=r[2];const l=o.indexOf(s)===0&&o.lastIndexOf(s)===o.length-1;let u=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))o=_f(t,o);else if(!u&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Re.warn(`${e}: attribute ${a} is missing quotes`)}i[a]=o}return i}}const zP="com.apple.hls.interstitial";function WP(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function qP(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class Cx{constructor(e,t,r=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(i=t==null?void 0:t.tagOrder)!=null?i:r,t){const s=t.attr;for(const a in s)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==s[a]){Re.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Oe(new ze({}),s,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const s=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Z(s.getTime())&&(this._endDate=s)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Re.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Z(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===zP}get isValid(){return!!this.id&&!this._badValueForSameId&&Z(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const YP=10;class QP{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?Z(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||YP}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Ys(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function qg(n){switch(n){case"AES-128":case"AES-256":return Ci.cbc;case"AES-256-CTR":return Ci.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function Yg(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Lf(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function XP(n){const e=Lf(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function ZP(n){const e=function(r,i,s){const a=r[i];r[i]=r[s],r[s]=a};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function JP(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),i=r[r.length-1].split(",");if(i.length===2){const s=i[0]==="base64",a=i[1];s?(r.splice(-1,1),t=Yg(a)):t=XP(a)}}return t}const mc=typeof self<"u"?self:void 0;var Ce={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},zt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Ru(n){switch(n){case zt.FAIRPLAY:return Ce.FAIRPLAY;case zt.PLAYREADY:return Ce.PLAYREADY;case zt.WIDEVINE:return Ce.WIDEVINE;case zt.CLEARKEY:return Ce.CLEARKEY}}var Ql={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Hd(n){if(n===Ql.WIDEVINE)return Ce.WIDEVINE;if(n===Ql.PLAYREADY)return Ce.PLAYREADY;if(n===Ql.CENC||n===Ql.CLEARKEY)return Ce.CLEARKEY}function Xl(n){switch(n){case Ce.FAIRPLAY:return zt.FAIRPLAY;case Ce.PLAYREADY:return zt.PLAYREADY;case Ce.WIDEVINE:return zt.WIDEVINE;case Ce.CLEARKEY:return zt.CLEARKEY}}function Ja(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[Ce.FAIRPLAY,Ce.WIDEVINE,Ce.PLAYREADY,Ce.CLEARKEY].filter(i=>!!e[i]):[];return!r[Ce.WIDEVINE]&&t&&r.push(Ce.WIDEVINE),r}const Dx=function(n){return mc!=null&&(n=mc.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function eO(n,e,t,r){let i;switch(n){case Ce.FAIRPLAY:i=["cenc","sinf"];break;case Ce.WIDEVINE:case Ce.PLAYREADY:i=["cenc"];break;case Ce.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return tO(i,e,t,r)}function tO(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs=${s}`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs=${s}`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function nO(n){var e;return n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function bx(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=Yg(o).subarray(0,16);return ZP(l),l}}return null}let Zl={};class Uo{static clearKeyUriToKeyIdMap(){Zl={}}constructor(e,t,r,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Ys(e)}isSupported(){if(this.method){if(Ys(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case zt.FAIRPLAY:case zt.WIDEVINE:case zt.PLAYREADY:case zt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(Ys(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Re.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=rO(e);return new Uo(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=JP(this.uri);if(t)switch(this.keyFormat){case zt.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case zt.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=uP(r,null,t),this.keyId=bx(t);break}default:{let r=t.subarray(0,16);if(r.length!==16){const i=new Uint8Array(16);i.set(r,16-r.length),r=i}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=Zl[this.uri];if(!r){const i=Object.keys(Zl).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,i),Zl[this.uri]=r}this.keyId=r}return this}}function rO(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const H0=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,K0=/#EXT-X-MEDIA:(.*)/g,iO=/^#EXT(?:INF|-X-TARGETDURATION):/m,Kd=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),sO=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class lr{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static resolve(e,t){return Gg.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return iO.test(e)}static parseMasterPlaylist(e,t){const r=j0(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];H0.lastIndex=0;let a;for(;(a=H0.exec(e))!=null;)if(a[1]){var o;const u=new ze(a[1],i),c=_f(i,a[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:lr.resolve(c,t)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),q0(u.CODECS,d);const f=u["SUPPLEMENTAL-CODECS"];f&&(d.supplemental={},q0(f,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||s.push(d),i.levels.push(d)}else if(a[3]){const u=a[3],c=a[4];switch(u){case"SESSION-DATA":{const d=new ze(c,i),h=d["DATA-ID"];h&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[h]=d);break}case"SESSION-KEY":{const d=z0(c,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):Re.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new ze(c,i);G0(i,d,t)}break}case"CONTENT-STEERING":{const d=new ze(c,i);i.contentSteering={uri:lr.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=W0(c);break}}}const l=s.length>0&&s.length<i.levels.length;return i.levels=l?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,r){let i;const s={},a=r.levels,o={AUDIO:a.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:a.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(K0.lastIndex=0;(i=K0.exec(e))!==null;){const u=new ze(i[1],r),c=u.TYPE;if(c){const d=o[c],h=s[c]||[];s[c]=h;const f=u.LANGUAGE,g=u["ASSOC-LANGUAGE"],m=u.CHANNELS,p=u.CHARACTERISTICS,y=u["INSTREAM-ID"],v={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||f||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:f,url:u.URI?lr.resolve(u.URI,t):""};if(g&&(v.assocLang=g),m&&(v.channels=m),p&&(v.characteristics=p),y&&(v.instreamId=y),d!=null&&d.length){const E=lr.findGroup(d,v.groupId)||d[0];Y0(v,E,"audioCodec"),Y0(v,E,"textCodec")}h.push(v)}}return s}static parseLevelPlaylist(e,t,r,i,s,a){var o;const l={url:t},u=new QP(t),c=u.fragments,d=[];let h=null,f=0,g=0,m=0,p=0,y=0,v=null,E=new Bd(i,l),_,L,R,A=-1,T=!1,w=null,I;if(Kd.lastIndex=0,u.m3u8=e,u.hasVariableRefs=j0(e),((o=Kd.exec(e))==null?void 0:o[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(_=Kd.exec(e))!==null;){T&&(T=!1,E=new Bd(i,l),E.playlistOffset=m,E.start=m,E.sn=f,E.cc=p,y&&(E.bitrate=y),E.level=r,h&&(E.initSegment=h,h.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),w&&(E.setByteRange(w),w=null)));const K=_[1];if(K){E.duration=parseFloat(K);const W=(" "+_[2]).slice(1);E.title=W||null,E.tagList.push(W?["INF",K,W]:["INF",K])}else if(_[3]){if(Z(E.duration)){E.playlistOffset=m,E.start=m,R&&X0(E,R,u),E.sn=f,E.level=r,E.cc=p,c.push(E);const W=(" "+_[3]).slice(1);E.relurl=_f(u,W),Af(E,v,d),v=E,m+=E.duration,f++,g=0,T=!0}}else{if(_=_[0].match(sO),!_){Re.warn("No matches on slow regex match for level playlist!");continue}for(L=1;L<_.length&&_[L]===void 0;L++);const W=(" "+_[L]).slice(1),H=(" "+_[L+1]).slice(1),X=_[L+2]?(" "+_[L+2]).slice(1):null;switch(W){case"BYTERANGE":v?E.setByteRange(H,v):E.setByteRange(H);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=H,E.tagList.push(["PROGRAM-DATE-TIME",H]),A===-1&&(A=c.length);break;case"PLAYLIST-TYPE":u.type&&Tr(u,W,_),u.type=H.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Tr(u,W,_):c.length>0&&Z0(u,W,_),f=u.startSN=parseInt(H);break;case"SKIP":{u.skippedSegments&&Tr(u,W,_);const $=new ze(H,u),F=$.decimalInteger("SKIPPED-SEGMENTS");if(Z(F)){u.skippedSegments+=F;for(let Q=F;Q--;)c.push(null);f+=F}const U=$.enumeratedString("RECENTLY-REMOVED-DATERANGES");U&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(U.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Tr(u,W,_),u.targetduration=Math.max(parseInt(H),1);break;case"VERSION":u.version!==null&&Tr(u,W,_),u.version=parseInt(H);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Tr(u,W,_),u.live=!1;break;case"#":(H||X)&&E.tagList.push(X?[H,X]:[H]);break;case"DISCONTINUITY":p++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([W]);break;case"BITRATE":E.tagList.push([W,H]),y=parseInt(H)*1e3,Z(y)?E.bitrate=y:y=0;break;case"DATERANGE":{const $=new ze(H,u),F=new Cx($,u.dateRanges[$.ID],u.dateRangeTagCount);u.dateRangeTagCount++,F.isValid||u.skippedSegments?u.dateRanges[F.id]=F:Re.warn(`Ignoring invalid DATERANGE tag: "${H}"`),E.tagList.push(["EXT-X-DATERANGE",H]);break}case"DEFINE":{{const $=new ze(H,u);"IMPORT"in $?HP(u,$,a):G0(u,$,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Tr(u,W,_):c.length>0&&Z0(u,W,_),u.startCC=p=parseInt(H);break;case"KEY":{const $=z0(H,t,u);if($.isSupported()){if($.method==="NONE"){R=void 0;break}R||(R={}),R[$.keyFormat]&&(R=Oe({},R)),R[$.keyFormat]=$}else Re.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${H}"`);break}case"START":u.startTimeOffset=W0(H);break;case"MAP":{const $=new ze(H,u);if(E.duration){const F=new Bd(i,l);Q0(F,$,r,R),h=F,E.initSegment=h,h.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime)}else{const F=E.byteRangeEndOffset;if(F){const U=E.byteRangeStartOffset;w=`${F-U}@${U}`}else w=null;Q0(E,$,r,R),h=E,T=!0}h.cc=p;break}case"SERVER-CONTROL":{I&&Tr(u,W,_),I=new ze(H),u.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),u.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Tr(u,W,_);const $=new ze(H);u.partTarget=$.decimalFloatingPoint("PART-TARGET");break}case"PART":{let $=u.partList;$||($=u.partList=[]);const F=g>0?$[$.length-1]:void 0,U=g++,Q=new ze(H,u),Y=new Yk(Q,E,l,U,F);$.push(Y),E.duration+=Y.duration;break}case"PRELOAD-HINT":{const $=new ze(H,u);u.preloadHint=$;break}case"RENDITION-REPORT":{const $=new ze(H,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push($);break}default:Re.warn(`line parsed but not handled: ${_}`);break}}}v&&!v.relurl?(c.pop(),m-=v.duration,u.partList&&(u.fragmentHint=v)):u.partList&&(Af(E,v,d),E.cc=p,u.fragmentHint=E,R&&X0(E,R,u)),u.targetduration||(u.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const M=c.length,j=c[0],z=c[M-1];if(m+=u.skippedSegments*u.targetduration,m>0&&M&&z){u.averagetargetduration=m/M;const K=z.sn;u.endSN=K!=="initSegment"?K:0,u.live||(z.endList=!0),j&&u.startCC===void 0&&(u.startCC=j.cc),A>0&&(oO(c,A),j&&d.unshift(j))}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(m+=u.fragmentHint.duration),u.totalduration=m,d.length&&u.dateRangeTagCount&&j&&kx(d,u),u.endCC=p,u}}function kx(n,e){const t=n.length;if(!t)return;const r=n[t-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let a=s.length;a--;){const o=e.dateRanges[s[a]],l=o.startDate.getTime();o.tagAnchor=r.ref;for(let u=t;u--;){const c=aO(e,l,n,u,i);if(c!==-1){o.tagAnchor=e.fragments[c].ref;break}}}}function aO(n,e,t,r,i){const s=t[r];if(s){const o=s.programDateTime;if(e>=o||r===0){var a;const l=(((a=t[r+1])==null?void 0:a.start)||i)-s.start;if(e<=o+l*1e3){const u=t[r].sn-n.startSN,c=n.fragments;if(c.length>t.length){const h=(t[r+1]||c[c.length-1]).sn-n.startSN;for(let f=h;f>u;f--){const g=c[f].programDateTime;if(e>=g&&e<g+c[f].duration*1e3)return f}}return u}}}return-1}function z0(n,e,t){var r,i;const s=new ze(n,t),a=(r=s.METHOD)!=null?r:"",o=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=(i=s.KEYFORMAT)!=null?i:"identity";o&&s.IV&&!l&&Re.error(`Invalid IV: ${s.IV}`);const d=o?lr.resolve(o,e):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Uo(a,d,c,h,l)}function W0(n){const t=new ze(n).decimalFloatingPoint("TIME-OFFSET");return Z(t)?t:null}function q0(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const i=t.filter(s=>vx(s,r));i.length&&(e[`${r}Codec`]=i.map(s=>s.split("/")[0]).join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function Y0(n,e,t){const r=e[t];r&&(n[t]=r)}function oO(n,e){let t=n[e];for(let r=e;r--;){const i=n[r];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function Af(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function Q0(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function X0(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&r.push(n)}function Tr(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Z0(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function zd(n,e){const t=e.startPTS;if(Z(t)){let r=0,i;e.sn>n.sn?(r=t-n.start,i=n):(r=n.start-t,i=e),i.duration!==r&&i.setDuration(r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function Px(n,e,t,r,i,s){r-t<=0&&(Re.warn("Fragment should have a positive duration",e),r=t+e.duration,s=i+e.duration);let o=t,l=r;const u=e.startPTS,c=e.endPTS;if(Z(u)){const p=Math.abs(u-t);Z(e.deltaPTS)?e.deltaPTS=Math.max(p,e.deltaPTS):e.deltaPTS=p,o=Math.max(t,u),t=Math.min(t,u),i=Math.min(i,e.startDTS),l=Math.min(r,c),r=Math.max(r,c),s=Math.max(s,e.endDTS)}const d=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(r-e.start),e.startPTS=t,e.maxStartPTS=o,e.startDTS=i,e.endPTS=r,e.minEndPTS=l,e.endDTS=s;const h=e.sn;if(!n||h<n.startSN||h>n.endSN)return 0;let f;const g=h-n.startSN,m=n.fragments;for(m[g]=e,f=g;f>0;f--)zd(m[f],m[f-1]);for(f=g;f<m.length-1;f++)zd(m[f],m[f+1]);return n.fragmentHint&&zd(m[m.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function lO(n,e){if(n===e)return;let t=null;const r=n.fragments;for(let u=r.length-1;u>=0;u--){const c=r[u].initSegment;if(c){t=c;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;dO(n,e,(u,c,d,h)=>{if((!e.startCC||e.skippedSegments)&&c.cc!==u.cc){const f=u.cc-c.cc;for(let g=d;g<h.length;g++)h[g].cc+=f;e.endCC=h[h.length-1].cc}Z(u.startPTS)&&Z(u.endPTS)&&(c.setStart(c.startPTS=u.startPTS),c.startDTS=u.startDTS,c.maxStartPTS=u.maxStartPTS,c.endPTS=u.endPTS,c.endDTS=u.endDTS,c.minEndPTS=u.minEndPTS,c.setDuration(u.endPTS-u.startPTS),c.duration&&(i=c),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(c.elementaryStreams=u.elementaryStreams),c.loader=u.loader,u.hasStats&&(c.stats=u.stats),u.initSegment&&(c.initSegment=u.initSegment,t=u.initSegment)});const s=e.fragments,a=e.fragmentHint?s.concat(e.fragmentHint):s;if(t&&a.forEach(u=>{var c;u&&(!u.initSegment||u.initSegment.relurl===((c=t)==null?void 0:c.relurl))&&(u.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=s.some(u=>!u),e.deltaUpdateFailed){Re.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)s.shift();e.startSN=s[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=uO(n.dateRanges,e));const u=n.fragments.filter(c=>c.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let c=1;c<a.length;c++)a[c].programDateTime===null&&Af(a[c],a[c-1],u);kx(u,e)}e.endCC=s[s.length-1].cc}if(!e.startCC){var o;const u=Mx(n,e.startSN-1);e.startCC=(o=u==null?void 0:u.cc)!=null?o:s[0].cc}cO(n.partList,e.partList,(u,c)=>{c.elementaryStreams=u.elementaryStreams,c.stats=u.stats}),i?Px(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):Ox(n,e),s.length&&(e.totalduration=e.edge-s[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const l=e.advancedDateTime;if(e.advanced&&l){const u=e.edge;e.driftStart||(e.driftStartTime=l,e.driftStart=u),e.driftEndTime=l,e.driftEnd=u}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function uO(n,e){const{dateRanges:t,recentlyRemovedDateranges:r}=e,i=Oe({},n);r&&r.forEach(o=>{delete i[o]});const a=Object.keys(i).length;return a&&Object.keys(t).forEach(o=>{const l=i[o],u=new Cx(t[o].attr,l);u.isValid?(i[o]=u,l||(u.tagOrder+=a)):Re.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ke(t[o].attr)}"`)}),i}function cO(n,e,t){if(n&&e){let r=0;for(let i=0,s=n.length;i<=s;i++){const a=n[i],o=e[i+r];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):r--}}}function dO(n,e,t){const r=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,a=e.startSN-n.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=i;u<=s;u++){const c=l[a+u];let d=o[u];if(r&&!d&&c&&(d=e.fragments[u]=c),c&&d){if(t(c,d,u,o),c.url&&c.url!==d.url){e.playlistParsingError=J0(`media sequence mismatch ${d.sn}:`,n,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=J0(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,n,e,c,d);return}}}}function J0(n,e,t,r,i){return new Error(`${n} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Ox(n,e,t=!0){const r=e.startSN+e.skippedSegments-n.startSN,i=n.fragments,s=r>=0;let a=0;if(s&&r<i.length)a=i[r].start;else if(s&&e.startSN===n.endSN+1)a=n.fragmentEnd;else if(s&&t)a=n.fragmentStart+r*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=n.fragmentStart;else return;Rf(e,a)}function Rf(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function Fx(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const s=r[r.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function Mx(n,e,t){if(!n)return null;let r=n.fragments[e-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===e)?r:e<n.startSN&&t&&t.sn===e?t:null}function ey(n,e,t){return n?Nx(n.partList,e,t):null}function Nx(n,e,t){if(n)for(let r=n.length;r--;){const i=n[r];if(i.index===t&&i.fragment.sn===e)return i}return null}function Ux(n){n.forEach((e,t)=>{var r;(r=e.details)==null||r.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function ho(n,e){for(let r=0,i=n.length;r<i;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function hO(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function ty(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function $x(n,e){const t=e.fragments;for(let r=0,i=t.length;r<i;r++)ty(t[r],n);e.fragmentHint&&ty(e.fragmentHint,n),e.alignedSliding=!0}function fO(n,e){n&&(Bx(e,n),!e.alignedSliding&&n&&pc(e,n),!e.alignedSliding&&n&&!e.skippedSegments&&Ox(n,e,!1))}function Bx(n,e){if(!hO(e,n))return;const t=Math.min(e.endCC,n.endCC),r=ho(e.fragments,t),i=ho(n.fragments,t);if(!r||!i)return;Re.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const s=r.start-i.start;$x(s,n)}function pc(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let i,s;const a=Math.min(e.endCC,n.endCC);e.startCC<a&&n.startCC<a&&(i=ho(r,a),s=ho(t,a)),(!i||!s)&&(i=r[Math.floor(r.length/2)],s=ho(t,i.cc)||t[Math.floor(t.length/2)]);const o=i.programDateTime,l=s.programDateTime;if(!o||!l)return;const u=(l-o)/1e3-(s.start-i.start);$x(u,n)}const gO={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},B={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Qg extends Ix{constructor(e,t,r,i,s){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=B.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,h=ge.bufferInfo(u||l,d,a.maxBufferHole);if(this.log(`media seeking to ${Z(d)?d.toFixed(3):d}, state: ${c}`),this.state===B.ENDED)this.resetLoadingState();else if(o){const f=a.maxFragLookUpTolerance,g=o.start-f,m=o.start+o.duration+f;if(!h.len||m<h.start||g>h.end){const p=d>m;(d<g||p)&&(p&&o.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const f=this.lastCurrentTime;if(d>f&&(this.lastCurrentTime=d),!this.loadingParts){const g=Math.max(h.end,d),m=this.shouldLoadParts(this.getLevelDetails(),g);m&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${g.toFixed(2)}`),this.loadingParts=m)}}!this.hls.hasEnoughToStart&&!h.len&&(this.log(`setting startPosition to ${d} because of seek before start`),this.nextLoadPosition=this.startPosition=d),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=s,this.hls=e,this.fragmentLoader=new GP(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new zg(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===B.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=B.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,i=this.config.timelineOffset||0;if(r<=i)return!1;const s=e.buffered;this.config.maxBufferHole&&s&&s.length>1&&(e=ge.bufferedInfo(s,e.start,0));const a=e.nextStart;if(a&&a>i&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return ge.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),r.addEventListener("seeking",this.onMediaSeeking),r.addEventListener("ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===B.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=B.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const i=s=>{const a=s.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${s.part?" part: "+s.part.index:""} of ${this.fragInfo(a,!1,s.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,r,i).then(s=>{if(!s)return;const a=this.state,o=s.frag;if(this.fragContextChanged(o)){(a===B.FRAG_LOADING||!this.fragCurrent&&a===B.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=B.IDLE);return}"payload"in s&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(S.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===B.STOPPED||this.state===B.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===gt.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===gt.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:r};this.hls.trigger(S.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{const i=r==null?void 0:r.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:i}=this,{frag:s,payload:a}=r,o=s.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&Ys(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,qg(o.method)).catch(u=>{throw i.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:s}),u}).then(u=>{const c=self.performance.now();return i.trigger(S.FRAG_DECRYPTED,{frag:s,payload:u,stats:{tstart:l,tdecrypt:c}}),r.payload=u,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===B.STOPPED||this.state===B.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==B.STOPPED&&(this.state=B.IDLE),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?gO.toString(ge.getBuffered(r)):"(detached)"})`),xt(e)){var i;if(e.type!==ne.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=B.IDLE;return}}const s=(i=this.levels)==null?void 0:i[e.level];s!=null&&s.fragmentError&&(this.log(`Resetting level fragment error count of ${s.fragmentError} on frag buffered`),s.fragmentError=0)}this.state=B.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:s}=e,a=!s||s.length===0||s.some(l=>!l),o=new Wg(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var s;this.fragCurrent=e;const a=t==null?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=B.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(S.KEY_LOADED,d),this.state===B.KEY_LOADING&&(this.state=B.IDLE),d}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(xt(e)&&(!l||e.sn!==l.sn)){const d=this.shouldLoadParts(t.details,e.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=d)}if(r=Math.max(e.start,r||0),this.loadingParts&&xt(e)){const d=a.partList;if(d&&i){r>e.end&&a.fragmentHint&&(e=a.fragmentHint);const h=this.getNextPart(d,e,r);if(h>-1){const f=d[h];e=this.fragCurrent=f.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${f.index} (${h}/${d.length-1}) of ${this.fragInfo(e,!1,f)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=B.FRAG_LOADING;let g;return o?g=o.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(e,f,t,i)).catch(m=>this.handleFragLoadError(m)):g=this.doFragPartsLoad(e,f,t,i).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:f,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}else if(!e.url||this.loadedEndOfParts(d,r))return Promise.resolve(null)}}if(xt(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${a?"["+a.startSN+"-"+a.endSN+"]":""}, target: ${parseFloat(r.toFixed(3))}`),Z(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=B.FRAG_LOADING;const u=this.config.progressive;let c;return u&&o?c=o.then(d=>!d||this.fragContextChanged(d==null?void 0:d.frag)?null:this.fragmentLoader.load(e,i)).catch(d=>this.handleFragLoadError(d)):c=Promise.all([this.fragmentLoader.load(e,u?i:void 0),o]).then(([d])=>(!u&&d&&i&&i(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,r,i){return new Promise((s,a)=>{var o;const l=[],u=(o=r.details)==null?void 0:o.partList,c=d=>{this.fragmentLoader.loadPart(e,d,i).then(h=>{l[d.index]=h;const f=h.part;this.hls.trigger(S.FRAG_LOADED,h);const g=ey(r.details,e.sn,d.index+1)||Nx(u,e.sn,d.index+1);if(g)c(g);else return s({frag:e,part:f,partsLoaded:l})}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===O.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(S.ERROR,t)}else this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==B.PARSING){!this.fragCurrent&&this.state!==B.STOPPED&&this.state!==B.ERROR&&(this.state=B.IDLE);return}const{frag:r,part:i,level:s}=t,a=self.performance.now();r.stats.parsing.end=a,i&&(i.stats.parsing.end=a);const o=this.getLevelDetails(),u=o&&r.sn>o.endSN||this.shouldLoadParts(o,r.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(r,i,s,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var r;const s=e.partList[0],a=s.end+(((r=e.fragmentHint)==null?void 0:r.duration)||0);if(t>=a){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>s.start-s.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:s,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const o=t[i],l=o.details,u=a>-1?ey(l,s,a):null,c=u?u.fragment:Mx(l,s,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:u,level:o}):null}bufferFragmentData(e,t,r,i,s){var a;if(!e||this.state!==B.PARSING)return;const{data1:o,data2:l}=e;let u=o;if(o&&l&&(u=wn(o,l)),!((a=u)!=null&&a.length))return;const c={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:u};if(this.hls.trigger(S.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ge.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,i=ge.bufferInfo(t,r,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(e.start-a,i.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var r;const i=this.getLoadPosition();if(!Z(i))return null;const a=this.lastCurrentTime>i||(r=this.media)!=null&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,a)}getFwdBufferInfoAtPos(e,t,r,i){const s=ge.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&(s.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(s.nextStart,a.end)-t,i);return ge.bufferInfo(e,t,o)}}return s}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,i=Math.max(Math.min(e-t,r.maxBufferLength),t),s=Math.max(e-t*3,r.maxMaxBufferLength/2,i);return s>=i?(r.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=ne.MAIN){var r;const i=(r=this.fragmentTracker)==null?void 0:r.getAppendedFrag(e,t);return i&&"fragment"in i?i.fragment:i}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:s}=this,a=r[0].start,o=s.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=s.initialLiveManifestSize;if(i<d)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var u;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,f=this.hls.liveSyncPosition,g=l?(h!==-1&&h>=a?h:f)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${f} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=a&&(l=r[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const d=l.sn-t.startSN;c=this.filterReplacedPrimary(r[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===gt.OK||r===gt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,s){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&r.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i,0);if(o!==null&&r.len+o.len>=s){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(ny(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(ny(this.hls.config)&&e.type!==ne.SUBTITLE){const r=this.hls.interstitialsManager,i=r==null?void 0:r.bufferingItem;if(i){const a=i.event;if(a){if(a.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&(t==null?void 0:t.live)===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const s=r==null?void 0:r.playerQueue;if(s)for(let a=s.length;a--;){const o=s[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let i=-1,s=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const u=e[o];if(a=a&&!u.independent,i>-1&&r<u.start)break;const c=u.loaded;c?i=-1:(s||u.independent||a)&&u.fragment===t&&(i=o),s=c}return i}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=DP(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];r.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=Rx(e,r.cc,r.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:s}=this,{fragments:a,endSN:o}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=i,c=r.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&l&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let h;if(e<t){var f;const m=e<this.lastCurrentTime||e>t-u||(f=this.media)!=null&&f.paused||!this.startFragRequested?0:u;h=hs(s,a,e,m)}else h=a[a.length-1];if(h){const g=h.sn-r.startSN,m=this.fragmentTracker.getState(h);if((m===gt.OK||m===gt.PARTIAL&&h.gap)&&(s=h),s&&h.sn===s.sn&&(!d||c[0].fragment.sn>h.sn||!r.live&&!d)&&s&&h.level===s.level){const y=a[g+1];h.sn<o&&this.fragmentTracker.getState(y)!==gt.OK?h=y:h=null}}return h}alignPlaylists(e,t,r){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragmentStart,a=!t,o=e.alignedSliding&&Z(s);if(a||!o&&!s){fO(r,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const i=this.timelineOffset;if(r===-1){const s=this.startTimeOffset!==null,a=s?this.startTimeOffset:e.startTimeOffset;a!==null&&Z(a)?(r=t+a,a<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${a} found in ${s?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+i}this.nextLoadPosition=r+i}getLoadPosition(){var e;const{media:t}=this;let r=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&xt(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==B.FRAG_LOADING_WAITING_RETRY)&&(this.state=B.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const g=this.getCurrentContext(t.chunkMeta);g&&(t.frag=g.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var i;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const s=t.details===O.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction,{action:o,flags:l,retryCount:u=0,retryConfig:c}=a||{},d=!!a&&!!c,h=d&&o===Dt.RetryRequest,f=d&&!a.resolved&&l===On.MoveAllAlternatesMatchingHost;if(!h&&f&&xt(r)&&!r.endList)this.resetFragmentErrors(e),this.treatAsGap(r),a.resolved=!0;else if((h||f)&&u<c.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const g=Kg(c,u);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${u+1}/${c.maxNumRetry} in ${g}ms`),a.resolved=!0,this.retryDate=self.performance.now()+g,this.state=B.FRAG_LOADING_WAITING_RETRY}else if(c&&a)if(this.resetFragmentErrors(e),u<c.maxNumRetry)!s&&o!==Dt.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else o===Dt.SendAlternateToPenaltyBox?this.state=B.WAITING_LEVEL:this.state=B.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===B.PARSING||this.state===B.PARSED){const t=e.frag,r=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const a=!s;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===ne.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==B.STOPPED&&(this.state=B.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const i=ge.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===B.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==B.STOPPED&&(this.state=B.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){const s=r.details;if(!s){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const h=i?0:Px(s,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:s,level:r,drift:h,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var o;if(r.fragmentError===0&&this.treatAsGap(e,r),((o=this.transmuxer)==null?void 0:o.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(l.message),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=B.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ne.MAIN?"level":"track"}fragInfo(e,t=!0,r){var i,s;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${((i=t&&!r?e.startPTS:(r||e).start)!=null?i:NaN).toFixed(3)}-${((s=t&&!r?e.endPTS:(r||e).end)!=null?s:NaN).toFixed(3)}]${r&&e.type==="main"?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function ny(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class jx{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=mO(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function mO(n,e){const t=new Uint8Array(e);let r=0;for(let i=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}var Wd={exports:{}},ry;function pO(){return ry||(ry=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function s(l,u,c,d,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new i(c,d||l,h),g=t?t+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],f]:l._events[g].push(f):(l._events[g]=f,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,g=new Array(f);h<f;h++)g[h]=d[h].fn;return g},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,h,f,g){var m=t?t+u:u;if(!this._events[m])return!1;var p=this._events[m],y=arguments.length,v,E;if(p.fn){switch(p.once&&this.removeListener(u,p.fn,void 0,!0),y){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,c),!0;case 3:return p.fn.call(p.context,c,d),!0;case 4:return p.fn.call(p.context,c,d,h),!0;case 5:return p.fn.call(p.context,c,d,h,f),!0;case 6:return p.fn.call(p.context,c,d,h,f,g),!0}for(E=1,v=new Array(y-1);E<y;E++)v[E-1]=arguments[E];p.fn.apply(p.context,v)}else{var _=p.length,L;for(E=0;E<_;E++)switch(p[E].once&&this.removeListener(u,p[E].fn,void 0,!0),y){case 1:p[E].fn.call(p[E].context);break;case 2:p[E].fn.call(p[E].context,c);break;case 3:p[E].fn.call(p[E].context,c,d);break;case 4:p[E].fn.call(p[E].context,c,d,h);break;default:if(!v)for(L=1,v=new Array(y-1);L<y;L++)v[L-1]=arguments[L];p[E].fn.apply(p[E].context,v)}}return!0},o.prototype.on=function(u,c,d){return s(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return s(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,h){var f=t?t+u:u;if(!this._events[f])return this;if(!c)return a(this,f),this;var g=this._events[f];if(g.fn)g.fn===c&&(!h||g.once)&&(!d||g.context===d)&&a(this,f);else{for(var m=0,p=[],y=g.length;m<y;m++)(g[m].fn!==c||h&&!g[m].once||d&&g[m].context!==d)&&p.push(g[m]);p.length?this._events[f]=p.length===1?p[0]:p:a(this,f)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&a(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(Wd)),Wd.exports}var yO=pO(),Xg=Wk(yO);const $o="1.6.5",xa={};function vO(){return typeof __HLS_WORKER_BUNDLE__=="function"}function EO(){const n=xa[$o];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return xa[$o]=i,i}function SO(n){const e=xa[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return xa[n]=i,i}function xO(n){const e=xa[n||$o];if(e&&e.clientCount--===1){const{worker:r,objectURL:i}=e;delete xa[n||$o],i&&self.URL.revokeObjectURL(i),r.terminate()}}function Gx(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Zg(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function zc(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Bo(n,e){const t=e;let r=0;for(;Zg(n,e);){r+=10;const i=zc(n,e+6);r+=i,Gx(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)}function TO(n,e,t,r){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=e[t+2],a=s>>2&15;if(a>12){const f=new Error(`invalid ADTS sampling index:${a}`);n.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}const o=(s>>6&3)+1,l=e[t+3]>>6&3|(s&1)<<2,u="mp4a.40."+o,c=i[a];let d=a;(o===5||o===29)&&(d-=3);const h=[o<<3|(d&14)>>1,(d&1)<<7|l<<3];return Re.log(`manifest codec:${r}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${o} sampling index:${a})`),{config:h,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:r}}function Vx(n,e){return n[e]===255&&(n[e+1]&246)===240}function Hx(n,e){return n[e+1]&1?7:9}function Jg(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function _O(n,e){return e+5<n.length}function yc(n,e){return e+1<n.length&&Vx(n,e)}function LO(n,e){return _O(n,e)&&Vx(n,e)&&Jg(n,e)<=n.length-e}function AO(n,e){if(yc(n,e)){const t=Hx(n,e);if(e+t>=n.length)return!1;const r=Jg(n,e);if(r<=t)return!1;const i=e+r;return i===n.length||yc(n,i)}return!1}function Kx(n,e,t,r,i){if(!n.samplerate){const s=TO(e,t,r,i);if(!s)return;Oe(n,s)}}function zx(n){return 1024*9e4/n}function RO(n,e){const t=Hx(n,e);if(e+t<=n.length){const r=Jg(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function Wx(n,e,t,r,i){const s=zx(n.samplerate),a=r+i*s,o=RO(e,t);let l;if(o){const{frameLength:d,headerLength:h}=o,f=h+d,g=Math.max(0,t+f-e.length);g?(l=new Uint8Array(f-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+f);const m={unit:l,pts:a};return g||n.samples.push(m),{sample:m,length:f,missing:g}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:u,missing:-1}}function IO(n,e){return Zg(n,e)&&zc(n,e+6)+10<=n.length-e}function wO(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function qd(n,e=0,t=1/0){return CO(n,e,t,Uint8Array)}function CO(n,e,t,r){const i=DO(n);let s=1;"BYTES_PER_ELEMENT"in r&&(s=r.BYTES_PER_ELEMENT);const a=bO(n)?n.byteOffset:0,o=(a+n.byteLength)/s,l=(a+e)/s,u=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(u+Math.max(t,0),o));return new r(i,u,c-u)}function DO(n){return n instanceof ArrayBuffer?n:n.buffer}function bO(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function kO(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const r=n.data.subarray(1).indexOf(0);if(r===-1)return;const i=hn(qd(n.data,1,r)),s=n.data[2+r],a=n.data.subarray(3+r).indexOf(0);if(a===-1)return;const o=hn(qd(n.data,3+r,a));let l;return i==="-->"?l=hn(qd(n.data,4+r+a)):l=wO(n.data.subarray(4+r+a)),e.mimeType=i,e.pictureType=s,e.description=o,e.data=l,e}function PO(n){if(n.size<2)return;const e=hn(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function OO(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=hn(n.data.subarray(t),!0);t+=r.length+1;const i=hn(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=hn(n.data.subarray(1));return{key:n.type,info:"",data:e}}function FO(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=hn(n.data.subarray(t),!0);t+=r.length+1;const i=hn(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=hn(n.data);return{key:n.type,info:"",data:e}}function MO(n){return n.type==="PRIV"?PO(n):n.type[0]==="W"?FO(n):n.type==="APIC"?kO(n):OO(n)}function NO(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=zc(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}}const Jl=10,UO=10;function qx(n){let e=0;const t=[];for(;Zg(n,e);){const r=zc(n,e+6);n[e+5]>>6&1&&(e+=Jl),e+=Jl;const i=e+r;for(;e+UO<i;){const s=NO(n.subarray(e)),a=MO(s);a&&t.push(a),e+=s.size+Jl}Gx(n,e)&&(e+=Jl)}return t}function Yx(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function $O(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}}function em(n){const e=qx(n);for(let t=0;t<e.length;t++){const r=e[t];if(Yx(r))return $O(r)}}let on=function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n}({});function rr(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class tm{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=wn(this.cachedData,e),this.cachedData=null);let r=Bo(e,0),i=r?r.length:0,s;const a=this._audioTrack,o=this._id3Track,l=r?em(r):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&Z(l))&&(this.basePTS=BO(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:on.audioId3,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){const c=this.appendFrame(a,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,i+=c.length,s=i):i=u}else IO(e,i)?(r=Bo(e,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:on.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,s=i):i++;if(i===u&&s!==u){const c=e.slice(s);this.cachedData?this.cachedData=wn(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:rr(),id3Track:o,textTrack:rr()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:rr(),id3Track:this._id3Track,textTrack:rr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const BO=(n,e,t)=>{if(Z(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};let eu=null;const jO=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],GO=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],VO=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],HO=[0,1,1,4];function Qx(n,e,t,r,i){if(t+24>e.length)return;const s=Xx(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,o=r+i*a,l={unit:e.subarray(t,t+s.frameLength),pts:o,dts:o};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function Xx(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,i=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const a=n[e+2]>>1&1,o=n[e+3]>>6,l=t===3?3-r:r===3?3:4,u=jO[l*14+i-1]*1e3,d=GO[(t===3?0:t===2?1:2)*3+s],h=o===3?1:2,f=VO[t][r],g=HO[r],m=f*8*g,p=Math.floor(f*u/d+a)*g;if(eu===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);eu=E?parseInt(E[1]):0}return!!eu&&eu<=87&&r===2&&u>=224e3&&o===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:h,frameLength:p,samplesPerFrame:m}}}function nm(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function Zx(n,e){return e+1<n.length&&nm(n,e)}function KO(n,e){return nm(n,e)&&4<=n.length-e}function Jx(n,e){if(e+1<n.length&&nm(n,e)){const r=Xx(n,e);let i=4;r!=null&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===n.length||Zx(n,s)}return!1}class zO extends tm{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=Bo(e,0);let i=(r==null?void 0:r.length)||0;if(Jx(e,i))return!1;for(let s=e.length;i<s;i++)if(AO(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return LO(e,t)}appendFrame(e,t,r){Kx(e,this.observer,t,r,e.manifestCodec);const i=Wx(e,t,r,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const eT=(n,e)=>{let t=0,r=5;e+=r;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=n[e];const o=Math.min(r,8),l=8-o;s[0]=4278190080>>>24+l<<l,i[0]=(a[0]&s[0])>>l,t=t?t<<o|i[0]:i[0],e+=1,r-=o}return t};class WO extends tm{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const i=tT(e,t,r,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Bo(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&em(t)!==void 0&&eT(e,r)<16}}function tT(n,e,t,r,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));const f=(e[t+6]<<8|e[t+7])>>12-h&1,m=[2,1,2,3,3,4,4,5][d]+f,p=e[t+5]>>3,y=e[t+5]&7,v=new Uint8Array([s<<6|p<<1|y>>2,(y&3)<<6|d<<3|f<<2|l>>4,l<<4&224]),E=1536/o*9e4,_=r+i*E,L=e.subarray(t,t+c);return n.config=v,n.channelCount=m,n.samplerate=o,n.samples.push({unit:L,pts:_}),c}class qO extends tm{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Bo(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&em(t)!==void 0&&eT(e,r)<=16)return!1;for(let i=e.length;r<i;r++)if(Jx(e,r))return Re.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return KO(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return Qx(e,t,r,this.basePTS,this.frameIndex)}}const YO=/\/emsg[-/]ID3/i;class QO{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const s=this.videoTrack=rr("video",1),a=this.audioTrack=rr("audio",1),o=this.txtTrack=rr("text",1);if(this.id3Track=rr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=gx(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:h}=l.video;s.id=u,s.timescale=o.timescale=c,s.codec=d,s.supplemental=h}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;a.id=u,a.timescale=c,a.codec=d}o.id=dx.text,s.sampleDuration=0,s.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return Zk(e)}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=wn(this.remainderData,e));const o=sP(r);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=r;const a=this.extractID3Track(i,t);return s.samples=L0(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=L0(e,t),{videoTrack:t,audioTrack:rr(),id3Track:i,textTrack:rr()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=me(e.samples,["emsg"]);i&&i.forEach(s=>{const a=oP(s);if(YO.test(a.schemeIdUri)){const o=iy(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=a.payload;r.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:on.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=iy(a,t);r.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:on.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function iy(n,e){return Z(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class XO{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new zg(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ci.cbc)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);i.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e}decryptAvcSample(e,t,r,i,s){const a=px(s.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)})}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(r>=s.length);r++){const a=s[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,r,i,a),!this.decrypter.isSync()))return}}}}class nT{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,i;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const s=r.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,i=r.length;if(i){const s=r[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,r){const i=t.byteLength;let s=e.naluState||0;const a=s,o=[];let l=0,u,c,d,h=-1,f=0;for(s===-1&&(h=0,f=this.getNALuType(t,0),s=0,l=1);l<i;){if(u=t[l++],!s){s=u?0:1;continue}if(s===1){s=u?0:2;continue}if(!u)s=3;else if(u===1){if(c=l-s-1,h>=0){const g={data:t.subarray(h,c),type:f};o.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(a&&l<=4-a&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-a)),c>0&&(g.data=wn(g.data,t.subarray(0,c)),g.state=0))}l<i?(d=this.getNALuType(t,l),h=l,f=d,s=0):s=-1}else s=0}if(h>=0&&s>=0){const g={data:t.subarray(h,i),type:f,state:s};o.push(g)}if(o.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=wn(g.data,t))}return e.naluState=s,o}}class fo{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Re.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class sy extends nT{parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let a=this.VideoSample,o,l=!1;r.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(u=>{var c,d;switch(u.type){case 1:{let m=!1;o=!0;const p=u.data;if(l&&p.length>4){const y=this.readSliceType(p);(y===2||y===4||y===7||y===9)&&(m=!0)}if(m){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.frame=!0,a.key=m;break}case 5:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,Hg(u.data,1,r.pts,t.samples);break}case 7:{var f,g;o=!0,l=!0;const m=u.data,p=this.readSPS(m);if(!e.sps||e.width!==p.width||e.height!==p.height||((f=e.pixelRatio)==null?void 0:f[0])!==p.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==p.pixelRatio[1]){e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[m];const y=m.subarray(1,4);let v="avc1.";for(let E=0;E<3;E++){let _=y[E].toString(16);_.length<2&&(_="0"+_),v+=_}e.codec=v}break}case 8:o=!0,e.pps=[u.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(u)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new fo(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r=8,i=8,s;for(let a=0;a<e;a++)i!==0&&(s=t.readEG(),i=(r+s+256)%256),r=i===0?r:i}readSPS(e){const t=new fo(e);let r=0,i=0,s=0,a=0,o,l,u;const c=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),f=t.readBoolean.bind(t),g=t.skipBits.bind(t),m=t.skipEG.bind(t),p=t.skipUEG.bind(t),y=this.skipScalingList.bind(this);c();const v=c();if(d(5),g(3),c(),p(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){const T=h();if(T===3&&g(1),p(),p(),g(1),f())for(l=T!==3?8:12,u=0;u<l;u++)f()&&(u<6?y(16,t):y(64,t))}p();const E=h();if(E===0)h();else if(E===1)for(g(1),m(),m(),o=h(),u=0;u<o;u++)m();p(),g(1);const _=h(),L=h(),R=d(1);R===0&&g(1),g(1),f()&&(r=h(),i=h(),s=h(),a=h());let A=[1,1];if(f()&&f())switch(c()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((_+1)*16-r*2-i*2),height:(2-R)*(L+1)*16-(R?2:4)*(s+a),pixelRatio:A}}}class ay extends nT{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,i){const s=this.parseNALu(e,r.data,i);let a=this.VideoSample,o,l=!1;r.data=null,a&&s.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var h;(h=a)!=null&&h.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,Hg(u.data,2,r.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Oe(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const f=this.readSPS(u.data);e.width=f.width,e.height=f.height,e.pixelRatio=f.pixelRatio,e.codec=f.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in f.params)e.params[g]=f.params[g]}this.pushParameterSet(e.sps,u.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const f=this.readPPS(u.data);for(const g in f)e.params[g]=f[g]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:o=!1;break}a&&o&&a.units.push(u)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[r]=e[i],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new fo(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const r=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:r+1,temporalIdNested:i}}readSPS(e){const t=new fo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const i=t.readBits(2),s=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),g=t.readUByte(),m=t.readUByte(),p=t.readUByte(),y=t.readUByte(),v=[],E=[];for(let Te=0;Te<r;Te++)v.push(t.readBoolean()),E.push(t.readBoolean());if(r>0)for(let Te=r;Te<8;Te++)t.readBits(2);for(let Te=0;Te<r;Te++)v[Te]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[Te]&&t.readUByte();t.readUEG();const _=t.readUEG();_==3&&t.skipBits(1);const L=t.readUEG(),R=t.readUEG(),A=t.readBoolean();let T=0,w=0,I=0,M=0;A&&(T+=t.readUEG(),w+=t.readUEG(),I+=t.readUEG(),M+=t.readUEG());const j=t.readUEG(),z=t.readUEG(),K=t.readUEG(),W=t.readBoolean();for(let Te=W?0:r;Te<=r;Te++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let yt=0;yt<4;yt++)for(let ot=0;ot<(yt===3?2:6);ot++)if(!t.readBoolean())t.readUEG();else{const Jt=Math.min(64,1<<4+(yt<<1));yt>1&&t.readEG();for(let yr=0;yr<Jt;yr++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const $=t.readUEG();let F=0;for(let Te=0;Te<$;Te++){let yt=!1;if(Te!==0&&(yt=t.readBoolean()),yt){Te===$&&t.readUEG(),t.readBoolean(),t.readUEG();let ot=0;for(let pr=0;pr<=F;pr++){const Jt=t.readBoolean();let yr=!1;Jt||(yr=t.readBoolean()),(Jt||yr)&&ot++}F=ot}else{const ot=t.readUEG(),pr=t.readUEG();F=ot+pr;for(let Jt=0;Jt<ot;Jt++)t.readUEG(),t.readBoolean();for(let Jt=0;Jt<pr;Jt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Te=t.readUEG();for(let yt=0;yt<Te;yt++){for(let ot=0;ot<K+4;ot++)t.readBits(1);t.readBits(1)}}let Q=0,Y=1,oe=1,de=!0,pe=1,he=0;t.readBoolean(),t.readBoolean();let Fe=!1;if(t.readBoolean()){if(t.readBoolean()){const vr=t.readUByte(),rl=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ms=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];vr>0&&vr<16?(Y=rl[vr-1],oe=ms[vr-1]):vr===255&&(Y=t.readBits(16),oe=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Fe=t.readBoolean(),Fe&&(T+=t.readUEG(),w+=t.readUEG(),I+=t.readUEG(),M+=t.readUEG()),t.readBoolean()&&(pe=t.readBits(32),he=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const ms=t.readBoolean(),il=t.readBoolean();let en=!1;(ms||il)&&(en=t.readBoolean(),en&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),en&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Gr=0;Gr<=r;Gr++){de=t.readBoolean();const sl=de||t.readBoolean();let ps=!1;sl?t.readEG():ps=t.readBoolean();const Dn=ps?1:t.readUEG()+1;if(ms)for(let Ot=0;Ot<Dn;Ot++)t.readUEG(),t.readUEG(),en&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(il)for(let Ot=0;Ot<Dn;Ot++)t.readUEG(),t.readUEG(),en&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),Q=t.readUEG())}let Wn=L,Mi=R;if(A||Fe){let Te=1,yt=1;_===1?Te=yt=2:_==2&&(Te=2),Wn=L-Te*w-Te*T,Mi=R-yt*M-yt*I}const Wc=i?["A","B","C"][i]:"",qc=o<<24|l<<16|u<<8|c;let Ca=0;for(let Te=0;Te<32;Te++)Ca=(Ca|(qc>>Te&1)<<31-Te)>>>0;let dt=Ca.toString(16);return a===1&&dt==="2"&&(dt="6"),{codecString:`hvc1.${Wc}${a}.${dt}.${s?"H":"L"}${y}.B0`,params:{general_tier_flag:s,general_profile_idc:a,general_profile_space:i,general_profile_compatibility_flags:[o,l,u,c],general_constraint_indicator_flags:[d,h,f,g,m,p],general_level_idc:y,bit_depth:j+8,bit_depth_luma_minus8:j,bit_depth_chroma_minus8:z,min_spatial_segmentation_idc:Q,chroma_format_idc:_,frame_rate:{fixed:de,fps:he/pe}},width:Wn,height:Mi,pixelRatio:[Y,oe]}}readPPS(e){const t=new fo(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),s=t.readBoolean();let a=1;return s&&i?a=0:s?a=3:i&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Et=188;class ei{constructor(e,t,r,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.videoParser=null}static probe(e,t){const r=ei.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(e){const t=e.length;let r=Math.min(Et*5,t-Et)+1,i=0;for(;i<r;){let s=!1,a=-1,o=0;for(let l=i;l<t;l+=Et)if(e[l]===71&&(t-l===Et||e[l+Et]===71)){if(o++,a===-1&&(a=l,a!==0&&(r=Math.min(a+Et*99,e.length-Et)+1)),s||(s=If(e,l)===0),s&&o>1&&(a===0&&o>2||l+Et>r))return a}else{if(o)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:dx[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ei.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=ei.createTrack("audio",i),this._id3Track=ei.createTrack("id3"),this._txtTrack=ei.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,i=!1){r||(this.sampleAes=null);let s;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=a.pid,d=a.pesData,h=o.pid,f=l.pid,g=o.pesData,m=l.pesData,p=null,y=this.pmtParsed,v=this._pmtId,E=e.length;if(this.remainderData&&(e=wn(this.remainderData,e),E=e.length,this.remainderData=null),E<Et&&!i)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};const _=Math.max(0,ei.syncOffset(e));E-=(E-_)%Et,E<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let L=0;for(let A=_;A<E;A+=Et)if(e[A]===71){const T=!!(e[A+1]&64),w=If(e,A),I=(e[A+3]&48)>>4;let M;if(I>1){if(M=A+5+e[A+4],M===A+Et)continue}else M=A+4;switch(w){case c:if(T){if(d&&(s=Ts(d,this.logger))){if(this.videoParser===null)switch(a.segmentCodec){case"avc":this.videoParser=new sy;break;case"hevc":this.videoParser=new ay;break}this.videoParser!==null&&this.videoParser.parsePES(a,u,s,!1)}d={data:[],size:0}}d&&(d.data.push(e.subarray(M,A+Et)),d.size+=A+Et-M);break;case h:if(T){if(g&&(s=Ts(g,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break;case"ac3":this.parseAC3PES(o,s);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(M,A+Et)),g.size+=A+Et-M);break;case f:T&&(m&&(s=Ts(m,this.logger))&&this.parseID3PES(l,s),m={data:[],size:0}),m&&(m.data.push(e.subarray(M,A+Et)),m.size+=A+Et-M);break;case 0:T&&(M+=e[M]+1),v=this._pmtId=ZO(e,M);break;case v:{T&&(M+=e[M]+1);const j=JO(e,M,this.typeSupported,r,this.observer,this.logger);c=j.videoPid,c>0&&(a.pid=c,a.segmentCodec=j.segmentVideoCodec),h=j.audioPid,h>0&&(o.pid=h,o.segmentCodec=j.segmentAudioCodec),f=j.id3Pid,f>0&&(l.pid=f),p!==null&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${p}'. Backtracking to sync byte @${_} to parse all TS packets.`),p=null,A=_-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=w;break}}else L++;L>0&&wf(this.observer,new Error(`Found ${L} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=g,l.pesData=m;const R={audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};return i&&this.extractRemainingSamples(R),R}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:s}=e,a=r.pesData,o=t.pesData,l=i.pesData;let u;if(a&&(u=Ts(a,this.logger))){if(this.videoParser===null)switch(r.segmentCodec){case"avc":this.videoParser=new sy;break;case"hevc":this.videoParser=new ay;break}this.videoParser!==null&&(this.videoParser.parsePES(r,s,u,!0),r.pesData=null)}else r.pesData=a;if(o&&(u=Ts(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(u=Ts(l,this.logger))?(this.parseID3PES(i,u),i.pesData=null):i.pesData=l}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new XO(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(r=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const d=i.missing,h=i.sample.unit.byteLength;if(d===-1)s=wn(i.sample.unit,s);else{const f=h-d;i.sample.unit.set(s.subarray(0,d),f),e.samples.push(i.sample),r=i.missing}}let a,o;for(a=r,o=s.length;a<o-1&&!yc(s,a);a++);if(a!==r){let d;const h=a<o-1;if(h?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",wf(this.observer,new Error(d),h,this.logger),!h)return}Kx(e,this.observer,s,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(i){const d=zx(e.samplerate);l=i.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;a<o;)if(c=Wx(e,s,a,l,u),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;a<o-1&&!yc(s,a);a++);}parseMPEGPES(e,t){const r=t.data,i=r.length;let s=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(Zx(r,a)){const l=Qx(e,r,a,o,s);if(l)a+=l.length,s++;else break}else a++}parseAC3PES(e,t){{const r=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=r.length;let a=0,o=0,l;for(;o<s&&(l=tT(e,r,o,i,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=Oe({},t,{type:this._videoTrack?on.emsg:on.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function If(n,e){return((n[e+1]&31)<<8)+n[e+2]}function ZO(n,e){return(n[e+10]&31)<<8|n[e+11]}function JO(n,e,t,r,i,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],l=e+3+o-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<l;){const c=If(n,e),d=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){Yd("ADTS AAC",s);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!r){Yd("H.264",s);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?s.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!r){Yd("AC-3",s);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let h=e+5,f=d;for(;f>2;){switch(n[h]){case 106:t.ac3!==!0?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3");break}const m=n[h+1]+2;h+=m,f-=m}}break;case 194:case 135:return wf(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"));break}e+=d+5}return a}function wf(n,e,t,r){r.warn(`parsing error: ${e.message}`),n.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Yd(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Ts(n,e){let t=0,r,i,s,a,o;const l=n.data;if(!n||n.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=wn(l[0],l[1]),l.splice(1,1);if(r=l[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(i=(r[4]<<8)+r[5],i&&i>n.size-6)return null;const c=r[7];c&192&&(a=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(o=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),s=r[8];let d=s+9;if(n.size<=d)return null;n.size-=d;const h=new Uint8Array(n.size);for(let f=0,g=l.length;f<g;f++){r=l[f];let m=r.byteLength;if(d)if(d>m){d-=m;continue}else r=r.subarray(d),m-=d,d=0;h.set(r,t),t+=m}return i&&(i-=s+3),{data:h,pts:a,dts:o,len:i}}return null}class eF{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Wr=Math.pow(2,32)-1;class P{static init(){P.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in P.types)P.types.hasOwnProperty(e)&&(P.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);P.HDLR_TYPES={video:t,audio:r};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);P.STTS=P.STSC=P.STCO=s,P.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),P.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),P.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),P.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);P.FTYP=P.box(P.types.ftyp,a,l,a,o),P.DINF=P.box(P.types.dinf,P.box(P.types.dref,i))}static box(e,...t){let r=8,i=t.length;const s=i;for(;i--;)r+=t[i].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),i=0,r=8;i<s;i++)a.set(t[i],r),r+=t[i].byteLength;return a}static hdlr(e){return P.box(P.types.hdlr,P.HDLR_TYPES[e])}static mdat(e){return P.box(P.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(Wr+1)),i=Math.floor(t%(Wr+1));return P.box(P.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return P.box(P.types.mdia,P.mdhd(e.timescale||0,e.duration||0),P.hdlr(e.type),P.minf(e))}static mfhd(e){return P.box(P.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?P.box(P.types.minf,P.box(P.types.smhd,P.SMHD),P.DINF,P.stbl(e)):P.box(P.types.minf,P.box(P.types.vmhd,P.VMHD),P.DINF,P.stbl(e))}static moof(e,t,r){return P.box(P.types.moof,P.mfhd(e),P.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=P.trak(e[t]);return P.box.apply(null,[P.types.moov,P.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(P.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=P.trex(e[t]);return P.box.apply(null,[P.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(Wr+1)),i=Math.floor(t%(Wr+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return P.box(P.types.mvhd,s)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,r[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return P.box(P.types.sdtp,r)}static stbl(e){return P.box(P.types.stbl,P.stsd(e),P.box(P.types.stts,P.STTS),P.box(P.types.stsc,P.STSC),P.box(P.types.stsz,P.STSZ),P.box(P.types.stco,P.STCO))}static avc1(e){let t=[],r=[],i,s,a;for(i=0;i<e.sps.length;i++)s=e.sps[i],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],a=s.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(s));const o=P.box(P.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return P.box(P.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,P.box(P.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),P.box(P.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return P.box(P.types.mp4a,P.audioStsd(e),P.box(P.types.esds,P.esds(e)))}static mp3(e){return P.box(P.types[".mp3"],P.audioStsd(e))}static ac3(e){return P.box(P.types["ac-3"],P.audioStsd(e),P.box(P.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return P.box(P.types.stsd,P.STSD,P.mp4a(e));if(t==="ac3"&&e.config)return P.box(P.types.stsd,P.STSD,P.ac3(e));if(t==="mp3"&&e.codec==="mp3")return P.box(P.types.stsd,P.STSD,P.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return P.box(P.types.stsd,P.STSD,P.avc1(e));if(t==="hevc"&&e.vps)return P.box(P.types.stsd,P.STSD,P.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),i=e.width||0,s=e.height||0,a=Math.floor(r/(Wr+1)),o=Math.floor(r%(Wr+1));return P.box(P.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const r=P.sdtp(e),i=e.id,s=Math.floor(t/(Wr+1)),a=Math.floor(t%(Wr+1));return P.box(P.types.traf,P.box(P.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),P.box(P.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),P.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,P.box(P.types.trak,P.tkhd(e),P.mdia(e))}static trex(e){const t=e.id;return P.box(P.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],i=r.length,s=12+16*i,a=new Uint8Array(s);let o,l,u,c,d,h;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<i;o++)l=r[o],u=l.duration,c=l.size,d=l.flags,h=l.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*o);return P.box(P.types.trun,a)}static initSegment(e){P.types||P.init();const t=P.moov(e);return wn(P.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],i=4,s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let a=s.length;for(let g=0;g<r.length;g+=1){a+=3;for(let m=0;m<r[g].length;m+=1)a+=2+r[g][m].length}const o=new Uint8Array(a);o.set(s,0),a=s.length;const l=r.length-1;for(let g=0;g<r.length;g+=1){o.set(new Uint8Array([32+g|(g===l?128:0),0,r[g].length]),a),a+=3;for(let m=0;m<r[g].length;m+=1)o.set(new Uint8Array([r[g][m].length>>8,r[g][m].length&255]),a),a+=2,o.set(r[g][m],a),a+=r[g][m].length}const u=P.box(P.types.hvcC,o),c=e.width,d=e.height,h=e.pixelRatio[0],f=e.pixelRatio[1];return P.box(P.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,P.box(P.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),P.box(P.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,f>>24,f>>16&255,f>>8&255,f&255])))}}P.types=void 0;P.HDLR_TYPES=void 0;P.STTS=void 0;P.STSC=void 0;P.STCO=void 0;P.STSZ=void 0;P.VMHD=void 0;P.SMHD=void 0;P.STSD=void 0;P.FTYP=void 0;P.DINF=void 0;const rT=9e4;function rm(n,e,t=1,r=!1){const i=n*e*t;return r?Math.round(i):i}function tF(n,e,t=1,r=!1){return rm(n,e,1/t,r)}function Ka(n,e=!1){return rm(n,1e3,1/rT,e)}function nF(n,e=1){return rm(n,rT,1/e)}const rF=10*1e3,iF=1024,sF=1152,aF=1536;let _s=null,Qd=null;function oy(n,e,t,r){return{duration:e,size:t,cts:r,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class Iu{constructor(e,t,r,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.ISGenerated=!1,_s===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);_s=a?parseInt(a[1]):0}if(Qd===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Qd=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,i=e.reduce((s,a)=>{let o=a.pts,l=o-s;return l<-4294967296&&(t=!0,o=Sn(o,r),l=o-s),l>0?s:o},r);return t&&this.logger.debug("PTS rollover detected"),i}remux(e,t,r,i,s,a,o,l){let u,c,d,h,f,g,m=s,p=s;const y=e.pid>-1,v=t.pid>-1,E=t.samples.length,_=e.samples.length>0,L=o&&E>0||E>1;if((!y||_)&&(!v||L)||this.ISGenerated||o){if(this.ISGenerated){var A,T,w,I;const K=this.videoTrackConfig;(K&&(t.width!==K.width||t.height!==K.height||((A=t.pixelRatio)==null?void 0:A[0])!==((T=K.pixelRatio)==null?void 0:T[0])||((w=t.pixelRatio)==null?void 0:w[1])!==((I=K.pixelRatio)==null?void 0:I[1]))||!K&&L||this.nextAudioPts===null&&_)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,s,a));const M=this.isVideoContiguous;let j=-1,z;if(L&&(j=oF(t.samples),!M&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,j>0){this.logger.warn(`[mp4-remuxer]: Dropped ${j} out of ${E} video samples due to a missing keyframe`);const K=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(j),t.dropped+=j,p+=(t.samples[0].pts-K)/t.inputTimeScale,z=p}else j===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${E} video samples`),g=!1);if(this.ISGenerated){if(_&&L){const K=this.getVideoStartPts(t.samples),H=(Sn(e.samples[0].pts,K)-K)/t.inputTimeScale;m+=Math.max(0,H),p+=Math.max(0,-H)}if(_){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,a)),c=this.remuxAudio(e,m,this.isAudioContiguous,a,v||L||l===ne.AUDIO?p:void 0),L){const K=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,a)),u=this.remuxVideo(t,p,M,K)}}else L&&(u=this.remuxVideo(t,p,M,0));u&&(u.firstKeyFrame=j,u.independent=j!==-1,u.firstKeyFramePTS=z)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(f=iT(r,s,this._initPTS,this._initDTS)),i.samples.length&&(h=sT(i,s,this._initPTS))),{audio:c,video:u,initSegment:d,independent:g,text:h,id3:f}}generateIS(e,t,r,i){const s=e.samples,a=t.samples,o=this.typeSupported,l={},u=this._initPTS;let c=!u||i,d="audio/mp4",h,f,g,m;if(c&&(h=f=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):P.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(m=e.id,g=e.inputTimeScale,!u||g!==u.timescale?h=f=s[0].pts-Math.round(g*r):c=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:P.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(m=t.id,g=t.inputTimeScale,!u||g!==u.timescale){const p=this.getVideoStartPts(a),y=Math.round(g*r);f=Math.min(f,Sn(a[0].dts,p)-y),h=Math.min(h,p-y)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:h,timescale:g},this._initDTS={baseTime:f,timescale:g}):h=g=void 0,{tracks:l,initPTS:h,timescale:g,trackId:m}}remuxVideo(e,t,r,i){const s=e.inputTimeScale,a=e.samples,o=[],l=a.length,u=this._initPTS;let c=this.nextAvcDts,d=8,h=this.videoSampleDuration,f,g,m=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,y=!1;if(!r||c===null){const F=t*s,U=a[0].pts-Sn(a[0].dts,a[0].pts);_s&&c!==null&&Math.abs(F-U-c)<15e3?r=!0:c=F-U}const v=u.baseTime*s/u.timescale;for(let F=0;F<l;F++){const U=a[F];U.pts=Sn(U.pts-v,c),U.dts=Sn(U.dts-v,c),U.dts<a[F>0?F-1:F].dts&&(y=!0)}y&&a.sort(function(F,U){const Q=F.dts-U.dts,Y=F.pts-U.pts;return Q||Y}),f=a[0].dts,g=a[a.length-1].dts;const E=g-f,_=E?Math.round(E/(l-1)):h||e.inputTimeScale/30;if(r){const F=f-c,U=F>_,Q=F<-1;if((U||Q)&&(U?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ka(F,!0)} ms (${F}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ka(-F,!0)} ms (${F}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Q||c>=a[0].pts||_s)){f=c;const Y=a[0].pts-F;if(U)a[0].dts=f,a[0].pts=Y;else{let oe=!0;for(let de=0;de<a.length&&!(a[de].dts>Y&&oe);de++){const pe=a[de].pts;if(a[de].dts-=F,a[de].pts-=F,de<a.length-1){const he=a[de+1].pts,Fe=a[de].pts,Ze=he<=Fe,Wn=he<=pe;oe=Ze==Wn}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${Ka(Y,!0)}/${Ka(f,!0)}, delta: ${Ka(F,!0)} ms`)}}f=Math.max(0,f);let L=0,R=0,A=f;for(let F=0;F<l;F++){const U=a[F],Q=U.units,Y=Q.length;let oe=0;for(let de=0;de<Y;de++)oe+=Q[de].data.length;R+=oe,L+=Y,U.length=oe,U.dts<A?(U.dts=A,A+=_/4|0||1):A=U.dts,m=Math.min(U.pts,m),p=Math.max(U.pts,p)}g=a[l-1].dts;const T=R+4*L+8;let w;try{w=new Uint8Array(T)}catch(F){this.observer.emit(S.ERROR,S.ERROR,{type:re.MUX_ERROR,details:O.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:T,reason:`fail allocating video mdat ${T}`});return}const I=new DataView(w.buffer);I.setUint32(0,T),w.set(P.types.mdat,4);let M=!1,j=Number.POSITIVE_INFINITY,z=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,W=Number.NEGATIVE_INFINITY;for(let F=0;F<l;F++){const U=a[F],Q=U.units;let Y=0;for(let pe=0,he=Q.length;pe<he;pe++){const Fe=Q[pe],Ze=Fe.data,Wn=Fe.data.byteLength;I.setUint32(d,Wn),d+=4,w.set(Ze,d),d+=Wn,Y+=4+Wn}let oe;if(F<l-1)h=a[F+1].dts-U.dts,oe=a[F+1].pts-U.pts;else{const pe=this.config,he=F>0?U.dts-a[F-1].dts:_;if(oe=F>0?U.pts-a[F-1].pts:_,pe.stretchShortVideoTrack&&this.nextAudioPts!==null){const Fe=Math.floor(pe.maxBufferHole*s),Ze=(i?m+i*s:this.nextAudioPts)-U.pts;Ze>Fe?(h=Ze-he,h<0?h=he:M=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${Ze/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=he}else h=he}const de=Math.round(U.pts-U.dts);j=Math.min(j,h),K=Math.max(K,h),z=Math.min(z,oe),W=Math.max(W,oe),o.push(oy(U.key,h,Y,de))}if(o.length){if(_s){if(_s<70){const F=o[0].flags;F.dependsOn=2,F.isNonSync=0}}else if(Qd&&W-z<K-j&&_/K<.025&&o[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let F=f;for(let U=0,Q=o.length;U<Q;U++){const Y=F+o[U].duration,oe=F+o[U].cts;if(U<Q-1){const de=Y+o[U+1].cts;o[U].duration=de-oe}else o[U].duration=U?o[U-1].duration:_;o[U].cts=0,F=Y}}}h=M||!h?_:h,this.nextAvcDts=c=g+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;const $={data1:P.moof(e.sequenceNumber++,f,Oe(e,{samples:o})),data2:w,startPTS:m/s,endPTS:(p+h)/s,startDTS:f/s,endDTS:c/s,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,$}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return sF;case"ac3":return aF;default:return iF}}remuxAudio(e,t,r,i,s){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],g=s!==void 0;let m=e.samples,p=h?0:8,y=this.nextAudioPts||-1;const v=t*a,E=d.baseTime*a/d.timescale;if(this.isAudioContiguous=r=r||m.length&&y>0&&(i&&Math.abs(v-y)<9e3||Math.abs(Sn(m[0].pts-E,v)-y)<20*c),m.forEach(function(H){H.pts=Sn(H.pts-E,v)}),!r||y<0){if(m=m.filter(H=>H.pts>=0),!m.length)return;s===0?y=0:i&&!g?y=Math.max(0,v):y=m[0].pts}if(e.segmentCodec==="aac"){const H=this.config.maxAudioFramesDrift;for(let X=0,$=y;X<m.length;X++){const F=m[X],U=F.pts,Q=U-$,Y=Math.abs(1e3*Q/a);if(Q<=-H*c&&g)X===0&&(this.logger.warn(`Audio frame @ ${(U/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Q/a)} ms.`),this.nextAudioPts=y=$=U);else if(Q>=H*c&&Y<rF&&g){let oe=Math.round(Q/c);$=U-oe*c,$<0&&(oe--,$+=c),X===0&&(this.nextAudioPts=y=$),this.logger.warn(`[mp4-remuxer]: Injecting ${oe} audio frame @ ${($/a).toFixed(3)}s due to ${Math.round(1e3*Q/a)} ms gap.`);for(let de=0;de<oe;de++){const pe=Math.max($,0);let he=eF.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);he||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),he=F.unit.subarray()),m.splice(X,0,{unit:he,pts:pe}),$+=c,X++}}F.pts=$,$+=c}}let _=null,L=null,R,A=0,T=m.length;for(;T--;)A+=m[T].unit.byteLength;for(let H=0,X=m.length;H<X;H++){const $=m[H],F=$.unit;let U=$.pts;if(L!==null){const Y=f[H-1];Y.duration=Math.round((U-L)/l)}else if(r&&e.segmentCodec==="aac"&&(U=y),_=U,A>0){A+=p;try{R=new Uint8Array(A)}catch(Y){this.observer.emit(S.ERROR,S.ERROR,{type:re.MUX_ERROR,details:O.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:A,reason:`fail allocating audio mdat ${A}`});return}h||(new DataView(R.buffer).setUint32(0,A),R.set(P.types.mdat,4))}else return;R.set(F,p);const Q=F.byteLength;p+=Q,f.push(oy(!0,u,Q,0)),L=U}const w=f.length;if(!w)return;const I=f[f.length-1];this.nextAudioPts=y=L+l*I.duration;const M=h?new Uint8Array(0):P.moof(e.sequenceNumber++,_/l,Oe({},e,{samples:f}));e.samples=[];const j=_/a,z=y/a,W={data1:M,data2:R,startPTS:j,endPTS:z,startDTS:j,endDTS:z,type:"audio",hasAudio:!0,hasVideo:!1,nb:w};return this.isAudioContiguous=!0,W}}function Sn(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function oF(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function iT(n,e,t,r){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let o=0;o<i;o++){const l=n.samples[o];l.pts=Sn(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=Sn(l.dts-r.baseTime*s/r.timescale,e*s)/s}const a=n.samples;return n.samples=[],{samples:a}}function sT(n,e,t){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let a=0;a<r;a++){const o=n.samples[a];o.pts=Sn(o.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((a,o)=>a.pts-o.pts);const s=n.samples;return n.samples=[],{samples:s}}class lF{constructor(e,t,r,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1,this.logger=i}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(nP(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const i=this.initData=gx(e);i.audio&&(t=ly(i.audio,$e.AUDIO,this.logger)),i.video&&(r=ly(i.video,$e.VIDEO,this.logger));const s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+r,supplemental:i.video.supplemental,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:r,supplemental:i.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,r,i,s,a){var o,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};Z(c)||(c=this.lastEndTime=s||0);const h=t.samples;if(!(h!=null&&h.length))return d;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((o=g)!=null&&o.length||(this.generateInitSegment(h),g=this.initData),!((l=g)!=null&&l.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const m=rP(h,g,this.logger),p=g.audio?m[g.audio.id]:null,y=g.video?m[g.video.id]:null,v=tu(y,1/0),E=tu(p,1/0),_=tu(y,0,!0),L=tu(p,0,!0);let R,A=s,T=0;if(p&&(!y||!u&&E<v||u&&u.trackId===g.audio.id)?(f.trackId=g.audio.id,R=p,T=L-E):y&&(f.trackId=g.video.id,R=y,T=_-v),R){const H=R.timescale;A=R.start/H,f.timescale=H,u||(f.initPTS=R.start-s*H,this.initPTS=u={baseTime:f.initPTS,timescale:H,trackId:f.trackId})}(a||!u)&&(uF(u,A,s,T)||f.timescale!==u.timescale)&&(f.initPTS=A-s,u&&u.timescale===1&&this.logger.warn(`Adjusting initPTS @${s} from ${u.baseTime/u.timescale} to ${f.initPTS}`),this.initPTS=u={baseTime:f.initPTS,timescale:1});const w=e?A-u.baseTime/u.timescale:c;iP(g,h,u.baseTime/u.timescale);const I=w+T;T>0?this.lastEndTime=I:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const M=!!g.audio,j=!!g.video;let z="";M&&(z+="audio"),j&&(z+="video");const K={data1:h,startPTS:w,startDTS:w,endPTS:I,endDTS:I,type:z,hasAudio:M,hasVideo:j,nb:1,dropped:0};d.audio=M&&!j?K:void 0,d.video=j?K:void 0;const W=y==null?void 0:y.sampleCount;if(W){const H=y.keyFrameIndex,X=H!==-1;K.nb=W,K.dropped=H===0||this.isVideoContiguous?0:X?H:W,K.independent=X,K.firstKeyFrame=H,X&&y.keyFrameStart&&(K.firstKeyFramePTS=y.keyFrameStart-u.baseTime/u.timescale),this.isVideoContiguous||(d.independent=X),this.isVideoContiguous||(this.isVideoContiguous=X),K.dropped&&this.logger.warn(`fmp4 does not start with IDR: firstIDR ${H}/${W} dropped: ${K.dropped} pts: ${K.firstKeyFramePTS||"NA"}`)}return d.initSegment=f,d.id3=iT(r,s,u,u),i.samples.length&&(d.text=sT(i,s,u)),d}}function tu(n,e,t=!1){return(n==null?void 0:n.start)!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function uF(n,e,t,r){if(n===null)return!0;const i=Math.max(r,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>i}function ly(n,e,t){const r=n==null?void 0:n.codec;return r&&r.length>4?r:e===$e.AUDIO?r==="ec-3"||r==="ac-3"||r==="alac"?r:r==="fLaC"||r==="Opus"?cc(r,!1):(t.warn(`Unhandled audio codec "${r}" in mp4 MAP`),r||"mp4a"):(t.warn(`Unhandled video codec "${r}" in mp4 MAP`),r||"avc1")}let Ir;try{Ir=self.performance.now.bind(self.performance)}catch{Ir=Date.now}const wu=[{demux:QO,remux:lF},{demux:ei,remux:Iu},{demux:zO,remux:Iu},{demux:qO,remux:Iu}];wu.splice(2,0,{demux:WO,remux:Iu});class uy{constructor(e,t,r,i,s,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=s,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const s=r.transmuxing;s.executeStart=Ir();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;i&&(this.currentTransmuxState=i);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:f,initSegmentChange:g}=i||o,{audioCodec:m,videoCodec:p,defaultInitPts:y,duration:v,initSegmentData:E}=l,_=cF(a,t);if(_&&Ys(_.method)){const T=this.getDecrypter(),w=qg(_.method);if(T.isSync()){let I=T.softwareDecrypt(a,_.key.buffer,_.iv.buffer,w);if(r.part>-1){const j=T.flush();I=j&&j.buffer}if(!I)return s.executeEnd=Ir(),Xd(r);a=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=T.webCryptoDecrypt(a,_.key.buffer,_.iv.buffer,w).then(I=>{const M=this.push(I,null,r);return this.decryptionPromise=null,M}),this.decryptionPromise}const L=this.needsProbing(c,d);if(L){const T=this.configureTransmuxer(a);if(T)return this.logger.warn(`[transmuxer] ${T.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,error:T,reason:T.message}),s.executeEnd=Ir(),Xd(r)}(c||d||g||L)&&this.resetInitSegment(E,m,p,v,t),(c||g||L)&&this.resetInitialTimestamp(y),u||this.resetContiguity();const R=this.transmux(a,_,f,h,r);this.asyncResult=jo(R);const A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=Ir(),R}flush(e){const t=e.transmuxing;t.executeStart=Ir();const{decrypter:r,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return this.asyncResult=!0,s.then(()=>this.flush(e));const a=[],{timeOffset:o}=i;if(r){const d=r.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=Ir();const d=[Xd(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(o);return jo(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===ne.MAIN?"level":"track"} ${r.level}`);const c=this.remuxer.remux(i,s,a,o,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=Ir()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,s){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,r,i),o.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,r,i,s):a=this.transmuxUnencrypted(e,r,i,s),a}transmuxUnencrypted(e,t,r,i){const{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,o,l,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,s){return this.demuxer.demuxSampleAes(e,t,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i}=this;let s;for(let d=0,h=wu.length;d<h;d++){var a;if((a=wu[d].demux)!=null&&a.probe(e,this.logger)){s=wu[d];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=s.remux,c=s.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(r,t,i,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(r,t,i,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new zg(this.config)),e}}function cF(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Xd=n=>({remuxResult:{},chunkMeta:n});function jo(n){return"then"in n&&n.then instanceof Function}class dF{constructor(e,t,r,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=s||null}}class hF{constructor(e,t,r,i,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=a}}let cy=0;class aT{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=cy++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const h=(d=this.workerContext)==null?void 0:d.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const a=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===S.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new Xg,this.observer.on(S.FRAG_DECRYPTED,a),this.observer.on(S.ERROR,a);const o=R0(s.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(s.workerPath||vO()){try{s.workerPath?(l.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=SO(s.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=EO());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:Ke(s)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new uy(this.observer,o,s,"",t,e.logger)}return}}this.transmuxer=new uy(this.observer,o,s,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=cy++;const t=this.hls.config,r=R0(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:Ke(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),xO(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,i,s,a,o,l,u,c){var d,h;u.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:g}=this,m=a?a.start:s.start,p=s.decryptdata,y=this.frag,v=!(y&&s.cc===y.cc),E=!(y&&u.level===y.level),_=y?u.sn-y.sn:-1,L=this.part?u.part-this.part.index:-1,R=_===0&&u.id>1&&u.id===(y==null?void 0:y.stats.chunkCount),A=!E&&(_===1||_===0&&(L===1||R&&L<=0)),T=self.performance.now();(E||_||s.stats.parsing.start===0)&&(s.stats.parsing.start=T),a&&(L||!A)&&(a.stats.parsing.start=T);const w=!(y&&((d=s.initSegment)==null?void 0:d.url)===((h=y.initSegment)==null?void 0:h.url)),I=new hF(v,A,l,E,m,w);if(!A||v||w){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${s.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===ne.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${v}
        trackSwitch: ${E}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${w}`);const M=new dF(r,i,t,o,c);this.configureTransmuxer(M)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:p,chunkMeta:u,state:I},e instanceof ArrayBuffer?[e]:[]);else if(g){const M=g.push(e,p,u,I);jo(M)?M.then(j=>{this.handleTransmuxComplete(j)}).catch(j=>{this.transmuxerError(j,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(M)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const i=r.flush(e);jo(i)?i.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const dy=100;class fF extends Qg{constructor(e,t,r){super(e,t,r,"audio-stream-controller",ne.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){if(r===ne.MAIN){const a=t.cc,o=this.fragCurrent;if(this.initPTS[a]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${a} found from main: ${i}/${s}`),this.mainAnchor=t,this.state===B.WAITING_INIT_PTS){const l=this.waitingData;(!l&&!this.loadingParts||l&&l.frag.cc!==a)&&this.syncWithAnchor(t,l==null?void 0:l.frag)}else!this.hls.hasEnoughToStart&&o&&o.cc!==a?(o.abortRequests(),this.syncWithAnchor(t,o)):this.state===B.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const i=((r=this.mainFragLoading)==null?void 0:r.frag)||null;if(t&&(i==null?void 0:i.cc)===t.cc)return;const s=(i||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=Rx(a,s,o);l&&(this.log(`Waiting fragment cc (${t==null?void 0:t.cc}) cancelled because video is at cc ${e.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===B.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=B.STOPPED;return}const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(dy),r>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=B.IDLE):this.state=B.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case B.IDLE:this.doTickIdle();break;case B.WAITING_TRACK:{const{levels:t,trackId:r}=this,i=t==null?void 0:t[r],s=i==null?void 0:i.details;if(s&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(s))break;this.state=B.WAITING_INIT_PTS}break}case B.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:i,trackId:s}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((i==null?void 0:i[s])||null),this.state=B.IDLE}break}case B.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:r,part:i,cache:s,complete:a}=t,o=this.mainAnchor;if(this.initPTS[r.cc]!==void 0){this.waitingData=null,this.state=B.FRAG_LOADING;const l=s.flush().buffer,u={frag:r,part:i,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),a&&super._handleFragmentLoadComplete(u)}else o&&o.cc!==t.frag.cc&&this.syncWithAnchor(o,t.frag)}else this.state=B.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:i,trackId:s}=this,a=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(r!=null&&r[s]))return;const o=r[s],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=B.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,$e.AUDIO,ne.AUDIO));const c=this.getFwdBufferInfo(u,ne.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=B.ENDED;return}const d=c.len,h=t.maxBufferLength,f=l.fragments,g=f[0].start,m=this.getLoadPosition(),p=this.flushing?m:c.end;if(this.switchingTrack&&i){const E=m;l.PTSKnown&&E<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=g+.05)}if(d>=h&&!this.switchingTrack&&p<f[f.length-1].start)return;let y=this.getNextFragment(p,l);if(y&&this.isLoopLoading(y,p)&&(y=this.getNextFragmentLoopLoading(y,l,c,ne.MAIN,h)),!y){this.bufferFlushed=!0;return}let v=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&xt(y)&&!y.endList&&(!l.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===gt.OK&&(this.mainFragLoading=v=null),v&&xt(v))){if(y.start>v.end){const _=this.fragmentTracker.getFragAtPos(p,ne.MAIN);_&&_.end>v.end&&(v=_,this.mainFragLoading={frag:_,targetBufferTime:null})}if(y.start>v.end)return}this.loadFragment(y,o,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Mo(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==B.STOPPED&&(this.setInterval(dy),this.state=B.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:i}=this,{details:s,id:a,groupId:o,track:l}=t;if(!i){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const u=this.mainDetails;if(!u||s.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==B.STOPPED&&(this.state=B.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=i[a];let d=0;if(s.live||(r=c.details)!=null&&r.live){if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;if(c.details){var h;d=this.alignPlaylists(s,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}s.alignedSliding||(Bx(s,u),s.alignedSliding||pc(s,u),d=s.fragmentStart)}c.details=s,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:s,id:a,groupId:t.groupId}),this.state===B.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=B.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=l[o];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new aT(this.hls,ne.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[r.cc],g=(t=r.initSegment)==null?void 0:t.data;if(f!==void 0){const p=i?i.index:-1,y=p!==-1,v=new Wg(r.level,r.sn,r.stats.chunkCount,s.byteLength,p,y);h.push(s,g,d,"",r,i,c.totalduration,!1,v,f)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:m}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new jx,complete:!1};m.push(new Uint8Array(s)),this.state!==B.STOPPED&&(this.state=B.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ne.MAIN&&xt(t.frag)&&(this.mainFragLoading=t,this.state===B.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type!==ne.AUDIO){!this.audioOnly&&r.type===ne.MAIN&&!r.elementaryStreams.video&&!r.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(xt(r)){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,we({},s)))}this.fragBufferedComplete(r,i),this.media&&this.tick()}onError(e,t){var r;if(t.fatal){this.state=B.ERROR;return}switch(t.details){case O.FRAG_GAP:case O.FRAG_PARSING_ERROR:case O.FRAG_DECRYPT_ERROR:case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ne.AUDIO,t);break;case O.AUDIO_TRACK_LOAD_ERROR:case O.AUDIO_TRACK_LOAD_TIMEOUT:case O.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===B.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Se.AUDIO_TRACK&&(this.state=B.IDLE);break;case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case O.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case O.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==$e.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==$e.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===B.ENDED&&(this.state=B.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,ne.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:u,level:c}=o,{details:d}=c,{audio:h,text:f,id3:g,initSegment:m}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=B.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const p=l.initSegment||l;this._bufferInitSegment(c,m.tracks,p,a),i.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:r,tracks:m.tracks})}if(h){const{startPTS:p,endPTS:y,startDTS:v,endDTS:E}=h;u&&(u.elementaryStreams[$e.AUDIO]={startPTS:p,endPTS:y,startDTS:v,endDTS:E}),l.setElementaryStreamInfo($e.AUDIO,p,y,v,E),this.bufferFragmentData(h,l,u,a)}if(g!=null&&(t=g.samples)!=null&&t.length){const p=Oe({id:r,frag:l,details:d},g);i.trigger(S.FRAG_PARSING_METADATA,p)}if(f){const p=Oe({id:r,frag:l,details:d},f);i.trigger(S.FRAG_PARSING_USERDATA,p)}}_bufferInitSegment(e,t,r,i){if(this.state!==B.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const s=t.audio;s.id=ne.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(S.BUFFER_CODECS,t);const o=s.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:o};this.hls.trigger(S.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===gt.NOT_LOADED||i===gt.PARTIAL){var s;if(!xt(e))this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=B.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&pc(t.details,a)}else super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o}=this.bufferedTrack;ns({name:t,lang:r,assocLang:i,characteristics:s,audioCodec:a,channels:o},e,ji)||(hc(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(S.AUDIO_TRACK_SWITCHED,we({},e))}}class im extends jr{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let a=0;a<i.length;a++){const o=i[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=o.URI||""}if(l===e){s=a;break}else l===e.substring(0,l.length)&&(s=a)}if(s!==-1){const a=i[s],o=parseInt(a["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let l=parseInt(a["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=r&&w0(r);return new C0(o,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(r){this.warn(`Could not construct new URL with HLS Delivery Directives: ${r}`)}return e}playlistLoaded(e,t,r){const{details:i,stats:s}=t,a=self.performance.now(),o=s.loading.first?Math.max(0,a-s.loading.first):0;i.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==i.appliedTimelineOffset){const c=Math.max(l||0,0);i.appliedTimelineOffset=c,i.fragments.forEach(d=>{d.start=d.playlistOffset+c})}if(i.live||r!=null&&r.live){const c="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(r),r&&i.fragments.length>0){lO(r,i);const v=i.playlistParsingError;if(v){this.warn(v);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var u;const{networkDetails:_}=t;E.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:v,reason:v.message,level:t.level||void 0,parent:(u=i.fragments[0])==null?void 0:u.type,networkDetails:_,stats:s});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=s.loading.start);const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,f=(i.edge-h)*1e3,g=Fx(i,f);if(i.requestScheduled+g<a?i.requestScheduled=a:i.requestScheduled+=g,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let m,p,y;if(i.canBlockReload&&i.endSN&&i.advanced){const v=this.hls.config.lowLatencyMode,E=i.lastPartSn,_=i.endSN,L=i.lastPartIndex,R=L!==-1,A=E===_;R?A?(p=_+1,y=v?0:L):(p=E,y=v?L+1:i.maxPartIndex):p=_+1;const T=i.age,w=T+i.ageHeader;let I=Math.min(w-i.partTarget,i.targetduration*1.5);if(I>0){if(w>i.targetduration*3)this.log(`Playlist last advanced ${T.toFixed(2)}s ago. Omitting segment and part directives.`),p=void 0,y=void 0;else if(r!=null&&r.tuneInGoal&&w-i.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${I} with playlist age: ${i.age}`),I=0;else{const M=Math.floor(I/i.targetduration);if(p+=M,y!==void 0){const j=Math.round(I%i.targetduration/i.partTarget);y+=j}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${T.toFixed(2)}s goal: ${I} skip sn ${M} to part ${y}`)}i.tuneInGoal=I}if(m=this.getDeliveryDirectives(i,t.deliveryDirectives,p,y),v||!A){i.requestScheduled=a,this.loadingPlaylist(c,m);return}}else(i.canBlockReload||i.canSkipUntil)&&(m=this.getDeliveryDirectives(i,t.deliveryDirectives,p,y));m&&p!==void 0&&i.canBlockReload&&(i.requestScheduled=s.loading.first+Math.max(g-o*2,g/2)),this.scheduleLoading(c,m,i)}else this.clearTimer()}scheduleLoading(e,t,r){const i=r||e.details;if(!i){this.loadingPlaylist(e,t);return}const s=self.performance.now(),a=i.requestScheduled;if(s>=a){this.loadingPlaylist(e,t);return}const o=a-s;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,r,i){let s=w0(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=Au.No),new C0(r,i,s)}checkRetry(e){const t=e.details,r=fc(e),i=e.errorAction,{action:s,retryCount:a=0,retryConfig:o}=i||{},l=!!i&&!!o&&(s===Dt.RetryRequest||!i.resolved&&s===Dt.SendAlternateToPenaltyBox);if(l){var u;if(a>=o.maxNumRetry)return!1;if(r&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=Kg(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,i.resolved=!0}return l}}function oT(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Go(n[t].attrs,e[t].attrs))return!1;return!0}function Go(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function Cf(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class gF extends im{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==i){this.warn(`Audio track with id:${r} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(i==null?void 0:i.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(h=>!r||r.indexOf(h.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(h=>h.default)&&(this.selectDefaultTrack=!1),o.forEach((h,f)=>{h.id=f});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!s&&l){const h=or(l,o,ji);if(h>-1)s=o[h];else{const f=or(l,this.tracks);s=this.tracks[f]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const c={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(o.length&&d===-1){var a;const h=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(h.message),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===Se.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const i=this.currentTrack;if(i&&ns(e,i,ji))return i;const s=or(e,this.tracksInGroup,ji);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=wP(e,t.levels,r,a,ji);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=or(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===r&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,we({},i)),s))return;const a=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(!(this.selectDefaultTrack&&!i.default)&&(!e||ns(e,i,ji)))return r}if(e){const{name:r,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(ns({name:r,lang:i,assocLang:s,characteristics:a,audioCodec:o,channels:l},c,ji))return u}for(let u=0;u<t.length;u++){const c=t[u];if(Go(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(Go(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&hc(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}}class mF{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!r&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=(t=e[0])==null?void 0:t.label;(r==="async-blocker"||r==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(s){var r;if(i.onError(s),this.queues===null||this.tracks===null)return;const a=(r=this.tracks[e])==null?void 0:r.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=(t=this.tracks)==null?void 0:t[e],i=r==null?void 0:r.buffer;return i?`SourceBuffer${i.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(r=>r.label).join(", "))||""}}const hy=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,lT="HlsJsTrackRemovedError";class pF extends Error{constructor(e){super(e),this.name=lT}}class yF extends jr{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=r=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=r=>{const{media:i,mediaSource:s}=this;r&&this.log("Media source opened"),!(!i||!s)&&(s.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:i,mediaSource:s}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:i}=this;r!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${r})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=zk(wi(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const s=this.isUpdating();s||this.operationQueue.removeBlockers();const a=this.isQueued();(s||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${s?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?Oe(r,i.tracks):this.sourceBuffers.forEach(s=>{const[a]=s;a&&(r[a]=Oe({},this.tracks[a]),this.removeBuffer(a)),s[0]=s[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(r=this.transferData)!=null&&r.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media,i=wi(this.appendSource);if(this.transferData=this.overrides=void 0,r&&i){const s=!!t.mediaSource;(s||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(a),s)this._objectUrl=r.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&a instanceof l,fy(r),vF(r,o),r.load()}catch{r.src=o}else r.src=o}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(r=e.constructor)==null?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,i=t.tracks,s=i?Object.keys(i):null,a=s?s.length:0,o=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(i&&s&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ke(r,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${Ke(i,(l,u)=>l==="initSegment"?void 0:u)}}`),!lx(i,r)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(r)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,s.forEach(l=>{const u=l,c=i[u];if(c){const d=c.buffer;if(d){const h=this.fragmentTracker,f=c.id;if(h.hasFragments(f)||h.hasParts(f)){const p=ge.getBuffered(d);h.detectEvictedFragments(u,p,f,null,!0)}const g=Zd(u),m=[u,d];this.sourceBuffers[g]=m,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:s,_objectUrl:a}=this;if(s){if(this.log(`media source ${r?"transferring":"detaching"}`),r)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=s.readyState==="open";try{const l=s.sourceBuffers;for(let u=l.length;u--;)o&&l[u].abort(),s.removeSourceBuffer(l[u]);o&&s.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(s.removeEventListener("startstreaming",this._onStartStreaming),s.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),r||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(i.removeAttribute("src"),this.appendSource&&fy(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),r)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(s){this.warn(`onBufferReset ${e}`,s)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Zd(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new mF(this.tracks)}onBufferCodecs(e,t){const r=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const s="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),a=!s&&this.sourceBufferCount&&this.media&&i.some(o=>!r[o]);if(s||a){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${i}" SourceBuffers`);return}i.forEach(o=>{var l,u,c;const d=t[o],{id:h,codec:f,levelCodec:g,container:m,metadata:p,supplemental:y}=d;let v=r[o];const E=(l=this.transferData)==null||(u=l.tracks)==null?void 0:u[o],_=E!=null&&E.buffer?E:v,L=(_==null?void 0:_.pendingCodec)||(_==null?void 0:_.codec),R=_==null?void 0:_.levelCodec;v||(v=r[o]={buffer:void 0,listeners:[],codec:f,supplemental:y,container:m,levelCodec:g,metadata:p,id:h});const A=Lu(L,R),T=A==null?void 0:A.replace(hy,"$1");let w=Lu(f,g);const I=(c=w)==null?void 0:c.replace(hy,"$1");w&&A&&T!==I&&(o.slice(0,5)==="audio"&&(w=cc(w,this.appendSource)),this.log(`switching codec ${L} to ${w}`),w!==(v.pendingCodec||v.codec)&&(v.pendingCodec=w),v.container=m,this.appendChangeType(o,m,w))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const i=`${t};codecs=${r}`,s={label:`change-type=${i}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),o.changeType(i),a.codec=r,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(s,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,i=r+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(r,ne.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>i||l!=null&&l.buffer&&ge.isBuffered(l.buffer,i)||((o=this.fragmentTracker.getAppendedFrag(i,ne.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:i,type:s,parent:a,frag:o,part:l,chunkMeta:u}=t,c=u.buffering[s],d=o.sn,h=self.performance.now();c.start=h;const f=o.stats.buffering,g=l?l.stats.buffering:null;f.start===0&&(f.start=h),g&&g.start===0&&(g.start=h);const m=r.audio;let p=!1;s==="audio"&&(m==null?void 0:m.container)==="audio/mpeg"&&(p=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const y=this.tracks.video,v=y==null?void 0:y.buffer;if(v&&d!=="initSegment"){const L=l||o,R=this.blockedAudioAppend;if(s==="audio"&&a!=="main"&&!this.blockedAudioAppend){const T=L.start+L.duration*.05,w=v.buffered,I=this.currentOp("video");!w.length&&!I?this.blockAudio(L):!I&&!ge.isBuffered(v,T)&&this.lastVideoAppendEnd<T&&this.blockAudio(L)}else if(s==="video"){const A=L.end;if(R){const T=R.frag.start;(A>T||A<this.lastVideoAppendEnd||ge.isBuffered(v,T))&&this.unblockAudio()}this.lastVideoAppendEnd=A}}const E=(l||o).start,_={label:`append-${s}`,execute:()=>{if(c.executeStart=self.performance.now(),p){const L=this.tracks[s];if(L){const R=L.buffer;if(R){const A=E-R.timestampOffset;Math.abs(A)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${E} (delta: ${A}) sn: ${d})`),R.timestampOffset=E)}}}this.appendExecutor(i,s)},onStart:()=>{},onComplete:()=>{const L=self.performance.now();c.executeEnd=c.end=L,f.first===0&&(f.first=L),g&&g.first===0&&(g.first=L);const R={};this.sourceBuffers.forEach(([A,T])=>{A&&(R[A]=ge.getBuffered(T))}),this.appendErrors[s]=0,s==="audio"||s==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:s,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:R})},onError:L=>{var R;const A={type:re.MEDIA_ERROR,parent:o.type,details:O.BUFFER_APPEND_ERROR,sourceBufferName:s,frag:o,part:l,chunkMeta:u,error:L,err:L,fatal:!1},T=(R=this.media)==null?void 0:R.error;if(L.code===DOMException.QUOTA_EXCEEDED_ERR)A.details=O.BUFFER_FULL_ERROR;else if(L.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!T)A.errorAction=No(!0);else if(L.name===lT&&this.sourceBufferCount===0)A.errorAction=No(!0);else{const w=++this.appendErrors[s];this.warn(`Failed ${w}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${s}" sourceBuffer (${T||"no media error"})`),(w>=this.hls.config.appendErrorMaxRetry||T)&&(A.fatal=!0)}this.hls.trigger(S.ERROR,A)}};this.append(_,s,this.isPending(this.tracks[s]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:r,startOffset:i,endOffset:s}=t;r?this.append(this.getFlushOp(r,i,s),r):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,i,s),a)})}onFragParsed(e,t){const{frag:r,part:i}=t,s=[],a=i?i.elementaryStreams:r.elementaryStreams;a[$e.AUDIOVIDEO]?s.push("audiovideo"):(a[$e.AUDIO]&&s.push("audio"),a[$e.VIDEO]&&s.push("video"));const o=()=>{const l=self.performance.now();r.stats.buffering.end=l,i&&(i.stats.buffering.end=l);const u=i?i.stats:r.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:r,part:i,stats:u,id:r.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(o,s).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,r;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((r=this.tracks[e])==null?void 0:r.ending))})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const i=((r=this.overrides)==null?void 0:r.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})&&(i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===O.BUFFER_APPEND_ERROR&&t.frag){var r;const i=(r=t.errorAction)==null?void 0:r.nextAutoLevel;Z(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.sourceBufferCount)return;const i=e.config,s=r.currentTime,a=t.levelTargetDuration,o=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(Z(o)&&o>=0){const l=Math.max(o,a),u=Math.floor(s/a)*a-l;this.flushBackBuffer(s,a,u)}if(Z(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const l=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),u=Math.max(l,a),c=Math.floor(s/a)*a+u;this.flushFrontBuffer(s,a,c)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const o=ge.getBuffered(s);if(o.length>0&&r>o.start(0)){var a;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:r});const l=this.tracks[i];if((a=this.details)!=null&&a.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l!=null&&l.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:i})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([i,s])=>{if(s){const a=ge.getBuffered(s),o=a.length;if(o<2)return;const l=a.start(o-1),u=a.end(o-1);if(r>l||e>=l&&e<=u)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||(r==null?void 0:r.readyState)!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&r.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,i);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const s=(e=this.overrides)==null?void 0:e.duration;if(s)return Z(s)?{duration:s}:null;const a=this.media.duration,o=Z(r.duration)?r.duration:0;return i>o&&i>a||!Z(a)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:r}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(Z(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&r!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${r}.`),i.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ke(r)}`),this.tracksReady){var i;const s=(i=this.transferData)==null?void 0:i.tracks;s&&Object.keys(s).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const i=this.tracks[t];e[t]={buffer:r,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const s in e){const a=s,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),u=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(a)?" Queued":""} ${Ke(o)}`);try{const c=r.addSourceBuffer(u),d=Zd(a),h=[a,c];t[d]=h,o.buffer=c}catch(c){var i;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[a],this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:u,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let i=e.codec;r&&(t==="video"||t==="audiovideo")&&xf(r,"video")&&(i=gP(i,r));const s=Lu(i,e.levelCodec);return s?t.slice(0,5)==="audio"?cc(s,this.appendSource):s:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(s,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:s})})}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${i}`,t),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.currentOp(e);s&&s.onError(i)}removeExecutor(e,t,r){const{media:i,mediaSource:s}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!i||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=Z(i.duration)?i.duration:1/0,u=Z(s.duration)?s.duration:1/0,c=Math.max(0,t),d=Math.min(r,l,u);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],i=r==null?void 0:r.buffer;if(!i)throw new pF(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,i=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(a=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var r;const i=(r=this.tracks[t])==null?void 0:r.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const i=this.tracks[e];if(!i)return;const s=i.buffer;if(!s)return;const a=r.bind(this,e);i.listeners.push({event:t,listener:a}),s.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(i=>{r.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function fy(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function vF(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function Zd(n){return n==="audio"?1:0}class sm{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Z(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,sm.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const i=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let s=e.length-1;const a=Math.max(t,r);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&i(l,e[o+1])){s=o;break}}return s}}const EF={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Gt=EF,SF={HLS:"h"},xF=SF,TF="CMCD-Object",_F="CMCD-Request",LF="CMCD-Session",AF="CMCD-Status",eo={OBJECT:TF,REQUEST:_F,SESSION:LF,STATUS:AF},RF={[eo.OBJECT]:["br","d","ot","tb"],[eo.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[eo.SESSION]:["cid","pr","sf","sid","st","v"],[eo.STATUS]:["bs","rtp"]};class Ta{constructor(e,t){Array.isArray(e)&&(e=e.map(r=>r instanceof Ta?r:new Ta(r))),this.value=e,this.params=t}}const IF="Dict";function wF(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function CF(n,e,t,r){return new Error(`failed to ${n} "${wF(e)}" as ${t}`,{cause:r})}function hr(n,e,t){return CF("serialize",n,e,t)}class uT{constructor(e){this.description=e}}const gy="Bare Item",DF="Boolean";function bF(n){if(typeof n!="boolean")throw hr(n,DF);return n?"?1":"?0"}function kF(n){return btoa(String.fromCharCode(...n))}const PF="Byte Sequence";function OF(n){if(ArrayBuffer.isView(n)===!1)throw hr(n,PF);return`:${kF(n)}:`}const FF="Integer";function MF(n){return n<-999999999999999||999999999999999<n}function cT(n){if(MF(n))throw hr(n,FF);return n.toString()}function NF(n){return`@${cT(n.getTime()/1e3)}`}function dT(n,e){if(n<0)return-dT(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}const UF="Decimal";function $F(n){const e=dT(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw hr(n,UF);const t=e.toString();return t.includes(".")?t:`${t}.0`}const BF="String",jF=/[\x00-\x1f\x7f]+/;function GF(n){if(jF.test(n))throw hr(n,BF);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function VF(n){return n.description||n.toString().slice(7,-1)}const HF="Token";function my(n){const e=VF(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw hr(e,HF);return e}function Df(n){switch(typeof n){case"number":if(!Z(n))throw hr(n,gy);return Number.isInteger(n)?cT(n):$F(n);case"string":return GF(n);case"symbol":return my(n);case"boolean":return bF(n);case"object":if(n instanceof Date)return NF(n);if(n instanceof Uint8Array)return OF(n);if(n instanceof uT)return my(n);default:throw hr(n,gy)}}const KF="Key";function bf(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw hr(n,KF);return n}function am(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${bf(e)}`:`;${bf(e)}=${Df(t)}`).join("")}function hT(n){return n instanceof Ta?`${Df(n.value)}${am(n.params)}`:Df(n)}function zF(n){return`(${n.value.map(hT).join(" ")})${am(n.params)}`}function WF(n,e={whitespace:!0}){if(typeof n!="object")throw hr(n,IF);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof Ta||(s=new Ta(s));let a=bf(i);return s.value===!0?a+=am(s.params):(a+="=",Array.isArray(s.value)?a+=zF(s):a+=hT(s)),a}).join(`,${r}`)}function qF(n,e){return WF(n,e)}function YF(n){return n==="ot"||n==="sf"||n==="st"}function QF(n){return typeof n=="number"?Z(n):n!=null&&n!==""&&n!==!1}function XF(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const i=t.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")}const Cu=n=>Math.round(n),ZF=(n,e)=>(e!=null&&e.baseUrl&&(n=XF(n,e.baseUrl)),encodeURIComponent(n)),nu=n=>Cu(n/100)*100,JF={br:Cu,d:Cu,bl:nu,dl:nu,mtp:nu,nor:ZF,rtp:nu,tb:Cu};function eM(n,e){const t={};if(n==null||typeof n!="object")return t;const r=Object.keys(n).sort(),i=Oe({},JF,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return r.forEach(a=>{if(s!=null&&s(a))return;let o=n[a];const l=i[a];l&&(o=l(o,e)),!(a==="v"&&o===1)&&(a=="pr"&&o===1||QF(o)&&(YF(a)&&typeof o=="string"&&(o=new uT(o)),t[a]=o))}),t}function fT(n,e={}){return n?qF(eM(n,e),Oe({whitespace:!1},e)):""}function tM(n,e={}){const t={};if(!n)return t;const r=Object.entries(n),i=Object.entries(RF).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=r.reduce((a,o)=>{var l,u;const[c,d]=o,h=((l=i.find(f=>f[1].includes(c)))===null||l===void 0?void 0:l[0])||eo.REQUEST;return(u=a[h])!==null&&u!==void 0||(a[h]={}),a[h][c]=d,a},{});return Object.entries(s).reduce((a,[o,l])=>(a[o]=fT(l,e),a),t)}function nM(n,e,t){return Oe(n,tM(e,t))}const rM="CMCD";function iM(n,e={}){if(!n)return"";const t=fT(n,e);return`${rM}=${encodeURIComponent(t)}`}const py=/CMCD=[^&#]+/;function sM(n,e,t){const r=iM(e,t);if(!r)return n;if(py.test(n))return n.replace(py,r);const i=n.includes("?")?"&":"?";return`${n}${i}${r}`}class aM{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Gt.MANIFEST,su:!this.initialized})}catch(s){this.hls.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const{frag:s,part:a}=i,o=this.hls.levels[s.level],l=this.getObjectType(s),u={d:(a||s).duration*1e3,ot:l};(l===Gt.VIDEO||l===Gt.AUDIO||l==Gt.MUXED)&&(u.br=o.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=a?this.getNextPart(a):this.getNextFrag(s);c!=null&&c.url&&c.url!==s.url&&(u.nor=c.url),this.apply(i,u)}catch(s){this.hls.logger.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:xF.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Oe(t,this.createData());const r=t.ot===Gt.INIT||t.ot===Gt.VIDEO||t.ot===Gt.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((a,o)=>(i.includes(o)&&(a[o]=t[o]),a),{}));const s={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),nM(e.headers,t,s)):e.url=sM(e.url,t,s)}getNextFrag(e){var t;const r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){const i=e.sn-r.startSN;return r.fragments[i+1]}}getNextPart(e){var t,r;const{index:i,fragment:s}=e,a=(t=this.hls.levels[s.level])==null||(r=t.details)==null?void 0:r.partList;if(a){const{sn:o}=s;for(let l=a.length-1;l>=0;l--){const u=a[l];if(u.index===i&&u.fragment.sn===o)return a[l+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Gt.TIMED_TEXT;if(e.sn==="initSegment")return Gt.INIT;if(t==="audio")return Gt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Gt.VIDEO:Gt.MUXED}getTopBandwidth(e){let t=0,r;const i=this.hls;if(e===Gt.AUDIO)r=i.audioTracks;else{const s=i.maxAutoLevel,a=s>-1?s+1:i.levels.length;r=i.levels.slice(0,a)}return r.forEach(s=>{s.bitrate>t&&(t=s.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,r=e===Gt.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:ge.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,o){t(s),this.loader.load(s,a,o)}}}}const oM=3e5;class lM extends jr{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===Dt.SendAlternateToPenaltyBox&&r.flags===On.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:u}=t.context;o&&i?a=this.getPathwayForGroupId(o,u,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&i&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==a),r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${Ke(s)} penalized: ${Ke(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(s=>{i-r[s]>oM&&delete r[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in r)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,Ux(t),this.hls.trigger(S.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[o];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,r){const i=this.getLevelsForPathway(r).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===Se.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===Se.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach(s=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=s;if(t.some(c=>c.pathwayId===a))return;const u=this.getLevelsForPathway(o).map(c=>{const d=new ze(c.attrs);d["PATHWAY-ID"]=a;const h=d.AUDIO&&`${d.AUDIO}_clone_${a}`,f=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;h&&(r[d.AUDIO]=h,d.AUDIO=h),f&&(i[d.SUBTITLES]=f,d.SUBTITLES=f);const g=gT(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),m=new Mo({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:g,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let p=1;p<c.audioGroups.length;p++)m.addGroupId("audio",`${c.audioGroups[p]}_clone_${a}`);if(c.subtitleGroups)for(let p=1;p<c.subtitleGroups.length;p++)m.addGroupId("text",`${c.subtitleGroups[p]}_clone_${a}`);return m});t.push(...u),yy(this.audioTracks,r,l,a),yy(this.subtitleTracks,i,l,a)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(c,d,h,f)=>{this.log(`Loaded steering manifest: "${i}"`);const g=c.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":p,"PATHWAY-PRIORITY":y}=g;if(m)try{this.uri=new self.URL(m,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||h.url),p&&this.clonePathways(p);const v={steeringManifest:g,url:i.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,v),y&&this.updatePathwayPriority(y)},onError:(c,d,h,f)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let g=this.timeToLoad*1e3;if(c.code===429){const m=this.loader;if(typeof(m==null?void 0:m.getResponseHeader)=="function"){const p=m.getResponseHeader("Retry-After");p&&(g=parseFloat(p)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,g)},onTimeout:(c,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const i=(r=this.hls)==null?void 0:r.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function yy(n,e,t,r){n&&Object.keys(e).forEach(i=>{const s=n.filter(a=>a.groupId===i).map(a=>{const o=Oe({},a);return o.details=void 0,o.attrs=new ze(o.attrs),o.url=o.attrs.URI=gT(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[i],o.attrs["PATHWAY-ID"]=r,o});n.push(...s)})}function gT(n,e,t,r){const{HOST:i,PARAMS:s,[t]:a}=r;let o;e&&(o=a==null?void 0:a[e],o&&(n=o));const l=new self.URL(n);return i&&!o&&(l.host=i),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}function un(n,e,t){Ln(n,e,t),n.addEventListener(e,t)}function Ln(n,e,t){n.removeEventListener(e,t)}class Qs extends jr{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Qs.CDMCleanupPromise?[Qs.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:r,initData:i}=t,s=`"${t.type}" event: init data type: "${r}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Ja(this.config));const o=a.map(Xl).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=Ru(a);let l,u;if(r==="sinf"){if(o!==Ce.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${o}`);return}const g=ht(new Uint8Array(i));try{const m=Yg(JSON.parse(g).sinf),p=mx(m);if(!p)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(p.subarray(8,24)),u=Ce.FAIRPLAY}catch(m){this.warn(`${s} Failed to parse sinf: ${m}`);return}}else{if(o!==Ce.WIDEVINE&&o!==Ce.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${o}`);return}const g=cP(i),m=g.filter(y=>!!y.systemId&&Hd(y.systemId)===o);m.length>1&&this.warn(`${s} Using first of ${m.length} pssh found for selected key-system ${o}`);const p=m[0];if(!p){g.length===0||g.some(y=>!y.systemId)?this.warn(`${s} contains incomplete or invalid pssh data`):this.log(`ignoring ${s} for ${g.map(y=>Hd(y.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(u=Hd(p.systemId),p.version===0&&p.data)if(u===Ce.WIDEVINE){const y=p.data.length-22;l=new Uint8Array(p.data.subarray(y,y+16))}else u===Ce.PLAYREADY&&(l=bx(p.data))}if(!u||!l)return;const c=Zn.hexDump(l),{keyIdToKeySessionPromise:d,mediaKeySessions:h}=this;let f=d[c];for(let g=0;g<h.length;g++){const m=h[g],p=m.decryptdata;if(!p.keyId)continue;const y=Zn.hexDump(p.keyId);if(c===y||p.uri.replace(/-/g,"").indexOf(c)!==-1){if(f=d[y],p.pssh)break;delete d[y],p.pssh=new Uint8Array(i),p.keyId=l,f=d[c]=f.then(()=>this.generateRequestWithPreferredKeySession(m,r,i,"encrypted-event-key-match")),f.catch(v=>this.handleError(v));break}}if(!f){if(u!==o){this.log(`Ignoring "${t.type}" event with ${u} init data for selected key-system ${o}`);return}f=d[c]=this.getKeySystemSelectionPromise([u]).then(({keySystem:g,mediaKeys:m})=>{var p;this.throwIfDestroyed();const y=new Uo("ISO-23001-7",c,(p=Xl(g))!=null?p:"");return y.pssh=new Uint8Array(i),y.keyId=l,this.attemptSetMediaKeys(g,m).then(()=>{this.throwIfDestroyed();const v=this.createMediaKeySessionContext({decryptdata:y,keySystem:g,mediaKeys:m});return this.generateRequestWithPreferredKeySession(v,r,i,"encrypted-event-no-match")})}),f.catch(g=>this.handleError(g))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===Ce.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(a,o,l)=>!!a&&l.indexOf(a)===o,i=t.map(a=>a.audioCodec).filter(r),s=t.map(a=>a.videoCodec).filter(r);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,o)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,i,s).then(d=>a({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof yn?o(d):o(new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${r}`;return Dx===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return r(e,t)}getMediaKeysPromise(e,t,r){const i=eO(e,t,r,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let a=s==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ke(i)}`),a=this.requestMediaKeySystemAccess(e,i);const o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),a.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const u=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),o.mediaKeys=l.createMediaKeys().then(c=>(this.log(`Media-keys created for "${e}"`),o.hasMediaKeys=!0,u.then(d=>d?this.setMediaKeysServerCertificate(c,e,d):c))),o.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${e}"}: ${c}`)}),o.mediaKeys})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Zn.hexDump(e.keyId||[])}`);const i=r.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,s,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Zn.hexDump(e.keyId)}updateKeySession(e,t){var r;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${Zn.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),i.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Xl(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:r})=>this.attemptSetMediaKeys(t,r))}selectKeySystem(e){return new Promise((t,r)=>this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const s=Xl(i);s?t(s):r(new Error(`Unable to find format for key-system "${i}"`))}).catch(r))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Ja(this.config),r=e.map(Ru).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(r)}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let s=this.keyIdToKeySessionPromise[r];return s||(s=this.getKeySystemForKeyPromise(t).then(({keySystem:o,mediaKeys:l})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(o,l).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:o,mediaKeys:l,decryptdata:t}))))),(this.keyIdToKeySessionPromise[r]=s.then(o=>{const l="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(o,l,u,"playlist-key")})).catch(o=>this.handleError(o))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof yn?this.hls.trigger(S.ERROR,e.data):this.hls.trigger(S.ERROR,{type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const i=Ru(e.keyFormat),s=i?[i]:Ja(this.config);return this.attemptKeySystemAccess(s)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Ja(this.config)),e.length===0)throw new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ke({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(r).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>r.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,r,i){var s,a;const o=(s=this.config.drmSystems)==null||(a=s[e.keySystem])==null?void 0:a.generateRequest;if(o)try{const g=o.call(this.hls,t,r,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,r=g.initData?g.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(g){var l;if(this.warn(g.message),(l=this.hls)!=null&&l.config.debug)throw g}if(r===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const u=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${u} (init data type: ${t} length: ${r?r.byteLength:null})`);const c=new Xg,d=e._onmessage=g=>{const m=e.mediaKeysSession;if(!m){c.emit("error",new Error("invalid state"));return}const{messageType:p,message:y}=g;this.log(`"${p}" message event for session "${m.sessionId}" message size: ${y.byteLength}`),p==="license-request"||p==="license-renewal"?this.renewLicense(e,y).catch(v=>{c.eventNames().length?c.emit("error",v):this.handleError(v)}):p==="license-release"?e.keySystem===Ce.FAIRPLAY&&(this.updateKeySession(e,Lf("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${p}"`)},h=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const p=e.keyStatus;c.emit("keyStatus",p),p==="expired"&&(this.warn(`${e.keySystem} expired for key ${u}`),this.renewKeySession(e))};un(e.mediaKeysSession,"message",d),un(e.mediaKeysSession,"keystatuseschange",h);const f=new Promise((g,m)=>{c.on("error",m),c.on("keyStatus",p=>{p.startsWith("usable")?g():p==="output-restricted"?m(new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):p==="internal-error"?m(new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${p}"`)):p==="expired"?m(new Error("key expired while generating request")):this.warn(`unhandled key status change "${p}"`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{var g;this.log(`Request generated for key-session "${(g=e.mediaKeysSession)==null?void 0:g.sessionId}" keyId: ${u}`)}).catch(g=>{throw new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_SESSION,error:g,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>f).catch(g=>{throw c.removeAllListeners(),this.removeSession(e),g}).then(()=>(c.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,r)=>{if(typeof r=="string"&&typeof t=="object"){const i=r;r=t,t=i}this.log(`key status change "${t}" for keyStatuses keyId: ${Zn.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${Zn.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,r=t.loader,i=new r(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:s},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,m)=>{a(h.data)},onError:(h,f,g,m)=>{o(new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:we({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${s}). Status: ${h.code} (${h.text})`))},onTimeout:(h,f,g)=>{o(new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(h,f,g)=>{o(new Error("aborted"))}};i.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((i,s)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r==null?void 0:r.byteLength}) on "${t}"`),i(e)}).catch(a=>{s(new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(i=>{throw new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:i,fatal:!0},i.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(r,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,h=s.length;d<h;d++){var a,o;c=s[d];const f=(a=c.querySelector("name"))==null?void 0:a.textContent,g=(o=c.querySelector("value"))==null?void 0:o.textContent;f&&g&&e.setRequestHeader(f,g)}}const l=i.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Lf(atob(u))}setupLicenseXHR(e,t,r,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,r,i)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,r,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,o,a,e)}catch(c){this.error(c)}i(l)}else{const l=r.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||o.status>=400&&o.status<500)s(new yn({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==Ce.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,un(r,"encrypted",this.onMediaEncrypted),un(r,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(Ln(e,"encrypted",this.onMediaEncrypted),Ln(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Uo.clearKeyUriToKeyIdMap();const i=r.length;Qs.CDMCleanupPromise=Promise.all(r.map(s=>this.removeSession(s)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(s=>{var a;this.log(`Could not clear media keys: ${s}`),(a=this.hls)==null||a.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${s}`)})}))).catch(s=>{var a;this.log(`Could not close sessions and clear media keys: ${s}`),(a=this.hls)==null||a.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${s}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{drmSystemOptions:s}=this.config;return(nO(s)?new Promise((o,l)=>{self.setTimeout(()=>l(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(o)}):Promise.resolve()).catch(o=>{var l;this.log(`Could not remove session: ${o}`),(l=this.hls)==null||l.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${o}`)})}).then(()=>t.close()).catch(o=>{var l;this.log(`Could not close session: ${o}`),(l=this.hls)==null||l.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${o}`)})})}}}Qs.CDMCleanupPromise=void 0;class yn extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class uM{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,a=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/s,u=this.hls;if(u.trigger(S.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:r}),l>0&&a>u.config.fpsDroppedMonitoringThreshold*o){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function mT(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function pT(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){Re.debug(`[texttrack-utils]: ${r}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){Re.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function js(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let r=n.cues.length;r--;)e&&n.cues[r].removeEventListener("enter",e),n.removeCue(n.cues[r]);t==="disabled"&&(n.mode=t)}function kf(n,e,t,r){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=dM(n.cues,e,t);for(let a=0;a<s.length;a++)(!r||r(s[a]))&&n.removeCue(s[a])}i==="disabled"&&(n.mode=i)}function cM(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,i=t,s;for(;r<=i;)if(s=Math.floor((i+r)/2),e<n[s].startTime)i=s-1;else if(e>n[s].startTime&&r<t)r=s+1;else return s;return n[r].startTime-e<e-n[i].startTime?r:i}function dM(n,e,t){const r=[],i=cM(n,e);if(i>-1)for(let s=i,a=n.length;s<a;s++){const o=n[s];if(o.startTime>=e&&o.endTime<=t)r.push(o);else if(o.startTime>t)return r}return r}function Du(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}class hM extends im{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=Du(this.media.textTracks);for(let s=0;s<r.length;s++)if(r[s].mode==="hidden")t=r[s];else if(r[s].mode==="showing"){t=r[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;Du(r.textTracks).forEach(a=>{js(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${r} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!s&&o){this.selectDefaultTrack=!1;const c=or(o,a);if(c>-1)s=a[c];else{const d=or(o,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const u={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(r&&!s.default||!r&&!e)&&(!e||ns(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(Go(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(Go(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(Cf(i,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Se.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&ns(e,r))return r;const i=or(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(r)return null;{const s=or(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,i=e.groupId,s=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Du(e.textTracks),r=this.currentTrack;let i;if(r&&(i=t.filter(s=>Cf(r,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Z(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===r&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:o="",name:l,type:u,url:c}=i;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:u,url:c});const d=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(d)}}function fM(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}function go(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Xs=.025;let vc=function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n}({});function gM(n,e,t){return`${n.identifier}-${t+1}-${go(e)}`}class mM{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;return e<=0||isNaN(r)?!1:r===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Jd(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,r=Jd(t,e);return t-r<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Z(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Jd(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Xs))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?vc.Range:vc.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return pM(this)}}function Jd(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Xs)?e.start:e.start+e.duration}function yT(n,e,t){const r=new self.URL(n,t);return r.protocol!=="data:"&&r.searchParams.set("_HLS_primary_id",e),r}function eh(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function pM(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function As(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class yM{constructor(e,t,r,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const s=this.hls=new e(t);this.interstitial=r,this.assetItem=i;let a=i.uri;try{a=yT(a,t.primarySessionId).href}catch{}s.loadSource(a);const o=()=>{this.hasDetails=!0};s.once(S.LEVEL_LOADED,o),s.once(S.AUDIO_TRACK_LOADED,o),s.once(S.SUBTITLE_TRACK_LOADED,o),s.on(S.MEDIA_ATTACHING,(l,{media:u})=>{this.removeMediaListeners(),this.mediaAttached=u,this.interstitial.playoutLimit&&(u.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&s.on(S.BUFFER_APPENDED,()=>{const d=this.bufferedEnd;this.reachedPlayout(d)&&(this._bufferedEosTime=d,s.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var e;return((e=this.interstitial)==null?void 0:e.appendInPlace)||!1}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const r=this.timelineOffset,i=ge.bufferInfo(e,r,0);return this.getAssetTime(i.end)>=this._bufferedEosTime-.02}reachedPlayout(e){const r=this.interstitial.playoutLimit;return this.startOffset+e>=r}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ge.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){const e=this.hls;if(this.hasDetails){e.stopLoad();const t=r=>delete r.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){this.hls.on(e,t)}once(e,t,r){this.hls.once(e,t)}off(e,t,r){this.hls.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${As(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const vy=.033;class vM extends jr{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[r]||(t===void 0&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&(s=i[r])!=null&&s.event;){var s;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let i=0;i<r.length;i++){let s=r[i];if(t&&t!=="primary"&&(s=s[t]),e===s.start||e>s.start&&e<s.end)return i}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let i=e;i<=t&&r[i];i++){const s=r[i].event;if(s!=null&&s.restrictions.jump&&!s.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var r;if(((r=t[i].event)==null?void 0:r.identifier)===e)return i}return-1}findAssetIndex(e,t){const r=e.assetList,i=r.length;if(i>1)for(let s=0;s<i;s++){const a=r[s];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&t<o+(a.duration||0))return s}}return 0}get assetIdAtEnd(){var e,t;const r=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(r){const i=r.assetList,s=i[i.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:i}=r,s=this.events,a=this.parseDateRanges(i,{url:r.url},t),o=Object.keys(i),l=s?s.filter(u=>!o.includes(u.identifier)):[];a.length&&a.sort((u,c)=>{const d=u.cue.pre,h=u.cue.post,f=c.cue.pre,g=c.cue.post;if(d&&!f)return-1;if(f&&!d||h&&!g)return 1;if(g&&!h)return-1;if(!d&&!f&&!h&&!g){const m=u.startTime,p=c.startTime;if(m!==p)return m-p}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[]){const r=this.events||[];if(r.length||t.length||this.length<2){const i=this.items,s=this.parseSchedule(r,e);(t.length||(i==null?void 0:i.length)!==s.length||s.some((o,l)=>Math.abs(o.playout.start-i[l].playout.start)>.005||Math.abs(o.playout.end-i[l].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const i=[],s=Object.keys(e);for(let a=0;a<s.length;a++){const o=s[a],l=e[o];if(l.isInterstitial){let u=this.eventMap[o];u?u.setDateRange(l):(u=new mM(l,t),this.eventMap[o]=u,r===!1&&(u.appendInPlace=r)),i.push(u)}}return i}parseSchedule(e,t){const r=[],i=t.main.details,s=i.live?1/0:i.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,d)=>{const h=c.cue.pre,f=c.cue.post,g=e[d-1]||null,m=c.appendInPlace,p=f?s:c.startOffset,y=c.duration,v=c.timelineOccupancy===vc.Range?y:0,E=c.resumptionOffset,_=(g==null?void 0:g.startTime)===p,L=p+c.cumulativeDuration;let R=m?L+y:p+E;if(h||!f&&p<=0){const T=u;u+=v,c.timelineStart=L;const w=a;a+=y,r.push({event:c,start:L,end:R,playout:{start:w,end:a},integrated:{start:T,end:u}})}else if(p<=s){if(!_){const I=p-l;if(I>vy){const M=l,j=u;u+=I;const z=a;a+=I;const K={previousEvent:e[d-1]||null,nextEvent:c,start:M,end:M+I,playout:{start:z,end:a},integrated:{start:j,end:u}};r.push(K)}else I>0&&g&&(g.cumulativeDuration+=I,r[r.length-1].end=p)}f&&(R=L),c.timelineStart=L;const T=u;u+=v;const w=a;a+=y,r.push({event:c,start:L,end:R,playout:{start:w,end:a},integrated:{start:T,end:u}})}else return;const A=c.resumeTime;f||A>s?l=s:l=A}),l<s){var o;const c=l,d=u,h=s-l;u+=h;const f=a;a+=h,r.push({previousEvent:((o=r[r.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:c+h,playout:{start:f,end:a},integrated:{start:d,end:u}})}this.setDurations(s,a,u)}else r.push({previousEvent:null,nextEvent:null,start:0,end:s,playout:{start:0,end:s},integrated:{start:0,end:s}}),this.setDurations(s,s,s);return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,i=r.live?1/0:r.edge;let s=0,a=-1;e.forEach((o,l)=>{const u=o.cue.pre,c=o.cue.post,d=u?0:c?i:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=s:(s=0,a=d),!c&&o.snapOptions.in&&(o.resumeAnchor=hs(null,r.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<vy&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const f=Z(o.resumeOffset)?o.resumeOffset:o.duration;s+=f})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(r-i)>Xs?(this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${i}`),!1):t?!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(r>=l)return this.log(`"${e.identifier}" resumption ${r} past ${a} playlist end ${l}`),!1;const u=hs(null,o.fragments,r);if(!u)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(u.start-r)<Xs+c||Math.abs(u.end-r)<Xs+c?!1:(this.log(`"${e.identifier}" resumption ${r} not aligned with ${a} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${r} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,i=!1,s=!1;e.assetList.forEach((a,o)=>{const l=t+r;a.startOffset=r,a.timelineStart=l,i||(i=a.duration===null),s||(s=!!a.error);const u=a.error?0:a.duration||0;r+=u}),i&&!s?e.duration=Math.max(r,e.duration):e.duration=r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function qr(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class EM{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let i;try{i=yT(r,this.hls.sessionId,e.baseUrl)}catch(h){const f=this.assignAssetListError(e,O.ASSET_LIST_LOAD_ERROR,h,r);this.hls.trigger(S.ERROR,f);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const s=this.hls.config,a=s.loader,o=new a(s),l={responseType:"json",url:i.href},u=s.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,m)=>{const p=h.data,y=p==null?void 0:p.ASSETS;if(!Array.isArray(y)){const v=this.assignAssetListError(e,O.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,f,m);this.hls.trigger(S.ERROR,v);return}e.assetListResponse=p,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:p,networkDetails:m})},onError:(h,f,g,m)=>{const p=this.assignAssetListError(e,O.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${f.url})`),f.url,m,g);this.hls.trigger(S.ERROR,p)},onTimeout:(h,f,g)=>{const m=this.assignAssetListError(e,O.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${f.url})`),f.url,h,g);this.hls.trigger(S.ERROR,m)}};return o.load(l,c,d),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,r,i,s,a){return e.error=r,{type:re.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:r,networkDetails:a,stats:s}}}function Ey(n){n==null||n.play().catch(()=>{})}class SM extends jr{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;const i=r-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const a=i<=-.01;this.timelinePos=r,this.bufferedPos=r;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(r,r-i)&&this.updateSchedule(),this.checkBuffer(),a&&r<o.start||r>=o.end){var l;const h=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a){const f=this.findItemIndex(o);if(h>f){const g=this.schedule.findJumpRestrictedIndex(f+1,h);if(g>f){this.setSchedulePosition(g);return}}}this.setSchedulePosition(h);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(o)){const h=o.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(r,h))}return}const c=u.timelineStart,d=u.duration||0;(a&&r<c||r>=c+d)&&this.setScheduleToAssetAtTime(r,u)},this.onTimeupdate=()=>{const r=this.currentTime;if(r===void 0||this.playbackDisabled)return;if(r>this.timelinePos)this.timelinePos=r,r>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(r>=i.end){this.timelinePos=i.end;const o=this.findItemIndex(i);this.setSchedulePosition(o+1)}const s=this.playingAsset;if(!s)return;const a=s.timelineStart+(s.duration||0);r>=a&&this.setScheduleToAssetAtTime(r,s)},this.onScheduleUpdate=(r,i)=>{const s=this.schedule,a=this.playingItem,o=s.events||[],l=s.items||[],u=s.durations,c=r.map(g=>g.identifier),d=!!(o.length||c.length);(d||i)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(g=>qr(g))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`),this.playerQueue.forEach(g=>{if(g.interstitial.appendInPlace){const m=g.assetItem.timelineStart,p=g.timelineOffset-m;if(p)try{g.timelineOffset=m}catch(y){Math.abs(p)>Xs&&this.warn(`${y} ("${g.assetId}" ${g.timelineOffset}->${m})`)}}});let h=null;if(a){const g=this.updateItem(a,this.timelinePos);this.itemsMatch(a,g)&&(this.playingItem=g,this.waitingItem=this.endedItem=null,h=()=>this.trimInPlace(g,a))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const f=this.bufferingItem;if(f){const g=this.updateItem(f,this.bufferedPos);this.itemsMatch(f,g)?(this.bufferingItem=g,h||(h=()=>this.trimInPlace(g,f))):f.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(f.event,null))}if(r.forEach(g=>{g.assetList.forEach(m=>{this.clearAssetPlayer(m.identifier,null)})}),d||i){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}h&&h(),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new EM(e),this.schedule=new vM(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Ln(e,"play",this.onPlay),Ln(e,"pause",this.onPause),Ln(e,"seeking",this.onSeeking),Ln(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;un(r,"seeking",this.onSeeking),un(r,"timeupdate",this.onTimeupdate),un(r,"play",this.onPlay),un(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,r===null)this.checkStart();else if(!i){this.clearScheduleState();const s=this.findItemIndex(r);this.setSchedulePosition(s)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,i=this.media;if(this.media=null,!r&&(i&&this.removeMediaListeners(i),this.detachedData)){const s=this.getBufferingPlayer();s&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,s.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=d=>d&&e.getAssetPlayer(d.identifier),i=(d,h,f,g,m)=>{if(d){let p=d[h].start;const y=d.event;if(y){if(h==="playout"||y.timelineOccupancy!==vc.Point){const v=r(f);(v==null?void 0:v.interstitial)===y&&(p+=v.assetItem.startOffset+v[m])}}else{const v=g==="bufferedPos"?a():e[g];p+=v-d.start}return p}return 0},s=(d,h)=>{if(d!==0&&h!=="primary"&&e.schedule.length){var f;const g=e.schedule.findItemIndexAtTime(d),m=(f=e.schedule.items)==null?void 0:f[g];if(m){const p=m[h].start-m.start;return d+p}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var h;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:e.schedule.durations[d]},l=(d,h)=>{var f,g;const m=e.effectivePlayingItem;if(m!=null&&(f=m.event)!=null&&f.restrictions.skip)return;e.log(`seek to ${d} "${h}"`);const p=e.effectivePlayingItem,y=e.schedule.findItemIndexAtTime(d,h),v=(g=e.schedule.items)==null?void 0:g[y],E=e.getBufferingPlayer(),_=E==null?void 0:E.interstitial,L=_==null?void 0:_.appendInPlace,R=p&&e.itemsMatch(p,v);if(p&&(L||R)){const T=r(e.playingAsset),w=(T==null?void 0:T.media)||e.primaryMedia;if(w){const I=h==="primary"?w.currentTime:i(p,h,e.playingAsset,"timelinePos","currentTime"),M=d-I,j=(L?I:w.currentTime)+M;if(j>=0&&(!T||L||j<=T.duration)){w.currentTime=j;return}}}if(v){let T=d;if(h!=="primary"){const I=v[h].start,M=d-I;T=v.start+M}const w=!e.isInterstitial(v);if((!e.isInterstitial(p)||p.event.appendInPlace)&&(w||v.event.appendInPlace)){const I=e.media||(L?E==null?void 0:E.media:null);I&&(I.currentTime=T)}else if(p){const I=e.findItemIndex(p);if(y>I){const j=e.schedule.findJumpRestrictedIndex(I+1,y);if(j>I){e.setSchedulePosition(j);return}}let M=0;if(w)e.timelinePos=T,e.checkBuffer();else{var A;const j=v==null||(A=v.event)==null?void 0:A.assetList;if(j){const z=d-(v[h]||v).start;for(let K=j.length;K--;){const W=j[K];if(W.duration&&z>=W.startOffset&&z<W.startOffset+W.duration){M=K;break}}}}e.setSchedulePosition(y,M)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const h=t();return e.isInterstitial(h)?h:null},c={get currentTime(){const d=u(),h=e.effectivePlayingItem;return h&&h===d?i(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(d){const h=u(),f=e.effectivePlayingItem;f&&f===h&&l(d+f.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const h=(d=u())==null?void 0:d.event.assetList;return h?h.map(f=>e.getAssetPlayer(f.identifier)):[]},get playingIndex(){var d;const h=(d=u())==null?void 0:d.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};this.manager={get events(){var d,h;return((d=e.schedule)==null||(h=d.events)==null?void 0:h.slice(0))||[]},get schedule(){var d,h;return((d=e.schedule)==null||(h=d.items)==null?void 0:h.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return s(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,h=d==null?void 0:d.event;if(h&&!h.restrictions.skip){const f=e.findItemIndex(d);if(h.appendInPlace){const g=d.playout.start+d.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(h,f,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!r?!1:this.findItemIndex(t)===r.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,r;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(s=this.primaryMedia);const a=(r=s)==null?void 0:r.currentTime;if(!(a===void 0||!Z(a)))return a}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,i=e.media;if(r&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const s=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ke(s)}`),this.detachedData=s}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var r,i;if(e.media===t)return;let s=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,u=(r=this.detachedData)==null?void 0:r.mediaSource;let c;if(a.media)l&&(s=a.transferMedia(),this.detachedData=s),c="Primary";else if(u){const f=this.getBufferingPlayer();f?(s=f.transferMedia(),c=`${f}`):c="detached MediaSource"}else c="detached media";if(!s){if(u)s=this.detachedData,this.log(`using detachedData: MediaSource ${Ke(s)}`);else if(!this.detachedData||a.media===t){const f=this.playerQueue;f.length>1&&f.forEach(g=>{if(o&&g.interstitial.appendInPlace!==l){const m=g.interstitial;this.clearInterstitial(g.interstitial,null),m.appendInPlace=!1,m.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${m}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=s&&"mediaSource"in s&&((i=s.mediaSource)==null?void 0:i.readyState)!=="closed",h=d&&s?s:t;if(this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${c}`),h===s){const f=o&&e.assetId===this.schedule.assetIdAtEnd;h.overrides={duration:this.schedule.duration,endOfStream:!o||f,cueRemoval:!o}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const r=this.timelinePos,i=this.effectivePlayingItem;if(r===-1){const s=this.hls.startPosition;if(this.timelinePos=s,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(s>=0||!this.primaryLive){const a=this.timelinePos=s>0?s:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(i&&!this.playingItem){const s=e.findItemIndex(i);this.setSchedulePosition(s)}}advanceAfterAssetEnded(e,t,r){const i=eh(e,r);if(!e.isAssetPastPlayoutLimit(i))this.setSchedulePosition(t,i);else{const s=this.schedule.items;if(s){const a=t+1,o=s.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.timelinePos=l,this.checkBuffer()),this.setSchedulePosition(a)}}}setScheduleToAssetAtTime(e,t){const r=this.schedule,i=t.parentIdentifier,s=r.getEvent(i);if(s){const a=r.findEventIndex(i),o=r.findAssetIndex(s,e);this.advanceAfterAssetEnded(s,a,o-1)}}setSchedulePosition(e,t){const r=this.schedule.items;if(!r||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const i=e>=0?r[e]:null,s=this.playingItem,a=this.playingLastItem;if(this.isInterstitial(s)){var o;const u=s.event,c=this.playingAsset,d=c==null?void 0:c.identifier,h=d?this.getAssetPlayer(d):null;if(h&&d&&(!this.eventItemsMatch(s,i)||t!==void 0&&d!==((o=u.assetList)==null?void 0:o[t].identifier))){var l;const f=u.findAssetIndex(c);this.log(`INTERSTITIAL_ASSET_ENDED ${f+1}/${u.assetList.length} ${As(c)}`),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:f,event:u,schedule:r.slice(0),scheduleIndex:e,player:h}),this.retreiveMediaSource(d,i),h.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(s,i)&&(this.endedItem=s,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${qr(s)}`),u.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:u,schedule:r.slice(0),scheduleIndex:e}),u.cue.once)){this.updateSchedule();const f=this.schedule.items;if(i&&f){const g=this.schedule.findItemIndex(i);this.advanceSchedule(g,f,t,s,a)}return}}this.advanceSchedule(e,r,t,s,a)}advanceSchedule(e,t,r,i,s){const a=e>=0?t[e]:null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(u=>{const c=u.interstitial,d=this.schedule.findEventIndex(c.identifier);(d<e||d>e+1)&&this.clearInterstitial(c,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const u=a.event;if(r===void 0){r=this.schedule.findAssetIndex(u,this.timelinePos);const f=eh(u,r-1);if(u.isAssetPastPlayoutLimit(f)){this.advanceAfterAssetEnded(u,e,r);return}r=f}const c=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let d=this.preloadAssets(u,r);if(this.eventItemsMatch(a,c||i)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${qr(a)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!o){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const h=u.assetList[r];if(!h){const f=t[e+1],g=this.media;f&&g&&!this.isInterstitial(f)&&g.currentTime<f.start&&(g.currentTime=this.timelinePos=f.start),this.advanceAfterAssetEnded(u,e,r||0);return}if(d||(d=this.getAssetPlayer(h.identifier)),d===null||d.destroyed){const f=u.assetList.length;this.warn(`asset ${r+1}/${f} player destroyed ${u}`),d=this.createAssetPlayer(u,h,r)}if(!this.eventItemsMatch(a,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(d,r,t,e,o),this.shouldPlay&&Ey(d.media)}else a!==null?(this.resumePrimary(a,e,i),this.shouldPlay&&Ey(this.hls.media)):s&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,r){var i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${qr(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.timelinePos=a),this.attachPrimary(a,e)}if(!r)return;const s=this.schedule.items;s&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${qr(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(r<i.fragmentStart||r>i.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ge.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const s=this.hls;s.media?this.checkBuffer():(this.transferMediaTo(s,i),r&&this.startLoadingPrimaryAt(e,r)),r||(this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((r=i.mainForwardBufferInfo)==null?void 0:r.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const r=this.hls.levels[t.level],i=we(we({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=we(we({},this.altSelection),{},{audio:r});return}const s=we(we({},i),{},{audio:r});this.mediaSelection=s}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=we(we({},this.altSelection),{},{subtitles:r});return}const s=we(we({},i),{},{subtitles:r});this.mediaSelection=s}onAudioTrackSwitching(e,t){const r=b0(t);this.playerQueue.forEach(i=>i.hls.setAudioOption(t)||i.hls.setAudioOption(r))}onSubtitleTrackSwitch(e,t){const r=b0(t);this.playerQueue.forEach(i=>i.hls.setSubtitleOption(t)||t.id!==-1&&i.hls.setSubtitleOption(r))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const s=t[i];if(s.cue.post){var r;const a=this.schedule.findEventIndex(s.identifier),o=(r=this.schedule.items)==null?void 0:r[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const r=this.findItemIndex(t);this.setSchedulePosition(r+1)}else this.shouldPlay=!1}updateItem(e,t){const r=this.schedule.items;if(e&&r){const i=this.findItemIndex(e,t);return r[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((s,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(s.identifier,null)});const r=e.end+.25,i=ge.bufferInfo(this.primaryMedia,r,0);(i.end>r||(i.nextStart||0)>r)&&(this.attachPrimary(r,null),this.flushFrontBuffer(r))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===((r=t.event)==null?void 0:r.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const r=ge.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,t,e)}updateBufferedPos(e,t,r){const i=this.schedule,s=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],s)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var u,c;const d=this.findItemIndex(s),h=Math.min(d+1,t.length-1),f=t[h];if((l===-1&&s&&e>=s.end||(u=f.event)!=null&&u.appendInPlace&&e+.01>=f.start)&&(l=h),h-o>1&&(s==null||(c=s.event)==null?void 0:c.appendInPlace)===!1)return;if(this.bufferedPos=e,l>d&&l>o)this.bufferedToItem(f);else{const g=this.primaryDetails;this.primaryLive&&g&&e>g.edge-g.targetduration&&f.start<g.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else r&&a&&!this.itemsMatch(a,s)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const s=this.getAssetPlayer(i.identifier);return!(s!=null&&s.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:i,events:s}=r;if(!i||!s)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${qr(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),this.playbackDisabled||(a?e.event.assetList.forEach(u=>{const c=this.getAssetPlayer(u.identifier);c&&c.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering()))),this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:s.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(r!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,i=r.assetList.length===0&&!r.assetListLoader,s=r.cue.once;if(i||!s){const a=this.preloadAssets(r,t);if(a!=null&&a.interstitial.appendInPlace){const o=r.assetList[t],l=this.primaryMedia;o&&l&&this.bufferAssetPlayer(a,l)}}}preloadAssets(e,t){const r=e.assetUrl,i=e.assetList.length,s=i===0&&!e.assetListLoader,a=e.cue.once;if(s){const l=e.timelineStart;if(e.appendInPlace){var o;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(o=h.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const h=c-l;h>0&&(u=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:i} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),r)return this.createAsset(e,0,0,l,e.duration,r);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!a&&i){for(let l=t;l<i;l++){const u=e.assetList[l],c=this.getAssetPlayerQueueIndex(u.identifier);(c===-1||this.playerQueue[c].destroyed)&&!u.error&&this.createAssetPlayer(e,u,l)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r]}return null}createAsset(e,t,r,i,s,a){const o={parentIdentifier:e.identifier,identifier:gM(e,a,t),duration:s,startOffset:r,timelineStart:i,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,r){const i=this.hls,s=i.userConfig;let a=s.videoPreference;const o=i.loadLevelObj||i.levels[i.currentLevel];(a||o)&&(a=Oe({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=i.audioTracks[i.audioTrack],u=i.subtitleTracks[i.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const E=this.timelinePos-t.timelineStart;if(E>1){const _=t.duration;_&&E<_&&(c=E)}}const d=t.identifier,h=we(we({},s),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||s.audioPreference,subtitlePreference:u||s.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const f=h.cmcd;f!=null&&f.sessionId&&f.contentId&&(h.cmcd=Oe({},f,{contentId:go(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const g=new yM(this.HlsPlayerClass,h,e,t);this.playerQueue.push(g),e.assetList[r]=t;const m=E=>{if(E.live){const R=new Error(`Interstitials MUST be VOD assets ${e}`),A={fatal:!0,type:re.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:R};this.handleAssetItemError(A,e,this.schedule.findEventIndex(e.identifier),r,R.message);return}const _=E.edge-E.fragmentStart,L=t.duration;(L===null||_>L)&&(this.log(`Interstitial asset "${d}" duration change ${L} > ${_}`),t.duration=_,this.updateSchedule())};g.on(S.LEVEL_UPDATED,(E,{details:_})=>m(_)),g.on(S.LEVEL_PTS_UPDATED,(E,{details:_})=>m(_));const p=(E,_)=>{const L=this.getAssetPlayer(d);if(L&&_.tracks){L.off(S.BUFFER_CODECS,p),L.tracks=_.tracks;const R=this.primaryMedia;this.bufferingAsset===L.assetItem&&R&&!L.media&&this.bufferAssetPlayer(L,R)}};g.on(S.BUFFER_CODECS,p);const y=()=>{var E;const _=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${_}`),!_)return;const L=this.schedule.findEventIndex(e.identifier),R=(E=this.schedule.items)==null?void 0:E[L];if(this.isInterstitial(R)){const T=e.findAssetIndex(t),w=eh(e,T);if(!e.isAssetPastPlayoutLimit(w))this.bufferedToItem(R,w);else{var A;const I=(A=this.schedule.items)==null?void 0:A[L+1];I&&this.bufferedToItem(I)}}};g.on(S.BUFFERED_TO_END,y);const v=E=>()=>{if(!this.getAssetPlayer(d))return;this.shouldPlay=!0;const L=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,L,E)};return g.once(S.MEDIA_ENDED,v(r)),g.once(S.PLAYOUT_LIMIT_REACHED,v(1/0)),g.on(S.ERROR,(E,_)=>{const L=this.getAssetPlayer(d);if(_.details===O.BUFFER_STALLED_ERROR){if(L!=null&&L.media){const R=L.currentTime,A=L.duration-R;R&&e.appendInPlace&&A/L.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${d} ${e} at ${L.media.currentTime}`),y()):(this.warn(`Stalled at ${R} of ${R+A} in asset ${d} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(_,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${_.error} ${e}`)}),g.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(d))return;const _=new Error(`Asset player destroyed unexpectedly ${d}`),L={fatal:!0,type:re.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:_};this.handleAssetItemError(L,e,this.schedule.findEventIndex(e.identifier),r,_.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${As(t)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:g}),g}clearInterstitial(e,t){e.assetList.forEach(r=>{this.clearAssetPlayer(r.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(r!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&qr(t)}`);const i=this.playerQueue[r];this.transferMediaFromPlayer(i,t),this.playerQueue.splice(r,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,i,s){const{interstitial:a,assetItem:o,assetId:l}=e,u=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,r[i]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${As(o)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:r.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,s)}bufferAssetPlayer(e,t){var r,i;const{interstitial:s,assetItem:a}=e,o=this.schedule.findEventIndex(s.identifier),l=(r=this.schedule.items)==null?void 0:r[o];if(!l)return;this.setBufferingItem(l),this.bufferingAsset=a;const u=this.getBufferingPlayer();if(u===e)return;const c=s.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks)return;if(d&&!lx(d,e.tracks)){const h=new Error(`Asset ${As(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),f={fatal:!0,type:re.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},g=s.findAssetIndex(a);this.handleAssetItemError(f,s,o,g,h.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,r,i,s){if(e.details===O.BUFFER_STALLED_ERROR)return;const a=t.assetList[i];this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&As(a)} ${e.error}`);const o=a==null?void 0:a.identifier,l=this.getAssetPlayerQueueIndex(o),u=this.playerQueue[l]||null,c=this.schedule.items,d=Oe({},e,{fatal:!1,errorAction:No(!0),asset:a,assetListIndex:i,event:t,schedule:c,scheduleIndex:r,player:u});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const h=this.playingAsset,f=new Error(s);if(a&&(this.clearAssetPlayer(o,null),a.error=f),!t.assetList.some(g=>!g.error))t.error=f;else if(t.appendInPlace){for(let g=i;g<t.assetList.length;g++)this.resetAssetPlayer(t.assetList[g].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):h&&h.identifier===o&&this.advanceAfterAssetEnded(t,r,i)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;if(this.updateSchedule(),r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${r?qr(r):"<none>"} error: ${e.error}`);let i=this.timelinePos;i===-1&&(i=this.hls.startPosition);const s=this.updateItem(r,i);this.itemsMatch(r,s)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));const a=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var r;const i=t.event,s=i.identifier,a=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(s))return;const o=i.timelineStart,l=i.duration;let u=0;a.forEach((g,m)=>{const p=parseFloat(g.DURATION);this.createAsset(i,m,u,o+u,p,g.URI),u+=p}),i.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${l}) ${i}`);const c=this.waitingItem,d=(c==null?void 0:c.event.identifier)===s;this.updateSchedule();const h=(r=this.bufferingItem)==null?void 0:r.event;if(d){var f;const g=this.schedule.findEventIndex(s),m=(f=this.schedule.items)==null?void 0:f[g];if(m){if(!this.playingItem&&this.timelinePos>m.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==g){i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.primaryFallback(i);return}this.setBufferingItem(m)}this.setSchedulePosition(g)}else if((h==null?void 0:h.identifier)===s&&h.appendInPlace){const g=i.assetList[0],m=this.getAssetPlayer(g.identifier),p=this.primaryMedia;g&&m&&p&&this.bufferAssetPlayer(m,p)}}onError(e,t){switch(t.details){case O.ASSET_LIST_PARSING_ERROR:case O.ASSET_LIST_LOAD_ERROR:case O.ASSET_LIST_LOAD_TIMEOUT:{const r=t.interstitial;r&&this.primaryFallback(r);break}case O.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Sy=500;class xM extends Qg{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",ne.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=B.IDLE,this.setInterval(Sy),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(xt(r)&&(this.fragPrevious=r),this.state=B.IDLE,!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const o=r.start;for(let u=0;u<s.length;u++)if(o>=s[u].start&&o<=s[u].end){a=s[u];break}const l=r.start+r.duration;a?a.end=l:(a={start:o,end:l},s.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(r===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=s){a.shift();continue}else if(a[o].start<s)a[o].start=s;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(r,s,ne.SUBTITLE)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===ne.SUBTITLE&&(t.details===O.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==B.STOPPED&&(this.state=B.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&oT(this.levels,t)){this.levels=t.map(r=>new Mo(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const i=new Mo(r);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ne.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==B.STOPPED&&this.setInterval(Sy)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:i,levels:s}=this,{details:a,id:o}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=s[o];if(o>=s.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(a.live||(r=l.details)!=null&&r.live){const d=this.mainDetails;if(a.deltaUpdateFailed||!d)return;const h=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(pc(a,d),u=a.fragmentStart):h&&(u=h.start,Rf(a,u));else{var c;u=this.alignPlaylists(a,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&h&&(u=h.start,Rf(a,u))}}l.details=a,this.levelLastLoaded=l,o===i&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===B.IDLE&&(hs(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i!=null&&i.key&&i.iv&&Ys(i.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer,qg(i.method)).catch(o=>{throw s.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();s.trigger(S.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=B.IDLE})}}doTick(){if(!this.media){this.state=B.IDLE;return}if(this.state===B.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details||this.waitForLive(r))return;const{config:i}=this,s=this.getLoadPosition(),a=ge.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:o,len:l}=a,u=r.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,h=d.length,f=u.edge;let g=null;const m=this.fragPrevious;if(o<f){const v=i.maxFragLookUpTolerance,E=o>f-v?0:v;g=hs(m,d,Math.max(d[0].start,o),E),!g&&m&&m.start<d[0].start&&(g=d[0])}else g=d[h-1];if(g=this.filterReplacedPrimary(g,r.details),!g)return;const p=g.sn-u.startSN,y=d[p-1];if(y&&y.cc===g.cc&&this.fragmentTracker.getState(y)===gt.NOT_LOADED&&(g=y),this.fragmentTracker.getState(g)===gt.NOT_LOADED){const v=this.mapToInitFragWhenRequired(g);v&&this.loadFragment(v,r,o)}}}loadFragment(e,t,r){xt(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new TM(this.tracksBuffered[this.currentTrackId]||[])}}class TM{constructor(e){this.buffered=void 0;const t=(r,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}const _M={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},vT=n=>String.fromCharCode(_M[n]||n),kn=15,_r=100,LM={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},AM={17:2,18:4,21:6,22:8,23:10,19:13,20:15},RM={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},IM={25:2,26:4,29:6,30:8,31:10,27:13,28:15},wM=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CM{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;Re.log(`${this.time} [${e}] ${r}`)}}}const Ui=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class ET{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class DM{constructor(){this.uchar=" ",this.penState=new ET}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class bM{constructor(e){this.chars=[],this.pos=0,this.currPenState=new ET,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<_r;t++)this.chars.push(new DM);this.logger=e}equals(e){for(let t=0;t<_r;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<_r;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<_r;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>_r&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=_r)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=vT(e);if(this.pos>=_r){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<_r;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<_r;r++){const i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class th{constructor(e){this.rows=[],this.currRow=kn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<kn;t++)this.rows.push(new bM(e));this.logger=e}reset(){for(let e=0;e<kn;e++)this.rows[e].clear();this.currRow=kn-1}equals(e){let t=!0;for(let r=0;r<kn;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<kn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<kn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ke(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<kn;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[s].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[s+u])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ke(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let s=0;s<kn;s++){const a=this.rows[s].getTextString();a&&(i=s+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class xy{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new th(r),this.nonDisplayedMemory=new th(r),this.lastOutputScreen=new th(r),this.currRollUpRow=this.displayedMemory.rows[kn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[kn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}this.logger.log(2,"MIDROW: "+Ke(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ty{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=PM(),this.logger=void 0;const i=this.logger=new CM;this.channels=[null,new xy(e,t,i),new xy(e+1,r,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const i=t[r]&127,s=t[r+1]&127;let a=!1,o=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+Ui([t[r],t[r+1]])+"] -> ("+Ui([i,s])+")");const l=this.cmdHistory;if(i>=16&&i<=31){if(kM(i,s,l)){ru(null,null,l),this.logger.log(3,()=>"Repeated command ("+Ui([i,s])+") is dropped");continue}ru(i,s,this.cmdHistory),a=this.parseCmd(i,s),a||(a=this.parseMidrow(i,s)),a||(a=this.parsePAC(i,s)),a||(a=this.parseBackgroundAttributes(i,s))}else ru(null,null,l);if(!a&&(o=this.parseChars(i,s),o)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ui([i,s])+" orig: "+Ui([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(r||i))return!1;const s=e===20||e===21||e===23?1:2,a=this.channels[s];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ui([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const a=e<=23?1:2;t>=64&&t<=95?r=a===1?LM[e]:RM[e]:r=a===1?AM[e]:IM[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,i.underline=(r&1)===1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((r-16)/2)*4,i}parseChars(e,t){let r,i=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+vT(a)+"' in channel "+r),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Ui(i).join(",")),i}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(r||i))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=wM[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}ru(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function ru(n,e,t){t.a=n,t.b=e}function kM(n,e,t){return t.a===n&&t.b===e}function PM(){return{a:null,b:null}}var om=function(){if(mc!=null&&mc.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const u=l.toLowerCase();return~o.indexOf(u)?u:!1}function r(o){return t(n,o)}function i(o){return t(e,o)}function s(o,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)o[d]=c[d]}return o}function a(o,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let h="",f=!1,g=o,m=l,p=u,y=null,v="",E=!0,_="auto",L="start",R=50,A="middle",T=50,w="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return h},set:function(I){h=""+I}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return f},set:function(I){f=!!I}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return g},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");g=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return m},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");m=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return p},set:function(I){p=""+I,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return y},set:function(I){y=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return v},set:function(I){const M=r(I);if(M===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=M,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return E},set:function(I){E=!!I,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return _},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");_=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return L},set:function(I){const M=i(I);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");L=M,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return R},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");R=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return A},set:function(I){const M=i(I);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");A=M,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return T},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");T=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return w},set:function(I){const M=i(I);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");w=M,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class OM{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ST(n){function e(r,i,s,a){return(r|0)*3600+(i|0)*60+(s|0)+parseFloat(a||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class FM{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function xT(n,e,t,r){const i=r?n.split(r):[n];for(const s in i){if(typeof i[s]!="string")continue;const a=i[s].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const Pf=new om(0,0,""),iu=Pf.align==="middle"?"middle":"center";function MM(n,e,t){const r=n;function i(){const o=ST(n);if(o===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,l){const u=new FM;xT(o,function(h,f){let g;switch(h){case"region":for(let m=t.length-1;m>=0;m--)if(t[m].id===f){u.set(h,t[m].region);break}break;case"vertical":u.alt(h,f,["rl","lr"]);break;case"line":g=f.split(","),u.integer(h,g[0]),u.percent(h,g[0])&&u.set("snapToLines",!1),u.alt(h,g[0],["auto"]),g.length===2&&u.alt("lineAlign",g[1],["start",iu,"end"]);break;case"position":g=f.split(","),u.percent(h,g[0]),g.length===2&&u.alt("positionAlign",g[1],["start",iu,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,f);break;case"align":u.alt(h,f,["start",iu,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&Pf.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",iu);let d=u.get("position","auto");d==="auto"&&Pf.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){n=n.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),a(),e.endTime=i(),a(),s(n,e)}function TT(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class NM{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new OM,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let s=t.buffer,a=0;for(s=TT(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const o=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),o}function i(s){xT(s,function(a,o){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const o=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=r(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new om(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{MM(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const UM=/\r\n|\n\r|\n|\r/g,nh=function(e,t,r=0){return e.slice(r,r+t.length)===t},$M=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Z(t)||!Z(r)||!Z(i)||!Z(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*i,t+=60*60*1e3*s,t};function lm(n,e,t){return go(n.toString())+go(e.toString())+go(t)}const BM=function(e,t,r){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=r};function jM(n,e,t,r,i,s,a){const o=new NM,l=hn(new Uint8Array(n)).trim().replace(UM,`
`).split(`
`),u=[],c=e?nF(e.baseTime,e.timescale):0;let d="00:00.000",h=0,f=0,g,m=!0;o.oncue=function(p){const y=t[r];let v=t.ccOffset;const E=(h-c)/9e4;if(y!=null&&y.new&&(f!==void 0?v=t.ccOffset=y.start:BM(t,r,E)),E){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}v=E-t.presentationOffset}const _=p.endTime-p.startTime,L=Sn((p.startTime+v-f)*9e4,i*9e4)/9e4;p.startTime=Math.max(L,0),p.endTime=Math.max(L+_,0);const R=p.text.trim();p.text=decodeURIComponent(encodeURIComponent(R)),p.id||(p.id=lm(p.startTime,p.endTime,R)),p.endTime>0&&u.push(p)},o.onparsingerror=function(p){g=p},o.onflush=function(){if(g){a(g);return}s(u)},l.forEach(p=>{if(m)if(nh(p,"X-TIMESTAMP-MAP=")){m=!1,p.slice(16).split(",").forEach(y=>{nh(y,"LOCAL:")?d=y.slice(6):nh(y,"MPEGTS:")&&(h=parseInt(y.slice(7)))});try{f=$M(d)/1e3}catch(y){g=y}return}else p===""&&(m=!1);o.parse(p+`
`)}),o.flush()}const rh="stpp.ttml.im1t",_T=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,LT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,GM={left:"start",center:"center",right:"end",start:"start",end:"end"};function _y(n,e,t,r){const i=me(new Uint8Array(n),["mdat"]);if(i.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(o=>hn(o)),a=tF(e.baseTime,1,e.timescale);try{s.forEach(o=>t(VM(o,a)))}catch(o){r(o)}}function VM(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((d,h)=>(d[h]=i.getAttribute(`ttp:${h}`)||s[h],d),{}),o=i.getAttribute("xml:space")!=="preserve",l=Ly(ih(i,"styling","style")),u=Ly(ih(i,"layout","region")),c=ih(i,"body","[begin]");return[].map.call(c,d=>{const h=AT(d,o);if(!h||!d.hasAttribute("begin"))return null;const f=ah(d.getAttribute("begin"),a),g=ah(d.getAttribute("dur"),a);let m=ah(d.getAttribute("end"),a);if(f===null)throw Ay(d);if(m===null){if(g===null)throw Ay(d);m=f+g}const p=new om(f-e,m-e,h);p.id=lm(p.startTime,p.endTime,p.text);const y=u[d.getAttribute("region")],v=l[d.getAttribute("style")],E=HM(y,v,l),{textAlign:_}=E;if(_){const L=GM[_];L&&(p.lineAlign=L),p.align=_}return Oe(p,E),p}).filter(d=>d!==null)}function ih(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function Ly(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function AT(n,e){return[].slice.call(n.childNodes).reduce((t,r,i)=>{var s;return r.nodeName==="br"&&i?t+`
`:(s=r.childNodes)!=null&&s.length?AT(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function HM(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),s.reduce((o,l)=>{const u=sh(e,r,l)||sh(n,r,l)||sh(i,r,l);return u&&(o[l]=u),o},{})}function sh(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function Ay(n){return new Error(`Could not parse ttml timestamp ${n}`)}function ah(n,e){if(!n)return null;let t=ST(n);return t===null&&(_T.test(n)?t=KM(n,e):LT.test(n)&&(t=zM(n,e))),t}function KM(n,e){const t=_T.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function zM(n,e){const t=LT.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class su{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class WM{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Iy(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new su(this,"textTrack1"),t=new su(this,"textTrack2"),r=new su(this,"textTrack3"),i=new su(this,"textTrack4");this.cea608Parser1=new Ty(1,e,t),this.cea608Parser2=new Ty(3,r,i)}addCues(e,t,r,i,s){let a=!1;for(let o=s.length;o--;){const l=s[o],u=qM(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),a=!0,u/(r-t)>.5))return}if(a||s.push([t,r]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,r,i)}else{const o=this.Cues.newCue(null,t,r,i);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){const{unparsedVttFrags:a}=this;r===ne.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),a.length&&(this.unparsedVttFrags=[],a.forEach(o=>{this.onFragLoaded(S.FRAG_LOADED,o)}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let i=0;i<r.textTracks.length;i++){const s=r.textTracks[i];if(Ry(s,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:s,languageCode:a}=t[e],o=this.getExistingTrack(s,a);if(o)r[e]=o,js(r[e]),mT(r[e],i);else{const l=this.createTextTrack("captions",s,a);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,i={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,r){const i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:i}=this;Object.keys(i).forEach(s=>{js(i[s]),delete i[s]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Iy(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)js(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some(s=>s.textCodec===rh);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(oT(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,o=a?Du(a.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(o){let d=null;for(let h=0;h<o.length;h++)if(o[h]&&Ry(o[h],l)){d=o[h],o[h]=null;break}d&&(c=d)}if(c)js(c);else{const d=RT(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),o!=null&&o.length){const l=o.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const i=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!i)return;const s=`textTrack${i[1]}`,a=this.captionsProperties[s];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ne.MAIN){var r,i;const{cea608Parser1:s,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:u}=t.frag,c=(r=(i=t.part)==null?void 0:i.index)!=null?r:-1;s&&a&&(u!==o+1||u===o&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),a.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===ne.SUBTITLE)if(i.byteLength){const s=r.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const o=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),o&&o.textCodec===rh?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;_y(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{r.logger.log(`Failed to parse IMSC1: ${i}`),r.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:s,unparsedVttFrags:a}=this,o=s.length-1;if(!s[r.cc]&&o===-1){a.push(e);return}const l=this.hls,u=(t=r.initSegment)!=null&&t.data?wn(r.initSegment.data,new Uint8Array(i)).buffer:i;jM(u,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(r,i),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&o>r.cc)&&l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||_y(t,this.initPTS[e.cc],()=>{r.textCodec=rh,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>pT(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;r.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===ne.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:i}=t;if(!(r.type===ne.MAIN&&this.closedCaptionsForLevel(r)==="NONE"))for(let s=0;s<i.length;s++){const a=i[s].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(i[s].pts,o[0]),this.cea608Parser2.addData(i[s].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:s}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>kf(o[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>kf(o[l],t,i))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let i=2;for(let s=0;s<r;s++){const a=e[i++],o=127&e[i++],l=127&e[i++];if(o===0&&l===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(t[c].push(o),t[c].push(l))}}return t}}function RT(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function Ry(n,e){return!!n&&n.kind===RT(e)&&Cf(e,n)}function qM(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function Iy(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const YM=/\s/,QM={newCue(n,e,t,r){const i=[];let s,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<r.rows.length;h++)if(s=r.rows[h],o=!0,l=0,u="",!s.isEmpty()){var d;for(let m=0;m<s.chars.length;m++)YM.test(s.chars[m].uchar)&&o?l++:(u+=s.chars[m].uchar,o=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const f=TT(u.trim()),g=lm(e,t,f);n!=null&&(d=n.cues)!=null&&d.getCueById(g)||(a=new c(e,t,f),a.id=g,a.line=h+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),i.push(a))}return n&&i.length&&(i.sort((h,f)=>h.line==="auto"||f.line==="auto"?0:h.line>8&&f.line>8?f.line-h.line:h.line-f.line),i.forEach(h=>pT(n,h))),i}};function XM(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const ZM=/(\d+)-(\d+)\/(\d+)/;class wy{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||nN,this.controller=new self.AbortController,this.stats=new Vg}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=JM(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&Z(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(jo(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var h;this.response=this.loader=d;const f=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},u-(f-i.loading.start)),!d.ok){const{status:m,statusText:p}=d;throw new rN(p||"fetch, bad network response",m,d)}i.loading.first=f,i.total=tN(d.headers)||i.total;const g=(h=this.callbacks)==null?void 0:h.onProgress;return g&&Z(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,g):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var h,f;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const m=d[o];m&&(i.loaded=i.total=m);const p={url:g.url,data:d,code:g.status},y=(h=this.callbacks)==null?void 0:h.onProgress;y&&!Z(t.highWaterMark)&&y(i,e,d,g),(f=this.callbacks)==null||f.onSuccess(p,i,e,g)}).catch(d=>{var h;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const f=d&&d.code||0,g=d?d.message:null;(h=this.callbacks)==null||h.onError({code:f,text:g},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,s){const a=new jx,o=e.body.getReader(),l=()=>o.read().then(u=>{if(u.done)return a.dataLength&&s(t,r,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<i||a.dataLength?(a.push(c),a.dataLength>=i&&s(t,r,a.flush().buffer,e)):s(t,r,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function JM(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Oe({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function eN(n){const e=ZM.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function tN(n){const e=n.get("Content-Range");if(e){const r=eN(e);if(Z(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function nN(n,e){return new self.Request(n.url,e)}class rN extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const iN=/^age:\s*[\d.]+\s*$/im;class IT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Vg,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return s(r,t.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),s(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:r.status,text:a.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=r.loadPolicy;if(i)for(const o in i)e.setRequestHeader(o,i[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&Z(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const g=c??t.response;if(g!=null){var a,o;r.loading.end=Math.max(self.performance.now(),r.loading.first);const m=t.responseType==="arraybuffer"?g.byteLength:g.length;r.loaded=r.total=m,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first);const p=(a=this.callbacks)==null?void 0:a.onProgress;p&&p(r,e,g,t);const y={url:t.responseURL,data:g,code:u};(o=this.callbacks)==null||o.onSuccess(y,r,e,t);return}}const d=s.loadPolicy.errorRetry,h=r.retry,f={url:e.url,data:void 0,code:u};if(gc(d,h,!1,f))this.retry(d);else{var l;Re.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,r)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(gc(e,t,!0))this.retry(e);else{var r;Re.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Kg(e,r.retry),r.retry++,Re.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&iN.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const sN={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},aN=we(we({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:IT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:CP,bufferController:yF,capLevelController:sm,errorController:OP,fpsController:uM,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Dx,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:sN},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},oN()),{},{subtitleStreamController:xM,subtitleTrackController:hM,timelineController:WM,audioStreamController:fF,audioTrackController:gF,emeController:Qs,cmcdController:aM,contentSteeringController:lM,interstitialsController:SM});function oN(){return{cueHandler:QM,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function lN(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const r=Of(n),i=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,u=[];s.forEach(c=>{const d=`${a}Loading${c}`,h=e[d];if(h!==void 0&&l){u.push(d);const f=r[o].default;switch(e[o]={default:f},c){case"TimeOut":f.maxLoadTimeMs=h,f.maxTimeToFirstByteMs=h;break;case"MaxRetry":f.errorRetry.maxNumRetry=h,f.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":f.errorRetry.retryDelayMs=h,f.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=h,f.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${o}": ${Ke(e[o])}`)}),we(we({},r),e)}function Of(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(Of):Object.keys(n).reduce((e,t)=>(e[t]=Of(n[t]),e),{}):n}function uN(n,e){const t=n.loader;t!==wy&&t!==IT?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):XM()&&(n.loader=wy,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const bu=2,cN=.1,dN=.05,hN=100;class fN extends Ix{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var r;(r=this.media)!=null&&r.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var r;this.ended=((r=this.media)==null?void 0:r.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(hN),this.mediaSource=t.mediaSource;const r=this.media=t.media;un(r,"playing",this.onMediaPlaying),un(r,"waiting",this.onMediaWaiting),un(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(Ln(r,"playing",this.onMediaPlaying),Ln(r,"waiting",this.onMediaWaiting),Ln(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,i;const s=(r=this.hls)==null?void 0:r.config;if(!s)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,u=!this.seeking&&o,c=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,s.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!ge.getBuffered(a).length){this.nudgeRetry=0;return}const d=ge.bufferInfo(a,e,0),h=d.nextStart||0,f=this.fragmentTracker;if(o&&f&&this.hls){const R=Cy(this.hls.inFlightFragments,e),A=d.len>bu,T=!h||R||h-e>bu&&!f.getPartialFragment(e);if(A||T)return;this.moved=!1}const g=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&f){if(!(d.len>0)&&!h)return;const A=Math.max(h,d.start||0)-e,w=!!(g!=null&&g.live)?g.targetduration*2:bu,I=f.getPartialFragment(e);if(A>0&&(A<=w||I)){a.paused||this._trySkipBufferHole(I);return}}const m=s.detectStallWithCurrentTimeMs,p=self.performance.now(),y=this.waiting;let v=this.stalled;if(v===null)if(y>0&&p-y<m)v=this.stalled=y;else{this.stalled=p;return}const E=p-v;if(!o&&(E>=m||y)&&this.hls){var _;if(((_=this.mediaSource)==null?void 0:_.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const L=ge.bufferInfo(a,e,s.maxBufferHole);this._tryFixBufferStall(L,E,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(r=this.buffered.audio)!=null&&r.length&&i&&i.length>1&&e>i.end(0)){const s=ge.bufferedInfo(ge.timeRangesToArray(this.buffered.audio),e,0);if(s.len>1&&t>=s.start){const a=ge.timeRangesToArray(i),o=ge.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=ge.bufferedInfo(a,e,0).bufferedIndex,u=a[o].end,c=a[o+1].start;if((l===-1||l>o)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;const h=this.fragmentTracker.getPartialFragment(e)||void 0,f=ge.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:h,buffer:f.len,bufferInfo:f})}}}}}_tryFixBufferStall(e,t,r){var i,s;const{fragmentTracker:a,media:o}=this,l=(i=this.hls)==null?void 0:i.config;if(!o||!a||!l)return;const u=(s=this.hls)==null?void 0:s.latestLevelDetails,c=a.getPartialFragment(r);if((c||u!=null&&u.live&&r<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,h=this.adjacentTraversal(e,r);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-r<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,i=e.nextStart;if(r&&i){const s=r.getFragAtPos(t,ne.MAIN),a=r.getFragAtPos(i,ne.MAIN);if(s&&a)return a.sn-s.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:i,stalled:s}=this;if(!i&&s!==null&&r&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${Ke(e)})`);this.warn(a.message),t.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:s}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:i}=this,s=(t=this.hls)==null?void 0:t.config;if(!i||!r||!s)return 0;const a=i.currentTime,o=ge.bufferInfo(i,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const c=o.len<=s.maxBufferHole,d=o.len>0&&o.len<1&&i.readyState<3,h=l-a;if(h>0&&(c||d)){if(h>s.maxBufferHole){let g=!1;if(a===0){const m=r.getAppendedFrag(0,ne.MAIN);m&&l<m.end&&(g=!0)}if(!g){const m=e||r.getAppendedFrag(a,ne.MAIN);if(m){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||Cy(this.hls.inFlightFragments,l))return 0;let y=!1,v=m.end;for(;v<l;){const E=r.getPartialFragment(v);if(E)v+=E.duration;else{y=!0;break}}if(y)return 0}}}const f=Math.max(l+dN,a+cN);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${f}`),this.moved=!0,i.currentTime=f,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${f}`);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:e||void 0,buffer:o.len,bufferInfo:o})}return f}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:i}=this,s=t==null?void 0:t.config;if(!r||!s)return 0;const a=r.currentTime;if(this.nudgeRetry++,i<s.nudgeMaxRetry){const o=a+(i+1)*s.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),r.currentTime=o,t.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${s.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Cy(n,e){const t=Dy(n.main);if(t&&t.start<=e)return t;const r=Dy(n.audio);return r&&r.start<=e?r:null}function Dy(n){if(!n)return null;switch(n.state){case B.IDLE:case B.STOPPED:case B.ENDED:case B.ERROR:return null}return n.frag}const gN=.25;function Ff(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function by(n,e,t,r,i){let s=new n(e,t,"");try{s.value=r,i&&(s.type=i)}catch{s=new n(e,t,Ke(i?we({type:i},r):r))}return s}const au=(()=>{const n=Ff();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function mN(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class pN{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&js(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return mT(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:i}}}=this;if(!r&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Ff();if(a)for(let o=0;o<s.length;o++){const l=s[o].type;if(l===on.emsg&&!r||!i)continue;const u=qx(s[o].data);if(u){const c=s[o].pts;let d=c+s[o].duration;d>au&&(d=au),d-c<=0&&(d=c+gN);for(let f=0;f<u.length;f++){const g=u[f];if(!Yx(g)){this.updateId3CueEnds(c,l);const m=by(a,c,d,g,l);m&&this.id3Track.addCue(m)}}}}}updateId3CueEnds(e,t){var r;const i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(let s=i.length;s--;){const a=i[s];a.type===t&&a.startTime<e&&a.endTime===au&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let u;i==="audio"?u=c=>c.type===on.audioId3&&l:i==="video"?u=c=>c.type===on.emsg&&o:u=c=>c.type===on.audioId3&&l||c.type===on.emsg&&o,kf(s,t,r,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:r}=this,{dateRanges:i}=e,s=Object.keys(i);let a=this.dateRangeCuesAppended;if(r&&t){var o;if((o=r.cues)!=null&&o.length){const c=Object.keys(a).filter(d=>!s.includes(d));for(let d=c.length;d--;){const h=c[d],f=a[h].cues;delete a[h],Object.keys(f).forEach(g=>{try{const m=f[g];m.removeEventListener("enter",this.onEventCueEnter),r.removeCue(m)}catch{}})}}else a=this.dateRangeCuesAppended={}}const l=e.fragments[e.fragments.length-1];if(s.length===0||!Z(l==null?void 0:l.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const u=Ff();for(let c=0;c<s.length;c++){const d=s[c],h=i[d],f=h.startTime,g=a[d],m=(g==null?void 0:g.cues)||{};let p=(g==null?void 0:g.durationKnown)||!1,y=au;const{duration:v,endDate:E}=h;if(E&&v!==null)y=f+v,p=!0;else if(h.endOnNext&&!p){const L=s.reduce((R,A)=>{if(A!==h.id){const T=i[A];if(T.class===h.class&&T.startDate>h.startDate&&(!R||h.startDate<R.startDate))return T}return R},null);L&&(y=L.startTime,p=!0)}const _=Object.keys(h.attr);for(let L=0;L<_.length;L++){const R=_[L];if(!WP(R))continue;const A=m[R];if(A)p&&!g.durationKnown?A.endTime=y:Math.abs(A.startTime-f)>.01&&(A.startTime=f,A.endTime=y);else if(u){let T=h.attr[R];qP(R)&&(T=mN(T));const I=by(u,f,y,{key:R,data:T},on.dateRange);I&&(I.id=d,this.id3Track.addCue(I),m[R]=I,this.hls.config.interstitialsController&&(R==="X-ASSET-LIST"||R==="X-ASSET-URL")&&I.addEventListener("enter",this.onEventCueEnter))}}a[d]={cues:m,dateRange:h,durationKnown:p}}}}class yN{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,r=this.levelDetails;if(!t||!r)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:a}=this.config;if(!s||a===1||!r.live)return;const o=this.targetLatency;if(o===null)return;const l=i-o,u=Math.min(this.maxLatency,o+r.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,f=Math.min(d,Math.max(1,h));this.changeMediaPlaybackRate(t,f)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let u=o&&r||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:a*i);const c=i;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const r=this.levelDetails;if(r===null)return null;const i=r.edge,s=e-t-this.edgeStalled,a=i-r.totalduration,o=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,s),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===O.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,i;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class vN extends im{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,i=[],s={},a={};let o=!1,l=!1,u=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:h,videoCodec:f}=c;h&&(c.audioCodec=h=cc(h,r)||void 0),f&&(f=c.videoCodec=mP(f));const{width:g,height:m,unknownCodecs:p}=c;let y=p?p.length:0;if(p)for(let I=y;I--;){const M=p[I];this.isAudioSupported(M)?(c.audioCodec=h=h?`${h},${M}`:M,y--,Sa.audio[h.substring(0,4)]=2):this.isVideoSupported(M)&&(c.videoCodec=f=f?`${f},${M}`:M,y--,Sa.video[f.substring(0,4)]=2)}if(o||(o=!!(g&&m)),l||(l=!!f),u||(u=!!h),y||h&&!this.isAudioSupported(h)||f&&!this.isVideoSupported(f)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:v,"FRAME-RATE":E,"HDCP-LEVEL":_,"PATHWAY-ID":L,RESOLUTION:R,"VIDEO-RANGE":A}=d,w=`${`${L||"."}-`}${c.bitrate}-${R}-${E}-${v}-${A}-${_}`;if(s[w])if(s[w].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const I=a[w]+=1;c.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const M=this.createLevel(c);s[w]=M,i.push(M)}else s[w].addGroupId("audio",d.AUDIO),s[w].addGroupId("text",d.SUBTITLES);else{const I=this.createLevel(c);s[w]=I,a[w]=1,i.push(I)}}),this.filterAndSortMediaOptions(i,t,o,l,u)}createLevel(e){const t=new Mo(e),r=e.supplemental;if(r!=null&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(i.message),t.supportedResult=Tx(i,[])}return t}isAudioSupported(e){return xf(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return xf(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,i,s){let a=[],o=[],l=e;if((r||i)&&s&&(l=l.filter(({videoCodec:p,videoRange:y,width:v,height:E})=>(!!p||!!(v&&E))&&SP(y))),l.length===0){Promise.resolve().then(()=>{if(this.hls){let p="no level with compatible codecs found in manifest",y=p;t.levels.length&&(y=`one or more CODECS in variant not supported: ${Ke(t.levels.map(E=>E.attrs.CODECS).filter((E,_,L)=>L.indexOf(E)===_))}`,this.warn(y),p+=` (${y})`);const v=new Error(p);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:v,reason:y})}});return}t.audioTracks&&(a=t.audioTracks.filter(p=>!p.audioCodec||this.isAudioSupported(p.audioCodec)),ky(a)),t.subtitles&&(o=t.subtitles,ky(o));const u=l.slice(0);l.sort((p,y)=>{if(p.attrs["HDCP-LEVEL"]!==y.attrs["HDCP-LEVEL"])return(p.attrs["HDCP-LEVEL"]||"")>(y.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&p.height!==y.height)return p.height-y.height;if(p.frameRate!==y.frameRate)return p.frameRate-y.frameRate;if(p.videoRange!==y.videoRange)return dc.indexOf(p.videoRange)-dc.indexOf(y.videoRange);if(p.videoCodec!==y.videoCodec){const v=A0(p.videoCodec),E=A0(y.videoCodec);if(v!==E)return E-v}if(p.uri===y.uri&&p.codecSet!==y.codecSet){const v=uc(p.codecSet),E=uc(y.codecSet);if(v!==E)return E-v}return p.averageBitrate!==y.averageBitrate?p.averageBitrate-y.averageBitrate:0});let c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length)){for(let p=0;p<u.length;p++)if(u[p].pathwayId===l[0].pathwayId){c=u[p];break}}this._levels=l;for(let p=0;p<l.length;p++)if(l[p]===c){var d;this._firstLevel=p;const y=c.bitrate,v=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${y}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const E=Math.min(y,this.hls.config.abrEwmaDefaultEstimateMax);E>v&&v===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=E)}break}const h=s&&!i,f=this.hls.config,g=!!(f.audioStreamController&&f.audioTrackController),m={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:g&&!h&&a.some(p=>!!p.url)};this.hls.trigger(S.MANIFEST_PARSED,m)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&i&&s===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${r}${s?" with Pathway "+s:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,l);const u=a.details;if(!u||u.live){const c=this.switchParams(a.uri,i==null?void 0:i.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=r}}onError(e,t){t.fatal||!t.context||t.context.type===Se.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ne.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(s=>!!r[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:s}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${i}`),(o=t.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(i,t,l)}else(r=t.deliveryDirectives)!=null&&r.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,s=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${i}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${s?" Pathway "+s:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(S.LEVEL_LOADING,{url:r,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const r=this._levels.filter((s,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(o=>o.level=-1)),!1));Ux(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=r.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(S.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function ky(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function wT(){return self.SourceBuffer||self.WebKitSourceBuffer}function CT(){if(!wi())return!1;const e=wT();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function EN(){if(!CT())return!1;const n=wi();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Fo(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Fo(e,"audio"))))}function SN(){var n;const e=wT();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const xN=100;class TN extends Qg{constructor(e,t,r){super(e,t,r,"stream-controller",ne.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,s=i?i.currentTime:null;if(s===null||!Z(s)||(this.log(`Media seeked to ${s.toFixed(3)}`),!this.getBufferedFrag(s)))return;const a=this.getFwdBufferInfoAtPos(i,s,ne.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${s} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:i}=this;if(this.stopLoad(),this.setInterval(xN),this.level=-1,!this.startFragRequested){let s=i.startLevel;s===-1&&(i.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=i.firstAutoLevel),i.nextLoadLevel=s,this.level=i.loadLevel,this._hasEnoughToStart=!!t}r>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=B.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=B.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case B.WAITING_LEVEL:{const{levels:t,level:r}=this,i=t==null?void 0:t[r],s=i==null?void 0:i.details;if(s&&(!s.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(s))break;this.state=B.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=B.IDLE;break}break}case B.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:i,level:s}=this,a=i==null?void 0:i[s];this.resetStartWhenNotLoaded(a||null),this.state=B.IDLE}}break}this.state===B.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[s]))return;const a=r[s],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const m={};this.altAudio===2&&(m.type="video"),this.hls.trigger(S.BUFFER_EOS,m),this.state=B.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=a.details;if(!u||this.state===B.WAITING_LEVEL||this.waitForLive(a)){this.level=s,this.state=B.WAITING_LEVEL,this.startFragRequested=!1;return}const c=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let f=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&f&&xt(f)&&this.fragmentTracker.getState(f)!==gt.OK){var g;const p=((g=this.backtrackFragment)!=null?g:f).sn-u.startSN,y=u.fragments[p-1];y&&f.cc===y.cc&&(f=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,h)){if(!f.gap){const p=this.audioOnly&&!this.altAudio?$e.AUDIO:$e.VIDEO,y=(p===$e.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,p,ne.MAIN)}f=this.getNextFragmentLoopLoading(f,u,o,ne.MAIN,d)}f&&(f.initSegment&&!f.initSegment.data&&!this.bitrateTest&&(f=f.initSegment),this.loadFragment(f,a,h))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);i===gt.NOT_LOADED||i===gt.PARTIAL?xt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ne.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],u=this.fragLastKbps;u&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:r=0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(a.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case B.KEY_LOADING:case B.FRAG_LOADING:case B.FRAG_LOADING_WAITING_RETRY:case B.PARSING:case B.PARSED:this.state=B.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;un(r,"playing",this.onMediaPlaying),un(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(Ln(r,"playing",this.onMediaPlaying),Ln(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,i=!1;t.levels.forEach(s=>{const a=s.audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&i&&!SN(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==B.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=B.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:i,startFragRequested:s}=this,a=t.level,o=t.details,l=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===B.FRAG_LOADING||this.state===B.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(o.live||(r=u.details)!=null&&r.live){var h;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(u.details=o,this.levelLastLoaded=u,s||this.setStartPosition(o,d),this.hls.trigger(S.LEVEL_UPDATED,{details:o,level:a}),this.state===B.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=B.IDLE}s&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,s=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=s>=a-t.maxFragLookUpTolerance&&s<=o;if(i!==null&&r.duration>i&&(s<i||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&r.readyState<4||s<o-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),r.readyState))if(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=ge.bufferInfo(r,i,0);if(!(d!=null&&(u=d.buffered)!=null&&u.length)){r.currentTime=i;return}if(d.start<=s){r.currentTime=i;return}const{nextStart:f}=ge.bufferedInfo(d.buffered,s,0);f&&(r.currentTime=f)}else r.currentTime=i}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:i,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const o=a[r.level];if(!o){this.warn(`Level ${r.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const u=o.videoCodec,c=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,h=this._getAudioCodec(o),f=this.transmuxer=this.transmuxer||new aT(this.hls,ne.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=i?i.index:-1,m=g!==-1,p=new Wg(r.level,r.sn,r.stats.chunkCount,s.byteLength,g,m),y=this.initPTS[r.cc];f.push(s,d,h,u,r,i,l.totalduration,c,p,y)}onAudioTrackSwitching(e,t){const r=this.hls,i=this.altAudio===2;if(hc(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.fragmentTracker.removeAllFragments(),r.once(S.BUFFER_FLUSHED,()=>{var a;(a=this.hls)==null||a.trigger(S.AUDIO_TRACK_SWITCHED,t)}),r.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}r.trigger(S.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=hc(t.url,this.hls);if(r){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,s,a=!1;for(const o in r){const l=r[o];if(l.id==="main"){if(s=o,i=l,o==="video"){const u=r[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t,s=r.type===ne.MAIN;if(s){if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===B.PARSED&&(this.state=B.IDLE);return}const o=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),xt(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}const a=this.media;a&&(!this._hasEnoughToStart&&ge.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),s&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal){this.state=B.ERROR;return}switch(t.details){case O.FRAG_GAP:case O.FRAG_PARSING_ERROR:case O.FRAG_DECRYPT_ERROR:case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ne.MAIN,t);break;case O.LEVEL_LOAD_ERROR:case O.LEVEL_LOAD_TIMEOUT:case O.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===B.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Se.LEVEL&&(this.state=B.IDLE);break;case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case O.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case O.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=B.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==$e.AUDIO||!this.altAudio){const r=(t===$e.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;r&&(this.afterBufferFlushed(r,t,ne.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&r&&(r+=i);const s=this.getLevelDetails(),a=ge.getBuffered(e),o=a.length?a.start(0):0,l=o-r,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((s==null?void 0:s.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),r+=l,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${o}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:i}=this,s=r==null?void 0:r.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=B.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=s.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(S.FRAG_LOADED,r),s.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r=this.playlistType,{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:u,level:c}=o,{video:d,text:h,id3:f,initSegment:g}=s,{details:m}=c,p=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=B.PARSING,g){if(g!=null&&g.tracks){const E=l.initSegment||l;this._bufferInitSegment(c,g.tracks,E,a),i.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:r,tracks:g.tracks})}const y=g.initPTS,v=g.timescale;Z(y)&&(this.initPTS[l.cc]={baseTime:y,timescale:v},i.trigger(S.INIT_PTS_FOUND,{frag:l,id:r,initPTS:y,timescale:v}))}if(d&&m){p&&d.type==="audiovideo"&&this.logMuxedErr(l);const y=m.fragments[l.sn-1-m.startSN],v=l.sn===m.startSN,E=!y||l.cc>y.cc;if(s.independent!==!1){const{startPTS:_,endPTS:L,startDTS:R,endDTS:A}=d;if(u)u.elementaryStreams[d.type]={startPTS:_,endPTS:L,startDTS:R,endDTS:A};else if(d.firstKeyFrame&&d.independent&&a.id===1&&!E&&(this.couldBacktrack=!0),d.dropped&&d.independent){const T=this.getMainFwdBufferInfo(),w=(T?T.end:this.getLoadPosition())+this.config.maxBufferHole,I=d.firstKeyFramePTS?d.firstKeyFramePTS:_;if(!v&&w<I-this.config.maxBufferHole&&!E){this.backtrack(l);return}else E&&(l.gap=!0);l.setElementaryStreamInfo(d.type,l.start,L,l.start,A,!0)}else v&&_-(m.appliedTimelineOffset||0)>bu&&(l.gap=!0);l.setElementaryStreamInfo(d.type,_,L,R,A),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,u,a,v||E)}else if(v||E)l.gap=!0;else{this.backtrack(l);return}}if(p){const{startPTS:y,endPTS:v,startDTS:E,endDTS:_}=p;u&&(u.elementaryStreams[$e.AUDIO]={startPTS:y,endPTS:v,startDTS:E,endDTS:_}),l.setElementaryStreamInfo($e.AUDIO,y,v,E,_),this.bufferFragmentData(p,l,u,a)}if(m&&f!=null&&(t=f.samples)!=null&&t.length){const y={id:r,frag:l,details:m,samples:f.samples};i.trigger(S.FRAG_PARSING_METADATA,y)}if(m&&h){const y={id:r,frag:l,details:m,samples:h.samples};i.trigger(S.FRAG_PARSING_USERDATA,y)}}logMuxedErr(e){this.warn(`${xt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,i){if(this.state!==B.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:s,video:a,audiovideo:o}=t;if(s){let u=Lu(s.codec,e.audioCodec);u==="mp4a"&&(u="mp4a.40.5");const c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const d=s.metadata;d&&"channelCount"in d&&(d.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),e.audioCodec&&e.audioCodec!==u&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${u}"`),s.levelCodec=u,s.id=ne.MAIN,this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${u||""}/${e.audioCodec||""}/${s.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=ne.MAIN;const u=a.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${a.codec!==u?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(S.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:u,data:d,frag:r,part:null,chunkMeta:i,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ne.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,r=e==null?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=B.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(ge.isBuffered(e,r)?t=this.getAppendedFrag(r):ge.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(S.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Z(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Z(t)){const r=this.getLevelDetails(),i=this.currentFrag||(r?hs(null,r.fragments,t):null);if(i){const s=i.programDateTime;if(s!==null){const a=s+(t-i.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class _N{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[r].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=O.KEY_LOAD_ERROR,r,i,s){return new Rr({type:re.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length){const{sn:r,cc:i}=e;for(let s=0;s<t.length;s++){const a=t[s];if(i<=a.cc&&(r==="initSegment"||a.sn==="initSegment"||r<a.sn))return this.emeController.selectKeySystemFormat(a).then(o=>{if(a.setKeyFormat(o),this.emeController&&this.config.requireKeySystemAccessOnStart){const l=Ru(o);if(l)return this.emeController.getKeySystemAccess([l])}})}}else if(this.config.requireKeySystemAccessOnStart){const r=Ja(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,u))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let o=this.keyUriToKeyInfo[a];if((r=o)!=null&&r.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if((i=o)!=null&&i.keyLoadPromise){var l;switch((l=o.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(u=>(s.key=u.keyInfo.decryptdata.key,{frag:e,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,r))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,i=r.loader,s=new i(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,f,g,m)=>{const{frag:p,keyInfo:y,url:v}=g;if(!p.decryptdata||y!==this.keyUriToKeyInfo[v])return o(this.createKeyLoadError(p,O.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));y.decryptdata.key=p.decryptdata.key=new Uint8Array(h.data),p.keyLoader=null,y.loader=null,a({frag:p,keyInfo:y})},onError:(h,f,g,m)=>{this.resetLoader(f),o(this.createKeyLoadError(t,O.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),g,we({url:l.url,data:void 0},h)))},onTimeout:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(t,O.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(h,f,g)=>{this.resetLoader(f),o(this.createKeyLoadError(t,O.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};s.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}}function Py(n){const{type:e}=n;switch(e){case Se.AUDIO_TRACK:return ne.AUDIO;case Se.SUBTITLE_TRACK:return ne.SUBTITLE;default:return ne.MAIN}}function oh(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class LN{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,i=t.loader,s=r||i,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Se.MANIFEST,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:i,pathwayId:s,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:r,level:i,pathwayId:s,responseType:"text",type:Se.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Se.AUDIO_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:a,track:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:Se.SUBTITLE_TRACK,url:s,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const r=this.loaders[Se.LEVEL];if(r){const i=r.context;i&&!t.levels.some(s=>s===i.levelOrTrack)&&(r.abort(),delete this.loaders[Se.LEVEL])}}load(e){var t;const r=this.hls.config;let i=this.getInternalLoader(e);if(i){const u=this.hls.logger,c=i.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===Se.MANIFEST?s=r.manifestLoadPolicy.default:s=Oe({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Z((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===Se.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===Se.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===Se.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const h=Math.max(c*3,d*.8)*1e3;s=Oe({},s,{maxTimeToFirstByteMs:Math.min(h,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(u,c,d,h)=>{const f=this.getInternalLoader(d);this.resetInternalLoader(d.type);const g=u.data;if(g.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,d,new Error("no EXTM3U delimiter"),h||null,c);return}c.parsing.start=performance.now(),lr.isMediaPlaylist(g)||d.type!==Se.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,h||null,f):this.handleMasterPlaylist(u,c,d,h)},onError:(u,c,d,h)=>{this.handleNetworkError(c,d,!1,u,h)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};i.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,i){const s=this.hls,a=e.data,o=oh(e,r),l=lr.parseMasterPlaylist(a,o);if(l.playlistParsingError){this.handleManifestParsingError(e,r,l.playlistParsingError,i,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g}=l;this.variableList=g;const{AUDIO:m=[],SUBTITLES:p,"CLOSED-CAPTIONS":y}=lr.parseMasterPlaylistMedia(a,o,l);m.length&&!m.some(E=>!E.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ze({}),bitrate:0,url:""})),s.trigger(S.MANIFEST_LOADED,{levels:c,audioTracks:m,subtitles:p,captions:y,contentSteering:u,url:o,stats:t,networkDetails:i,sessionData:d,sessionKeys:h,startTimeOffset:f,variableList:g})}handleTrackOrLevelPlaylist(e,t,r,i,s){const a=this.hls,{id:o,level:l,type:u}=r,c=oh(e,r),d=Z(l)?l:Z(o)?o:0,h=Py(r),f=lr.parseLevelPlaylist(e.data,c,d,h,0,this.variableList);if(u===Se.MANIFEST){const g={attrs:new ze({}),bitrate:0,details:f,name:"",url:c};f.requestScheduled=t.loading.start+Fx(f,0),a.trigger(S.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=f,this.handlePlaylistLoaded(f,e,t,r,i,s)}handleManifestParsingError(e,t,r,i,s){this.hls.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.MANIFEST_PARSING_ERROR,fatal:t.type===Se.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,r=!1,i,s){let a=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Se.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Se.AUDIO_TRACK||e.type===Se.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=O.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case Se.MANIFEST:l=r?O.MANIFEST_LOAD_TIMEOUT:O.MANIFEST_LOAD_ERROR,u=!0;break;case Se.LEVEL:l=r?O.LEVEL_LOAD_TIMEOUT:O.LEVEL_LOAD_ERROR,u=!1;break;case Se.AUDIO_TRACK:l=r?O.AUDIO_TRACK_LOAD_TIMEOUT:O.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Se.SUBTITLE_TRACK:l=r?O.SUBTITLE_TRACK_LOAD_TIMEOUT:O.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:re.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:s};if(i){const h=(t==null?void 0:t.url)||e.url;d.response=we({url:h,data:void 0},i)}this.hls.trigger(S.ERROR,d)}handlePlaylistLoaded(e,t,r,i,s,a){const o=this.hls,{type:l,level:u,id:c,groupId:d,deliveryDirectives:h}=i,f=oh(t,i),g=Py(i),m=typeof i.level=="number"&&g===ne.MAIN?u:void 0;if(!e.fragments.length){const y=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:y,reason:y.message,response:t,context:i,level:m,parent:g,networkDetails:s,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const p=e.playlistParsingError;if(p){if(this.hls.logger.warn(p),!o.config.ignorePlaylistParsingErrors){o.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:p,reason:p.message,response:t,context:i,level:m,parent:g,networkDetails:s,stats:r});return}e.playlistParsingError=null}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Se.MANIFEST:case Se.LEVEL:o.trigger(S.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||o.levels[0],level:m||0,id:c||0,stats:r,networkDetails:s,deliveryDirectives:h,withoutMultiVariant:l===Se.MANIFEST});break;case Se.AUDIO_TRACK:o.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:h});break;case Se.SUBTITLE_TRACK:o.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:h});break}}}class sr{static get version(){return $o}static isMSESupported(){return CT()}static isSupported(){return EN()}static getMediaSource(){return wi()}static get Events(){return S}static get MetadataSchema(){return on}static get ErrorTypes(){return re}static get ErrorDetails(){return O}static get DefaultConfig(){return sr.defaultConfig?sr.defaultConfig:aN}static set DefaultConfig(e){sr.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Xg,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=Kk(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=lN(sr.DefaultConfig,e,t);this.userConfig=e,r.progressive&&uN(r,t);const{abrController:i,bufferController:s,capLevelController:a,errorController:o,fpsController:l}=r,u=new o(this),c=this.abrController=new i(this),d=new FP(this),h=r.interstitialsController,f=h?this.interstitialsController=new h(this,sr):null,g=this.bufferController=new s(this,d),m=this.capLevelController=new a(this),p=new l(this),y=new LN(this),v=r.contentSteeringController,E=v?new v(this):null,_=this.levelController=new vN(this,E),L=new pN(this),R=new _N(this.config),A=this.streamController=new TN(this,d,R),T=this.gapController=new fN(this,d);m.setStreamController(A),p.setStreamController(A);const w=[y,_,A];f&&w.splice(1,0,f),E&&w.splice(1,0,E),this.networkControllers=w;const I=[c,g,T,m,p,L,d];this.audioTrackController=this.createController(r.audioTrackController,w);const M=r.audioStreamController;M&&w.push(this.audioStreamController=new M(this,d,R)),this.subtitleTrackController=this.createController(r.subtitleTrackController,w);const j=r.subtitleStreamController;j&&w.push(this.subtititleStreamController=new j(this,d,R)),this.createController(r.timelineController,I),R.emeController=this.emeController=this.createController(r.emeController,I),this.cmcdController=this.createController(r.cmcdController,I),this.latencyController=this.createController(yN,I),this.coreComponents=I,w.push(u);const z=u.onErrorOut;typeof z=="function"&&this.on(S.ERROR,z,u),this.on(S.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const i=e===S.ERROR;this.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,fatal:i,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const s=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.ATTACH_MEDIA_ERROR,fatal:!0,error:s});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,i=t?e:{media:r};this._media=r,this.trigger(S.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,i=this._url=Gg.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),!(!this.started||!this.networkControllers));r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ne.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ne.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ne.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=fM()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){EP(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,r)for(let s=i;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=r)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const r=Lx(t);return _x(e,r,navigator.mediaCapabilities)}}sr.defaultConfig=void 0;const AN=({url:n,width:e=640,height:t=360})=>{const r=C.useRef(null);return C.useEffect(()=>{if(r.current)if(sr.isSupported()){const i=new sr({liveSyncDurationCount:1,maxLiveSyncPlaybackRate:1.5,enableWorker:!0,lowLatencyMode:!0});return i.loadSource(n),i.attachMedia(r.current),i.on(sr.Events.MANIFEST_PARSED,()=>{var s;(s=r.current)==null||s.play()}),()=>{i.destroy()}}else r.current.canPlayType("application/vnd.apple.mpegurl")&&(r.current.src=n,r.current.addEventListener("loadedmetadata",()=>{var i;(i=r.current)==null||i.play()}))},[n]),x.jsx("video",{ref:r,autoPlay:!0,controls:!0,muted:!0,playsInline:!0,width:e,height:t,style:{backgroundColor:"black"}})};function RN(){return x.jsx("div",{className:Mk.container,children:x.jsx(AN,{url:`${st}/stream/balkon/channel/0/hls/live/index.m3u8`})})}const IN="_container_kywe4_1",wN={container:IN},CN="_container_eu7zb_1",DN={container:CN},bN="_container_1d92m_1",kN="_selected_1d92m_45",Oy={container:bN,selected:kN};function ou({onClick:n,value:e,name:t,children:r}){const i=e===t;return x.jsx("div",{className:`${Oy.container} ${i?Oy.selected:""}`,onClick:()=>n(t),children:r})}function PN({onChange:n,value:e}){return x.jsxs("div",{className:DN.container,children:[x.jsx(ou,{onClick:n,value:e,name:"passwordChange",children:"Zmiana hasła"}),x.jsx(ou,{onClick:n,value:e,name:"homeChange",children:"Zmiana domu"}),x.jsx(ou,{onClick:n,value:e,name:"homeCode",children:"Kod domu"}),x.jsx(ou,{onClick:n,value:e,name:"homeLeave",children:"Wyjdź z domu"})]})}const ON="_form_1o1q4_1",FN={form:ON};function MN(){const{createData:n}=it();return _t({mutationFn:e=>n(be.changePassword,{current_password:e.currentPassword,new_password:e.newPassword,new_password2:e.newPassword2})})}function NN(){const[n,e]=C.useState(""),[t,r]=C.useState(""),[i,s]=C.useState(""),[a,o]=C.useState({}),l=MN();C.useEffect(()=>{if(l.isError){const c=l.error;if(!c.details)return;o(c.details)}},[l.error]);function u(c){c.preventDefault(),o({}),l.mutate({currentPassword:n,newPassword:t,newPassword2:i})}return x.jsx(Fi,{children:x.jsxs("form",{className:FN.form,onSubmit:u,children:[x.jsx(mr,{children:"Zmiana hasła"}),x.jsx(dn,{type:"password",name:"currentPassword",placeholder:"Obecne hasło",onChange:c=>e(c.target.value)}),x.jsx(Ne,{show:!!(a!=null&&a.current_password),type:"error",children:a.current_password}),x.jsx(dn,{type:"password",name:"newPassword",placeholder:"Nowe hasło",onChange:c=>r(c.target.value)}),x.jsx(dn,{type:"password",name:"newPassword2",placeholder:"Powtórz nowe hasło",onChange:c=>s(c.target.value)}),x.jsx(Ne,{show:!!(a!=null&&a.empty),type:"error",children:a.empty}),x.jsx(Ne,{show:!!(a!=null&&a.new_password2),type:"error",children:a.new_password2}),x.jsx(Ne,{show:l.isSuccess,type:"success",children:"Hasło zostało zmienione"}),x.jsx(Xe,{children:"Zapisz"})]})})}const UN="_container_1nv0z_1",$N="_message_1nv0z_19",BN="_pulse_1nv0z_1",jN={container:UN,message:$N,pulse:BN};function DT(){const{updateData:n,deleteData:e}=it();function t(){return _t({mutationFn:i=>n(be.home,{code:i})})}function r(){return _t({mutationFn:()=>e(be.home)})}return{updateHome:t,deleteHome:r}}function GN(){const[n,e]=C.useState(""),[t,r]=C.useState(""),{updateHome:i}=DT(),s=i(),a=s.error;C.useEffect(()=>{if(a){if(!a.details)return;r(a.details[Object.keys(a.details)[0]])}},[a]);function o(){if(r(""),n===""){r("Podaj kod domu");return}s.mutate(n)}return x.jsxs(Fi,{children:[x.jsx(mr,{children:"Zmiana domu"}),x.jsx("p",{className:jN.message,children:"Pamiętaj że po zmianie domu wszystkie urzeczy zapisane w domu zostą usunąte"}),x.jsx(dn,{type:"text",name:"homeCode",placeholder:"Kod domu",onChange:l=>e(l.target.value),error:t!==""}),x.jsx(Ne,{show:t!=="",type:"error",children:t}),x.jsx(Xe,{type:"danger",onClick:o,children:"Zmień"})]})}const VN="_container_ukza4_1",HN="_codeDisplay_ukza4_75",KN="_pulse_ukza4_1",zN={container:VN,codeDisplay:HN,pulse:KN};function WN(){const{readData:n}=it(),{data:e,status:t,isLoading:r}=gr({queryKey:["home_code"],queryFn:()=>n(be.home),staleTime:30});return{data:e,status:t,isLoading:r}}function qN(){const{data:n,status:e,isLoading:t}=WN();return t||n===void 0?x.jsx(Cn,{}):e==="error"?x.jsx("p",{children:"Wystąpił bład"}):x.jsxs("div",{className:zN.container,children:[x.jsx("p",{children:"Twój jednorazowy kod domu"}),n.data.code]})}function YN(){const{deleteHome:n}=DT(),e=n(),t=Kn();C.useEffect(()=>{e.isSuccess&&t("/")},[e.isSuccess]);function r(){e.mutate()}function i(){t("/")}return x.jsx(Ea,{name:"dom",onConfirm:r,onCancel:i})}function QN(){const[n,e]=C.useState("passwordChange"),r={passwordChange:x.jsx(NN,{}),homeChange:x.jsx(GN,{}),homeCode:x.jsx(qN,{}),homeLeave:x.jsx(YN,{})}[n]||null;return x.jsxs("div",{className:wN.container,children:[x.jsx(PN,{onChange:e,value:n}),r]})}const XN="_tile_xo108_1",ZN="_changeName_xo108_9",za={tile:XN,changeName:ZN,delete:"_delete_xo108_25"},JN="_changeName_1sa2l_1",e2="_formContainer_1sa2l_21",Fy={changeName:JN,formContainer:e2},t2="_container_z7bt8_1",n2={container:t2};function r2({onClose:n,onConfirm:e}){const[t,r]=C.useState("");function i(s){s.stopPropagation(),n()}return x.jsxs("section",{className:n2.container,children:[x.jsx(dn,{name:"nazwa",type:"text",placeholder:"Nazwa",onChange:s=>r(s.target.value)}),x.jsxs(zn,{children:[x.jsx(Xe,{onClick:()=>e(t),children:"Zapisz"}),x.jsx(Xe,{onClick:i,children:"Anuluj"})]})]})}function bT(){const{updateData:n,deleteData:e}=it(),t=Zt();function r(s){return _t({mutationFn:a=>n(`${be.device}${s}/`,a),onSuccess:async a=>{await Promise.all([t.invalidateQueries({queryKey:[rt.ROOMS]}),t.invalidateQueries({queryKey:[rt.DEVICES]}),t.invalidateQueries({queryKey:[rt.UNASSIGNED_DEVICE]})]);const o={type:"device",id:a.data.id,is_favourite:!0};$S(t,o,a.status)}})}function i(s){return _t({mutationFn:()=>e(`${be.device}${s}/`),onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:[rt.ROOMS]}),t.invalidateQueries({queryKey:[rt.DEVICES]})])}})}return{updateDevice:r,deleteDevice:i}}function kT(){const{updateData:n,deleteData:e}=it(),t=Zt();function r(s){return _t({mutationFn:a=>n(`${be.room}${s}/`,a),onSuccess:a=>{console.log(a),BS(t,a)}})}function i(s){return _t({mutationFn:()=>e(`${be.room}${s}/`),onSuccess:a=>{const o=t.getQueryData([rt.ROOMS]);if(!o)return;const l=o.data.filter(u=>u.id!==s);t.setQueryData([rt.ROOMS],{...o,data:l})}})}return{updateRoom:r,deleteRoom:i}}function PT({children:n,type:e,id:t,onSuccess:r}){var f,g;const[i,s]=C.useState(!1),{updateDevice:a}=bT(),o=a(t),{updateRoom:l}=kT(),u=l(t);C.useEffect(()=>{(o.isSuccess||u.isSuccess)&&(s(!1),r==null||r())},[o.isSuccess,u.isSuccess]),C.useEffect(()=>{o.reset(),u.reset()},[i]);function c(m){e==="device"?o.mutate({name:m}):e==="room"&&u.mutate({name:m})}const d=o.error,h=u.error;return x.jsxs("div",{className:Fy.changeName,onClick:()=>{s(!0)},children:[i&&x.jsxs("div",{className:Fy.formContainer,children:[x.jsx(r2,{onClose:()=>s(!1),onConfirm:c}),x.jsx(Ne,{show:!!(d!=null&&d.details),type:"error",children:(f=d==null?void 0:d.details)==null?void 0:f.non_field_errors}),x.jsx(Ne,{show:!!(h!=null&&h.details),type:"error",children:(g=h==null?void 0:h.details)==null?void 0:g.name})]}),!i&&n]})}function i2(){const n=Br(),e=parseInt(n.id?n.id:"0"),t=Kn(),[r,i]=C.useState(!1),[s,a]=C.useState(!1),[o,l]=C.useState(!1),{updateDevice:u,deleteDevice:c}=bT(),d=u(e),h=c(e);C.useEffect(()=>{(d.isSuccess||h.isSuccess)&&t("/",{replace:!0})},[d.isSuccess,h.isSuccess,t]);function f(){d.mutate({room:null})}function g(){h.mutate()}return x.jsxs(Pt,{children:[x.jsxs(pn,{title:"Ustawienia urzadzenia",children:[x.jsx(Ne,{type:"success",show:r,timeout:3e3,onTimeout:()=>i(!1),children:"Zmiana nazwy powiodła się"}),x.jsx(Xe,{type:"fancy",onClick:()=>t(-1),children:"Wróć"})]}),x.jsxs(Ur,{children:[x.jsx(Ue,{className:za.changeName,children:x.jsx(PT,{type:"device",id:e,onSuccess:()=>i(!0),children:"Zmień nazwę"})}),x.jsxs(Ue,{className:za.tile,type:"danger",children:[x.jsx("div",{className:za.delete,onClick:()=>a(!0),children:"Usuń z pokoju"}),x.jsx(Ea,{name:"z pokoju",onConfirm:f,onCancel:()=>a(!1),show:s})]}),x.jsxs(Ue,{className:za.tile,type:"danger",children:[x.jsx("div",{className:za.delete,onClick:()=>l(!0),children:"Usuń urządzenie"}),x.jsx(Ea,{name:"urządzenie",onConfirm:g,onCancel:()=>l(!1),show:o})]})]})]})}const s2="_tile_1k3z9_1",a2="_changeName_1k3z9_9",o2="_visibility_1k3z9_41",Ls={tile:s2,changeName:a2,delete:"_delete_1k3z9_25",visibility:o2};function l2(){const n=Br(),e=parseInt(n.id?n.id:"0"),{room:t}=HS(e),[r,i]=C.useState(!1),[s,a]=C.useState(!1),{deleteRoom:o,updateRoom:l}=kT(),u=o(e),c=l(e),d=Kn();function h(){u.mutate(),d("/",{replace:!0})}function f(){const g=t.visibility==="private"?"PU":"PR";console.log(g),c.mutate({visibility:g})}return x.jsxs(Pt,{children:[x.jsxs(pn,{title:"Ustawienia pokoju",children:[x.jsx(Ne,{type:"success",show:r,timeout:3e3,onTimeout:()=>i(!1),children:"Zmiana nazwy powiodła się"}),x.jsx(Xe,{type:"fancy",onClick:()=>d(-1),children:"Wróć"})]}),x.jsxs(Ur,{children:[x.jsx(Ue,{className:Ls.changeName,children:x.jsx(PT,{type:"room",id:e,onSuccess:()=>i(!0),children:"Zmień nazwę"})}),x.jsx(Ue,{className:Ls.tile,children:x.jsxs("div",{className:Ls.visibility,children:[x.jsx("div",{className:Ls.delete,onClick:f,children:"Zmień widoczność"}),x.jsx(Ne,{show:c.isSuccess,children:"Zmieniono widoczność pokoju"})]})}),x.jsxs(Ue,{className:Ls.tile,type:"danger",children:[x.jsx("div",{className:Ls.delete,onClick:()=>a(!0),children:"Usuń pokój"}),x.jsx(Ea,{name:"z pokoju",onConfirm:h,onCancel:()=>a(!1),show:s})]})]})]})}const u2=KA([{path:"/login/",element:x.jsx($I,{}),action:BI},{path:"/registration/",element:x.jsx(kI,{}),action:PI},{path:"/",element:x.jsx(mw,{}),children:[{path:"",element:x.jsx(HC,{})},{path:"/router/",element:x.jsx(mD,{})},{path:"room/",element:x.jsx(ID,{})},{path:"room/:id/",element:x.jsx(DD,{})},{path:"room/:id/add/",element:x.jsx(GD,{})},{path:"room/:id/settings/",element:x.jsx(l2,{})},{path:"aquarium/",element:x.jsx(WD,{})},{path:"aquarium/:id/",element:x.jsx(bb,{})},{path:"rfid/:id/",element:x.jsx(Jb,{})},{path:"lamp/",element:x.jsx(lk,{})},{path:"lamp/:id/",element:x.jsx(Rk,{})},{path:"button/:id/",element:x.jsx(Ik,{})},{path:"device/",element:x.jsx(wk,{})},{path:":deviceFun/:id/event/wizard/",element:x.jsx(Ok,{})},{path:":deviceFun/:id/settings/",element:x.jsx(i2,{})},{path:"camera/",element:x.jsx(RN,{})},{path:"settings/",element:x.jsx(QN,{})}]}]),c2=new RR;aS(document.getElementById("root")).render(x.jsx(C.StrictMode,{children:x.jsxs(bR,{client:c2,children:[!1,x.jsx(HR,{children:x.jsx(eR,{router:u2})})]})}));
